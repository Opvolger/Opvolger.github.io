<!doctype html>
<html>
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <meta name="generator" content="pandoc">
      <meta name="author" content="Bas Magré">
      <meta name="date" content="2013-nu">
      
      <title>Kodi - NPO Uitzendinggemist</title>
      <link rel="icon" href="/website-template/favicon.ico">
      <!-- Bootstrap -->
      <link rel="stylesheet" target="_blank" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
      <!-- Font-awesome -->
      <link rel="stylesheet" target="_blank" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
      <!-- Styles -->
      <link rel="stylesheet" href="/website-template/styles.css">
            <!-- Add favicon here -->
            <!-- Add site-verifications here -->
         </head>
   <body>
            <nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark">
                <!--<a class="navbar-brand" href="#">Navbar</a>-->
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                   <ul class="navbar-nav mr-auto">
                      <li class="nav-item active">
                         <a class="nav-link" href="/index.html">Me <span class="sr-only">(current)</span></a>
                      </li>
                      <!-- <li class="nav-item">
                         <a class="nav-link" href="#">Link</a>
                      </li> -->
                      <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarKODI" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Kodi Addons
                        </a>
                        <div class="dropdown-menu" aria-labelledby="navbarKODI">
                           <a class="dropdown-item" href="/kodi/npo.html">NPO Uitzending gemist</a>               
                           <a class="dropdown-item" href="/kodi/kanalenlijst-hans.html">De Transponder - Kanalenlijk (Hans)</a>
                           <div class="dropdown-divider"></div>
                           <a class="dropdown-item" href="/kodi/rtlxl.html">(Inactive) RTLxl</a>
                        </div>
                     </li>
                      <li class="nav-item dropdown">
                         <a class="nav-link dropdown-toggle" href="#" id="navbarSFVF2" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                         Starfive VisionFive 2
                         </a>
                         <div class="dropdown-menu" aria-labelledby="navbarSFVF2">
                            <a class="dropdown-item" href="/starfiveVisionFive2/UbuntuATIRadeonR9_290.html">Ubuntu 22.04 with ATI Radeon R9 290</a>
                            <a class="dropdown-item" href="/starfiveVisionFive2/FedoraATIRadeon5450.html">Fedora with ATI Radeon5450</a>
                            <a class="dropdown-item" href="/starfiveVisionFive2/UbuntuATIRadeonR9_290_2023_11_20.html">Ubuntu 23.10 with ATI Radeon R9 290</a>
                            <a class="dropdown-item" href="/starfiveVisionFive2/OpenSUSEATIRadeonR9_290.html">OpenSUSE Tumbleweed ATI Radeon R9 290</a>
                            <a class="dropdown-item" href="/starfiveVisionFive2/OpenSUSEATIRadeonR9_290_mainline.html">OpenSUSE Tumbleweed ATI Radeon R9 290</a>
                            <!-- <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="#">Something else here</a> -->
                         </div>
                      </li>
                      <!-- <li class="nav-item">
                         <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Disabled</a>
                      </li> -->
                   </ul>
                   <div class="menu-icons">
                     <a class="menu-icon" target="_blank" href="https://github.com/Opvolger" target="_blank"><i class="fa fa-github fa-2x"></i></a>
                     <a class="menu-icon" target="_blank" href="https://www.twitter.com/Opvolger" target="_blank"><i class="fa fa-twitter fa-2x"></i></a>
                     <a class="menu-icon" href="mailto:Opvolger@gmail.com"><i class="fa fa-at fa-2x"></i></a>
                     <a class="menu-icon" target="_blank" href="https://www.linkedin.com/in/bas-magr%C3%A9-67234222/" target="_blank"><i class="fa fa-linkedin fa-2x"></i></a>
                     <a class="menu-icon" target="_blank" href="https://www.youtube.com/@justanotherdevopsguy" target="_blank"><i class="fa fa-youtube fa-2x"></i></a>
                     <a class="menu-icon" target="_blank" href="https://www.youtube.com/@opvolger" target="_blank"><i class="fa fa-youtube fa-2x"></i></a>
                  </div>

                   <!-- <form class="form-inline my-2 my-lg-0">
                      <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
                      <button class="btn btn-outline-info my-2 my-sm-0" type="submit">Search</button>
                   </form> -->
                </div>
             </nav>
            <div class="container">
         <p class="date">2013-nu - Bas Magré</p>
         <!-- <h1 class="title">Kodi - NPO Uitzendinggemist</h1> -->
                  <div class="row">
            <div class="col-xl-10"><h1
id="kodi-addon---npo-uitzending-gemist">Kodi addon - NPO Uitzending
gemist</h1>
<p>Een stukje uitleg over het hoe en waarom van de addon <a
target="_blank" href="https://github.com/Opvolger/plugin.video.uzg">plugin.video.uzg</a>
voor Kodi. Deze blijf ik aanvullen als er (grote) dingen veranderen.</p>
<h2 id="waarom">Waarom</h2>
<p>Omdat ik had besloten de “kabel” eruit “te gooien”, omdat ik geen zin
meer had in betaald reclame te kijken en alles was van het zelfde op
t.v. Netflix kwam toen net in Nederland en ik dacht: “Ik doe het gewoon,
ik gooi de kabel er uit”. Ik had een “Smart” TV welke RTL-XL en NPO
uitzendingen terug kon kijken (zonder reclame) en film van Netflix.
Prima. Google Chromecast + Kodi op een Raspberry Pi. Alles opgelost
dacht ik.</p>
<p>Helaas 2 maanden nadat ik mijn kabel opzeg, veranderd de “API” van
RTL-XL en weer 4 maanden later die van NPO. Kortom, ik kon dit niet meer
kijken op mijn “Smart” TV.</p>
<h2 id="oplossing">Oplossing</h2>
<p>Kodi gebruikte ik al jaren voor mijn series en films te kijken
(legaal! ik heb de DVD’s/Blu-Ray’s in de kast staan). Na het opzeggen
van de kabel had ik ook tvheadend met een dvb-t USB ontvanger
geconfigureerd met Kodi. Zodat ik in het hele huis Nederland 1/2/3 en TV
Gelderland kon kijken. Ik kan vanuit mijn werk uit aardig programmeren,
dus het lag nu voor de hand om een add-on te maken in Kodi voor NPO en
RTL-XL. Beide add-ons aangemeld bij Kodi en ze zijn jaren lang een
“Officiële” addon geweest, deze was dus te downloaden uit de repository
van Kodi zelf.</p>
<h2 id="uitwerking">Uitwerking</h2>
<p>Hoe start je nu zo iets? Het was vroeger wat meer zoek werk, maar je
kan het allemaal vinden op de wiki pagina van Kodi, nu hebben ze erg
goede uitlegt hoe je moet beginnen. Nu dus de taal python nog even leren
(lees google elke actie welke je wil doen) en achterhalen hoe je video’s
ophaalt bij NPO. Dat laatste ging vroeger erg makkelijk, dat deed je als
volgend:</p>
<p>Zet een “Zed Attack Proxy” op je pc Stel het juiste IP-Adres in (van
je locale netwerk) “ZAP &gt; Tools &gt; Options &gt; Local Proxies” Op
een Android telefoon (emulator of echte), zet je de NPO App er op. Zorg
ervoor dat je telefoon via de proxy loop (Ga naar “advanced options” van
je Wifi connection) of je emulator opstart met “-http-proxy
http://xx.xxx.xx.xx:8080” Klaar! Als je verkeer loopt nu via je pc, je
ziet alle aanvragen van de app. Alles ging over http, hier kon je zien
hoe de “API” werkte en deze “op de zelfde manier” toepassen in python.
Je moest alleen even aansluiten om de “API” van Kodi en klaar. Dit
klinkt natuurlijk makkelijker dan het is, maar daar komt het in het kort
wel op neer. Dit alles is gemaakt november 2013 t/m januari 2014. De
code aangeboden aan Kodi met een pull request en na wat kleine
aanpassingen geaccepteerd!</p>
<h2 id="tegenslag-stoppen-publieke-addon">Tegenslag / Stoppen publieke
addon</h2>
<p>Maar helaas kwam daar na 5 jaar in eind november 2018 een einde aan.
De NPO had namelijk de voorwaarden aangepast. Zover ik het nu kan lezen
mag er geen publieke plugins/addons meer gemaakt worden. Gelukkig mag
dit nog wel steeds voor eigen gebruik, er staat nergens dat dit niet
mag! De app was ook “verbeterd”, je kan niet meer al het verkeer
aftappen. Nu liep al het verkeer netjes via https, maar op Android
Telefoons van versie 5 en lager, kan zelf “root” certificaten toevoegen.
Dus we gingen naar “ZAP &gt; Tools &gt; Options &gt; Dynamic SSL
Certificates” en exporteerde het certificaat. We zette deze op de
Android telefoon en al het verkeer was weer leesbaar.</p>
<p>Wat je hier doet, is al je verkeer via je proxy laten lopen, op je pc
ook “decoderen” en opnieuw “coderen” mijn jouw certificaat. Je kan
namelijk niet het certificaat van NPO gebruiken, je hebt immers de
“private-key/geheime sleutel” niet. Je doet letterlijk een
man-in-the-middle attack.</p>
<p>De Api was totaal veranderd, tevens de voorwaarden. Volgens de nieuwe
voorwaarden mocht wat ik deed helaas niet meer. Netjes een verzoek
gedaan bij Kodi om mijn addon “broken” te melden.</p>
<p>Natuurlijk kon ik privé gewoon doorgaan met mijn addon.</p>
<h2 id="drm">DRM</h2>
<p>Alsof de tegenslag van november 2018 nog niet genoeg was, maart 2019
ging NPO over op DRM. Alles werkte nog, behalve de video-stream
uitvragen. Dit moest ik dus weer uitzoeken. De app was nog beter
beveiligt, ze doen nu aan “Certificate Pinning”, kortom je kan er niet
tussen in gaan zitten met je eigen zap-ssl-certificaat. Dit was niet zo
fijn. Uiteindelijk de Andoid App van de NPO moeten decompilen. Gelukkig
kan dit online (hoef je de tools niet te instaleren). Helaas hadden ze
gebruik gemaakt van “code obfuscation (niet leesbaar maken van code)”,
maar dat weerhield mij niet. Het koste mij alleen wat meer tijd. Ik kwam
er achter hoe de video’s nu werden opgevraagd, met deze informatie kon
ik mijn addon weer aanpassen.</p>
<p>Code uit de Android App</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">NedforceCatalog</span><span class="op">(</span>OkHttpClient okHttpClient<span class="op">,</span> NpoPlayerConfig npoPlayerConfig<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">_httpClient</span> <span class="op">=</span> okHttpClient<span class="op">;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">_config</span> <span class="op">=</span> npoPlayerConfig<span class="op">;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">switch</span> <span class="op">(</span><span class="kw">this</span><span class="op">.</span><span class="fu">_config</span><span class="op">.</span><span class="fu">getEnvironment</span><span class="op">())</span> <span class="op">{</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> <span class="dv">1</span><span class="op">:</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>                okHttpClient <span class="op">=</span> <span class="st">&quot;https://api.npobeta.nl&quot;</span><span class="op">;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> <span class="dv">2</span><span class="op">:</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>                okHttpClient <span class="op">=</span> <span class="st">&quot;https://start-api.npo.nl&quot;</span><span class="op">;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>            <span class="kw">default</span><span class="op">:</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>                okHttpClient <span class="op">=</span> <span class="st">&quot;https://npo-api.staging.egeniq.com&quot;</span><span class="op">;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">_baseUrl</span> <span class="op">=</span> HttpUrl<span class="op">.</span><span class="fu">parse</span><span class="op">(</span>okHttpClient<span class="op">);</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>en</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">getStreamForAsset</span><span class="op">(</span><span class="dt">final</span> <span class="bu">String</span> str<span class="op">,</span> <span class="bu">String</span> str2<span class="op">,</span> <span class="bu">String</span> str3<span class="op">,</span> <span class="dt">boolean</span> z<span class="op">,</span> <span class="dt">boolean</span> z2<span class="op">,</span> <span class="dt">int</span> i<span class="op">,</span> <span class="dt">final</span> CatalogCallback<span class="op">&lt;</span>NpoStream<span class="op">&gt;</span> catalogCallback<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        HttpUrl build <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">_baseUrl</span><span class="op">.</span><span class="fu">newBuilder</span><span class="op">().</span><span class="fu">addPathSegment</span><span class="op">(</span><span class="st">&quot;media&quot;</span><span class="op">).</span><span class="fu">addPathSegment</span><span class="op">(</span>str<span class="op">).</span><span class="fu">addPathSegment</span><span class="op">(</span><span class="st">&quot;stream&quot;</span><span class="op">).</span><span class="fu">build</span><span class="op">();</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>        JSONObject jSONObject <span class="op">=</span> <span class="kw">new</span> <span class="fu">JSONObject</span><span class="op">();</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        JSONObject jSONObject2 <span class="op">=</span> <span class="kw">new</span> <span class="fu">JSONObject</span><span class="op">();</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span> <span class="op">{</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>            jSONObject<span class="op">.</span><span class="fu">put</span><span class="op">(</span>Scopes<span class="op">.</span><span class="fu">PROFILE</span><span class="op">,</span> str2<span class="op">);</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>            str2 <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>z<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>                jSONObject2<span class="op">.</span><span class="fu">put</span><span class="op">(</span><span class="st">&quot;startOver&quot;</span><span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>            jSONObject<span class="op">.</span><span class="fu">put</span><span class="op">(</span><span class="st">&quot;options&quot;</span><span class="op">,</span> jSONObject2<span class="op">);</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(!</span>TextUtils<span class="op">.</span><span class="fu">isEmpty</span><span class="op">(</span>str3<span class="op">))</span> <span class="op">{</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>                jSONObject<span class="op">.</span><span class="fu">put</span><span class="op">(</span><span class="st">&quot;ageRestriction&quot;</span><span class="op">,</span> str3<span class="op">);</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>z2<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">(</span><span class="kw">this</span><span class="op">.</span><span class="fu">_config</span> <span class="op">==</span> <span class="kw">null</span> <span class="op">||</span> <span class="kw">this</span><span class="op">.</span><span class="fu">_config</span><span class="op">.</span><span class="fu">getPlayerOptions</span><span class="op">()</span> <span class="op">==</span> <span class="kw">null</span> <span class="op">||</span> TextUtils<span class="op">.</span><span class="fu">isEmpty</span><span class="op">(</span><span class="kw">this</span><span class="op">.</span><span class="fu">_config</span><span class="op">.</span><span class="fu">getPlayerOptions</span><span class="op">().</span><span class="fu">getEncryptionType</span><span class="op">())</span> <span class="op">!=</span> <span class="kw">null</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>                    GlobalLogger<span class="op">.</span><span class="fu">m6738a</span><span class="op">().</span><span class="fu">m6749b</span><span class="op">(</span>TAG<span class="op">,</span> <span class="st">&quot;skipCatalog = true requires to provide a DRM type!&quot;</span><span class="op">);</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>                    jSONObject<span class="op">.</span><span class="fu">put</span><span class="op">(</span><span class="st">&quot;skipCatalog&quot;</span><span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>                    jSONObject<span class="op">.</span><span class="fu">put</span><span class="op">(</span><span class="st">&quot;useEncryption&quot;</span><span class="op">,</span> <span class="kw">this</span><span class="op">.</span><span class="fu">_config</span><span class="op">.</span><span class="fu">getPlayerOptions</span><span class="op">().</span><span class="fu">getEncryptionType</span><span class="op">());</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>            jSONObject<span class="op">.</span><span class="fu">put</span><span class="op">(</span><span class="st">&quot;hasSubscription&quot;</span><span class="op">,</span> i <span class="op">!=</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>            str3 <span class="op">=</span> <span class="st">&quot;hasPremiumSubscription&quot;</span><span class="op">;</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span><span class="dv">2</span> <span class="op">!=</span> i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>                str2 <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>            jSONObject<span class="op">.</span><span class="fu">put</span><span class="op">(</span>str3<span class="op">,</span> str2<span class="op">);</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>            jSONObject<span class="op">.</span><span class="fu">put</span><span class="op">(</span><span class="st">&quot;platform&quot;</span><span class="op">,</span> <span class="dv">2</span> <span class="op">==</span> i <span class="op">?</span> Plan<span class="op">.</span><span class="fu">PREMIUM</span> <span class="op">:</span> <span class="st">&quot;npo&quot;</span><span class="op">);</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>            <span class="kw">this</span><span class="op">.</span><span class="fu">_httpClient</span><span class="op">.</span><span class="fu">newCall</span><span class="op">(</span><span class="kw">new</span> <span class="fu">Builder</span><span class="op">().</span><span class="fu">url</span><span class="op">(</span>build<span class="op">).</span><span class="fu">post</span><span class="op">(</span>RequestBody<span class="op">.</span><span class="fu">create</span><span class="op">(</span>HttpClient<span class="op">.</span><span class="fu">f5884b</span><span class="op">,</span> jSONObject<span class="op">.</span><span class="fu">toString</span><span class="op">())).</span><span class="fu">build</span><span class="op">()).</span><span class="fu">enqueue</span><span class="op">(</span><span class="kw">new</span> <span class="bu">Callback</span><span class="op">()</span> <span class="op">{</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>                <span class="kw">public</span> <span class="dt">void</span> <span class="fu">onFailure</span><span class="op">(</span>Call call<span class="op">,</span> <span class="bu">IOException</span> iOException<span class="op">)</span> <span class="op">{</span></span></code></pre></div>
<p>Gelukkig was Kodi 18 net uit en daar kon je streams met DRM bekijken!
Dus een paar avonden uitzoeken hoe je dat moest aanroepen en we konden
weer video’s opstarten.</p>
<h2 id="security-bug-2019-2023">Security BUG (2019-2023)</h2>
<p>Toen ik bezig was met uitzoeken hoe de “API’s” nu werkte. Ja API’s
want de lijst met programma’s en afleveringen staat helemaal los van de
uitvraag van de video-streams. Hierin zit dus ook een
beveiligingsprobleem. de uitvraag voor de video-stream heeft geen kennis
van de “API” van de NPO. Ook niet of je nu wel of geen “Premium” account
hebt. (Lees NPO-plus). Kortom, je kan dus ZONDER dat je NPO-Plus account
hebt WEL een NPO-Plus video opvragen. Vrij makkelijk zelfs, je past even
een switch aan van “false” naar “true” in je bericht en klaar.
Natuurlijk heb ik dit eerst netjes gemeld bij de NPO helemaal niks meer
gehoord. Een direct gericht via Twitter, geen response en publiek
bericht via twitter, geen reactie. Een bericht via Facebook, een hele
korte reactie van “We zullen het doorgeven…” Toen kwam ik deze pagina
tegen bij de NPO <a
target="_blank" href="https://over.npo.nl/organisatie/privacy-en-security/responsible-disclosure">link</a>.
Hier wilde ik wel in komen te staan!, een mail naar de NPO dan maar in
maart, april en in mei…, allemaal niks meer van gehoord.</p>
<p>Dus hier het beveiliging lek, ik vraag hier een video-stream op van
“De Luizenmoeder”. Welke ik netjes terug krijg. Ook al mijn andere
uitvragen komen nu met een 720p-stream terug i.p.v. een SD-stream. <img
src="images/hack-npo.jpeg" alt="hack NPO" /></p>
<p>Voor de netheid de “bug” niet doorgevoerd in mijn addon, maar dat is
met 2 regels aanpassen wel te doen :)</p>
<p>Update: uiteindelijk november 2019 is de bug herkend en zijn er
excuses gemaakt dat er zo traag gereageert was! alleen is de bug nooit
opgelost. 1 december 2023 heeft de NPO een totaal andere API genomen,
hierdoor werkt de “hack” niet meer.</p>
<h2 id="update-december-2023">Update december 2023</h2>
<p>Ze hebben in december 2023 de hele api vervangen, ik heb de hele
addon opnieuw mogen schrijven. Helaas geen “gratis” NPO-plus meer, maar
nog steeds uitzending gemist op Kodi.</p></div>
            <div class="d-none d-xl-block col-xl-2 bd-toc">
               <ul class="section-nav">
                  <li class="toc-entry"><ul>
<li><a href="#kodi-addon---npo-uitzending-gemist"
id="toc-kodi-addon---npo-uitzending-gemist">Kodi addon - NPO Uitzending
gemist</a>
<ul>
<li><a href="#waarom" id="toc-waarom">Waarom</a></li>
<li><a href="#oplossing" id="toc-oplossing">Oplossing</a></li>
<li><a href="#uitwerking" id="toc-uitwerking">Uitwerking</a></li>
<li><a href="#tegenslag-stoppen-publieke-addon"
id="toc-tegenslag-stoppen-publieke-addon">Tegenslag / Stoppen publieke
addon</a></li>
<li><a href="#drm" id="toc-drm">DRM</a></li>
<li><a href="#security-bug-2019-2023"
id="toc-security-bug-2019-2023">Security BUG (2019-2023)</a></li>
<li><a href="#update-december-2023" id="toc-update-december-2023">Update
december 2023</a></li>
</ul></li>
</ul></li>
               </ul>
            </div>
         </div>
               </div>
            <!-- Add comment hosting service here -->
            <!-- Footer -->
            <footer class="footer text-muted">
                <div align="center">
                   <!-- Update licences -->
                   Content is available under <a target="_blank" href="https://creativecommons.org/licenses/by-sa/3.0/" target="_blank" rel="noopener">CC BY-SA 3.0</a>
                   &nbsp;|&nbsp;
                   Sourcecode licensed under <a target="_blank" href="https://www.gnu.org/licenses/gpl-3.0.en.html" target="_blank" rel="noopener">GPL-3.0</a>
                   <br />
                   <!-- Please keep the following line -->
                   Built with <a target="_blank" href="https://www.pandoc.org" target="_blank" rel="noopener">Pandoc</a> 
                   using <a target="_blank" href="https://github.com/ashki23/pandoc-bootstrap" target="_blank" rel="noopener">pandoc-bootstrap</a> theme
                   <br />
                   <!-- Update copyright -->
                   Copyright, Bas Magr&eacute;
                </div>
             </footer>
             <!-- Add global site tag (gtag.js) and site analytics here -->
            <!-- JS, Popper.js, and jQuery -->
      <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
      <!-- Mathjax -->
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script>
         /* Bootstrap styles to tables */
         function bootstrapStylePandocTables() {
         $('tr.header').parent('thead').parent('table').addClass('table table-condensed'); }
         $(document).ready(function () { bootstrapStylePandocTables(); });
         /* Adjust the height when click the toc */
         var shiftWindow = function() { scrollBy(0, -60) };
         window.addEventListener("hashchange", shiftWindow);
         function load() { if (window.location.hash) shiftWindow(); }
      </script>
   </body>
</html>