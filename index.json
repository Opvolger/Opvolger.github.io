
[{"content":" Intro # On FOSDEM 2026 I say a presentation from Tom Wieczorek on RISC-V support for k0s. k0s is the simple, solid \u0026amp; certified Kubernetes distribution that works on any infrastructure: bare-metal, on-premises, edge, IoT, public \u0026amp; private clouds. It\u0026rsquo;s 100% open source \u0026amp; free. You can now compile and run it for RISC-V üòÉ, it has no binaries yet on the release files (no RISC-V runners on github üòê ). K0s is very empty after the default setup. k3s has default a csi provider for local storage, but k0s doesn\u0026rsquo;t. So I thought, how hard can it be, creating the csi provider for RISC-V nodes.\nChoice SMB of ISCSI # I have ISCSI and SMB on my network (synology nas). SMB is a microsoft protocol and has not the linux file permissions, so I thought first: I will compile the csi for iscsi, but there is (still) no official release. So I started with the csi for smb.\nI soon discovered that the Docker images I wanted to create for RISC-V were all based on Debian bookworm, which didn\u0026rsquo;t support RISC-V. So I patched the Docker files so they used a different base image (Debian trixie) for only RISC-V.\nFor some projects, I also had to patch the Makefiles, but usually, the modification the dockerfile only for RISC-V was enough!\nProject # I created a new github repo for my project: k8s-csi-driver-riscv64. It is not more than some patches and a makefile. It build docker images and push them. You can set your docker username or repo and username as variable, login with docker and start the build.\nImages # All the images needed for a working CSI provider (SMB) in Kubernetes are now present under my user on docker.\nInstall the CSI provider on your cluster # On the project readme-file can you see how you can install the helm-chart for the csi provider (SMB).\nIt is working # Here you see (debug kernel options, riscv64 with serial output)\nsfvf2lite login: opvolger Password: Linux sfvf2lite 6.19.0 #4 SMP PREEMPT_DYNAMIC Wed Feb 11 17:55:54 CET 2026 riscv64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. opvolger@sfvf2lite:~$ [ 47.494639] kube-bridge: port 1(vethdc1c21c8) entered blocking state [ 47.515393] kube-bridge: port 1(vethdc1c21c8) entered disabled state [ 47.544599] vethdc1c21c8: entered allmulticast mode [ 47.558788] vethdc1c21c8: entered promiscuous mode [ 47.565077] kube-bridge: port 2(veth51f3ed1e) entered blocking state [ 47.579886] kube-bridge: port 2(veth51f3ed1e) entered disabled state [ 47.588358] veth51f3ed1e: entered allmulticast mode [ 47.604744] veth51f3ed1e: entered promiscuous mode [ 47.668459] kube-bridge: port 1(vethdc1c21c8) entered blocking state [ 47.674916] kube-bridge: port 1(vethdc1c21c8) entered forwarding state [ 47.754553] kube-bridge: port 2(veth51f3ed1e) entered blocking state [ 47.761010] kube-bridge: port 2(veth51f3ed1e) entered forwarding state [ 71.231896] CIFS: No dialect specified on mount. Default has changed to a more secure dialect, SMB2.1 or later (e.g. SMB3.1.1), from CIFS (SMB1). To use the less secure SMB1 dialect to access old servers which do not support SMB3.1.1 (or even SMB3 or SMB2.1) specify vers=1.0 on mount. [ 71.257182] CIFS: enabling forceuid mount option implicitly because uid= option is specified [ 71.265666] CIFS: enabling forcegid mount option implicitly because gid= option is specified [ 71.274146] CIFS: Attempting to mount //192.168.2.203/kubernetes ü•≥\nYoutube demo # SMB-Share used in RISC-V Kubernetes cluster\n","date":"9 February 2026","externalUrl":null,"permalink":"/posts/risc-v/2026-02-09-kubernetes-riscv-csi-provider-smb/","section":"Posts","summary":"","title":"Building RISC-V Docker images for CSI provider (SMB)","type":"posts"},{"content":"","date":"9 February 2026","externalUrl":null,"permalink":"/categories/","section":"Categories","summary":"","title":"Categories","type":"categories"},{"content":"","date":"9 February 2026","externalUrl":null,"permalink":"/tags/k0s/","section":"Tags","summary":"","title":"K0s","type":"tags"},{"content":"","date":"9 February 2026","externalUrl":null,"permalink":"/tags/kubernetes/","section":"Tags","summary":"","title":"Kubernetes","type":"tags"},{"content":"","date":"9 February 2026","externalUrl":null,"permalink":"/","section":"Opvolger","summary":"","title":"Opvolger","type":"page"},{"content":"","date":"9 February 2026","externalUrl":null,"permalink":"/posts/","section":"Posts","summary":"","title":"Posts","type":"posts"},{"content":"","date":"9 February 2026","externalUrl":null,"permalink":"/categories/risc-v/","section":"Categories","summary":"","title":"RISC-V","type":"categories"},{"content":"","date":"9 February 2026","externalUrl":null,"permalink":"/tags/risc-v/","section":"Tags","summary":"","title":"RISC-V","type":"tags"},{"content":"","date":"9 February 2026","externalUrl":null,"permalink":"/tags/","section":"Tags","summary":"","title":"Tags","type":"tags"},{"content":"","date":"19 December 2025","externalUrl":null,"permalink":"/tags/k3s/","section":"Tags","summary":"","title":"K3s","type":"tags"},{"content":" Intro # I have now 3 StarFive VisionFive 2 (Lite).\nStarFive VisionFive 2 (kickstarter long time ago) StarFive VisionFive 2 Lite (kickstarter short time ago) StarFive VisionFive 2 Lite (send to my from StarFive, THNX!) I already had ordered my StarFive VisionFive 2 Lite and StarFive contacted me, if I wanted a board for testing and reviewing. So I said, \u0026ldquo;I\u0026rsquo;ve already ordered one.\u0026rdquo; But StarFive wanted to send me one anyway. \u0026ldquo;That\u0026rsquo;s great,\u0026rdquo; I said, \u0026ldquo;then I can create a Kubernetes cluster.\u0026rdquo; That\u0026rsquo;s how this challenge came about.\nIs there a out of the box kubernetes for RISC-V? # Solokube # Yes! There is Solokube, but that only works for a single node. I want a multi node cluster.\nk3s # But after some searching around, I found this pull-request on k3s. That let me to this github repo. So I forked it, created a new branch, pulled the latest changes from k3s main and merged his release branch in it. This worked! (after one little fix). So I created my own k3s-riscv64 bin file! See my repo.\nRunning k3s on my StarFive VisionFive 2 Lite # First i tried the StarFive Debian image. I copied the binary file and and and\u0026hellip; It didn\u0026rsquo;t work :(\nI known about this script check-config.sh from docker. Here you can check if your kernel has all the options needed to run docker. So I found out about this command ./k3s-riscv64 check-config.\ncat: /sys/kernel/security/apparmor/profiles: No such file or directory Verifying binaries in /var/lib/rancher/k3s/data/b43a475215976c5e56ad3e2fbc248ae845a7b93a49d328091377e8efc6fe5981/bin: - sha256sum: good - links: good System: - /var/lib/rancher/k3s/data/b43a475215976c5e56ad3e2fbc248ae845a7b93a49d328091377e8efc6fe5981/bin/aux/iptables: unknown version: - swap: disabled - routes: ok Limits: - /proc/sys/kernel/keys/root_maxkeys: 1000000 info: reading kernel config from /proc/config.gz ... Generally Necessary: - cgroup hierarchy: cgroups V2 mounted, cpu|cpuset|memory controllers status: good - CONFIG_NAMESPACES: enabled - CONFIG_NET_NS: enabled - CONFIG_PID_NS: enabled - CONFIG_IPC_NS: enabled - CONFIG_UTS_NS: enabled - CONFIG_CGROUPS: enabled - CONFIG_CGROUP_PIDS: enabled - CONFIG_CGROUP_CPUACCT: enabled - CONFIG_CGROUP_DEVICE: enabled - CONFIG_CGROUP_FREEZER: enabled - CONFIG_CGROUP_SCHED: enabled - CONFIG_CPUSETS: enabled - CONFIG_MEMCG: enabled - CONFIG_SECCOMP: enabled - CONFIG_KEYS: enabled - CONFIG_VETH: enabled - CONFIG_BRIDGE: enabled - CONFIG_BRIDGE_NETFILTER: enabled - CONFIG_IP_NF_FILTER: enabled - CONFIG_IP_NF_TARGET_MASQUERADE: enabled - CONFIG_IP_NF_TARGET_REJECT: enabled - CONFIG_NETFILTER_XT_MATCH_ADDRTYPE: enabled - CONFIG_NETFILTER_XT_MATCH_CONNTRACK: enabled - CONFIG_NETFILTER_XT_MATCH_IPVS: enabled - CONFIG_NETFILTER_XT_MATCH_COMMENT: missing (fail) - CONFIG_NETFILTER_XT_MATCH_MULTIPORT: enabled - CONFIG_NETFILTER_XT_MATCH_STATISTIC: missing (fail) - CONFIG_IP_NF_NAT: enabled - CONFIG_NF_NAT: enabled - CONFIG_POSIX_MQUEUE: enabled Optional Features: - CONFIG_USER_NS: enabled - CONFIG_BLK_CGROUP: enabled - CONFIG_BLK_DEV_THROTTLING: enabled - CONFIG_CGROUP_PERF: enabled - CONFIG_CGROUP_HUGETLB: enabled - CONFIG_NET_CLS_CGROUP: enabled - CONFIG_CGROUP_NET_PRIO: enabled - CONFIG_CFS_BANDWIDTH: enabled - CONFIG_FAIR_GROUP_SCHED: enabled - CONFIG_RT_GROUP_SCHED: missing - CONFIG_IP_NF_TARGET_REDIRECT: enabled - CONFIG_IP_SET: missing - CONFIG_IP_VS: enabled - CONFIG_IP_VS_NFCT: enabled - CONFIG_IP_VS_PROTO_TCP: enabled - CONFIG_IP_VS_PROTO_UDP: enabled - CONFIG_IP_VS_RR: enabled - CONFIG_EXT4_FS: enabled - CONFIG_EXT4_FS_POSIX_ACL: enabled - CONFIG_EXT4_FS_SECURITY: enabled - Network Drivers: - \u0026#34;overlay\u0026#34;: - CONFIG_VXLAN: enabled Optional (for encrypted networks): - CONFIG_CRYPTO: enabled - CONFIG_CRYPTO_AEAD: enabled - CONFIG_CRYPTO_GCM: enabled - CONFIG_CRYPTO_SEQIV: enabled - CONFIG_CRYPTO_GHASH: enabled - CONFIG_XFRM: enabled - CONFIG_XFRM_USER: enabled - CONFIG_XFRM_ALGO: enabled - CONFIG_INET_ESP: enabled - CONFIG_INET_XFRM_MODE_TRANSPORT: missing - Storage Drivers: - \u0026#34;overlay\u0026#34;: - CONFIG_OVERLAY_FS: enabled STATUS: 2 (fail) I am missing CONFIG_NETFILTER_XT_MATCH_COMMENT and CONFIG_NETFILTER_XT_MATCH_STATISTIC. So i need to build my own kernel with that options enabled!\nI already have done a howto compiling a kernel for the StarFive VisionFive 2 Lite here. But almost everything is already in the kernel 6.19-rc1 (latest kernel when I was making this), Only a patch for the PCIe is missing.\nSo I compiled my own kernel 6.19-rc1 with the patch and all the options needed.\nInstall k3s # For the server node\n# On the one of my risc-v machine with ip 192.168.2.30: wget https://raw.githubusercontent.com/Opvolger/k3s/refs/heads/release-1.34-riscv/install.sh chmod +x install.sh sudo GITHUB_URL=https://github.com/Opvolger/k3s/releases INSTALL_K3S_VERSION=v1.34-1 ./install.sh For the other agent nodes, replace the token for the token from the server (/var/lib/rancher/k3s/server/token).\n# On the other two of my risc-v machines, that will connect to ip 192.168.2.30: wget https://raw.githubusercontent.com/Opvolger/k3s/refs/heads/release-1.34-riscv/install.sh chmod +x install.sh sudo GITHUB_URL=https://github.com/Opvolger/k3s/releases INSTALL_K3S_VERSION=v1.34-1 INSTALL_K3S_EXEC=\u0026#34;agent --server https://192.168.2.30:6443 --token K105aa9e1f8a944fa6f1d8641b3c4e19cf962d943f56168d9441ff749b3014bdbae::server:281ceb4f9e6aaabdd0363c77991bf31e \u0026#34; ./install.sh Fix Kube config # Get the /etc/rancher/k3s/k3s.yaml from the server node and copy it in your main machine .kube/config if you don\u0026rsquo;t have one or merge the configs by hand. Change the ip address to what is the ip of your master node. In my case 192.168.2.30\nMy .kube/config looks something like this. (i renamed the cluster to riscv and had already the clusters local and nipogi).\napiVersion: v1 clusters: - cluster: certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0t server: https://127.0.0.1:6443 name: localhost - cluster: certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk server: https://192.168.2.201:6443 name: nipogi - cluster: certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJk server: https://192.168.2.30:6443 name: riscv contexts: - context: cluster: localhost user: localhost name: localhost - context: cluster: nipogi user: nipogi name: nipogi - context: cluster: riscv user: riscv name: riscv current-context: riscv kind: Config preferences: {} users: - name: localhost user: client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJra client-key-data: LS0tLS1CRUdJTiBFQyBQUklWQVRFIEtFWS0tLS0t - name: nipogi user: client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJrVENDQVR client-key-data: LS0tLS1CRUdJTiBFQyBQUklWQVRFIEtFWS0tLS0tCk1IY0NBUUVFSVBTa - name: riscv user: client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJrRENDQVRlZ0F3SUJ client-key-data: LS0tLS1CRUdJTiBFQyBQUklWQVRFIEtFWS0tLS0tCk1IY0NBUUVFSUpNK0NoMksvdWw0YmZRR3E3bnJQN kubectl get pods -A -o wide kubectl get nodes -o wide add DNS to your /etc/hosts # I want to test the ingress of my cluster, so I added a line to my /etc/hosts to simulate that the DNS is working :)\n# Loopback entries; do not change. # For historical reasons, localhost precedes localhost.localdomain: 127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 ::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 # See hosts(5) for proper format and other examples: # 192.168.1.10 foo.mydomain.org foo # 192.168.1.13 bar.mydomain.org bar 192.168.2.27 jenkins.k8s.riscv.net Install Jenkins helm-chart # See the github repo from jenkins helm-chart\n# On my main machine helm repo add jenkins https://charts.jenkins.io helm repo update kubectl create namespace jenkins helm install jenkins jenkins/jenkins -n jenkins It will not start up, there is no RISC-V image (yet).\n# On my main machine kubectl get pods -o wide -n jenkins kubectl get event --namespace jenkins --field-selector involvedObject.name=jenkins-0 Failed to pull image \u0026#34;docker.io/kiwigrid/k8s-sidecar:1.30.7\u0026#34;: rpc error: code = NotFound desc = failed to pull and unpack image \u0026#34;docker.io/kiwigrid/k8s-sidecar:1.30.7\u0026#34;: no match for platform in manifest: not found The project has no risc-v support, we need to build/push it\n# On the risc-v machine: git clone https://github.com/kiwigrid/k8s-sidecar.git cd k8s-sidecar git checkout 1.30.7 sudo docker build . -t opvolger/k8s-sidecar:1.30.7 sudo docker push opvolger/k8s-sidecar:1.30.7 I started to make a value.yaml for the values I want to change.\ncontroller: sidecars: configAutoReload: image: repository: opvolger/k8s-sidecar tag: 1.30.7 So the sidecar container was working, but now we have the next problem, jenkins image has not a risc-v arch image.\n# On my main machine helm uninstall jenkins -n jenkins helm install jenkins jenkins/jenkins -n jenkins --values values.yaml kubectl get pods -o wide -n jenkins kubectl get event --namespace jenkins --field-selector involvedObject.name=jenkins-0 Failed to pull image \u0026#34;docker.io/jenkins/jenkins:2.528.3-jdk21\u0026#34;: rpc error: code = NotFound desc = failed to pull and unpack image \u0026#34;docker.io/jenkins/jenkins:2.528.3-jdk21\u0026#34;: no match for platform in manifest: not found We need to build Jenkins for risc-v\nThe arguments to give for building the jenkins image was not complete, so i found some in the source code and some by getting the ARG from the build on my main machine.\n# On my main machine docker pull jenkins/jenkins:2.528.3-jdk21 docker history jenkins/jenkins:2.528.3-jdk21 --no-trunc | grep ARG # now you can see the build ARG\u0026#39;s needed to build the risc-v version. # On the risc-v machine: git clone https://github.com/jenkinsci/docker.git cd docker git checkout 2.528.3 sudo docker build -f debian/trixie/hotspot/Dockerfile . \\ --build-arg JENKINS_VERSION=2.528.3 \\ --build-arg WAR_SHA=bfa31f1e3aacebb5bce3d5076c73df97bf0c0567eeb8d8738f54f6bac48abd74 \\ --build-arg WAR_URL=https://repo.jenkins-ci.org/public/org/jenkins-ci/main/jenkins-war/2.528.3/jenkins-war-2.528.3.war \\ --build-arg COMMIT_SHA=1d22f3716cc2a5baeedeb636a006c4c38d35ce4c \\ --build-arg PLUGIN_CLI_VERSION=2.13.2 \\ --build-arg TRIXIE_TAG=20251208 \\ --build-arg JAVA_VERSION=21.0.9_10 \\ --build-arg TARGETARCH=riscv64 \\ -t opvolger/jenkins:2.528.3-jdk21 --progress plain But it will give an error 0.839 ERROR: unmanaged jlink version pattern This is because jlink has still a \u0026ldquo;bug\u0026rdquo; for RISC-V, you can see that with jlink --version It is making a system call that is not permitted.\n0.843 [0.013s][error][os] Syscall: RISCV_FLUSH_ICACHE not available; error=\u0026#39;Operation not permitted\u0026#39; (errno=EPERM) This is fixed in in moby. But that version of docker.io is not in debian trixie, what i am using. So we need to update docker.io. I updated with the version from sid.\nAdded this in /etc/apt/sources.list\ndeb http://deb.debian.org/debian/ sid main # On the risc-v machine: sudo -i nano /etc/apt/sources.list apt update apt install docker.io now remove the line in /etc/apt/sources.list again\n# On the risc-v machine: nano /etc/apt/sources.list apt update # leave the this with Ctrl + D Now run the docker build again.\n# On the risc-v machine: sudo docker build -f debian/trixie/hotspot/Dockerfile . \\ --build-arg JENKINS_VERSION=2.528.3 \\ --build-arg WAR_SHA=bfa31f1e3aacebb5bce3d5076c73df97bf0c0567eeb8d8738f54f6bac48abd74 \\ --build-arg WAR_URL=https://repo.jenkins-ci.org/public/org/jenkins-ci/main/jenkins-war/2.528.3/jenkins-war-2.528.3.war \\ --build-arg COMMIT_SHA=1d22f3716cc2a5baeedeb636a006c4c38d35ce4c \\ --build-arg PLUGIN_CLI_VERSION=2.13.2 \\ --build-arg TRIXIE_TAG=20251208 \\ --build-arg JAVA_VERSION=21.0.9_10 \\ --build-arg TARGETARCH=riscv64 \\ -t opvolger/jenkins:2.528.3-jdk21 --progress plain sudo docker push opvolger/jenkins:2.528.3-jdk21 I updated my values.yaml again with this new image, added username/password for login and an ingress.\ncontroller: admin: username: opvolger password: demodemo image: repository: opvolger/jenkins tag: 2.528.3-jdk21 sidecars: configAutoReload: image: repository: opvolger/k8s-sidecar tag: 1.30.7 ingress: enabled: true hostName: \u0026#34;jenkins.k8s.riscv.net\u0026#34; # On my main machine helm uninstall jenkins -n jenkins helm install jenkins jenkins/jenkins -n jenkins --values values.yaml It didn\u0026rsquo;t work, the sidecar image was restarting and giving an error:\n# On my main machine kubectl logs jenkins-0 config-reload -n jenkins The error of the sidecar container:\n{\u0026#34;time\u0026#34;: \u0026#34;2026-01-11T19:43:44.750737+00:00\u0026#34;, \u0026#34;level\u0026#34;: \u0026#34;INFO\u0026#34;, \u0026#34;msg\u0026#34;: \u0026#34;Starting collector\u0026#34;} {\u0026#34;time\u0026#34;: \u0026#34;2026-01-11T19:43:44.751753+00:00\u0026#34;, \u0026#34;level\u0026#34;: \u0026#34;INFO\u0026#34;, \u0026#34;msg\u0026#34;: \u0026#34;No folder annotation was provided, defaulting to k8s-sidecar-target-directory\u0026#34;} {\u0026#34;time\u0026#34;: \u0026#34;2026-01-11T19:43:44.752692+00:00\u0026#34;, \u0026#34;level\u0026#34;: \u0026#34;INFO\u0026#34;, \u0026#34;msg\u0026#34;: \u0026#34;Loading incluster config ...\u0026#34;} {\u0026#34;time\u0026#34;: \u0026#34;2026-01-11T19:43:44.756520+00:00\u0026#34;, \u0026#34;level\u0026#34;: \u0026#34;INFO\u0026#34;, \u0026#34;msg\u0026#34;: \u0026#34;Config for cluster api at \u0026#39;https://10.43.0.1:443\u0026#39; loaded.\u0026#34;} {\u0026#34;time\u0026#34;: \u0026#34;2026-01-11T19:43:44.757022+00:00\u0026#34;, \u0026#34;level\u0026#34;: \u0026#34;INFO\u0026#34;, \u0026#34;msg\u0026#34;: \u0026#34;Unique filenames will not be enforced.\u0026#34;} {\u0026#34;time\u0026#34;: \u0026#34;2026-01-11T19:43:44.757446+00:00\u0026#34;, \u0026#34;level\u0026#34;: \u0026#34;INFO\u0026#34;, \u0026#34;msg\u0026#34;: \u0026#34;5xx response content will not be enabled.\u0026#34;} {\u0026#34;time\u0026#34;: \u0026#34;2026-01-11T19:43:44.859127+00:00\u0026#34;, \u0026#34;level\u0026#34;: \u0026#34;ERROR\u0026#34;, \u0026#34;msg\u0026#34;: \u0026#34;FileNotFoundError: [Errno 2] No usable temporary directory found in [\u0026#39;/tmp\u0026#39;, \u0026#39;/var/tmp\u0026#39;, \u0026#39;/usr/tmp\u0026#39;, \u0026#39;/app\u0026#39;]\u0026#34;, \u0026#34;exc_info\u0026#34;: \u0026#34;Traceback (most recent call last):\\n File \\\u0026#34;/app/sidecar.py\\\u0026#34;, line 174, in \u0026lt;module\u0026gt;\\n main()\\n ~~~~^^\\n File \\\u0026#34;/app/sidecar.py\\\u0026#34;, line 136, in main\\n watch_for_changes(method, label, label_value, target_folder, request_url, request_method, request_payload,\\n ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n namespace, folder_annotation, resources, unique_filenames, script, enable_5xx,\\n ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n ignore_already_processed, resource_name)\\n ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\\n File \\\u0026#34;/app/resources.py\\\u0026#34;, line 427, in watch_for_changes\\n processes = _start_watcher_processes(current_namespace, folder_annotation, label,\\n label_value, request_method, mode, request_payload, resources,\\n target_folder, unique_filenames, script, request_url, enable_5xx,\\n ignore_already_processed, resource_name)\\n File \\\u0026#34;/app/resources.py\\\u0026#34;, line 460, in _start_watcher_processes\\n proc.start()\\n ~~~~~~~~~~^^\\n File \\\u0026#34;/usr/local/lib/python3.14/multiprocessing/process.py\\\u0026#34;, line 121, in start\\n self._popen = self._Popen(self)\\n ~~~~~~~~~~~^^^^^^\\n File \\\u0026#34;/usr/local/lib/python3.14/multiprocessing/context.py\\\u0026#34;, line 224, in _Popen\\n return _default_context.get_context().Process._Popen(process_obj)\\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^\\n File \\\u0026#34;/usr/local/lib/python3.14/multiprocessing/context.py\\\u0026#34;, line 300, in _Popen\\n return Popen(process_obj)\\n File \\\u0026#34;/usr/local/lib/python3.14/multiprocessing/popen_forkserver.py\\\u0026#34;, line 35, in __init__\\n super().__init__(process_obj)\\n ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^\\n File \\\u0026#34;/usr/local/lib/python3.14/multiprocessing/popen_fork.py\\\u0026#34;, line 20, in __init__\\n self._launch(process_obj)\\n ~~~~~~~~~~~~^^^^^^^^^^^^^\\n File \\\u0026#34;/usr/local/lib/python3.14/multiprocessing/popen_forkserver.py\\\u0026#34;, line 51, in _launch\\n self.sentinel, w = forkserver.connect_to_new_process(self._fds)\\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^\\n File \\\u0026#34;/usr/local/lib/python3.14/multiprocessing/forkserver.py\\\u0026#34;, line 89, in connect_to_new_process\\n self.ensure_running()\\n ~~~~~~~~~~~~~~~~~~~^^\\n File \\\u0026#34;/usr/local/lib/python3.14/multiprocessing/forkserver.py\\\u0026#34;, line 157, in ensure_running\\n address = connection.arbitrary_address(\u0026#39;AF_UNIX\u0026#39;)\\n File \\\u0026#34;/usr/local/lib/python3.14/multiprocessing/connection.py\\\u0026#34;, line 79, in arbitrary_address\\n return tempfile.mktemp(prefix=\u0026#39;sock-\u0026#39;, dir=util.get_temp_dir())\\n ~~~~~~~~~~~~~~~~~^^\\n File \\\u0026#34;/usr/local/lib/python3.14/multiprocessing/util.py\\\u0026#34;, line 216, in get_temp_dir\\n base_tempdir = _get_base_temp_dir(tempfile)\\n File \\\u0026#34;/usr/local/lib/python3.14/multiprocessing/util.py\\\u0026#34;, line 171, in _get_base_temp_dir\\n base_tempdir = tempfile.gettempdir()\\n File \\\u0026#34;/usr/local/lib/python3.14/tempfile.py\\\u0026#34;, line 316, in gettempdir\\n return _os.fsdecode(_gettempdir())\\n ~~~~~~~~~~~^^\\n File \\\u0026#34;/usr/local/lib/python3.14/tempfile.py\\\u0026#34;, line 309, in _gettempdir\\n tempdir = _get_default_tempdir()\\n File \\\u0026#34;/usr/local/lib/python3.14/tempfile.py\\\u0026#34;, line 224, in _get_default_tempdir\\n raise FileNotFoundError(_errno.ENOENT,\\n \\\u0026#34;No usable temporary directory found in %s\\\u0026#34; %\\n dirlist)\\nFileNotFoundError: [Errno 2] No usable temporary directory found in [\u0026#39;/tmp\u0026#39;, \u0026#39;/var/tmp\u0026#39;, \u0026#39;/usr/tmp\u0026#39;, \u0026#39;/app\u0026#39;]\u0026#34;} There was no temp directory where the container can write into. So I added it. Sometimes a had a timeout on my probes, so changed the probes as well\npersistence: volumes: - name: tmp emptyDir: {} controller: admin: username: opvolger password: demodemo # some more time for the low performance RISC-V boards probes: startupProbe: failureThreshold: 20 periodSeconds: 15 timeoutSeconds: 30 livenessProbe: failureThreshold: 10 initialDelaySeconds: 30 readinessProbe: failureThreshold: 10 initialDelaySeconds: 30 image: repository: opvolger/jenkins tag: 2.528.3-jdk21 sidecars: configAutoReload: additionalVolumeMounts: - name: tmp mountPath: \u0026#34;/tmp\u0026#34; image: repository: opvolger/k8s-sidecar tag: 1.30.7 ingress: enabled: true hostName: \u0026#34;jenkins.k8s.riscv.net\u0026#34; # On my main machine helm uninstall jenkins -n jenkins helm install jenkins jenkins/jenkins -n jenkins --values values.yaml Now it is running without a problem!\nKubernetes job # Oke, now we can create our first pipeline job in the jenkins. I created a very simple build. It will only run uanme -a on a ubuntu docker container.\npipeline { agent { kubernetes { yaml \u0026#39;\u0026#39;\u0026#39; apiVersion: v1 kind: Pod spec: containers: - name: shell image: ubuntu command: - sleep args: - infinity securityContext: # ubuntu runs as root by default, it is recommended or even mandatory in some environments (such as pod security admission \u0026#34;restricted\u0026#34;) to run as a non-root user. runAsUser: 1000 \u0026#39;\u0026#39;\u0026#39; defaultContainer \u0026#39;shell\u0026#39; retries 2 } } stages { stage(\u0026#39;Main\u0026#39;) { steps { sh \u0026#39;uname -a\u0026#39; } } } } Running the job! It was nog a success :(\n# On my main machine kubectl get event --namespace jenkins But this was failing!\nFailed to pull image \u0026#34;jenkins/inbound-agent:3345.v03dee9b_f88fc-1\u0026#34;: rpc error: code = NotFound desc = failed to pull and unpack image \u0026#34;docker.io/jenkins/inbound-agent:3345.v03dee9b_f88fc-1\u0026#34;: no match for platform in manifest: not found The last thing I needed was the agent docker for risc-v:\n# On the risc-v machine: git clone https://github.com/jenkinsci/docker-agent.git cd docker-agent git checkout 3345.v03dee9b_f88fc-1 sudo docker build -f debian/Dockerfile . \\ --build-arg JAVA_VERSION=21.0.9_10 \\ -t opvolger/inbound-agent:3345.v03dee9b_f88fc-1 --progress plain sudo docker push opvolger/inbound-agent:3345.v03dee9b_f88fc-1 persistence: volumes: - name: tmp emptyDir: {} agent: defaultsProviderTemplate: default image: repository: \u0026#34;opvolger/inbound-agent\u0026#34; tag: \u0026#34;3345.v03dee9b_f88fc-1\u0026#34; controller: admin: username: opvolger password: demodemo # some more time for the low performance RISC-V boards probes: startupProbe: failureThreshold: 20 periodSeconds: 15 timeoutSeconds: 30 livenessProbe: failureThreshold: 10 initialDelaySeconds: 30 readinessProbe: failureThreshold: 10 initialDelaySeconds: 30 image: repository: opvolger/jenkins tag: 2.528.3-jdk21 sidecars: configAutoReload: additionalVolumeMounts: - name: tmp mountPath: \u0026#34;/tmp\u0026#34; image: repository: opvolger/k8s-sidecar tag: 1.30.7 ingress: enabled: true hostName: \u0026#34;jenkins.k8s.riscv.net\u0026#34; uninstall and install again with the updated values.yaml\n# On my main machine helm uninstall jenkins -n jenkins helm install jenkins jenkins/jenkins -n jenkins --values values.yaml Re-create the pipeline, and it will work!\nAll in one deploy # create values.yaml\npersistence: volumes: - name: tmp emptyDir: {} agent: defaultsProviderTemplate: default image: repository: \u0026#34;opvolger/inbound-agent\u0026#34; tag: \u0026#34;3345.v03dee9b_f88fc-1\u0026#34; controller: admin: username: opvolger password: demodemo # some more time for the low performance RISC-V boards probes: startupProbe: failureThreshold: 20 periodSeconds: 15 timeoutSeconds: 30 livenessProbe: failureThreshold: 10 initialDelaySeconds: 30 readinessProbe: failureThreshold: 10 initialDelaySeconds: 30 image: repository: opvolger/jenkins tag: 2.528.3-jdk21 sidecars: configAutoReload: additionalVolumeMounts: - name: tmp mountPath: \u0026#34;/tmp\u0026#34; image: repository: opvolger/k8s-sidecar tag: 1.30.7 ingress: enabled: true hostName: \u0026#34;jenkins.k8s.riscv.net\u0026#34; installPlugins: - kubernetes:latest - workflow-aggregator:latest - git:latest - configuration-as-code:latest - blueocean:latest - job-dsl:latest JCasC: configScripts: jobs: | jobs: - script: \u0026gt; pipelineJob(\u0026#39;test\u0026#39;) { definition { cps { sandbox() script(\u0026#34;\u0026#34;\u0026#34;\\ pipeline { agent { kubernetes { yaml \u0026#39;\u0026#39;\u0026#39; apiVersion: v1 kind: Pod spec: containers: - name: shell image: ubuntu command: - sleep args: - infinity securityContext: runAsUser: 1000 \u0026#39;\u0026#39;\u0026#39; defaultContainer \u0026#39;shell\u0026#39; retries 2 } } stages { stage(\u0026#39;Main\u0026#39;) { steps { sh \u0026#39;uname -a\u0026#39; } } } }\u0026#34;\u0026#34;\u0026#34;.stripIndent()) } } } helm install jenkins jenkins/jenkins -n jenkins --values values.yaml Youtube video # RISC-V Kubernetes cluster with Jenkins on 3x StarFive VisionFive 2 (Lite).\n","date":"19 December 2025","externalUrl":null,"permalink":"/posts/starfive-visionfive-2/2025-12-19-lite-k8s/","section":"Posts","summary":"","title":"StarFive VisionFive 2 Lite - Kubernetes cluster","type":"posts"},{"content":"","date":"19 December 2025","externalUrl":null,"permalink":"/tags/starfive-visionfive-2/","section":"Tags","summary":"","title":"Starfive-Visionfive-2","type":"tags"},{"content":" Intro # Where is a new Lite edition of the StarFive VisionFive 2. It is the StarFive VisionFive 2 Lite. The form factor is a little bit smaller clock speeds is a bit lower, but almost the same. It is now only or SD-card or eMMC (soldered) but we have now Bluetooth and WiFi.\nThe u-boot and kernel patch is already on the way. Just like the StarFive VisionFive 2 (not Lite) is the GPU still not in de mainline kernel, but the rest is working.\nSo if you don\u0026rsquo;t want to run a vender Linux kernel/distro, you can run a mainline kernel with a patch and a normal rootfs from a distribution that already support RISC-V.\nI am on Fedora 43, and needed to install some missing packages (new laptop)\nsudo dnf install openssl-devel-engine swig gcc-c++-riscv64-linux-gnu gcc-c++ libmpc-devel gcc-plugin-devel git openal-soft-devel ncurses-devel flex bison gnutls-devel screen Building OpenSBI # v1.7 of OpenSBI has already support for the StarFive VisionFive 2 Lite.\ngit clone --branch v1.7 --depth=1 https://github.com/riscv-software-src/opensbi.git cd opensbi make CROSS_COMPILE=riscv64-linux-gnu- PLATFORM=generic FW_OPTIONS=0 FW_TEXT_START=0x40000000 Building U-Boot # We first get the u-boot code. We do not need al the history, so we add depth 1.\ngit clone --branch v2026.01-rc3 --depth=1 https://github.com/u-boot/u-boot.git and apply this patch\nThe website is very slow (timeouts) so i already downloaded the patch Re-PATCH-v1-2-9-riscv-dts-starfive-Add-VisionFive-2-Lite-board-device-tree.mbox\nThe patch is not working 100%, so we need to fix some stuff. That is why i use the reject option with git.\ncd u-boot wget https://raw.githubusercontent.com/Opvolger/ansible-riscv-sd-card-creater/refs/heads/master/files/jh7110-lite/Re-PATCH-v1-2-9-riscv-dts-starfive-Add-VisionFive-2-Lite-board-device-tree.mbox git apply --reject --whitespace=fix Re-PATCH-v1-2-9-riscv-dts-starfive-Add-VisionFive-2-Lite-board-device-tree.mbox You will see that some patches are rejected:\nChecking patch dts/upstream/src/riscv/starfive/jh7110-common.dtsi... error: while searching for: assigned-clock-rates = \u0026lt;50000000\u0026gt;; bus-width = \u0026lt;8\u0026gt;; bootph-pre-ram; cap-mmc-highspeed; mmc-ddr-1_8v; mmc-hs200-1_8v; cap-mmc-hw-reset; post-power-on-delay-ms = \u0026lt;200\u0026gt;; pinctrl-names = \u0026#34;default\u0026#34;; pinctrl-0 = \u0026lt;\u0026amp;mmc0_pins\u0026gt;; vmmc-supply = \u0026lt;\u0026amp;vcc_3v3\u0026gt;; vqmmc-supply = \u0026lt;\u0026amp;emmc_vdd\u0026gt;; status = \u0026#34;okay\u0026#34;; }; error: patch failed: dts/upstream/src/riscv/starfive/jh7110-common.dtsi:281 error: while searching for: assigned-clock-rates = \u0026lt;50000000\u0026gt;; bus-width = \u0026lt;4\u0026gt;; bootph-pre-ram; no-sdio; no-mmc; cd-gpios = \u0026lt;\u0026amp;sysgpio 41 GPIO_ACTIVE_LOW\u0026gt;; disable-wp; cap-sd-highspeed; post-power-on-delay-ms = \u0026lt;200\u0026gt;; pinctrl-names = \u0026#34;default\u0026#34;; pinctrl-0 = \u0026lt;\u0026amp;mmc1_pins\u0026gt;; status = \u0026#34;okay\u0026#34;; error: patch failed: dts/upstream/src/riscv/starfive/jh7110-common.dtsi:299 Hunk #3 succeeded at 444 (offset 7 lines). Checking patch dts/upstream/src/riscv/starfive/jh7110-deepcomputing-fml13v01.dts... Checking patch dts/upstream/src/riscv/starfive/jh7110-milkv-mars.dts... Checking patch dts/upstream/src/riscv/starfive/jh7110-pine64-star64.dts... Checking patch dts/upstream/src/riscv/starfive/jh7110-starfive-visionfive-2.dtsi... Checking patch dts/upstream/src/riscv/starfive/jh7110.dtsi... Hunk #1 succeeded at 205 (offset 5 lines). Checking patch arch/riscv/include/asm/arch-jh7110/eeprom.h... error: while searching for: #include \u0026lt;linux/types.h\u0026gt; u8 get_pcb_revision_from_eeprom(void); /** error: patch failed: arch/riscv/include/asm/arch-jh7110/eeprom.h:9 Checking patch board/starfive/visionfive2/visionfive2-i2c-eeprom.c... error: while searching for: return 0; } /** * get_pcb_revision_from_eeprom - get the PCB revision * * 1.2A return \u0026#39;A\u0026#39;/\u0026#39;a\u0026#39;, 1.3B return \u0026#39;B\u0026#39;/\u0026#39;b\u0026#39;,other values are illegal */ u8 get_pcb_revision_from_eeprom(void) { u8 pv = 0xFF; if (read_eeprom()) return pv; return pbuf.eeprom.atom1.data.pstr[6]; } u8 get_ddr_size_from_eeprom(void) error: patch failed: board/starfive/visionfive2/visionfive2-i2c-eeprom.c:535 Checking patch configs/starfive_visionfive2_defconfig... error: while searching for: CONFIG_CMD_BOOTSTAGE=y CONFIG_OF_BOARD=y CONFIG_DEVICE_TREE_INCLUDES=\u0026#34;starfive-visionfive2-u-boot.dtsi\u0026#34; CONFIG_OF_LIST=\u0026#34;starfive/jh7110-deepcomputing-fml13v01 starfive/jh7110-milkv-mars starfive/jh7110-pine64-star64 starfive/jh7110-starfive-visionfive-2-v1.2a starfive/jh7110-starfive-visionfive-2-v1.3b\u0026#34; CONFIG_MULTI_DTB_FIT=y CONFIG_ENV_OVERWRITE=y CONFIG_ENV_IS_IN_SPI_FLASH=y error: patch failed: configs/starfive_visionfive2_defconfig:79 Checking patch dts/upstream/src/riscv/starfive/jh7110s-starfive-visionfive-2-lite.dts... Checking patch board/starfive/visionfive2/visionfive2-i2c-eeprom.c... Hunk #7 succeeded at 633 (offset 18 lines). Checking patch drivers/pci/pcie_starfive_jh7110.c... Checking patch board/starfive/visionfive2/spl.c... Hunk #1 succeeded at 140 (offset 8 lines). Checking patch board/starfive/visionfive2/starfive_visionfive2.c... Hunk #1 succeeded at 69 (offset 6 lines). Checking patch arch/riscv/cpu/jh7110/spl.c... Checking patch arch/riscv/include/asm/arch-jh7110/eeprom.h... Checking patch board/starfive/visionfive2/visionfive2-i2c-eeprom.c... Hunk #1 succeeded at 580 (offset 30 lines). Applying patch dts/upstream/src/riscv/starfive/jh7110-common.dtsi with 2 rejects... Rejected hunk #1. Rejected hunk #2. Hunk #3 applied cleanly. Applied patch dts/upstream/src/riscv/starfive/jh7110-deepcomputing-fml13v01.dts cleanly. Applied patch dts/upstream/src/riscv/starfive/jh7110-milkv-mars.dts cleanly. Applied patch dts/upstream/src/riscv/starfive/jh7110-pine64-star64.dts cleanly. Applied patch dts/upstream/src/riscv/starfive/jh7110-starfive-visionfive-2.dtsi cleanly. Applied patch dts/upstream/src/riscv/starfive/jh7110.dtsi cleanly. Applying patch arch/riscv/include/asm/arch-jh7110/eeprom.h with 1 reject... Rejected hunk #1. Applying patch board/starfive/visionfive2/visionfive2-i2c-eeprom.c with 1 reject... Rejected hunk #1. Applying patch configs/starfive_visionfive2_defconfig with 1 reject... Rejected hunk #1. Applied patch dts/upstream/src/riscv/starfive/jh7110s-starfive-visionfive-2-lite.dts cleanly. Applied patch board/starfive/visionfive2/visionfive2-i2c-eeprom.c cleanly. Applied patch drivers/pci/pcie_starfive_jh7110.c cleanly. Applied patch board/starfive/visionfive2/spl.c cleanly. Applied patch board/starfive/visionfive2/starfive_visionfive2.c cleanly. Applied patch arch/riscv/cpu/jh7110/spl.c cleanly. Applied patch arch/riscv/include/asm/arch-jh7110/eeprom.h cleanly. Applied patch board/starfive/visionfive2/visionfive2-i2c-eeprom.c cleanly. All the patches that didn\u0026rsquo;t work are saved in *.rej files. We need to see what we need to fix. Lines that where added have a \u0026lsquo;+\u0026rsquo; sign what is deleted have - sign.\nYou can see that this is removed in the reject file dts/upstream/src/riscv/starfive/jh7110-common.dtsi.rej, but some thinks are already changed.\nWe will fix that. Open dts/upstream/src/riscv/starfive/jh7110-common.dtsi and change (from line 278)\n\u0026amp;mmc0 { max-frequency = \u0026lt;100000000\u0026gt;; assigned-clocks = \u0026lt;\u0026amp;syscrg JH7110_SYSCLK_SDIO0_SDCARD\u0026gt;; assigned-clock-rates = \u0026lt;50000000\u0026gt;; bus-width = \u0026lt;8\u0026gt;; bootph-pre-ram; cap-mmc-highspeed; mmc-ddr-1_8v; mmc-hs200-1_8v; cap-mmc-hw-reset; pinctrl-names = \u0026#34;default\u0026#34;; pinctrl-0 = \u0026lt;\u0026amp;mmc0_pins\u0026gt;; vmmc-supply = \u0026lt;\u0026amp;vcc_3v3\u0026gt;; vqmmc-supply = \u0026lt;\u0026amp;emmc_vdd\u0026gt;; status = \u0026#34;okay\u0026#34;; }; \u0026amp;mmc1 { max-frequency = \u0026lt;100000000\u0026gt;; assigned-clocks = \u0026lt;\u0026amp;syscrg JH7110_SYSCLK_SDIO1_SDCARD\u0026gt;; assigned-clock-rates = \u0026lt;50000000\u0026gt;; bus-width = \u0026lt;4\u0026gt;; bootph-pre-ram; cd-gpios = \u0026lt;\u0026amp;sysgpio 41 GPIO_ACTIVE_LOW\u0026gt;; disable-wp; cap-sd-highspeed; pinctrl-names = \u0026#34;default\u0026#34;; pinctrl-0 = \u0026lt;\u0026amp;mmc1_pins\u0026gt;; status = \u0026#34;okay\u0026#34;; }; to\n\u0026amp;mmc0 { max-frequency = \u0026lt;100000000\u0026gt;; assigned-clocks = \u0026lt;\u0026amp;syscrg JH7110_SYSCLK_SDIO0_SDCARD\u0026gt;; assigned-clock-rates = \u0026lt;50000000\u0026gt;; bus-width = \u0026lt;8\u0026gt;; bootph-pre-ram; pinctrl-names = \u0026#34;default\u0026#34;; pinctrl-0 = \u0026lt;\u0026amp;mmc0_pins\u0026gt;; status = \u0026#34;okay\u0026#34;; }; \u0026amp;mmc1 { max-frequency = \u0026lt;100000000\u0026gt;; assigned-clocks = \u0026lt;\u0026amp;syscrg JH7110_SYSCLK_SDIO1_SDCARD\u0026gt;; assigned-clock-rates = \u0026lt;50000000\u0026gt;; bus-width = \u0026lt;4\u0026gt;; bootph-pre-ram; cap-sd-highspeed; pinctrl-names = \u0026#34;default\u0026#34;; pinctrl-0 = \u0026lt;\u0026amp;mmc1_pins\u0026gt;; status = \u0026#34;okay\u0026#34;; }; In configs/starfive_visionfive2_defconfig.rej you can see that adding the new board to the CONFIG_OF_LIST didn\u0026rsquo;t work. Other board are already added or changed from name!\nSo edit configs/starfive_visionfive2_defconfig and change the line\nCONFIG_OF_LIST=\u0026#34;starfive/jh7110-deepcomputing-fml13v01 starfive/jh7110-milkv-mars starfive/jh7110-milkv-marscm-emmc starfive/jh7110-milkv-marscm-lite starfive/jh7110-pine64-star64 starfive/jh7110-starfive-visionfive-2-v1.2a starfive/jh7110-starfive-visionfive-2-v1.3b\u0026#34; to\nCONFIG_OF_LIST=\u0026#34;starfive/jh7110-deepcomputing-fml13v01 starfive/jh7110-milkv-mars starfive/jh7110-milkv-marscm-emmc starfive/jh7110-milkv-marscm-lite starfive/jh7110-pine64-star64 starfive/jh7110-starfive-visionfive-2-v1.2a starfive/jh7110-starfive-visionfive-2-v1.3b starfive/jh7110s-starfive-visionfive-2-lite\u0026#34; If we open arch/riscv/include/asm/arch-jh7110/eeprom.h.rej we see that only comment was added. so we ignore this rejected patch.\nNow the last *.rej file board/starfive/visionfive2/visionfive2-i2c-eeprom.c.rej\nWe have to edit board/starfive/visionfive2/visionfive2-i2c-eeprom.c from line 543\nchange\nu8 get_pcb_revision_from_eeprom(void) { u8 pv = 0xFF; if (read_eeprom()) return pv; return pbuf.eeprom.atom1.data.pstr[6]; } to\nu8 get_pcb_revision_from_eeprom(void) { if (read_eeprom()) return 0; return pbuf.eeprom.atom4.data.pcb_revision; } Now we can build it! We have patch the patch!\nmake CROSS_COMPILE=riscv64-linux-gnu- starfive_visionfive2_defconfig # if you want to use the PCIe interface for something different then NVMe drive. Disable the PCI in U-Boot. sed -i -e \u0026#39;s/CONFIG_PCI_INIT_R=y/CONFIG_CMD_PCI=n/g\u0026#39; .config sed -i -e \u0026#39;s/CONFIG_PCI_INIT_R=y/CONFIG_PCI_INIT_R=n/g\u0026#39; .config sed -i -e \u0026#39;s/PCI_INIT_R=y/PCI_INIT_R=n/g\u0026#39; .config make CROSS_COMPILE=riscv64-linux-gnu- OPENSBI=../opensbi/build/platform/generic/firmware/fw_payload.bin CONFIG_DEFAULT_FDT_FILE=starfive/jh7110s-starfive-visionfive-2-lite.dtb On the question Enumerate PCI buses during init (PCI_INIT_R) [N/y/?] (NEW) hit Enter.\nDone, it is build!\nKernel 6.18 with a patch # and apply this patch\nI uses the github mirror\n# we need some firmwares in the kernel git clone --depth 1 git://git.kernel.org/pub/scm/linux/kernel/git/firmware/linux-firmware.git linux-firmware # clone the kernel git clone --branch v6.18 --depth=1 https://github.com/torvalds/linux.git cd linux wget https://lore.kernel.org/all/20251120082946.109378-1-hal.feng@starfivetech.com/t.mbox.gz gzip -d t.mbox.gz git apply --reject --whitespace=fix t.mbox Just like U-boot, some files are rejected. But the changes are in the code. (I think double patches are in the t.mbox file). So nothing to do! Config en build the kernel!\nGenerate a .config file from the the default defconfig for RISC-V.\nChange the config file so we don\u0026rsquo;t need modules.\nI add the firmware needed for the Radeon R9 290 and add enable some kernel features.\nmake ARCH=riscv CROSS_COMPILE=riscv64-linux-gnu- defconfig -j 16 # don\u0026#39;t make modules, add everything in the kernel sed -i -e \u0026#39;s/=m/=y/g\u0026#39; .config # add some stuff to build cat \u0026gt;\u0026gt; .config \u0026lt;\u0026lt; EOL # firmware in kernel CONFIG_EXTRA_FIRMWARE=\u0026#34;amdgpu/hawaii_k_smc.bin amdgpu/hawaii_smc.bin amdgpu/hawaii_uvd.bin amdgpu/hawaii_vce.bin amdgpu/hawaii_sdma.bin amdgpu/hawaii_sdma1.bin amdgpu/hawaii_pfp.bin amdgpu/hawaii_me.bin amdgpu/hawaii_ce.bin amdgpu/hawaii_rlc.bin amdgpu/hawaii_mec.bin amdgpu/hawaii_mc.bin radeon/hawaii_pfp.bin radeon/hawaii_me.bin radeon/hawaii_ce.bin radeon/hawaii_mec.bin radeon/hawaii_mc.bin radeon/hawaii_rlc.bin radeon/hawaii_sdma.bin radeon/hawaii_smc.bin radeon/hawaii_k_smc.bin radeon/HAWAII_pfp.bin radeon/HAWAII_me.bin radeon/HAWAII_ce.bin radeon/HAWAII_mec.bin radeon/HAWAII_mc.bin radeon/HAWAII_mc2.bin radeon/HAWAII_rlc.bin radeon/HAWAII_sdma.bin radeon/HAWAII_smc.bin\u0026#34; CONFIG_EXTRA_FIRMWARE_DIR=\u0026#34;../linux-firmware\u0026#34; # AMDGPU + HDMI sound CONFIG_DRM_AMDGPU=y CONFIG_DRM_AMD_DC=y CONFIG_DRM_AMD_DC_FP=y CONFIG_SND_DYNAMIC_MINORS=y CONFIG_SND_MAX_CARDS=32 CONFIG_SND_VMASTER=y CONFIG_SND_HDA=y CONFIG_SND_HDA_INTEL=y CONFIG_SND_HDA_CODEC_HDMI=y CONFIG_SND_HDA_POWER_SAVE_DEFAULT=0 CONFIG_SND_HDA_CORE=y CONFIG_SND_HDA_COMPONENT=y CONFIG_SND_INTEL_NHLT=y CONFIG_SND_INTEL_DSP_CONFIG=y CONFIG_SND_INTEL_SOUNDWIRE_ACPI=y # needed for ubuntu (snap): CONFIG_SQUASHFS=y CONFIG_SQUASHFS_FILE_CACHE=y CONFIG_SQUASHFS_DECOMP_SINGLE=y CONFIG_SQUASHFS_COMPILE_DECOMP_SINGLE=y CONFIG_SQUASHFS_ZLIB=y CONFIG_SQUASHFS_LZ4=y CONFIG_SQUASHFS_LZO=y CONFIG_SQUASHFS_XZ=y CONFIG_SQUASHFS_ZSTD=y CONFIG_SQUASHFS_FRAGMENT_CACHE_SIZE=3 # needed for Fedora (zram) CONFIG_BLK_DEV_RAM=y CONFIG_BLK_DEV_RAM_COUNT=16 CONFIG_BLK_DEV_RAM_SIZE=4096 CONFIG_ZRAM=y CONFIG_ZRAM_DEF_COMP_LZ4=y CONFIG_ZRAM_DEF_COMP=\u0026#34;lz4\u0026#34; CONFIG_ZRAM_BACKEND_LZ4=y CONFIG_ZRAM_BACKEND_LZ4HC=y CONFIG_ZRAM_BACKEND_ZSTD=y CONFIG_ZRAM_BACKEND_DEFLATE=y CONFIG_ZRAM_BACKEND_842=y CONFIG_ZRAM_BACKEND_LZO=y CONFIG_ZRAM_MULTI_COMP=y CONFIG_ZRAM_WRITEBACK=y CONFIG_ZSMALLOC_STAT=y CONFIG_ZSMALLOC_CHAIN_SIZE=8 CONFIG_ZRAM_MEMORY_TRACKING=y EOL # open menu config and save the config again (default will be set) make ARCH=riscv CROSS_COMPILE=riscv64-linux-gnu- menuconfig -j 16 # now build make ARCH=riscv CROSS_COMPILE=riscv64-linux-gnu- -j 16 Create bootable SD-Card # So we now have a compiled U-boot. Time to put it on a SD-Card (partitiontable must be GPT not MBR)\nI will create the default 2 SPL/U-Boot partitions and a bigger one so we can put the kernel on it.\nOn my machine my SD-Card reader is on /dev/sda so:\n# create the correct boot partitions to boot (needs sudo) sudo sgdisk --clear \\ --set-alignment=2 \\ --new=1:4096:8191 --change-name=1:spl --typecode=1:2E54B353-1271-4842-806F-E436D6AF6985 \\ --new=2:8192:16383 --change-name=2:uboot --typecode=2:BC13C2FF-59E6-4262-A352-B275FD6F7172 \\ --new=3:16384:100M --change-name=3:boot --typecode=3:BC13C2FF-59E6-4262-A352-B275FD6F7173 \\ /dev/sda # format the boot partition sudo mkfs.ext4 /dev/sda3 # now put the firmware on partition 1 and 2 sudo dd if=u-boot/spl/u-boot-spl.bin.normal.out of=/dev/sda1 sudo dd if=u-boot/u-boot.itb of=/dev/sda2 # now mount and copy the boot files from debian to the 3th partition mkdir /tmp/mnt sudo mount /dev/sda3 /tmp/mnt sudo mkdir /tmp/mnt/starfive sudo cp linux/arch/riscv/boot/dts/starfive/jh7110s-starfive-visionfive-2-lite.dtb /tmp/mnt/starfive/jh7110s-starfive-visionfive-2-lite.dtb sudo cp linux/arch/riscv/boot/Image /tmp/mnt/Image sudo umount /dev/sda3 Run U-Boot and the kernel # Put the SD-Card in the StarFive VisionFive 2 Lite.\nLets Boot!\nI have a serial connection to my StarFive VisionFive 2 Lite. (start a serial connection for example with screen -L /dev/ttyUSB0 115200, how to connect to serial see this pdf)\nload mmc 0:3 ${kernel_addr_r} /Image load mmc 0:3 ${fdt_addr_r} /starfive/jh7110s-starfive-visionfive-2-lite.dtb setenv bootargs \u0026#39;\u0026#39; # and boot! booti $kernel_addr_r - $fdt_addr_r # now it will panic kernel, there is no rootfs! Boot Debain Trixie Setup # For example, we can start the initramfs from the debian-trixie setup.\n# get initramfs for the setup wget http://ftp.debian.org/debian/dists/trixie/main/installer-riscv64/current/images/netboot/debian-installer/riscv64/initrd.gz # mount SD-Card to /tmp/mnt sudo mount /dev/sda3 /tmp/mnt # copy it to the SD-Card sudo cp initrd.gz /tmp/mnt/initrd.gz sudo umount /dev/sda3 Download the debian-trixie-DI-rc1-riscv64-DVD-1.iso, but the debian-trixie-DI-rc1-riscv64-DVD-1.iso on USB. I used balenaEtcher to flash the iso on a USB device.\nPut the USB with the iso on an USB-slot and put the SD-Card in the SD-Card slot.\nConnect to the board with a serail connection\nload mmc 0:3 ${kernel_addr_r} /Image load mmc 0:3 ${fdt_addr_r} /starfive/jh7110s-starfive-visionfive-2-lite.dtb load mmc 0:3 ${ramdisk_addr_r} /initrd.gz # we don\u0026#39;t need bootargs setenv bootargs \u0026#39;\u0026#39; # and boot! booti $kernel_addr_r $ramdisk_addr_r:$filesize $fdt_addr_r Welcome in the setup of Debian. You kan install Debian on a new partition, for example a new partition 4. After the setup you can boot with:\nload mmc 0:3 ${kernel_addr_r} /Image load mmc 0:3 ${fdt_addr_r} /starfive/jh7110s-starfive-visionfive-2-lite.dtb load mmc 0:4 ${ramdisk_addr_r} /boot/initrd.img # we will use partition 4 as rootfs setenv bootargs \u0026#39;root=/dev/mmcblk0p4\u0026#39; # and boot! booti $kernel_addr_r $ramdisk_addr_r:$filesize $fdt_addr_r ","date":"3 December 2025","externalUrl":null,"permalink":"/posts/starfive-visionfive-2/2025-12-03-lite-uboot-kernel/","section":"Posts","summary":"","title":"StarFive VisionFive 2 Lite - U-boot and Kernel with external GPU ATI Radeon R9 290","type":"posts"},{"content":"","date":"9 November 2025","externalUrl":null,"permalink":"/categories/arm/","section":"Categories","summary":"","title":"ARM","type":"categories"},{"content":"","date":"9 November 2025","externalUrl":null,"permalink":"/tags/arm/","section":"Tags","summary":"","title":"ARM","type":"tags"},{"content":" Intro # With an external GPU, you can build your own kernel and boot Fedora aarch64 Desktop.\nFallback to llvmpipe on Radeon drivers # Al my ATI Radeon didn\u0026rsquo;t work (I had screen output), but all did fallback to llvmpipe. So no hardware acceleration.\nBut the ATI Radeon R9 290 has Radeon and AMDGPU support in the kernel. If you don\u0026rsquo;t build or disable Radeon in the kernel arguments, the AMDGPU drivers will work!\nFlash the Fedora KDE Desktop to SD-card # I downloaded the Fedora-KDE-Desktop-Disk-43-1.6.aarch64.raw.xz from the website.\nFlashed it to a SD-card with Fedora Media Writer. (Use options Select .iso file)\nAfter the SD-card was flashed, i opened gparted and deleted the first 2 partitions. Created a new fat32 one and added the label bootfs and added the Flag lba to it.\nNext I Resized the fedora partition to the end of the disk.\nThis will give something like this:\nBuild the kernel # Compiling will be done on an amd64 desktop. So we will cross-compile.\nI have installed Fedora Linux and had to install some stuff to be able to cross compile\n$ sudo dnf group install \u0026#34;Development Tools\u0026#34; $ sudo dnf install git gcc-plugin-devel libmpc-devel gcc-c++ gcc-c++-aarch64-linux-gnu ncurses-devel libmpc-devel nano gparted I will work from the directory /home/opvolger/demo.\nCheck out firmwares # First we need to clone the linux firmware\n$ cd /home/opvolger/demo $ git clone --depth 1 git://git.kernel.org/pub/scm/linux/kernel/git/firmware/linux-firmware.git We need this, so we can add firmware directly in the kernel.\nBuild kernel # Now we can clone the raspberry pi kernel.\n# checkout kernel code $ cd /home/opvolger/demo $ git clone --branch rpi-6.12.y --depth 1 https://github.com/raspberrypi/linux.git raspberrypi-6.12-y $ cd raspberrypi-6.12-y # we want to cross-compile the kernel $ export ARCH=arm64 $ export CROSS_COMPILE=aarch64-linux-gnu- # make a default .config for the pi5 chip. $ make bcm2712_defconfig # we need to make (and add stuff) changes $ make menuconfig Select the next kernel options\nDevice Drivers ‚îî‚îÄ\u0026gt;Generic Driver Options ‚îî‚îÄ\u0026gt;Firmware loader () Build named firmware blobs into the kernel binary (../linux-firmware) Firmware blobs root directory In the Build named firmware blobs into the kernel binary, you will need to add your blobs of your AMD video card. In my case it was the hawaii (R2 290) blobs. For example the 200-series you can find you \u0026ldquo;blob-names: on wikipedia\nIf you do not have the correct blobs, you can see it with the commands following after booting:\n$ journalctl -b | grep radeon $ journalctl -b | grep amdgpu $ journalctl -b | grep firmware Than you can change it and rebuild the kernel.\nChange Firmware blobs root directory to ../linux-firmware\namdgpu/hawaii_k_smc.bin amdgpu/hawaii_smc.bin amdgpu/hawaii_uvd.bin amdgpu/hawaii_vce.bin amdgpu/hawaii_sdma.bin amdgpu/hawaii_sdma1.bin amdgpu/hawaii_pfp.bin amdgpu/hawaii_me.bin amdgpu/hawaii_ce.bin amdgpu/hawaii_rlc.bin amdgpu/hawaii_mec.bin amdgpu/hawaii_mc.bin radeon/hawaii_pfp.bin radeon/hawaii_me.bin radeon/hawaii_ce.bin radeon/hawaii_mec.bin radeon/hawaii_mc.bin radeon/hawaii_rlc.bin radeon/hawaii_sdma.bin radeon/hawaii_smc.bin radeon/hawaii_k_smc.bin radeon/HAWAII_pfp.bin radeon/HAWAII_me.bin radeon/HAWAII_ce.bin radeon/HAWAII_mec.bin radeon/HAWAII_mc.bin radeon/HAWAII_mc2.bin radeon/HAWAII_rlc.bin radeon/HAWAII_sdma.bin radeon/HAWAII_smc.bin Add AMDGPU/ATIGPU support\nLinux Kernel Configuration ‚îî‚îÄ\u0026gt;Device Drivers ‚îî‚îÄ\u0026gt;Graphics support ‚îî‚îÄ\u0026gt;Direct Rendering Manager (XFree86 4.1.0 and higher DRI support) \u0026lt;*\u0026gt; ATI Redeon \u0026lt;*\u0026gt; AMD GPU [*] Enable amdgpu support for SI parts (NEW) [*] Enable amdgpu support for CIK parts (NEW) Change Direct Rendering Manager (XFree86 4.1.0 and higher DRI support) from M (Modules) to * (with in the kernel) (with the space bar).\nI disabled all DRM support .... that where selected. and selected ATI Redeon, AMD GPU and enabled SI en CIK support.\nNow we want sound on the HDMI monitor, so we add support for that.\nDevice Drivers ‚îî‚îÄ\u0026gt;Sound card support ‚îî‚îÄ\u0026gt;Advanced Linux Sound Architecture ‚îî‚îÄ\u0026gt;HD-Audio \u0026lt;*\u0026gt; HD Audio PCI \u0026lt;*\u0026gt; Build HDMI/DisplayPort HD-audio codec support Change Advanced Linux Sound Architecture from M (Modules) to * (with in the kernel) (with the space bar).\nSelect * for HD Audio PCI and now you can select * by Build HDMI/DisplayPort HD-audio codec support.\nNow add and change the file systems we will support\nFile systems ‚îî‚îÄ\u0026gt;\u0026lt;*\u0026gt; Btrfs filesystem support [*] Btrfs POSIX Access Control Lists [*] Btrfs debugging support [*] Btrfs assert support [*] Btrfs with the ref verify tool compiled in I changed all the M (Modules) to * (with in the kernel) (if possible) (with the space bar) and added all the Btrfs options. No idea if i need them all\u0026hellip;.\nChange M to * from ZRAM and enable all the sub Compressed RAM block device support:\nDevice Drivers ‚îî‚îÄ\u0026gt;Block devices ‚îî‚îÄ\u0026gt;\u0026lt;*\u0026gt;Compressed RAM block device support [*] lz4 compression support [*] lz4hc compression support [*] zstd compression support [*] deflate compression support [*] 842 compression support [*] lzo and lzo-rle compression support Default zram compressor (zstd) ---\u0026gt; [*] Write back incompressible or idle page to backing device [*] Track access time of zram entries [*] Track zRam block status [*] Enable multiple compression streams We now need to set the page size from 16 to 4 in the kernel\nKernel Features ‚îî‚îÄ\u0026gt;Page size (16KB) Now you need to select 4KB (space bar).\nWe can now Exit and save the changes!\nYou can disable more options (Like Amateur Radio support, Industrial I/O support, USB sound devices ,ALSA for SoC audio support, Broadcom VideoCore support, Touchscreens, Media USB Adapters, Radio Adapters and Support for small TFT LCD display modules), but this is optional. The kernel will compile faster.\nBefore we can build, we need to add a kernel patch. We need to change code so the pi can work with the AMDGPU.\nCreate a file drm.patch in /home/opvolger/demo/raspberrypi-6.12-y/. I found this patch here.\nFrom c1d421d7c501c77e8c04bdfa141a55e639822c03 Mon Sep 17 00:00:00 2001 From: Yang Bo \u0026lt;bo.yang@smail.nju.edu.cn\u0026gt; Date: Wed, 28 May 2025 11:18:19 +0800 Subject: [PATCH] Add amdgpu support for arm SoC Change-Id: Ic95c8514271d246dd668631810e8dee210f7f1b4 Signed-off-by: Yanghaku \u0026lt;bo.yang@smail.nju.edu.cn\u0026gt; --- drivers/gpu/drm/ttm/ttm_bo_util.c | 14 +------------- drivers/gpu/drm/ttm/ttm_module.c | 5 +++++ 2 files changed, 6 insertions(+), 13 deletions(-) diff --git a/drivers/gpu/drm/ttm/ttm_bo_util.c b/drivers/gpu/drm/ttm/ttm_bo_util.c index 0b3f4267130c..e0e55cb9edd2 100644 --- a/drivers/gpu/drm/ttm/ttm_bo_util.c +++ b/drivers/gpu/drm/ttm/ttm_bo_util.c @@ -343,8 +343,6 @@ static int ttm_bo_kmap_ttm(struct ttm_buffer_object *bo, .no_wait_gpu = false }; struct ttm_tt *ttm = bo-\u0026gt;ttm; -\tstruct ttm_resource_manager *man = -\tttm_manager_type(bo-\u0026gt;bdev, bo-\u0026gt;resource-\u0026gt;mem_type); pgprot_t prot; int ret; @@ -354,17 +352,7 @@ static int ttm_bo_kmap_ttm(struct ttm_buffer_object *bo, if (ret) return ret; -\tif (num_pages == 1 \u0026amp;\u0026amp; ttm-\u0026gt;caching == ttm_cached \u0026amp;\u0026amp; -\t!(man-\u0026gt;use_tt \u0026amp;\u0026amp; (ttm-\u0026gt;page_flags \u0026amp; TTM_TT_FLAG_DECRYPTED))) { -\t/* -\t* We\u0026#39;re mapping a single page, and the desired -\t* page protection is consistent with the bo. -\t*/ - -\tmap-\u0026gt;bo_kmap_type = ttm_bo_map_kmap; -\tmap-\u0026gt;page = ttm-\u0026gt;pages[start_page]; -\tmap-\u0026gt;virtual = kmap(map-\u0026gt;page); -\t} else { +\t{ /* * We need to use vmap to get the desired page protection * or to make the buffer object look contiguous. diff --git a/drivers/gpu/drm/ttm/ttm_module.c b/drivers/gpu/drm/ttm/ttm_module.c index b3fffe7b5062..9f3e425626b5 100644 --- a/drivers/gpu/drm/ttm/ttm_module.c +++ b/drivers/gpu/drm/ttm/ttm_module.c @@ -63,7 +63,12 @@ pgprot_t ttm_prot_from_caching(enum ttm_caching caching, pgprot_t tmp) { /* Cached mappings need no adjustment */ if (caching == ttm_cached) +\t{ +#ifdef CONFIG_ARM64 +\treturn pgprot_dmacoherent(tmp); +#endif return tmp; +\t} #if defined(__i386__) || defined(__x86_64__) if (caching == ttm_write_combined) -- 2.49.0 # we first apply the patch $ git apply # now we build the kernel. i have 16 cores, so i will build with -j 16 $ make -j 16 Copy to SD-card # I mounted the SD-cart to /run/media/opvolger/BOOTFS/ and /run/media/opvolger/fedora/. with dolphin (auto mount).\nNow create the file /run/media/opvolger/BOOTFS/config.txt with nano or something else.\nHere you can set some pi-setting for boot time\n# no idea if they are all needed # Automatically load overlays for detected DSI displays display_auto_detect=1 # Automatically load initramfs files, if found (we don\u0026#39;t) auto_initramfs=1 # Run in 64-bit mode arm_64bit=1 # Disable compensation for displays with overscan disable_overscan=1 # Run as fast as firmware / board allows arm_boost=1 # The name of the kernel kernel=Image # enable pci-express dtparam=pciex1 # enable serial (so you can see what is going wrong over serial) enable_serial=1 enable_uart=1 First check you PARTUUID of your fedora rootfs. You can do this with with the command blkid\n$ blkid ................ ................ ................ ................ /dev/sdb1: LABEL_FATBOOT=\u0026#34;BOOTFS\u0026#34; LABEL=\u0026#34;BOOTFS\u0026#34; UUID=\u0026#34;F830-72A5\u0026#34; BLOCK_SIZE=\u0026#34;512\u0026#34; TYPE=\u0026#34;vfat\u0026#34; PARTUUID=\u0026#34;a5e8e31d-01\u0026#34; /dev/zram0: LABEL=\u0026#34;zram0\u0026#34; UUID=\u0026#34;d3cb02f4-a70f-4f48-92ce-1bb0474c14fc\u0026#34; TYPE=\u0026#34;swap\u0026#34; /dev/sdb3: LABEL=\u0026#34;fedora\u0026#34; UUID=\u0026#34;fe1a5809-2964-4049-804b-c6308eea9706\u0026#34; UUID_SUB=\u0026#34;8695f5be-13c2-4f38-9ec4-ca593ac9665d\u0026#34; BLOCK_SIZE=\u0026#34;4096\u0026#34; TYPE=\u0026#34;btrfs\u0026#34; PARTUUID=\u0026#34;a5e8e31d-03\u0026#34; Now create the file /run/media/opvolger/BOOTFS/cmdline.txt with nano or something else.\nThis will add kernel argument on boot time. We enable serial output, set the correct settings for the root-fs of fedora, disable radeon drivers and enable amdgpu drivers.\nHere we can use a5e8e31d-03 for the PARTUUID. don\u0026rsquo;t forget to update. The boot process will stop. (it will not find a root partition).\nconsole=serial0,115200 console=tty1 root=PARTUUID=a5e8e31d-03 ro rootflags=subvol=root rhgb rootflags=subvol=root fsck.repair=yes rootwait plymouth.ignore-serial-consoles radeon.si_support=0 radeon.cik_support=0 amdgpu.si_support=1 amdgpu.cik_support=1 Now we change the fstab file from the fedora root partition. We have deleted the boot partition, so we must delete it from the mount on startup.\nsudo nano /run/media/opvolger/fedora/root/etc/fstab Add a # for the /boot and /boot/efi mounts. On a newer version the UUID\u0026rsquo;s can be different, keep them, only add the # on the lines where /boot annd /boot/efi are located.\nUUID=fe1a5809-2964-4049-804b-c6308eea9706 / btrfs x-systemd.growfs,compress=zstd:1,defaults,subvol=root 0 1 #UUID=c17a86dd-8323-4e0d-9595-3ba0107f6345 /boot ext4 defaults 0 0 UUID=fe1a5809-2964-4049-804b-c6308eea9706 /home btrfs x-systemd.growfs,compress=zstd:1,subvol=home 0 0 UUID=fe1a5809-2964-4049-804b-c6308eea9706 /var btrfs x-systemd.growfs,compress=zstd:1,subvol=var 0 0 #UUID=9AB8-3989 /boot/efi vfat defaults,umask=0077,shortname=winnt 0 0 Now we only have to copy the kernel files!\n$ cd /home/opvolger/demo/raspberrypi-6.12-y # copy kernel and device tree to boot partition SD-card $ cp arch/arm64/boot/Image /run/media/opvolger/BOOTFS/ $ cp arch/arm64/boot/dts/broadcom/bcm2712-rpi-5-b.dtb /run/media/opvolger/BOOTFS/ # copy overlay needed for pi boot process $ mkdir /run/media/opvolger/BOOTFS/overlays $ cp /home/opvolger/demo/raspberrypi-6.12-y/arch/arm64/boot/dts/overlays/* /run/media/opvolger/BOOTFS/overlays # now make the modules install them on the SD-card root partition (fedora) $ sudo ARCH=arm64 make modules_install INSTALL_MOD_PATH=/run/media/opvolger/b3712769-f055-426b-b48b-dfd0f9fc2b3a/ Boot from SD-Card # Umount the root and boot partitions from the SD-card.\nIf everything works great, you will see a setup and can create a user.\nInstall Stream # We need to install fex (intel/amd64 emulator), it needs it own root-fs. We will make one for him.\n$ sudo dnf install fex-emu fex-emu-filesystem fex-emu-rootfs-fedora fex-emu-thunks fex-emu-utils erofs-fuse erofs-utils squashfuse squashfuse-libs patchelf Now run FEXRootFSFetcher to create a intel/amd64 root-fs. I had the most success with Ubuntu 24.04.\n$ FEXRootFSFetcher RootFS not found. Do you want to try and download one? Response {y,yes,1} or {n,no,0} $ y RootFS list selection Options: 0: Cancel 1: Fedora 40 (EroFS) 2: Fedora 40 (SquashFS) 3: Fedora 38 (EroFS) 4: Fedora 38 (SquashFS) 5: ArchLinux (EroFS) 6: ArchLinux (SquashFS) 7: Ubuntu 24.04 (EroFS) 8: Ubuntu 24.04 (SquashFS) 9: Ubuntu 23.10 (EroFS) 10: Ubuntu 23.10 (SquashFS) 11: Ubuntu 23.04 (EroFS) 12: Ubuntu 23.04 (SquashFS) 13: Ubuntu 22.10 (EroFS) 14: Ubuntu 22.10 (SquashFS) 15: Ubuntu 22.04 (EroFS) 16: Ubuntu 22.04 (SquashFS) 17: Ubuntu 20.04 (EroFS) 18: Ubuntu 20.04 (SquashFS) Response {1-18} or 0 to cancel $ 7 Selected Rootfs: Ubuntu 24.04 (EroFS) URL: https://rootfs.fex-emu.gg/Ubuntu_24_04/2025-03-04/Ubuntu_24_04.ero Are you sure that you want to download this image Response {y,yes,1} or {n,no,0} $ y % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 1393M 100 1393M 0 0 34.0M 0 0:00:40 0:00:40 --:--:-- 33.4M Do you wish to extract the erofs file or use it as-is? Options: 0: Cancel 1: Extract 2: As-Is Response {1-2} or 0 to cancel $ 1 Extracting Erofs. This might take a few minutes. Do you wish to set this RootFS as default? Response {y,yes,1} or {n,no,0} $ y Ubuntu_24_04 set as default RootFS We now have a root-fs for intel/amd64 (games). But we need to install steam and dependacies, so we can game!\n# here is the intel/amd64 root-fs located $ cd ~/.fex-emu/RootFS/Ubuntu_24_04/ # get into the root-fs (so we can install steam on the root-fs) $ python chroot.py chroot INFO:root:Creating FEX paths INFO:root:Copying FEXInterpreter depends INFO:root:Patching FEX dependencies INFO:root:Mounting rootfs paths INFO:root:Setting up FEXServer config INFO:root:Chrooting in to /home/opvolger/.fex-emu/RootFS/Ubuntu_24_04 root@raspberrypi:/# apt update ..... ..... ..... ..... Get:73 http://archive.ubuntu.com/ubuntu noble-backports/main amd64 Components [7144 B] Get:74 http://archive.ubuntu.com/ubuntu noble-backports/universe i386 Packages [15.8 kB] Get:75 http://archive.ubuntu.com/ubuntu noble-backports/universe amd64 Packages [28.9 kB] Get:76 http://archive.ubuntu.com/ubuntu noble-backports/universe Translation-en [17.5 kB] Get:77 http://archive.ubuntu.com/ubuntu noble-backports/universe amd64 Components [11.0 kB] Get:78 http://archive.ubuntu.com/ubuntu noble-backports/restricted amd64 Components [212 B] Get:79 http://archive.ubuntu.com/ubuntu noble-backports/multiverse amd64 Components [212 B] Fetched 76.5 MB in 20s (3846 kB/s) Reading package lists... Done Building dependency tree... Done Reading state information... Done 189 packages can be upgraded. Run \u0026#39;apt list --upgradable\u0026#39; to see them. root@raspberrypi:/# apt install steam ..... ..... ..... ..... Recommended packages: luit The following NEW packages will be installed: bubblewrap cpp cpp-13 cpp-13-x86-64-linux-gnu cpp-x86-64-linux-gnu file fuse3 gcc-13-base libauthen-sasl-perl libclone-perl libdata-dump-perl libencode-locale-perl libfile-basedir-perl libfile-desktopentry-perl libfile-listing-perl libfile-mimeinfo-perl libfont-afm-perl libfuse3-3 libhtml-form-perl libhtml-format-perl libhtml-parser-perl libhtml-tagset-perl libhtml-tree-perl libhttp-cookies-perl libhttp-daemon-perl libhttp-date-perl libhttp-message-perl libhttp-negotiate-perl libio-html-perl libio-socket-ssl-perl libio-stringy-perl libipc-system-simple-perl libisl23 liblwp-mediatypes-perl liblwp-protocol-https-perl libmagic-mgc libmagic1t64 libmailtools-perl libmpc3 libmpfr6 libnet-dbus-perl libnet-http-perl libnet-smtp-ssl-perl libnet-ssleay-perl libnm0 libnm0:i386 libpipewire-0.3-0t64 libpipewire-0.3-common libspa-0.2-modules libtext-iconv-perl libtie-ixhash-perl libtimedate-perl libtry-tiny-perl liburi-perl libva-glx2 libva-glx2:i386 libwww-perl libwww-robotrules-perl libx11-protocol-perl libxkbfile1 libxml-parser-perl libxml-twig-perl libxml-xpathengine-perl libxmuu1 libxxf86dga1 perl-openssl-defaults steam:i386 steam-devices steam-installer steam-libs steam-libs:i386 steam-libs-i386:i386 x11-utils x11-xserver-utils xdg-desktop-portal xdg-desktop-portal-gtk xdg-utils 0 upgraded, 77 newly installed, 0 to remove and 189 not upgraded. Need to get 17.8 MB of archives. After this operation, 63.1 MB of additional disk space will be used. Do you want to continue? [Y/n] Y ..... ..... ..... ..... Setting up libmailtools-perl (2.21-2) ... Setting up libhttp-daemon-perl (6.16-1) ... Setting up cpp (4:13.2.0-7ubuntu1) ... Setting up xdg-desktop-portal-gtk (1.15.1-1build2) ... Setting up x11-xserver-utils (7.7+10build2) ... Setting up liblwp-protocol-https-perl (6.13-1) ... Setting up libwww-perl (6.76-1) ... Setting up libxml-parser-perl (2.47-1build3) ... Setting up libxml-twig-perl (1:3.52-2) ... Setting up libnet-dbus-perl (1.2.0-2build3) ... Processing triggers for hicolor-icon-theme (0.17-2) ... Processing triggers for libc-bin (2.39-0ubuntu8.4) ... root@raspberrypi:/# exit INFO:root:Returning from chroot INFO:root:Deleting FEX paths INFO:root:Unmount rootfs paths [sudo] password for opvolger: INFO:root:Fixing any potential permission issues We now have installed steam on the root-fs on the emulator. Now we need to install steam on the system. This can be done with the script from box64\n$ cd ~/ $ wget https://raw.githubusercontent.com/ptitSeb/box64/refs/heads/main/install_steam.sh $ chmod +x install_steam.sh $ ./install_steam.sh # run steam! $ FEXBatch FEXBash-opvolger@raspberrypi:~\u0026gt; steam This can give an error of missing packages\u0026hellip; just hit Enter and continue.\nThis script will install Steam in your home dir. After the setup is finished you can start Steam just with the command FEXBatch and than steam. ignore all the errors you see in your screen\u0026hellip;. Steam client will start!\nDownload Half Life 2. Start your game!\nDemo # ","date":"9 November 2025","externalUrl":null,"permalink":"/posts/raspberrypi5/2025-11-09-fedora-ati-radeon-r9-290/","section":"Posts","summary":"","title":"Raspberry Pi 5 - Fedora with AMDGPU and Halflife 2","type":"posts"},{"content":"","date":"9 November 2025","externalUrl":null,"permalink":"/tags/raspberry-pi/","section":"Tags","summary":"","title":"Raspberry-Pi","type":"tags"},{"content":"","date":"9 November 2025","externalUrl":null,"permalink":"/tags/raspberry-pi-5/","section":"Tags","summary":"","title":"Raspberry-Pi-5","type":"tags"},{"content":" Fedora on Pinebook Pro # Some stuff I did after installing Fedora on my Pinebook Pro.\nhowto from nullr0ute\nsudo dnf install arm-image-installer uboot-images-armv8 sudo spi-flashing-disk --target=pinebook-pro-rk3399 --media=/dev/sdb Now remove the mSD card from your host and put it into the Pinebook Pro. Press the power button, from experience you likely need to press and momentarily hold and in a second or two the display will light up with text output. Interrupt the boot by pressing space. Next up we write out the flash:\nHit any key to stop autoboot: 0 =\u0026gt; ls mmc 1:1 182272 idbloader.img 364544 idbloader-spi.img 1079808 u-boot.itb 1997312 u-boot-rockchip.bin 1997312 u-boot-rockchip-spi.bin 5 file(s), 0 dir(s) =\u0026gt; sf probe SF: Detected gd25q128 with page size 256 Bytes, erase size 4 KiB, total 16 MiB =\u0026gt; load mmc 1:1 ${fdt_addr_r} u-boot-rockchip-spi.bin 1997312 bytes read in 39 ms (8.2 MiB/s) =\u0026gt; sf update ${fdt_addr_r} 0 ${filesize} device 0 offset 0x0, size 0x52000 61440 bytes written, 274432 bytes skipped in 0.803s, speed 427777 B/s sudo arm-image-installer --media=/dev/sdb --resizefs --target=none --image=/home/opvolger/Downloads/Fedora-KDE-Desktop-Disk-42-1.1.aarch64.raw.xz fix install wifi firmware # wget https://fedora.roving-it.com/brcm-pinebookpro-0.0-1.noarch.rpm sudo yum install brcm-pinebookpro-0.0-1.noarch.rpm fix BlueTooth firmware # sudo dnf copr enable jwillikers/pinebook-pro sudo yum install ap6256-firmware Fix sound for Pinebook Pro # wget https://gitlab.manjaro.org/manjaro-arm/packages/community/pinebookpro-post-install/-/raw/master/asound.state alsactl --file asound.state restore ","date":"7 July 2025","externalUrl":null,"permalink":"/posts/pipebook-pro/2025-07-07-fedora-fix-after-install/","section":"Posts","summary":"","title":"Pinebook Pro - Fedora setup","type":"posts"},{"content":"","date":"7 July 2025","externalUrl":null,"permalink":"/tags/pinebook-pro/","section":"Tags","summary":"","title":"Pinebook-Pro","type":"tags"},{"content":" Intro # Debian (Trixie) has now officially support RISC-V. At the time of writing it is still in beta / first release candidate.\nHardware # This is my hardware setup:\nStarFive VisionFive 2 BEYIMEI PCIE Riser-Ver010X GPU Riser, 1X tot 16X (4PIN/6PIN/MOLEX) PCIE-verlengkabel, M.2 naar PCI-E Riser Card Bitcoin Litecoin Ethereum. This is about 11 EURO on amazon, so no big deal\u0026hellip; amazon-link AMD/ATI Hawaii PRO [Radeon R9 290/390], Bought on a Dutch second-hand website, for 45 EURO. or ATI Radeon 5450, Bought on a Dutch second-hand website, for 10 EURO. An ATX power supply (was still lying around in the house) For debugging a USB to TTL (was still lying around in the house), is about 5 EURO. or I created a \u0026ldquo;stand\u0026rdquo; for this all, see StarFive VisionFive 2 GPU stand (3D design).\nSetup Debian Trixie # I have my StarFive VisionFive 2 configured that it boots from SD-card, for more information see to doc from u-boot.\nI will boot from SD-Card into the setup (with some U-boot commands). The setup iso will be on an USB device (iso). I will install Debian Trixie on my eMMC module. After the setup i still use the SD-Card but now to boot to the eMMC. I will only use U-boot from the SD-Card.\nDownload Debian Trixie # At the time of writing the installer is still in develop, so the link for RC1 can be found here here. I downloaded the RISC-V DVD for riscv64, and the boot files that are needed\niso (setup). netboot. $ cd ~/Downloads $ mkdir DebianTrixie $ cd DebianTrixie $ wget https://cdimage.debian.org/cdimage/trixie_di_rc1/riscv64/iso-dvd/debian-trixie-DI-rc1-riscv64-DVD-1.iso $ wget https://cdimage.debian.org/cdimage/trixie_di_rc1/riscv64/iso-cd/debian-trixie-DI-rc1-riscv64-netinst.iso # extract the netinst iso (for example with 7z) $ 7z x debian-trixie-DI-rc1-riscv64-netinst.iso 7-Zip [64] 16.02 : Copyright (c) 1999-2016 Igor Pavlov : 2016-05-21 p7zip Version 16.02 (locale=en_US.UTF-8,Utf16=on,HugeFiles=on,64 bits,16 CPUs AMD Ryzen 7 2700X Eight-Core Processor (800F82),ASM,AES-NI) Scanning the drive for archives: 1 file, 638889984 bytes (610 MiB) Extracting archive: debian-trixie-DI-rc1-riscv64-netinst.iso WARNINGS: There are data after the end of archive -- Path = debian-trixie-DI-rc1-riscv64-netinst.iso Type = Iso WARNINGS: There are data after the end of archive Physical Size = 635740160 Tail Size = 3149824 Created = 2025-05-16 01:51:48 Modified = 2025-05-16 01:51:48 Everything is Ok Archives with Warnings: 1 Warnings: 1 Folders: 475 Files: 1231 Size: 789563228 Compressed: 638889984 Compile the latest version of U-Boot # Debian Trixie delivered no U-Boot, so we need the complit it your self. For more information see to doc from u-boot.\nThis is how I compiled it.\nFirst compile OPENSBI\n$ cd /tmp $ git clone --dept 1 --branch v1.6 https://github.com/riscv-software-src/opensbi.git Cloning into \u0026#39;opensbi\u0026#39;... remote: Enumerating objects: 513, done. remote: Counting objects: 100% (513/513), done. remote: Compressing objects: 100% (465/465), done. remote: Total 513 (delta 52), reused 250 (delta 32), pack-reused 0 (from 0) Receiving objects: 100% (513/513), 575.15 KiB | 10.85 MiB/s, done. Resolving deltas: 100% (52/52), done. warning: refs/tags/v1.6 958c08fa3d21612f6fdc684395011e040e9c8c22 is not a commit! Note: switching to \u0026#39;bd613dd92113f683052acfb23d9dc8ba60029e0a\u0026#39;. You are in \u0026#39;detached HEAD\u0026#39; state. You can look around, make experimental changes and commit them, and you can discard any commits you make in this state without impacting any branches by switching back to a branch. If you want to create a new branch to retain commits you create, you may do so (now or later) by using -c with the switch command. Example: git switch -c \u0026lt;new-branch-name\u0026gt; Or undo this operation with: git switch - Turn off this advice by setting config variable advice.detachedHead to false $ cd opensbi $ make CROSS_COMPILE=riscv64-linux-gnu- PLATFORM=generic FW_OPTIONS=0 FW_TEXT_START=0x40000000 Loaded configuration \u0026#39;/tmp/opensbi/platform/generic/configs/defconfig\u0026#39; Configuration saved to \u0026#39;/tmp/opensbi/build/platform/generic/kconfig/.config\u0026#39; CC-DEP platform/generic/platform.dep CC-DEP lib/sbi/riscv_asm.dep CC-DEP lib/sbi/riscv_atomic.dep AS-DEP lib/sbi/riscv_hardfp.dep CC-DEP lib/sbi/riscv_locks.dep CC-DEP lib/sbi/sbi_ecall.dep CC-DEP lib/sbi/sbi_ecall_base.dep ... ... ... OBJCOPY platform/generic/firmware/fw_jump.bin AS platform/generic/firmware/fw_payload.o CPP platform/generic/firmware/fw_payload.elf.ld ELF platform/generic/firmware/fw_payload.elf OBJCOPY platform/generic/firmware/fw_payload.bin So we have OPENSBI, now build U-Boot\n$ cd /tmp $ git clone --dept 1 --branch v2025.07-rc3 https://github.com/u-boot/u-boot.git Cloning into \u0026#39;u-boot\u0026#39;... remote: Enumerating objects: 38201, done. remote: Counting objects: 100% (38201/38201), done. remote: Compressing objects: 100% (31307/31307), done. remote: Total 38201 (delta 7245), reused 32889 (delta 6329), pack-reused 0 (from 0) Receiving objects: 100% (38201/38201), 50.35 MiB | 42.26 MiB/s, done. Resolving deltas: 100% (7245/7245), done. warning: refs/tags/v2025.07-rc3 5c221a09d58511bef3f99874a2bfa076128d36bc is not a commit! Note: switching to \u0026#39;2ca1398a5ece8d33d8feb6b410e6e38588b5d2bc\u0026#39;. You are in \u0026#39;detached HEAD\u0026#39; state. You can look around, make experimental changes and commit them, and you can discard any commits you make in this state without impacting any branches by switching back to a branch. If you want to create a new branch to retain commits you create, you may do so (now or later) by using -c with the switch command. Example: git switch -c \u0026lt;new-branch-name\u0026gt; Or undo this operation with: git switch - Turn off this advice by setting config variable advice.detachedHead to false Updating files: 100% (36214/36214), done. $ cd u-boot $ make CROSS_COMPILE=riscv64-linux-gnu- starfive_visionfive2_defconfig HOSTCC scripts/basic/fixdep HOSTCC scripts/kconfig/conf.o YACC scripts/kconfig/zconf.tab.c LEX scripts/kconfig/zconf.lex.c HOSTCC scripts/kconfig/zconf.tab.o HOSTLD scripts/kconfig/conf # # configuration written to .config # $ # with CONFIG_CMD_PCI and CONFIG_PCI_INIT_R to no, we will not init the pci (nvme) in u-boot. Not all AMDGPU like the \u0026#34;probe\u0026#34; from u-boot. $ sed -i -e \u0026#39;s/CONFIG_PCI_INIT_R=y/CONFIG_CMD_PCI=n/g\u0026#39; .config $ sed -i -e \u0026#39;s/CONFIG_PCI_INIT_R=y/CONFIG_PCI_INIT_R=n/g\u0026#39; .config $ make CROSS_COMPILE=riscv64-linux-gnu- OPENSBI=../opensbi/build/platform/generic/firmware/fw_payload.bin CONFIG_DEFAULT_FDT_FILE=starfive/jh7110-starfive-visionfive-2-v1.3b.dtb scripts/kconfig/conf --syncconfig Kconfig UPD include/config.h CFG u-boot.cfg GEN include/autoconf.mk GEN include/autoconf.mk.dep ... ... ... LD spl/u-boot-spl OBJCOPY spl/u-boot-spl-nodtb.bin mkdir -p spl/dts/ FDTGREP spl/dts/dt-spl.dtb COPY spl/u-boot-spl.dtb CAT spl/u-boot-spl-dtb.bin COPY spl/u-boot-spl.bin SYM spl/u-boot-spl.sym MKIMAGE u-boot.img COPY u-boot.dtb MKIMAGE u-boot-dtb.img BINMAN .binman_stamp OFCHK .config Create bootable SD-Card # So we now have a compiled U-boot. Time to put it on a SD-Card (partitiontable must be GPT not MBR)\nI will create the default 2 boot partitions and a bigger one so we can put the debian kernel en setup (initramfs) on it.\nOn my machine my SD-Card reader is on /dev/sdb so:\n# create the correct boot partitions to boot (needs sudo) $ sudo sgdisk --clear \\ --set-alignment=2 \\ --new=1:4096:8191 --change-name=1:spl --typecode=1:2E54B353-1271-4842-806F-E436D6AF6985 \\ --new=2:8192:16383 --change-name=2:uboot --typecode=2:BC13C2FF-59E6-4262-A352-B275FD6F7172 \\ --new=3:16384:500000 --change-name=3:setup --typecode=3:BC13C2FF-59E6-4262-A352-B275FD6F7173 \\ /dev/sdb [sudo] password for opvolger: The operation has completed successfully. # format the setup partition (may you get a Proceed anyway? question) $ sudo mkfs.ext4 /dev/sdb3 Creating filesystem with 241808 1k blocks and 60480 inodes Filesystem UUID: 3293ff0d-cf67-4e73-b520-8e41c68fe867 Superblock backups stored on blocks: 8193, 24577, 40961, 57345, 73729, 204801, 221185 Allocating group tables: done Writing inode tables: done Creating journal (4096 blocks): done Writing superblocks and filesystem accounting information: done # now put the firmware on partition 1 and 2 $ sudo dd if=/tmp/u-boot/spl/u-boot-spl.bin.normal.out of=/dev/sdb1 293+1 records in 293+1 records out 150047 bytes (150 kB, 147 KiB) copied, 0,0301388 s, 5,0 MB/s $ sudo dd if=/tmp/u-boot/u-boot.itb of=/dev/sdb2 6076+1 records in 6076+1 records out 3111253 bytes (3,1 MB, 3,0 MiB) copied, 1,19107 s, 2,6 MB/s # now mount and copy the boot files from debian to the 3th partition $ mkdir /tmp/mnt $ sudo mount /dev/sdb3 /tmp/mnt $ sudo cp ~/Downloads/DebianTrixie/dtb/starfive/jh7110-starfive-visionfive-2-v1.3b.dtb /tmp/mnt/jh7110-starfive-visionfive-2-v1.3b.dtb $ sudo cp ~/Downloads/DebianTrixie/install/* /tmp/mnt/ $ sudo umount /dev/sdb3 The SD-Card is now ready\nBut the debian-trixie-DI-rc1-riscv64-DVD-1.iso on USB # I used balenaEtcher to flash the iso on a USB device.\nRun the Debian Setup # Put on eMMC on the StarFive VisionFive 2 to install Debian on. Put the USB with the iso on an USB-slot and put the SD-Card in the SD-Card slot.\nLets Boot!\nI have a serial connection to my StarFive VisionFive 2 running on boot. It will look someting like this: (start a serial connection for example with screen -L /dev/ttyUSB0 115200, how to connect to serial see this pdf)\nU-Boot SPL 2025.07-rc3 (Jun 09 2025 - 18:21:24 +0200) DDR version: dc2e84f0. Trying to boot from MMC2 OpenSBI v1.6 ____ _____ ____ _____ / __ \\ / ____| _ \\_ _| | | | |_ __ ___ _ __ | (___ | |_) || | | | | | \u0026#39;_ \\ / _ \\ \u0026#39;_ \\ \\___ \\| _ \u0026lt; | | | |__| | |_) | __/ | | |____) | |_) || |_ \\____/| .__/ \\___|_| |_|_____/|____/_____| | | |_| Platform Name : StarFive VisionFive 2 v1.3B ... ... ... U-Boot 2025.07-rc3 (Jun 09 2025 - 18:21:24 +0200) CPU: sifive,u74-mc Model: StarFive VisionFive 2 v1.3B ... ... ... Net: eth0: ethernet@16030000, eth1: ethernet@16040000 starting USB... No USB controllers found scanning usb for storage devices... 0 Storage Device(s) found Working FDT set to ff71b200 Hit any key to stop autoboot: 0 StarFive # I hit a key to stop boot.\n# reset to all the defaults environment settings $ env default -a ## Resetting to default environment $ saveenv Saving Environment to SPIFlash... Erasing SPI flash...Writing to SPI flash...done OK # now have a look at the 3th partition of the SD-Card (mmc 1 == SD Card, mmc 0 == eMMC) $ ls mmc 1:3 ./ ../ lost+found/ 38025 jh7110-starfive-visionfive-2-v1.3b.dtb 49399458 initrd.gz 31158272 vmlinux 3 file(s), 3 dir(s) # we see the files, we can boot to the setup of Debian # load the kernel, devicetree and ramdisk in memory $ load mmc 1:3 ${kernel_addr_r} /vmlinux $ load mmc 1:3 ${fdt_addr_r} /jh7110-starfive-visionfive-2-v1.3b.dtb $ load mmc 1:3 ${ramdisk_addr_r} /initrd.gz # we don\u0026#39;t need bootargs $ setenv bootargs \u0026#39;\u0026#39; # and boot! $ booti $kernel_addr_r $ramdisk_addr_r:$filesize $fdt_addr_r I everything goes correct, you will see the Debain Setup!\nThe Setup of Debian # Set you keyboard and location, setup network and an user.\nPartition disks # I used Guided - use entire disk for Partitioning method:\nBy Select disk to partition, i used the eMMC MMC/SD card #1 (mmcblk0) - 61.9 GB MMC A3A561 and use sheme All files in one partition (recommended for new users).\nAnd of course i am sure\u0026hellip;\nConfigure the package manager # Use a network mirrors, Yes! I selected debian.org not all mirrors will have the RC1 of Trixie (I think).\nContinue the Architecture doesn't support \u0026quot;NaN passing\u0026quot; errors # Just accept it!\nNo boot loader installed # The setup will give you the warning\nNo boot loader has been installed, either because you chose not to or because your specific architecture doesn\u0026#39;t support a boot loader yet. You will need to boot manually with the /boot/vmlinuz kernel on partition /dev/mmcblk0p1 and root=/dev/mmcblk0p1 passed as a kernel argument. Thnx, now we now the kernel argument we need to boot.\nFirst Boot # U-Boot SPL 2025.07-rc3 (Jun 09 2025 - 18:21:24 +0200) DDR version: dc2e84f0. Trying to boot from MMC2 OpenSBI v1.6 ____ _____ ____ _____ / __ \\ / ____| _ \\_ _| | | | |_ __ ___ _ __ | (___ | |_) || | | | | | \u0026#39;_ \\ / _ \\ \u0026#39;_ \\ \\___ \\| _ \u0026lt; | | | |__| | |_) | __/ | | |____) | |_) || |_ \\____/| .__/ \\___|_| |_|_____/|____/_____| | | |_| Platform Name : StarFive VisionFive 2 v1.3B ... ... ... U-Boot 2025.07-rc3 (Jun 09 2025 - 18:21:24 +0200) CPU: sifive,u74-mc Model: StarFive VisionFive 2 v1.3B ... ... ... Net: eth0: ethernet@16030000, eth1: ethernet@16040000 starting USB... No USB controllers found scanning usb for storage devices... 0 Storage Device(s) found Working FDT set to ff71b200 Hit any key to stop autoboot: 0 StarFive # I hit a key to stop boot.\n# now have a look at /usr/lib/, so we can find the correct linux-image directory name $ ls mmc 0:1 /usr/lib/ ./ ../ riscv64-linux-gnu/ \u0026lt;SYM\u0026gt; ld-linux-riscv64-lp64d.so.1 tmpfiles.d/ apt/ dpkg/ systemd/ 286 os-release locale/ ... ... ... 79296 klibc-MkFWPdInFSYtTCP4fW_ZdljVYqU.so dbus-1.0/ tasksel/ linux-image-6.12.27-riscv64/ console-setup/ linux-image-6.12.30-riscv64/ cups/ ... ... ... udisks2/ firewalld/ pppd/ pm-utils/ \u0026lt;SYM\u0026gt; cpp speech-dispatcher-modules/ 8 file(s), 72 dir(s) # find the latest linux-image-6.12.xxxx-riscv64 # load the kernel, devicetree and ramdisk in memory $ load mmc 0:1 ${kernel_addr_r} /boot/vmlinuz $ load mmc 0:1 ${fdt_addr_r} /usr/lib/linux-image-6.12.30-riscv64/starfive/jh7110-starfive-visionfive-2-v1.3b.dtb $ load mmc 0:1 ${ramdisk_addr_r} /boot/initrd.img $ setenv bootargs \u0026#39;root=/dev/mmcblk0p1\u0026#39; # and boot! $ booti $kernel_addr_r $ramdisk_addr_r:$filesize $fdt_addr_r The first boot can take some time, you have to wait for the apparmor.service a long time\u0026hellip;\nTODO after first boot # Disable sleep (freeze the system) # sudo systemctl mask sleep.target suspend.target hibernate.target hybrid-sleep.target Remove CD-ROM from install medium # sudo nano /etc/apt/sources.list Command out the line starts with deb cdrom:\nCreate boot.scr # sudo nano /boot/boot.cmd put this in boot.cmd\nload mmc 0:1 ${kernel_addr_r} /boot/vmlinuz load mmc 0:1 ${fdt_addr_r} /usr/lib/linux-image-6.12.30-riscv64/starfive/jh7110-starfive-visionfive-2-v1.3b.dtb load mmc 0:1 ${ramdisk_addr_r} /boot/initrd.img setenv bootargs \u0026#39;root=/dev/mmcblk0p1\u0026#39; booti $kernel_addr_r $ramdisk_addr_r:$filesize $fdt_addr_r now create the boot.scr from boot.cmd\nsudo apt install u-boot-tools sudo mkimage -C none -A arm -T script -d /boot/boot.cmd /boot.scr It will now boot automaticly (in u-boot boot.scr will be loaded).\nIf there is a new kernel, you will need to update the boot.cmd and recreate the boot.scr file. the device-tree can become out of sync with the new kernel!\n","date":"9 June 2025","externalUrl":null,"permalink":"/posts/starfive-visionfive-2/2025-06-09-debiantrixie-amdgpu/","section":"Posts","summary":"","title":"StarFive VisionFive 2 - Debian Trixie with external AMDGPU","type":"posts"},{"content":" Intro # Ubuntu 25.04 is using the 6.14 kernel. This has the PCI-e controller of JH7110 SoC + AMDGPU drivers that are working with RISC-V. So if you have a M.2 to pci-e adapter you can now run Ubuntu with AMDGPU on RISC-V (without building your own kernel with patches etc.)\nThe only problem is now the U-boot that initialize the PCI-e controller to scan for M.2 drivers. Some of my AMDPGU do not like that (fan 100% and not detected anymore in the kernel).\nSo we need a U-boot (with the patches from Ubuntu) without the initialization of the PCI-e controller. I have build that and release the flash-files (u-boot + opensbi) on github.\nSo we can now just flash Ubuntu 25.04 to an eMMC and use the custom flash-files (u-boot + opensbi).\nA lot of my AMDGPU\u0026rsquo;s worked on this setup:\nATI Radeon HD 5450 (Cedar PRO) ATI Radeon HD 5850 (Cypress PRO) AMD Radeon R9 290 (Hawaii PRO) AMD Radeon R9 290X (Hawaii XT) not working:\nAMD Radeon RX 6600 (Navi 23 XL) It is booting, it gives screenoutput (black) and then the system hangs completely\nHardware Setup # I have configured my VisionFive 2 to boot from SD-card, see the last pages of this document.\nThe reason is I very often change u-boot / kernel, so i want them on the sd-card. (You can flash the created/downloaded firmware files and override the partitions 13 and 2 on the eMMC or flash it to the board. But this example will use a SD-card to boot).\nSo my setup is a SD-card to boot (custom U-boot) and an eMMC for the Ubuntu operation system (default Ubuntu kernel and GNU software)\nI have a M.2 to PCI-e board so I can add an AMDGPU on my VisionFive 2.\nIt can look something like this:\nor or see youtube video\nFlash Ubuntu 25.04 (beta) to eMMC # download from the site the image 25.04.\nI used \u0026ldquo;balenaEtcher\u0026rdquo; to flash this to my eMMC (with an USB to eMMC adapter).\nCreate/download u-boot without PCI-e initialization and flash to SD # We need a custom u-boot that will not try to initialize the PCI-e controller (scan for m.2 device). Some of the AMDGPU\u0026rsquo;s don\u0026rsquo;t like that (fan 100% and not detected anymore in the kernel)\nSo on build we need to set CONFIG_PCI_INIT_R and CONFIG_CMD_PCI to n (no).\nI all ready create this builds and they can be found here:\nInsert you SD-card (with GPT-partition-tables) in you computer (this example expect /dev/sdb to be your SD-card)\nwget https://github.com/Opvolger/ansible-riscv-sd-card-creater/releases/download/0.2.0/release.tgz tar -xvzf release.tgz # check where your SD-card is with lsblk, in this example it is /dev/sdb # delete MBR of SD-Card sudo dd if=/dev/zero of=/dev/sdb bs=512 count=1 conv=notrunc # we will create the needed partitions to boot from SD-card (for more information see https://docs.u-boot.org/en/latest/board/starfive/visionfive2.html) sudo sgdisk --clear \\ --set-alignment=2 \\ --new=1:4096:8191 --change-name=1:spl --typecode=1:2E54B353-1271-4842-806F-E436D6AF6985 \\ --new=2:8192:16383 --change-name=2:uboot --typecode=2:BC13C2FF-59E6-4262-A352-B275FD6F7172 \\ /dev/sdb # now \u0026#34;flash\u0026#34; the firmware on the sd-card sudo dd if=release/ubuntu-25-04/u-boot-spl.bin.normal.out of=/dev/sdb1 sudo dd if=release/ubuntu-25-04/u-boot.itb of=/dev/sdb2 If booting ubuntu is not working (you can see it with serial-connection for example screen -L /dev/ttyUSB0 115200), go back to default settings in u-boot with:\nhow to set the default is explained also in the ubuntu site. The only different is that I am using the sd-card and not the onboard flash.\nStarFive #\nenv default -f -a env save Reboot you board (power off/on)\nFirst boot Ubuntu # login with ubuntu/ubuntu (you have to change the password!)\n# set timezone sudo timedatectl set-timezone Europe/Amsterdam # check if the date is correct (now)! date # if not disable ntp sync timedatectl set-ntp false # update datetime to current date/time timedatectl set-time \u0026#39;2025-03-30 19:26:50\u0026#39; # enable ntp sync again timedatectl set-ntp true # update all packages sudo apt update sudo apt upgrade # add repo for firefox sudo add-apt-repository ppa:mozillateam/ppa # install what default stuff + install kde + firefox + some c dev tools (so you can compile some stuff) sudo apt install nano software-properties-common cmake cabextract sddm sddm-theme-breeze kde-standard build-essential libxml2 libcurl4-gnutls-dev fastfetch ubuntu-dev-tools libopenal-dev libpng-dev libjpeg-dev libfreetype6-dev libfontconfig1-dev libcurl4-gnutls-dev libsdl2-dev zlib1g-dev libbz2-dev libedit-dev python-is-python3 m4 clang firefox kde-spectacle # now reboot sudo reboot Fix network manager in KDE (so you can control network in KDE)\nsudo nano /etc/netplan/01-network-manager-all.yaml # Let NetworkManager manage all devices on this system network: version: 2 renderer: NetworkManager systemctl disable systemd-networkd.service systemctl enable NetworkManager.service Done # You will now see a KDE desktop login! Good luck and have fun!\n","date":"30 March 2025","externalUrl":null,"permalink":"/posts/starfive-visionfive-2/2025-03-30-ubuntu2504_outofthebox/","section":"Posts","summary":"","title":"StarFive VisionFive 2 - Ubuntu 25.04 (beta) AMDGPU","type":"posts"},{"content":" Intro # Ubuntu 24.10 is using the 6.11 kernel. This has the PCI-e controller of JH7110 SoC + AMDGPU drivers that are working with RISC-V. So if you have a M.2 to pci-e adapter you can now run Ubuntu with AMDGPU on RISC-V (without building your own kernel with patches etc.)\nThe only problem is now the U-boot that initialize the PCI-e controller to scan for M.2 drivers. Some of my AMDPGU do not like that (fan 100% and not detected anymore in the kernel).\nSo we need a U-boot (with the patches from Ubuntu) without the initialization of the PCI-e controller. I have build that and release the flash-files (u-boot + opensbi) on github.\nSo we can now just flash Ubuntu 24.10 to an eMMC and use the custom flash-files (u-boot + opensbi).\nA lot of my AMDGPU\u0026rsquo;s worked on this setup:\nATI Radeon HD 5450 (Cedar PRO) ATI Radeon HD 5850 (Cypress PRO) AMD Radeon R9 290 (Hawaii PRO) AMD Radeon R9 290X (Hawaii XT) not working:\nAMD Radeon RX 6600 (Navi 23 XL) It is booting, it gives screenoutput (black) and then the system hangs completely\nMy setup is a SD-card to boot (custom U-boot) and an eMMC for the Ubuntu operation system (default Ubuntu kernel and GNU software)\nFlash Ubuntu 24.10 to eMMC # download from the site the image 24.10.\nI used \u0026ldquo;balenaEtcher\u0026rdquo; to flash this to my eMMC (with an USB to eMMC adapter).\nCreate/download u-boot without PCI-e initialization and flash to SD # We need a custom u-boot that will not try to initialize the PCI-e controller (scan for m.2 device). Some of the AMDGPU\u0026rsquo;s don\u0026rsquo;t like that (fan 100% and not detected anymore in the kernel)\nSo on build we need to set CONFIG_PCI_INIT_R and CONFIG_CMD_PCI to n (no).\nI all ready create this builds and they can be found here:\nInsert you SD-card in you computer (this example expect /dev/sdb to be your SD-card)\nwget https://github.com/Opvolger/ansible-riscv-sd-card-creater/releases/download/0.1.0/release.tgz tar -xvzf release.tgz # check where your SD-card is with lsblk, in this example it is /dev/sdb # delete MBR of SD-Card sudo dd if=/dev/zero of=/dev/sdb bs=512 count=1 conv=notrunc # we will create the needed partitions to boot from SD-card (for more information see https://docs.u-boot.org/en/latest/board/starfive/visionfive2.html) sudo sgdisk --clear \\ --set-alignment=2 \\ --new=1:4096:8191 --change-name=1:spl --typecode=1:2E54B353-1271-4842-806F-E436D6AF6985 \\ --new=2:8192:16383 --change-name=2:uboot --typecode=2:BC13C2FF-59E6-4262-A352-B275FD6F7172 \\ /dev/sdb # now \u0026#34;flash\u0026#34; the firmware on the sd-card sudo dd if=release/ubuntu-24-10/u-boot-spl.bin.normal.out of=/dev/sdb1 sudo dd if=release/ubuntu-24-10/u-boot.itb of=/dev/sdb2 If booting ubuntu is not working (you can see it with serial-connection for example screen -L /dev/ttyUSB0 115200), go back to default settings in u-boot with:\nhow to set the default is explained also in the ubuntu site. The only different is that I am using the sd-card and not the onboard flash.\nStarFive #\nenv default -f -a env save Reboot you board (power off/on)\nFirst boot Ubuntu # login with ubuntu/ubuntu (you have to change the password!)\nsudo timedatectl set-timezone Europe/Amsterdam # check if the date is correct (now)! date sudo apt update sudo apt upgrade # add repo for firefox sudo add-apt-repository ppa:mozillateam/ppa # install what default stuff + install kde + firefox + some c dev tools (so you can compile some stuff) sudo apt install software-properties-common cmake cabextract sddm sddm-theme-breeze kde-standard build-essential libxml2 libcurl4-gnutls-dev neofetch ubuntu-dev-tools libopenal-dev libpng-dev libjpeg-dev libfreetype6-dev libfontconfig1-dev libcurl4-gnutls-dev libsdl2-dev zlib1g-dev libbz2-dev libedit-dev python-is-python3 m4 clang sddm-theme-breeze firefox I did get a configuration i had to fill in: Please enter the default mirror you want to be used by pbuilder. I hit enter and get the question again, so i filled in: http://archive.ubuntu.com/ubuntu and it was installing again.\n# now reboot sudo reboot Done # You will now see a KDE desktop login! Good luck and have fun!\n","date":"25 February 2025","externalUrl":null,"permalink":"/posts/starfive-visionfive-2/2025-02-25-ubuntu2410_outofthebox/","section":"Posts","summary":"","title":"StarFive VisionFive 2 - Ubuntu 24.10 AMDGPU","type":"posts"},{"content":" Intro # for more information see:\nxash3d-fwgs hlsdk-portable I have a StarFive VisionFive 2 with an AMD GPU (m2 -\u0026gt; PCI-e). This is running Ubuntu 24.10 with own build kernel 6.13.0. (default RISC-V + AMDGPU drivers). How i maked the kernel see OpenSUSEATIRadeonR9_290_mainline.md. How my build is running video.\nCompile Half-Life # command i used (maybe you need to install some packages):\n# install some dev packages sudo apt install git build-essential python3 libsdl2-dev libfontconfig-dev libfreetype-dev libopus-dev libbz2-dev # get the code (incl. sub repo\u0026#39;s) git clone --recursive https://github.com/FWGS/xash3d-fwgs.git git clone --recursive https://github.com/FWGS/hlsdk-portable.git # create dir where we will install hl mkdir /home/ubuntu/hl # build Xash3D (compatibility with Half-Life Engine/GoldSource) cd xash3d-fwgs/ ./waf configure -8 ./waf build ./waf install --destdir=/home/ubuntu/hl cd .. # build the game hl game cd hlsdk-portable ./waf configure -T release -8 ./waf cd .. # now copy the valve folder of the half-Life install from your steam isntall i have it installed on my main machine and copy it with scp. You can also copy the folder with a usb stick from a windows machine for example. scp -r opvolger@192.168.2.41:/home/opvolger/.steam/steam/steamapps/common/Half-Life/valve /home/ubuntu/hl # we have build are own hl game (code only), we need to copy it OVER the value dir we just copied. cp -r hlsdk-portable/build/* /home/ubuntu/hl/valve/ # the new builded libs are in dir cl_dll but must be in cl_dlls. # So we delete the copied cl_dlls from steam and rename the cl_dll to cl_dlls rm hl/valve/cl_dlls -rf mv hl/valve/cl_dll hl/valve/cl_dlls # now start the game! cd hl ./xash3d End result # video of playing hl on RISC-V\n","date":"31 January 2025","externalUrl":null,"permalink":"/posts/starfive-visionfive-2/2025-01-31-halflife/","section":"Posts","summary":"","title":"RISC-V - Compile halflife on RISC-V","type":"posts"},{"content":" Software # I used the VisionFive2 image of OpenSUSE Tumbleweed.\nHardware # Milk-V Jupiter AMD/ATI Radeon HD 5850, Bought on a Dutch second-hand website, for 15 EURO. For debugging a USB to TTL (was still lying around in the house), is about 5 EURO. Setup (hardware) # I have had multiple video cards directly in the jupiter.\nAMD RX 6600 It was detected, but with all firmwares i got a kernel panic. NVIDIA GeForce GTX 770, was detected also got to see kernel drivers with \u0026rsquo;lspci -k\u0026rsquo; but didn\u0026rsquo;t work. (gave no image). ATI Radeon HD 5450 works! got in KDE desktop (but was slow) ATI Radeon HD 5850 works! got in KDE desktop ATI Radeon R9 290 only works on a Riser board with another power supply. This setup is with only the ATI Radeon HD 5850, inserted in the mainboard. but most likely work with other ATI/AMD GPU\u0026rsquo;s.\nCompiling the kernel # I forked the Bianbu Linux - SpacemiT kernel.\nAfter the 6.1 kernel a lot is fixxed, so I now only need a config file.\nI have put all this in my github.\n# we need some firmwares in the kernel git clone --depth 1 git://git.kernel.org/pub/scm/linux/kernel/git/firmware/linux-firmware.git linux-firmware # we need the kernel git clone https://github.com/Opvolger/spacemit-k1-linux-6.6.git cd spacemit-k1-linux-6.6 Download/Download esos.elf and put it in linux-firmware directory (cloned from git.kernel.org)\n# create a .config for compiling the kernel without the onboard GPU and with the AMDGPU enabled. make ARCH=riscv CROSS_COMPILE=riscv64-linux-gnu- k1_extern_gpu_defconfig # i have added my GPU firmwares in the config file, maybe you need to edit the `.config` file. # find the line with CONFIG_EXTRA_FIRMWARE= and add you firmwares. i have a radeon/CYPRESS so search the kernel source code with the text `radeon/CYPRESS` and you will see all the *.bin files that are needed. or look in dir `linux-firmware/amdgpu/`. See list of codename/chipset (what is in the firmware) over here: https://help.ubuntu.com/community/RadeonDriver # build the kernel, i have 16 cores, so change it if you have more (or less). make ARCH=riscv CROSS_COMPILE=riscv64-linux-gnu- -j 16 The kernel will be here: arch/riscv/boot/Image.gz and dtb file here arch/riscv/boot/dts/spacemit/k1-x_milkv-jupiter.dtb.\nCreate SD-Card / eMMC / M2 with Opensuse Tumbleweed # Download Fedora Jupiter build # Download the Fedora 41 build. Direct Link to k1-fedora-minimal.img.gz\nI use this as a base, we replace the Fedora partition (root) for the OpenSuse Tumbleweed (root).\nDownload OpenSuse Tumbleweed build # Download the OpenSuse Tumbleweed image Direct Link to openSUSE-Tumbleweed-RISC-V-KDE.riscv64-rootfs.riscv64.tar.xz\nMaking it # Use a tool to flash the k1-fedora-minimal.img.gz to a CD-Card. U used balenaEtcher\nHere you can see that my CD-Card is /dev/sdb (fedora img has 6 parttions)\n$ lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINTS sda 8:0 0 223,6G 0 disk ‚îú‚îÄsda1 8:1 0 100M 0 part ‚îú‚îÄsda2 8:2 0 16M 0 part ‚îú‚îÄsda3 8:3 0 223G 0 part ‚îî‚îÄsda4 8:4 0 505M 0 part sdb 8:16 1 29,7G 0 disk ‚îú‚îÄsdb1 8:17 1 256K 0 part ‚îú‚îÄsdb2 8:18 1 64K 0 part ‚îú‚îÄsdb3 8:19 1 1M 0 part ‚îú‚îÄsdb4 8:20 1 2M 0 part ‚îú‚îÄsdb5 8:21 1 256M 0 part ‚îî‚îÄsdb6 8:22 1 2G 0 part zram0 252:0 0 8G 0 disk [SWAP] nvme0n1 259:0 0 465,8G 0 disk ‚îî‚îÄnvme0n1p1 259:1 0 465,8G 0 part nvme1n1 259:2 0 931,5G 0 disk ‚îú‚îÄnvme1n1p1 259:3 0 300M 0 part /boot/efi ‚îú‚îÄnvme1n1p2 259:4 0 280G 0 part / ‚îú‚îÄnvme1n1p3 259:5 0 8,8G 0 part [SWAP] ‚îî‚îÄnvme1n1p4 259:6 0 642,4G 0 part /home 1 = first stage bootloader (fsbl) 2 = saved environment variables for u-boot (env) 3 = RISC-V Open Source Supervisor Binary Interface (opensbi) 4 = U-Boot boot loader (uboot) 5 = kernel and devices-tree (bootfs) 6 = file-system (rootfs) We will replace the rootfs for the OpenSuse Tumbleweed rootfs.\nFirst we will delete the rootfs partition of Fedora and create a new root partition for OpenSuse Tumbleweed.\n$ sudo fdisk /dev/sdb [sudo] password for opvolger: Welcome to fdisk (util-linux 2.40.2). Changes will remain in memory only, until you decide to write them. Be careful before using the write command. GPT PMBR size mismatch (4726823 != 62333951) will be corrected by write. The backup GPT table is not on the end of the device. This problem will be corrected by write. Command (m for help): d Partition number (1-6, default 6): 6 Partition 6 has been deleted. Command (m for help): n Partition number (6-128, default 6): 6 First sector (896-62333918, default 532480): Last sector, +/-sectors or +/-size{K,M,G,T,P} (532480-62333918, default 62332927): Created a new partition 6 of type \u0026#39;Linux filesystem\u0026#39; and of size 29,5 GiB. Partition #6 contains a ext4 signature. Do you want to remove the signature? [Y]es/[N]o: N Command (m for help): w The partition table has been altered. Calling ioctl() to re-read partition table. Syncing disks. Remove and insert the SD-Card again.\nNow we will format the new partition\n$ sudo mkfs -t ext4 /dev/sdb6 mke2fs 1.47.1 (20-May-2024) /dev/sdb6 contains a ext4 file system labelled \u0026#39;rootfs\u0026#39; last mounted on /home/hezhengyu/program/images/fedora on Mon Jul 15 05:12:15 2024 Proceed anyway? (y,N) y Creating filesystem with 7725056 4k blocks and 1933312 inodes Filesystem UUID: ffafcae9-30cd-4b81-b4d2-23ad3ff5b340 Superblock backups stored on blocks: 32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, 4096000 Allocating group tables: done Writing inode tables: done Creating journal (32768 blocks): done Writing superblocks and filesystem accounting information: done You see that my partition is getting the UUID ffafcae9-30cd-4b81-b4d2-23ad3ff5b340, we will need this later in the env_k1-x.txt.\nWe will now extract the rootfs of OpenSuse Tumbleweed to the new partition.\nMount the rootfs partition. Now we will unpack the root fs\n# go to home dir $ cd # create dir mnt (if not existing) $ mkdir -p mnt # mount new partition to mnt dir in home dir. $ sudo mount /dev/sdb6 /home/$USER/mnt [sudo] password for opvolger: $ sudo tar -xJvf /home/$USER/Downloads/openSUSE-Tumbleweed-RISC-V-KDE.riscv64-rootfs.riscv64.tar.xz --directory /home/$USER/mnt Done. We will umount /dev/sdb6 and mount /dev/sdb5. So we can edit the boot txt file.\n$ sudo umount /dev/sdb6 $ sudo mount /dev/sdb5 /home/$USER/mnt $ ls /home/$USER/mnt bianbu.bmp env_k1-x.txt extlinux initramfs-6.1.15+.img spacemit vmlinuz-6.1.15+ $ sudo nano /home/$USER/mnt/env_k1-x.txt In my version of this image there is a initramfs-6.1.15+.img in /home/$USER/mnt. This can change. If that happend, you have to use a different version of that file in the env_k1-x.txt! Keep in mind i use my UUID of my formated rootfs, yours is different! I use ffafcae9-30cd-4b81-b4d2-23ad3ff5b340. If you are using an eMMC use mmc 1:5 and not mmc 0:5. If you are using nvme use nvme 0:5 and not mmc 0:5\nNow change\nramdisk_addr_r=0x21000000 fdt_addr_r=0x31000000 detect_dtb=setenv fdtfile ${product_name}.dtb bootcmd=run detect_dtb; sysboot mmc ${boot_devnum}:${bootfs_part} any ${kernel_addr_r} /extlinux/extlinux.conf to\nramdisk_addr_r=0x21000000 fdt_addr_r=0x31000000 load_files=load mmc 0:5 ${kernel_addr_r} /Image.gz; load mmc 0:5 ${fdt_addr_r} /k1-x_milkv-jupiter.dtb; load mmc 0:5 ${ramdisk_addr_r} /initramfs-6.1.15+.img set_bootargs=setenv bootargs \u0026#39;console=ttyS0,115200 root=UUID=ffafcae9-30cd-4b81-b4d2-23ad3ff5b340 rootfstype=ext4 rootwait rw earlycon clk_ignore_unused loglevel=7 radeon.pcie_gen2=0 swiotlb=131072 stmmaceth=chain_mode:1 selinux=0\u0026#39; bootcmd=run set_bootargs; run load_files; booti $kernel_addr_r $ramdisk_addr_r:$filesize $fdt_addr_r Exit the editor with Ctrl + X, and save your changes.\nCopy the kernel files and umount the bootfs partition\n$ cd spacemit-k1-linux-6.6 $ sudo cp arch/riscv/boot/Image.gz /home/$USER/mnt $ sudo cp arch/riscv/boot/dts/spacemit/k1-x_milkv-jupiter.dtb /home/$USER/mnt $ sudo umount /dev/sdb5 Done, put your SD-Card in your Jupiter and boot.\nYou will see a KDE login, but there is no user yet!.\nHit Ctrl + Alt + F3 and login as root with password linux.\nWelcome to openSUSE Tumbleweed 20241117 - Kernel 6.6.36+ (ttyS0). end0: 192.168.2.28 2a02:a447:277b:1:e172:a638:be8a:114c end1: fedora login: root Password: Have a lot of fun... 2a02-a447-277b-1-e172-a638-be8a-114c:~ # now create a user! I create a user opvolger.\n$ useradd opvolger # set password $ passwd opvolger New password: BAD PASSWORD: The password is shorter than 8 characters Retype new password: passwd: password updated successfully # install wheel group $ zypper install system-group-wheel Retrieving repository \u0026#39;Open H.264 Codec (openSUSE Tumbleweed)\u0026#39; metadata ..[done] Building repository \u0026#39;Open H.264 Codec (openSUSE Tumbleweed)\u0026#39; cache .......[done] Retrieving repository \u0026#39;openSUSE-Tumbleweed-Oss\u0026#39; metadata .................[done] Building repository \u0026#39;openSUSE-Tumbleweed-Oss\u0026#39; cache ......................[done] Retrieving repository \u0026#39;openSUSE-Tumbleweed-Update\u0026#39; metadata ..............[done] Building repository \u0026#39;openSUSE-Tumbleweed-Update\u0026#39; cache ...................[done] Loading repository data... Reading installed packages... Resolving package dependencies... The following NEW package is going to be installed: system-group-wheel 1 new package to install. Package download size: 8.6 KiB Package install size change: | 38 B required by packages that will be installed 38 B | - 0 B released by packages that will be removed Backend: classic_rpmtrans Continue? [y/n/v/...? shows all options] (y): Retrieving: system-group-wheel-20170617-26.1.noarch (openSUSE-Tumbleweed-Oss) (1/1), 8.6 KiB Retrieving: system-group-wheel-20170617-26.1.noarch.rpm ..................[done] Checking for file conflicts: .............................................[done] /usr/bin/systemd-sysusers --replace=/usr/lib/sysusers.d/system-group-wheel.conf - Creating group \u0026#39;wheel\u0026#39; with GID 469. (1/1) Installing: system-group-wheel-20170617-26.1.noarch ................[done] Running post-transaction scripts .........................................[done] # add user as sudo-er $ usermod -a -G wheel opvolger Now hit Ctrl + Alt + F2. Login with user opvolger and your password.\nWe will see the Desktop!\n","date":"20 November 2024","externalUrl":null,"permalink":"/posts/milk-v-jupiter/2024-11-20-opensuse-ati-radeon-hd5850/","section":"Posts","summary":"","title":"Milk-V Jupiter - OpenSUSE Tumbleweed with dedicated GPU ATI Radeon HD 5850","type":"posts"},{"content":"","date":"20 November 2024","externalUrl":null,"permalink":"/tags/milk-v-jupiter/","section":"Tags","summary":"","title":"Milk-v-Jupiter","type":"tags"},{"content":" Software # I used the VisionFive2 image of OpenSUSE Tumbleweed.\nHardware # Milk-V Jupiter BEYIMEI PCIE Riser-Ver010X GPU Riser, 1X tot 16X (4PIN/6PIN/MOLEX) PCIE-verlengkabel, M.2 naar PCI-E Riser Card Bitcoin Litecoin Ethereum. This is about 11 EURO on amazon, so no big deal\u0026hellip; amazon-link AMD/ATI Hawaii PRO [Radeon R9 290/390], Bought on a Dutch second-hand website, for 45 EURO. or ATI Radeon 5450, Bought on a Dutch second-hand website, for 10 EURO. 2x ATX power supply (was still lying around in the house + a new Cooler Master) For debugging a USB to TTL (was still lying around in the house), is about 5 EURO. Setup (hardware) # i have had multiple video cards directly in the jupiter.\nAMD RX 6600 It was detected, but with all firmwares i got a kernel panic. NVIDIA GeForce GTX 770, was detected also got to see kernel drivers with \u0026rsquo;lspci -k\u0026rsquo; but didn\u0026rsquo;t work. (gave no image). ATI Radeon 5450 works! got in KDE desktop (but was slow) ATI Radeon R9 290 only works on a Riser board with another power supply. I have tried everything\nother power supply. 4x to 16x PCIe converter. Riser board, but then everything on 1 power supply. I really have no idea why this has to be so complicated, I bought another 1x to 16x PCIe converter, it will arrive this week. It is possible that it does not want to work on 2x (mainboard) or with a 4x to 16x PCIe converter. Other video cards did work with the 4x to 16x PCIe converter in between. We will see. I hope that the 1x to 16x will work because the Riser board also indirectly goes from 1x to 16x.\nhence the somewhat strange setup: Compiling the kernel # I forked the milk-v kernel, updated it with the Bianbu Linux - SpacemiT kernel. I was patching myself, but eventually came across this pull-request.\nI have put all this in my github.\n# we need some firmwares in the kernel git clone --depth 1 git://git.kernel.org/pub/scm/linux/kernel/git/firmware/linux-firmware.git linux-firmware # we need the kernel git clone --branch bl-v1.0.y-amdgpu https://github.com/Opvolger/spacemit-k1-linux-6.1.git cd spacemit-k1-linux-6.1 # create a .config for compiling the kernel without the onboard GPU and with the AMDGPU enabled. make ARCH=riscv CROSS_COMPILE=riscv64-linux-gnu- k1_extern_gpu_defconfig # i have added my GPU firmwares in the config file, maybe you need to edit the `.config` file. # find the line with CONFIG_EXTRA_FIRMWARE= and add you firmwares. i have a amdgpu/hawaii so search the kernel source code with the text `amdgpu/hawaii` and you will see all the *.bin files that are needed. or look in dir `linux-firmware/amdgpu/`. # build the kernel, i have 16 cores, so change it if you have more (or less). make ARCH=riscv CROSS_COMPILE=riscv64-linux-gnu- -j 16 I have coped the root and boot partition of OpenSUSE to my m2 drive. boot is on my m2 partition 5 and root is partition 7.\nThe kernel will be here: arch/riscv/boot/Image.gz and dtb file here arch/riscv/boot/dts/spacemit/m1-x_milkv-jupiter.dtb.\nCopy them to the OpenSUSE boot partition. Check the name of the initramfs, in my case it is initramfs-6.6.36+.img. It\u0026rsquo;s not a problem that it\u0026rsquo;s a different version, we included the firmware in our kernel anyway.\nboot the milk-v with a serial connection. it will stop booting (u-boot is missing the standard files it expects. We have the OpenSUSE partitions which are organized differently than it expects).\n51af1d3a-4696-4dfc-b8ca-93c85b140f1e == UUID of the root partition of OpenSUSE on my m2 drive.\nboot the kernel from u-boot:\nramdisk_addr_r=0x21000000 fdt_addr_r=0x31000000 load nvme 0:5 ${kernel_addr_r} /Image.gz load nvme 0:5 ${fdt_addr_r} /m1-x_milkv-jupiter.dtb load nvme 0:5 ${ramdisk_addr_r} /initramfs-6.6.36+.img setenv bootargs \u0026#39;console=ttyS0,115200 root=UUID=51af1d3a-4696-4dfc-b8ca-93c85b140f1e rootfstype=ext4 rootwait rw earlycon clk_ignore_unused loglevel=7 radeon.pcie_gen2=0 swiotlb=131072 stmmaceth=chain_mode:1 selinux=0\u0026#39; booti $kernel_addr_r $ramdisk_addr_r:$filesize $fdt_addr_r You can make it shorter, create on your one pc the file:\nramdisk_addr_r=0x21000000 fdt_addr_r=0x31000000 load nvme 0:5 ${kernel_addr_r} /Image.gz load nvme 0:5 ${fdt_addr_r} /m1-x_milkv-jupiter.dtb load nvme 0:5 ${ramdisk_addr_r} /initramfs-6.6.36+.img setenv bootargs \u0026#39;console=ttyS0,115200 root=UUID=51af1d3a-4696-4dfc-b8ca-93c85b140f1e rootfstype=ext4 rootwait rw earlycon clk_ignore_unused loglevel=7 radeon.pcie_gen2=0 swiotlb=131072 stmmaceth=chain_mode:1 selinux=0\u0026#39; booti $kernel_addr_r $ramdisk_addr_r:$filesize $fdt_addr_r create a boot.source:\n$ sudo mkimage -C none -A riscv -T script -d boot.cmd boot.scr copy the file boot.scr to the OpenSUSE boot partition.\nThe next time you can boot in u-boot with\nload nvme 0:5 ${scriptaddr} boot.scr; source ${scriptaddr} ","date":"19 October 2024","externalUrl":null,"permalink":"/posts/milk-v-jupiter/2024-10-19-opensuse-ati-radeon-r9-290/","section":"Posts","summary":"","title":"Milk-V Jupiter - OpenSUSE Tumbleweed with external GPU ATI Radeon R9 290","type":"posts"},{"content":" Intro # Steps 6.11-rc6 with external GPU\nput all the downloads in one directory. In this example it is /home/opvolger/demo\ndownload OpenSuse VisionFive2 image # download it to /home/opvolger/demo\nurl\nflash img to eMMC (I used balenaEtcher, but dd or an other tool will work)\ndownload the kernel 6.11 or newer # kernel.org\nFor this example i use 6.11-rc6\n$ cd /home/opvolger/demo $ tar -xvzf linux-6.11-rc6.tar.gz get the linux-firmware blobs # We do not want history so --depth 1\n$ cd /home/opvolger/demo $ git clone --depth 1 git://git.kernel.org/pub/scm/linux/kernel/git/firmware/linux-firmware.git set config file make linux kernel # $ cd linux-6.11-rc6 $ make CROSS_COMPILE=riscv64-linux-gnu- ARCH=riscv menuconfig Select the next kernel options\nDevice Drivers ‚îî‚îÄ\u0026gt;Generic Driver Options ‚îî‚îÄ\u0026gt;Firmware loader () Build named firmware blobs into the kernel binary (../linux-firmware) Firmware blobs root directory In the Build named firmware blobs into the kernel binary, you will need to add your blobs of your AMD video card. In my case it was the hawaii (R2 290) blobs. For example the 200-series you can find you \u0026ldquo;blob-names: on wikipedia\nIf you do not have the correct blobs, you can see it with the commands following after booting:\n$ journalctl -b | grep radeon $ journalctl -b | grep amdgpu $ journalctl -b | grep firmware Than you can change it and rebuild the kernel.\nChange Firmware blobs root directory to ../linux-firmware\nradeon/hawaii_pfp.bin radeon/hawaii_me.bin radeon/hawaii_ce.bin radeon/hawaii_mec.bin radeon/hawaii_mc.bin radeon/hawaii_rlc.bin radeon/hawaii_sdma.bin radeon/hawaii_smc.bin radeon/hawaii_k_smc.bin radeon/HAWAII_pfp.bin radeon/HAWAII_me.bin radeon/HAWAII_ce.bin radeon/HAWAII_mec.bin radeon/HAWAII_mc.bin radeon/HAWAII_mc2.bin radeon/HAWAII_rlc.bin radeon/HAWAII_sdma.bin radeon/HAWAII_smc.bin Device Drivers ‚îî‚îÄ\u0026gt;Block devices \u0026lt;*\u0026gt; RAM block device support Linux Kernel Configuration ‚îî‚îÄ\u0026gt;Device Drivers ‚îî‚îÄ\u0026gt;Input device support ‚îî‚îÄ\u0026gt;Event interface Linux Kernel Configuration ‚îî‚îÄ\u0026gt;Device Drivers ‚îî‚îÄ\u0026gt;Graphics support ‚îî‚îÄ\u0026gt;Direct Rendering Manager (XFree86 4.1.0 and higher DRI support) \u0026lt;*\u0026gt; ATI Redeon \u0026lt;*\u0026gt; AMD GPU Device Drivers ‚îî‚îÄ\u0026gt;Sound card support ‚îî‚îÄ\u0026gt;Advanced Linux Sound Architecture ‚îî‚îÄ\u0026gt;HD-Audio \u0026lt;*\u0026gt; HD Audio PCI \u0026lt;*\u0026gt; Build HDMI/DisplayPort HD-audio codec support File systems -\u0026gt; [HIT ENTER] ‚îî‚îÄ\u0026gt;Miscellaneous filesystems -\u0026gt; [HIT ENTER] ‚îî‚îÄ\u0026gt; \u0026lt;*\u0026gt; SquashFS 4.0 - Squased file system support [HIT SPACE 2x] [*] Squashfs XATTR support [HIT SPACE] [*] Include support for ZLIB compressed file systems [*] Include support for LZ4 compressed file systems [HIT SPACE] [*] Include support for LZO compressed file systems [HIT SPACE] [*] Include support for XZ compressed file systems [HIT SPACE] [*] Include support for ZSTD compressed file systems [HIT SPACE] After all the kernel options, I want to edit the .config file. I only want modules in the kernel, so I don\u0026rsquo;t need a ramdrive (or can use one of older kernel).\nI use vscode to edit my .config file. but feel free to use your own editor\n$ code .config Replace all =m for =y. So all modules will be within the kernel.\nNow it is time to build the kernel\n$ make ARCH=riscv CROSS_COMPILE=riscv64-linux-gnu- -j 16 This can take a while\nI mounted the eMMC, and the directory is /run/media/opvolger/ROOT. So i copy my kernel and dtb to /run/media/opvolger/ROOT\n$ sudo cp arch/riscv/boot/Image.gz /run/media/opvolger/ROOT/boot/linux6-11-rc6 $ sudo cp arch/riscv/boot/dts/starfive/jh7110-starfive-visionfive-2-v1.3b.dtb /run/media/opvolger/ROOT/boot/dtb-6.11-rc6 $ cd /run/media/opvolger/ROOT $ sudo nano boot.cmd Now create the boot.cmd, so we don\u0026rsquo;t have to give this long command in u-boot.\nload mmc 0:3 ${kernel_addr_r} /boot/linux6-11-rc6 load mmc 0:3 ${fdt_addr_r} /boot/dtb-6.11-rc6 load mmc 0:3 ${ramdisk_addr_r} /boot/initrd setenv bootargs \u0026#39;root=/dev/mmcblk0p3 rw console=tty0 console=ttyS0,115200 earlycon rootwait stmmaceth=chain_mode:1 selinux=0\u0026#39; booti $kernel_addr_r $ramdisk_addr_r:$filesize $fdt_addr_r create a boot.source:\n$ sudo mkimage -C none -A riscv -T script -d boot.cmd boot.scr We can now unplug the eMMC from the pc and click it to the VisionFive 2.\nPoweron VisionFive 2 # Poweron you VisionFive 2 after you have make a serial connection.\n$ screen -L /dev/ttyUSB0 115200 Boot the VisionFive 2 and break the boot process\nNow we can load the boot source we created. We put it on partion 3, so we can load.\nload mmc 0:3 ${scriptaddr} boot.scr; source ${scriptaddr} The first boot will take some time (make root partition bigger etc.)\nYou can now log in with username root and password linux\nriscv login: root Password: Have a lot of fun... Create an user\n# create a user $ useradd opvolger # set password for user $ passwd opvolger New password: Retype new password: passwd: password updated successfully # update repo\u0026#39;s $ zypper update # install stuff $ zypper install opi neofetch chromium nano libcurl-devel git SDL2-devel git openal-soft-devel libvpx-devel alsa-devel flac-devel # install codecs (with errors, not all codes are allready on mainline for risc-v) option 2 $ opi codecs # install KDE-desktop $ zypper install -t pattern kde kde_plasma $ reboot ","date":"2 September 2024","externalUrl":null,"permalink":"/posts/starfive-visionfive-2/2024-09-02-opensuse-ati-radeon-r9_290_mainline/","section":"Posts","summary":"","title":"StarFive VisionFive 2 - 6.11-rc6 with external GPU","type":"posts"},{"content":" Intro # I read on the Ubuntu website that there is now external GPU support for Ubuntu 23.10. There is no lie in that, but with the current kernel (6.5.0-9 and 6.5.0-10) it completely crashes.\nlink\nKeep in mind that:\nthe kernel of Ubuntu only works with the firmware of Ubuntu. the kernel of StarFive only works with the firmware of Starfive. So I put together my own kernel again and got it running again.\nHardware # StarFive VisionFive 2 BEYIMEI PCIE Riser-Ver010X GPU Riser, 1X tot 16X (4PIN/6PIN/MOLEX) PCIE-verlengkabel, M.2 naar PCI-E Riser Card Bitcoin Litecoin Ethereum. This is about 11 EURO on amazon, so no big deal\u0026hellip; amazon-link AMD/ATI Hawaii PRO [Radeon R9 290/390], Bought on a Dutch second-hand website, for 45 EURO. or ATI Radeon 5450, Bought on a Dutch second-hand website, for 10 EURO. An ATX power supply (was still lying around in the house) For debugging a USB to TTL (was still lying around in the house), is about 5 EURO. or Downloades # download (to ~/Downloads/SF2_2023_11_20):\nvisionfive2_fw_payload.img u-boot-spl.bin.normal.out u-boot-starfive-ubuntu-deb Download the starfive-jh7110-VF2_515_v3.8.2-66-SD-minimal-desktop-wayland.img.bz2 (202310/sd) from StarFive VisionFive 2 Support page (I used One Drive).\nDownload [ubuntu-22.04.2-preinstalled-server-riscv64+visionfive.img.xz](https://cdimage.ubuntu.com/releases/23.10/release/ubuntu-23.10-preinstalled-server-riscv64+visionfive2.img.xz) from ubuntu Unzip it to ubuntu-23.10-preinstalled-server-riscv64+visionfive2.img.\n$ mkdir -p ~/Downloads/SF2_2023_11_20 $ mkdir -p ~/Downloads/SF2_2023_11_20/ubuntu $ cd ~/Downloads/SF2_2023_11_20 $ wget https://github.com/starfive-tech/VisionFive2/releases/download/VF2_v3.8.2/visionfive2_fw_payload.img $ wget https://github.com/starfive-tech/VisionFive2/releases/download/VF2_v3.8.2/u-boot-spl.bin.normal.out $ bzip2 -d ~/Downloads/SF2_2023_11_20/starfive-jh7110-VF2_515_v3.8.2-66-SD-minimal-desktop-wayland.img.bz2 Update firmware from the VisionFive 2 to Ubuntu firmware # My first staps are flowing the Ubuntu wiki\nWe already downloaded u-boot-starfive_2023.09.22-next-5d2fae79c7d6-0ubuntu1~ppa5_riscv64.deb and now extract the firmware to ~/Downloads/SF2_2023_11_20/ubuntu\nI used Ark for this # my download tree is now $ cd ~/Downloads/SF2_2023_11_20 $ tree . ‚îú‚îÄ‚îÄ sdcard.img ‚îú‚îÄ‚îÄ starfive-jh7110-VF2_515_v3.8.2-66-SD-minimal-desktop-wayland.img ‚îú‚îÄ‚îÄ u-boot-spl.bin.normal.out ‚îú‚îÄ‚îÄ u-boot-starfive_2023.09.22-next-5d2fae79c7d6-0ubuntu1~ppa5_riscv64.deb ‚îú‚îÄ‚îÄ ubuntu ‚îÇ ‚îú‚îÄ‚îÄ u-boot.itb ‚îÇ ‚îî‚îÄ‚îÄ u-boot-spl.bin.normal.out ‚îî‚îÄ‚îÄ visionfive2_fw_payload.img If you read the documentation of Ubuntu and uses the firmware of Ubuntu. This wil work for their kernels but if you compile the source code of StarFive the USB devices will not work (mouse/keyboard).\nI didn\u0026rsquo;t get it working with the sdcard.img (like last times) to flash my VisionFive 2, so I used tftp. I used the docker image\n$ cd ~/Downloads/SF2_2023_11_20 # startup the docker tftp server and expose the current directory to /var/tftpboot # The first time you will see this message, but the second time you will see nothing $ docker run -p 0.0.0.0:69:69/udp -v $(pwd):/var/tftpboot -i -t pghalliday/tftp Unable to find image \u0026#39;pghalliday/tftp:latest\u0026#39; locally latest: Pulling from pghalliday/tftp fae91920dcd4: Pull complete 0bb6771b2292: Pull complete Digest: sha256:59f843a93d62ac6e2fa475ee3d1a3786464fe5ea0334e6f1ea79bdec837f09fa Status: Downloaded newer image for pghalliday/tftp:latest Do NOT hit Ctrl+C! We need this server until we are done flashing!\nBoot up your VisionFive 2 without a SD-card and the USB to TTL connected (see link for more information)\nMy machine (with docker) has ip-address 192.168.2.29 and I give my VisionFive 2 the ip 192.168.2.222\nThis will be the commands (for the Ubuntu firmware):\n# set the ip of the VisionFive 2, and of the server (where docker is running) $ setenv ipaddr 192.168.2.222; setenv serverip 192.168.2.29 # check connection $ ping 192.168.2.29 # Initialize SPI Flash $ sf probe # Download and Update SPL binary $ tftpboot 0xa0000000 ${serverip}:ubuntu/u-boot-spl.bin.normal.out $ sf update 0xa0000000 0x0 $filesize # Download and Update U-Boot binary $ tftpboot 0xa0000000 ${serverip}:ubuntu/u-boot.itb $ sf update 0xa0000000 0x100000 $filesize # Reset the default (default load options) $ env default -f -a # Save your changes $ env save It will look somethink like this:\nHit any key to stop autoboot: 0 StarFive # setenv ipaddr 192.168.2.222; setenv serverip 192.168.2.29 StarFive # ping 192.168.2.29 ethernet@16030000 Waiting for PHY auto negotiation to complete....... done Using ethernet@16030000 device host 192.168.2.29 is alive StarFive # sf probe SF: Detected gd25lq128 with page size 256 Bytes, erase size 4 KiB, total 16 MiB StarFive # tftpboot 0xa0000000 ${serverip}:ubuntu/u-boot-spl.bin.normal.out Using ethernet@16030000 device TFTP from server 192.168.2.29; our IP address is 192.168.2.222 Filename \u0026#39;ubuntu/u-boot-spl.bin.normal.out\u0026#39;. Load address: 0xa0000000 Loading: ########## 900.4 KiB/s done Bytes transferred = 139367 (22067 hex) StarFive # sf update 0xa0000000 0x0 $filesize device 0 offset 0x0, size 0x22067 139367 bytes written, 0 bytes skipped in 0.802s, speed 177281 B/s StarFive # tftpboot 0xa0000000 ${serverip}:ubuntu/u-boot.itb Using ethernet@16030000 device TFTP from server 192.168.2.29; our IP address is 192.168.2.222 Filename \u0026#39;ubuntu/u-boot.itb\u0026#39;. Load address: 0xa0000000 Loading: ################################################################# #### 1010.7 KiB/s done Bytes transferred = 1005851 (f591b hex) StarFive # sf update 0xa0000000 0x100000 $filesize device 0 offset 0x100000, size 0xf591b 932123 bytes written, 73728 bytes skipped in 7.618s, speed 135134 B/s StarFive # env default -f -a ## Resetting to default environment StarFive # env save Saving Environment to SPIFlash... Erasing SPI flash...Writing to SPI flash...done OK Done!\nYou can turn off the VisionFive 2 again and hit Ctrl+C to stop docker.\nCreate the SD-card # I used balenaEtcher to flash a SD-card with ubuntu-23.10-preinstalled-server-riscv64+visionfive2.img.\nFedora install packages # I have installed Fedora linux and had to install some stuff to be able to cross compile\nsudo dnf group install \u0026#34;Development Tools\u0026#34; sudo dnf install git gcc-plugin-devel libmpc-devel gcc-c++ gcc-c++-riscv64-linux-gnu ncurses-devel libmpc-devel Building the Linux Kernel # Building a kernel of the source code from StarFive\nI build this on my own machine, otherwise it will take a very long time. so cross compile! Everything is neatly explained if you click through to the \u0026ldquo;linux\u0026rdquo; repo of all (yet) custom code for the SBC. link\n$ mkdir ~/Downloads/SF2_2023_11_20/visionfive2 $ cd ~/Downloads/SF2_2023_11_20/visionfive2 # we need the firmware for AMD / ATI cards, we do not need history so depth 1 $ git clone --depth 1 git://git.kernel.org/pub/scm/linux/kernel/git/firmware/linux-firmware.git linux-firmware Cloning into \u0026#39;linux-firmware\u0026#39;... remote: Enumerating objects: 3126, done. remote: Counting objects: 100% (3126/3126), done. remote: Compressing objects: 100% (2281/2281), done. remote: Total 3126 (delta 1061), reused 2423 (delta 751), pack-reused 0 Receiving objects: 100% (3126/3126), 428.00 MiB | 13.40 MiB/s, done. Resolving deltas: 100% (1061/1061), done. Updating files: 100% (3248/3248), done. #Check out the last kernel, we do not need history so depth 1 $ git clone --branch VF2_v3.8.2 --depth 1 https://github.com/starfive-tech/linux.git Cloning into \u0026#39;linux\u0026#39;... remote: Enumerating objects: 79432, done. remote: Counting objects: 100% (79432/79432), done. remote: Compressing objects: 100% (74286/74286), done. remote: Total 79432 (delta 7390), reused 21741 (delta 4319), pack-reused 0 Receiving objects: 100% (79432/79432), 213.11 MiB | 6.87 MiB/s, done. Resolving deltas: 100% (7390/7390), done. Note: switching to \u0026#39;b133739ab239ec9e5cd9bc4a15817145989021e4\u0026#39;. You are in \u0026#39;detached HEAD\u0026#39; state. You can look around, make experimental changes and commit them, and you can discard any commits you make in this state without impacting any branches by switching back to a branch. If you want to create a new branch to retain commits you create, you may do so (now or later) by using -c with the switch command. Example: git switch -c \u0026lt;new-branch-name\u0026gt; Or undo this operation with: git switch - Turn off this advice by setting config variable advice.detachedHead to false Updating files: 100% (74883/74883), done. I had to patch the kernel because I am using gcc-13: link\n*** ../linux-5.18/scripts/gcc-plugins/gcc-common.h 2022-03-20 20:14:17.0000 00000 +0000 --- scripts/gcc-plugins/gcc-common.h 2022-06-08 09:21:21.693178983 +0100 *************** *** 71,76 **** --- 71,78 ---- #include \u0026#34;varasm.h\u0026#34; #include \u0026#34;stor-layout.h\u0026#34; #include \u0026#34;internal-fn.h\u0026#34; + #include \u0026#34;gimple.h\u0026#34; + #include \u0026#34;gimple-iterator.h\u0026#34; #include \u0026#34;gimple-expr.h\u0026#34; #include \u0026#34;gimple-fold.h\u0026#34; #include \u0026#34;context.h\u0026#34; I used VS-Code to edit the file.\nNow we have the configure a new kernel 5.15 that workes with VisionFive 2 and an AMD/ATI Hawaii PRO [Radeon R9 290/390]. We can use the instructions of the other branch link. Here and there I deviated a little from it.\n# go to checkout code $ cd ~/Downloads/SF2_2023_11_20/visionfive2/linux # create the .config with all you need for only the StarFive VisionFive 2 make ARCH=riscv CROSS_COMPILE=riscv64-linux-gnu- starfive_jh7110_defconfig # starfive_jh7110_defconfig -\u0026gt; we need PCI-e what is not enabled in starfive_visionfive2_defconfig # open the menu make CROSS_COMPILE=riscv64-linux-gnu- ARCH=riscv menuconfig Now we have to add the ATI video-card and HDMI-audio.\nDevice Drivers ---\u0026gt; [HIT ENTER] Generic Driver Options ---\u0026gt; [HIT ENTER] Firmware loader ---\u0026gt; [HIT ENTER] () Build named firmware blobs into the kernel binary [HIT ENTER] (/lib/firmware) Firmware blobs root directory [change it to ../linux-firmware] enter this in the line:\n(radeon bins for ATI Radeon 5450, amdgpu/radeon bin files of AMD/ATI Hawaii PRO [Radeon R9 290/390] (has 2 drivers amd and ATI) and bin driver for my wifi dongel)\nradeon/CYPRESS_uvd.bin radeon/CEDAR_smc.bin radeon/CEDAR_me.bin radeon/CEDAR_pfp.bin radeon/CEDAR_rlc.bin amdgpu/hawaii_k_smc.bin amdgpu/hawaii_smc.bin amdgpu/hawaii_uvd.bin amdgpu/hawaii_vce.bin amdgpu/hawaii_sdma.bin amdgpu/hawaii_sdma1.bin amdgpu/hawaii_pfp.bin amdgpu/hawaii_me.bin amdgpu/hawaii_ce.bin amdgpu/hawaii_rlc.bin amdgpu/hawaii_mec.bin amdgpu/hawaii_mc.bin radeon/hawaii_pfp.bin radeon/hawaii_me.bin radeon/hawaii_ce.bin radeon/hawaii_mec.bin radeon/hawaii_mc.bin radeon/hawaii_rlc.bin radeon/hawaii_sdma.bin radeon/hawaii_smc.bin radeon/hawaii_k_smc.bin radeon/HAWAII_pfp.bin radeon/HAWAII_me.bin radeon/HAWAII_ce.bin radeon/HAWAII_mec.bin radeon/HAWAII_mc.bin radeon/HAWAII_mc2.bin radeon/HAWAII_rlc.bin radeon/HAWAII_sdma.bin radeon/HAWAII_smc.bin rt2870.bin Select Exit,Exit\nWe need some stuff for snapd:\nDevice Drivers -\u0026gt; Block devices -\u0026gt; [HIT ENTER] \u0026lt;*\u0026gt; RAM block device support [HIT SPACE 2x] Select Exit\nDevice Drivers -\u0026gt; Network device support ---\u0026gt; [HIT ENTER] Wireless LAN ---\u0026gt; [HIT ENTER] \u0026lt;*\u0026gt; Ralink driver support ---- [HIT SPACE 2x][HIT ENTER] \u0026lt;*\u0026gt; Ralink rt27xx/rt28xx/rt30xx (USB) [HIT SPACE 2x] [*] rt2800usb - Incl..... 6x [HIT SPACE 1x on 4 rows] Select Exit,Exit,Exit\nDevice Drivers ---\u0026gt; Graphics support ---\u0026gt; [HIT ENTER] \u0026lt;*\u0026gt; ATI GPU [HIT SPACE] \u0026lt;*\u0026gt; AMD GPU [HIT SPACE 2x] [*] Enable amdgpu support for SI parts [HIT SPACE] [*] Enable amdgpu support for CIK parts [HIT SPACE] ACP (Audio CoProcessor) Configuration ---\u0026gt; [HIT ENTER] [*] Enable AMD Audio CoProcessor IP support [HIT SPACE] Select Exit,Exit\nDevice Drivers ---\u0026gt; Sound card support ---\u0026gt; [HIT ENTER] Advanced Linux Sound Architecture ---\u0026gt; [HIT ENTER] HD-Audio ---\u0026gt; [HIT ENTER] \u0026lt;*\u0026gt; HD Audio PCI [HIT SPACE 2x] \u0026lt;*\u0026gt; Build HDMI/DisplayPort HD-audio codec support [HIT SPACE 2x] Select Exit,Exit,Exit,Exit\nWe need more some stuff for snapd:\nFile systems -\u0026gt; [HIT ENTER] Miscellaneous filesystems -\u0026gt; [HIT ENTER] \u0026lt;*\u0026gt; SquashFS 4.0 - Squased file system support [HIT SPACE 2x] [*] Squashfs XATTR support [HIT SPACE] [*] Include support for ZLIB compressed file systems [*] Include support for LZ4 compressed file systems [HIT SPACE] [*] Include support for LZO compressed file systems [HIT SPACE] [*] Include support for XZ compressed file systems [HIT SPACE] [*] Include support for ZSTD compressed file systems [HIT SPACE] Select Exit,Exit\nWe need CONFIG_SECCOMP and CONFIG_SECCOMP_FILTER for the epiphany browser\nGeneral architecture-dependent options ---\u0026gt; [HIT ENTER] [*] Enable seccomp to safely execute untrusted bytecode -\u0026gt; [HIT SPACE] Select Exit,Exit\nYes You wish to save your new configuration!\n# We can compile the kernel, I have 16 cores in my machine... so I added -j 16 $ make ARCH=riscv CROSS_COMPILE=riscv64-linux-gnu- -j 16 scripts/extract-cert.c: In function ‚Äòdisplay_openssl_errors‚Äô: scripts/extract-cert.c:46:9: warning: ‚ÄòERR_get_error_line‚Äô is deprecated: Since OpenSSL 3.0 [-Wdeprecated-declarations] 46 | while ((e = ERR_get_error_line(\u0026amp;file, \u0026amp;line))) { | ^~~~~ In file included from scripts/extract-cert.c:23: /usr/include/openssl/err.h:423:15: note: declared here 423 | unsigned long ERR_get_error_line(const char **file, int *line); | ^~~~~~~~~~~~~~~~~~ scripts/extract-cert.c: In function ‚Äòdrain_openssl_errors‚Äô: scripts/extract-cert.c:59:9: warning: ‚ÄòERR_get_error_line‚Äô is deprecated: Since OpenSSL 3.0 [-Wdeprecated-declarations] 59 | while (ERR_get_error_line(\u0026amp;file, \u0026amp;line)) {} | ^~~~~ /usr/include/openssl/err.h:423:15: note: declared here 423 | unsigned long ERR_get_error_line(const char **file, int *line); ....... ....... ....... ....... drivers/gpu/drm/amd/amdgpu/../display/dc/dce/dce_aux.c: In function ‚Äòdce_aux_transfer_with_retries‚Äô: drivers/gpu/drm/amd/amdgpu/../display/dc/dce/dce_aux.c:704:32: warning: storing the address of local variable ‚Äòreply‚Äô in ‚Äò*payload.reply‚Äô [-Wdangling-pointer=] 704 | payload-\u0026gt;reply = \u0026amp;reply; | ~~~~~~~~~~~~~~~^~~~~~~~ drivers/gpu/drm/amd/amdgpu/../display/dc/dce/dce_aux.c:687:17: note: ‚Äòreply‚Äô declared here 687 | uint8_t reply; | ^~~~~ drivers/gpu/drm/amd/amdgpu/../display/dc/dce/dce_aux.c:684:37: note: ‚Äòpayload‚Äô declared here 684 | struct aux_payload *payload) | ~~~~~~~~~~~~~~~~~~~~^~~~~~~ $ The kernel is Done! Now copy it to the boot partition on the SD-card!\nBOOT/ROOT Copy kernel # We need the initrd-img of 5.15.0 from VisionFive 2, so we don\u0026rsquo;t have to make it ourselves.\n# create a loop device of image sudo losetup -f -P ~/Downloads/SF2_2023_11_20/starfive-jh7110-VF2_515_v3.8.2-66-SD-minimal-desktop-wayland.img # find your loop device $ losetup -a # or -l /dev/loop0: []: (/home/opvolger/Downloads/SF2_2023_11_20/starfive-jh7110-VF2_515_v3.8.2-66-SD-minimal-desktop-wayland.img) $ lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINTS loop0 7:0 0 3,9G 0 loop ‚îú‚îÄloop0p1 259:7 0 2M 0 part ‚îú‚îÄloop0p2 259:8 0 4M 0 part ‚îú‚îÄloop0p3 259:9 0 100M 0 part ‚îî‚îÄloop0p4 259:10 0 3,8G 0 part .... .... .... .... # create dir $ mkdir -p ~/Downloads/SF2_2023_11_20/visionfive2/mount # mount to dir $ sudo mount /dev/loop0p3 ~/Downloads/SF2_2023_11_20/visionfive2/mount # copy initrd img $ cp ~/Downloads/SF2_2023_11_20/visionfive2/mount/initrd.img-5.15.0-starfive ~/Downloads/SF2_2023_11_20/visionfive2 # umount $ sudo umount /dev/loop0p3 # detache loop device $ sudo losetup -d /dev/loop0 We have the SD-card inserted (again). Mount the sd-card (cloudimg-rootfs) Now we need to mount the first partition of the SD-card. my is mounted on /run/media/opvolger/cloudimg-rootfs/ after a click in KDE :)\n# go to checkout code $ cd ~/Downloads/SF2_2023_11_20/visionfive2/linux # copy the kernel to the sd-card $ sudo cp arch/riscv/boot/Image.gz /run/media/opvolger/cloudimg-rootfs/boot/vmlinuz-5.15.0-dirty # copy the System map $ sudo cp System.map /run/media/opvolger/cloudimg-rootfs/boot/System.map-5.15.0-dirty # copy the dtb (Device Tree) to the sd-card $ sudo cp arch/riscv/boot/dts/starfive/jh7110-visionfive-v2.dtb /run/media/opvolger/cloudimg-rootfs/boot/dtb-5.15.0-dirty # copy initrd to the sd-card $ sudo cp ~/Downloads/SF2_2023_11_20/visionfive2/initrd.img-5.15.0-starfive /run/media/opvolger/cloudimg-rootfs/boot/initrd.img-5.15.0-dirty # we have now all the 4 files we need Now we need a custom boot option (the kernel we have made)\nedit 40_custom in /run/media/opvolger/cloudimg-rootfs/etc/grub.d/\n#!/bin/sh exec tail -n +3 $0 # This file provides an easy way to add custom menu entries. Simply type the # menu entries you want to add after this comment. Be careful not to change # the \u0026#39;exec tail\u0026#39; line above. menuentry \u0026#39;Ubuntu StarFive VisionFive 2 5.15.0-dirty\u0026#39; --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option \u0026#39;gnulinux-simple-5-15-0-dirty\u0026#39; { load_video insmod gzio if [ x$grub_platform = xxen ]; then insmod xzio; insmod lzopio; fi insmod part_gpt insmod ext2 search --no-floppy --fs-uuid --set=root 40249bdb-adbf-44bf-a50e-74b81c1200d7 echo \u0026#39;Loading Linux 5.15.0-dirty ...\u0026#39; linux /boot/vmlinuz-5.15.0-dirty root=LABEL=cloudimg-rootfs ro efi=debug earlycon sysctl.kernel.watchdog_thresh=60 echo \u0026#39;Loading initial ramdisk ...\u0026#39; initrd /boot/initrd.img-5.15.0-dirty echo \u0026#39;Loading device tree blob...\u0026#39; devicetree /boot/dtb-5.15.0-dirty } $ sudo nano /run/media/opvolger/cloudimg-rootfs/etc/grub.d/40_custom # Copy the text above Setup Ubuntu with ubuntu kernel and firmware # Put the SD-Card in the VisionFive 2 without an external GPU and use the USB to TTL.\nTurn on the VisionFive 2\nIf booting is not working, reflash the firmware but skip the command env default -f -a. I had this problem (sometimes?).\nUbuntu will boot with the kernel and firmware from Ubuntu!\nYou will get to setup your ubuntu password (default is ubuntu/ubuntu).\n-----BEGIN SSH HOST KEY KEYS----- ecdsa-sha2-nistp256 AAAAB2VjZHNhLXNoYTItbmlzdHByNTYAAAAIbmlzdHAyNTYAAABBBNPq5SLKgBXEcCWZwAequ9Qr9af/PSurVzwNX3XIF/CAutf/aMGsOtBIyH5mk44HdLmtNLoM+voHsiZZ2/I8uCU= root@ ubuntu ssh-ed25519 AAAAC3NzaC1lZBI1NTE5AAAAIGFLC6yXTpRmdkQstt6l2vzoJHRkQfvFllD3sVNg0L3o root@ubuntu ssh-rsa AAAAB3NzaC1yc2EAAABDAQABAAABgQC1nU/WOAedfYMyRYSLXWHgsDd8brhSlYYLMCpS00Lv2CJr037RUe+v5TfzPqbBw9xech8lFruZxzJ0AHJx4kbu34va9de6xSVLjD+5cHE343pn0eXi4VI9KT9bnN42h2 1+7q/yGv2+ALQJ48Gi/AvuDnWKFXa8i4LOqlVjbnfutpko6bdw1ogttRXF8Lh7PacU6XihfQ7R5yPk0r2Kw0eFPT8vLRWp5OmT2KJaMg0K/UE0+Avv5zLq5axvSchA4pbeQ0NhgCw7NQUmuFha3ZUf/saksiohAtXUo2AF HB3crZFM39ffyHaZyycP0rSMCU3ErCsV3YYRWJZ34A0t7+4fxdWUfhB1+hxm9D8EovTtB6/K1qiEU5/b7fP4n2wuBlpMhn/Nt/UG3vJ/jxtfLCoNHTL4iFdhP33mpnpB7uVZxR9TGI22+EQO5HyXSMF5HI4CGUr2bo2/ud A/QNZScPICD9Hfq1MFS553M2dINFpFmVuvSqK3u0w4sW7ErB2Xr/U= root@ubuntu -----END SSH HOST KEY KEYS----- [ 127.899234] cloud-init[1714]: Cloud-init v. 23.3.1-0ubuntu2 finished at Mon, 20 Nov 2023 23:21:04 +0000. Datasource DataSourceNoCloud [seed=/var/lib/cloud/seed/noc loud-net][dsmode=net]. Up 127.87 seconds [ OK ] Finished cloud-final.servi‚Ä¶ Execute cloud user/final scripts. [ OK ] Reached target cloud-init.target - Cloud-init target. Ubuntu 23.10 ubuntu ttyS0 ubuntu login: ubuntu Password: You are required to change your password immediately (administrator enforced). Changing password for ubuntu. Current password: New password: Retype new password: Welcome to Ubuntu 23.10 (GNU/Linux 6.5.0-9-generic riscv64) .... .... .... To run a command as administrator (user \u0026#34;root\u0026#34;), use \u0026#34;sudo \u0026lt;command\u0026gt;\u0026#34;. See \u0026#34;man sudo_root\u0026#34; for details. Now we will change the default boot option of Grub We will edit etc/default/grub\nThe default boot option is now GRUB_DEFAULT=0 we will change that to GRUB_DEFAULT=2. The boot options start counting with 0, so we need option number 3 (That is 2).\nubuntu@ubuntu:~$ sudo nano /etc/default/grub # now change `GRUB_DEFAULT=0` to `GRUB_DEFAULT=2` # We will now update grub with the custom kernel and menuentry ubuntu@ubuntu:~$ sudo update-grub Sourcing file \u0026#39;/etc/default/grub\u0026#39; Sourcing file \u0026#39;/etc/default/grub.d/10_cmdline.cfg\u0026#39; Sourcing file \u0026#39;/etc/default/grub.d/90_watchdog-thresh.cfg\u0026#39; Generating grub configuration file ... Found linux image: /boot/vmlinuz-6.5.0-9-generic Found initrd image: /boot/initrd.img-6.5.0-9-generic Found linux image: /boot/vmlinuz-5.15.0-dirty Found initrd image: /boot/initrd.img-5.15.0-dirty Warning: os-prober will not be executed to detect other bootable partitions. Systems on them will not be added to the GRUB boot configuration. Check GRUB_DISABLE_OS_PROBER documentation entry. Adding boot menu entry for UEFI Firmware Settings ... done # turn it off ubuntu@ubuntu:~$ sudo halt Broadcast message from root@ubuntu on pts/0 (Tue 2023-11-21 19:51:40 UTC): The system will halt now! ubuntu@ubuntu:~$ [ 366.522166] reboot: System halted Turn off the VisionFive2 and remove the CD-card.\nUpdate firmware VisionFive 2 to 3.8.2 # Now we need to update firmware of the board to the version of VisionFive2.\nI updated my board to VisionFive2 Software v3.8.2\nWe will use the firmware from StarFive (with there kernel-source-build 5.15.0-dirty) if you want to use an extenal GPU without a crash within 1a10 minutes. We can not start a Ubuntu kernel with the firmware of StarFive!\nI didn\u0026rsquo;t get it working with the sdcard.img (like last times) to flash my VisionFive 2, so I used tftp. I used the docker image\n$ cd ~/Downloads/SF2_2023_11_20 $ docker run -p 0.0.0.0:69:69/udp -v $(pwd):/var/tftpboot -i -t pghalliday/tftp Unable to find image \u0026#39;pghalliday/tftp:latest\u0026#39; locally latest: Pulling from pghalliday/tftp fae91920dcd4: Pull complete 0bb6771b2292: Pull complete Digest: sha256:59f843a93d62ac6e2fa475ee3d1a3786464fe5ea0334e6f1ea79bdec837f09fa Status: Downloaded newer image for pghalliday/tftp:latest Boot up your VisionFive 2 without a SD-card and the USB to TTL connected (see link for more information)\nMy machine (with docker) has ip-address 192.168.2.29 and I give my VisionFive 2 the ip 192.168.2.222\nThis will be the commands (for the StarFive firmware):\n# set the ip of the VisionFive 2, and of the server (where docker is running) $ setenv ipaddr 192.168.2.222; setenv serverip 192.168.2.29 # test network $ ping 192.168.2.29 # Initialize SPI Flash $ sf probe # Download and Update SPL binary $ tftpboot 0xa0000000 ${serverip}:u-boot-spl.bin.normal.out $ sf update 0xa0000000 0x0 $filesize # Download and Update U-Boot binary $ tftpboot 0xa0000000 ${serverip}:visionfive2_fw_payload.img $ sf update 0xa0000000 0x100000 $filesize # We will not need to reset to default now! # Save your changes $ env save It will look something like this: (I hit a key to stop autoboot)\n# open a (new console with) screen to the VisionFive 2 $ screen -L /dev/ttyUSB0 115200 # now turn on the VisionFive 2 and you will see that if boot. U-Boot SPL 2023.10-2023.09.22-next-5d2fae79c7d6-0ubuntu1~ppa5 (Oct 13 2023 - 13:25:02 +0000) DDR version: dc2e84f0. Trying to boot from SPI U-Boot 2023.10-2023.09.22-next-5d2fae79c7d6-0ubuntu1~ppa5 (Oct 13 2023 - 13:25:02 +0000) CPU: rv64imafdc_zba_zbb Model: StarFive VisionFive 2 v1.3B DRAM: 8 GiB Core: 129 devices, 24 uclasses, devicetree: board MMC: mmc@16010000: 0, mmc@16020000: 1 Loading Environment from SPIFlash... SF: Detected gd25lq128 with page size 256 Bytes, erase size 4 KiB, total 16 MiB OK StarFive EEPROM format v2 --------EEPROM INFO-------- Vendor : StarFive Technology Co., Ltd. Product full SN: VF7110B1-2253-D008E000-00001648 data version: 0x2 PCB revision: 0xb2 BOM revision: A Ethernet MAC0 address: 6c:cf:39:00:2a:e5 Ethernet MAC1 address: 6c:cf:39:00:2a:e6 --------EEPROM INFO-------- In: serial@10000000 Out: serial@10000000 Err: serial@10000000 Net: eth0: ethernet@16030000, eth1: ethernet@16040000 Working FDT set to ff7309d0 Hit any key to stop autoboot: 0 StarFive # setenv ipaddr 192.168.2.222; setenv serverip 192.168.2.29 StarFive # ping 192.168.2.29 ethernet@16030000 Waiting for PHY auto negotiation to complete....... done Using ethernet@16030000 device host 192.168.2.29 is alive StarFive # sf probe SF: Detected gd25lq128 with page size 256 Bytes, erase size 4 KiB, total 16 MiB StarFive # tftpboot 0xa0000000 ${serverip}:u-boot-spl.bin.normal.out Using ethernet@16030000 device TFTP from server 192.168.2.29; our IP address is 192.168.2.222 Filename \u0026#39;u-boot-spl.bin.normal.out\u0026#39;. Load address: 0xa0000000 Loading: ########### 1012.7 KiB/s done Bytes transferred = 147336 (23f88 hex) StarFive # sf update 0xa0000000 0x0 $filesize device 0 offset 0x0, size 0x23f88 143360 bytes written, 3976 bytes skipped in 0.840s, speed 178970 B/s StarFive # tftpboot 0xa0000000 ${serverip}:visionfive2_fw_payload.img Using ethernet@16030000 device TFTP from server 192.168.2.29; our IP address is 192.168.2.222 Filename \u0026#39;visionfive2_fw_payload.img\u0026#39;. Load address: 0xa0000000 Loading: ################################################################# ################################################################# ################################################################# ########### 1 MiB/s done Bytes transferred = 3013797 (2dfca5 hex) StarFive # sf update 0xa0000000 0x100000 $filesize device 0 offset 0x100000, size 0x2dfca5 933888 bytes written, 2079909 bytes skipped in 8.149s, speed 378573 B/s StarFive # env save Saving Environment to SPIFlash... Erasing SPI flash...Writing to SPI flash...done OK StarFive # Done!\nYou can turn off the VisionFive 2 again\nBoot Visionfive 2 with external GPU # Put the SD-card in the Visionfive 2.\nWe will start the Visionfive 2 with the external GPU.\nWe will use the USB to TTL to see that every thing is working!\n$ screen -L /dev/ttyUSB0 115200 # After boot up, login with ubuntu and your password # First update all the packages! ubuntu@ubuntu:~$ sudo apt update # This takes some time ubuntu@ubuntu:~$ sudo apt upgrade # after install updates ignore kernel warning! Restart some services # install KDE and some build tools ubuntu@ubuntu:~$ sudo apt install sddm sddm-theme-breeze kde-standard build-essential libxml2 libcurl4-gnutls-dev neofetch ubuntu-dev-tools libopenal-dev libpng-dev libjpeg-dev libfreetype6-dev libfontconfig1-dev libcurl4-gnutls-dev libsdl2-dev zlib1g-dev libbz2-dev libedit-dev python-is-python3 m4 clang sddm-theme-breeze epiphany-browser minetest Service restarts being deferred: /etc/needrestart/restart.d/dbus.service systemctl restart systemd-logind.service systemctl restart unattended-upgrades.service systemctl restart wpa_supplicant.service No containers need to be restarted. User sessions running outdated binaries: ubuntu @ user manager service: systemd[882] No VM guests are running outdated hypervisor (qemu) binaries on this host. ubuntu@ubuntu:~$ sudo reboot Now KDE will startup after booting! Have fun!\nNetwork # Fix network manager in KDE (so you can control network in KDE)\n$ sudo nano /etc/netplan/01-network-manager-all.yaml # Let NetworkManager manage all devices on this system network: version: 2 renderer: NetworkManager Need reboot to get it working!\nScreenshot! # picture or it didn\u0026rsquo;t happen\nATI Radeon 5450:\nATI Radeon R9 290:\n","date":"20 November 2023","externalUrl":null,"permalink":"/posts/starfive-visionfive-2/2023-11-20-ubuntu-ati-radeon-r9_290/","section":"Posts","summary":"","title":"StarFive VisionFive 2 - Ubuntu 23.10 external GPU ATI Radeon R9 290","type":"posts"},{"content":" Some notes # I created a custom kernel so I can run K3S on my mobile phone.\nflash mobile phone # here\nInstall pmbootstrap # https://wiki.postmarketos.org/wiki/User_talk:Docker\ncustom kernel # pmbootstrap init\npmbootstrap kconfig edit linux-postmarketos-qcom-sdm845\n\u0026gt; Networking support \u0026gt; Networking options \u0026gt; Network packet filtering framework (Netfilter) \u0026gt; Core Netfilter Configuration\nenable: \u0026ldquo;multiport\u0026rdquo; Multiple port match support\n-save-\npmbootstrap build linux-postmarketos-qcom-sdm845 --force kernel apk is in ~/.local/var/pmbootstrap/packages/v22.12/aarch64/linux-postmarketos-qcom-sdm845-6.1.0-r0.apk\n$ scp ~/.local/var/pmbootstrap/packages/v22.12/aarch64/linux-postmarketos-qcom-sdm845-6.1.0-r0.apk user@172.16.42.1:/home/user/linux-postmarketos-qcom-sdm845-6.1.0-r0.apk user@172.16.42.1\u0026#39;s password: linux-postmarketos-qcom-sdm845-6.1.0-r0.apk 100% 19MB 28.7MB/s 00:00 $ ssh user@172.16.42.1 user@172.16.42.1\u0026#39;s password: Welcome to postmarketOS! o/ This distribution is based on Alpine Linux. First time using postmarketOS? Make sure to read the cheatsheet in the wiki: -\u0026gt; https://postmarketos.org/cheatsheet You may change this message by editing /etc/motd. $ sudo -i [sudo] password for user: $ apk add -u /home/user/linux-postmarketos-qcom-sdm845-6.1.0-r0.apk --allow-untrusted ","date":"31 October 2023","externalUrl":null,"permalink":"/posts/xiaomi-poco-f1/2023-10-31-k3s-on-arm-postmarketos/","section":"Posts","summary":"","title":"Xiaomi POCO F1 - K3S Cluster on postmarketos","type":"posts"},{"content":"","date":"31 October 2023","externalUrl":null,"permalink":"/tags/xiaomi-poco-f1/","section":"Tags","summary":"","title":"Xiaomi-Poco-F1","type":"tags"},{"content":" Intro # I wanted to compile and test a few programs on a RISC-V. I only ran into the problem of minimal support of the onboard GPU and custom build Debian from the StarFive Team.\nSo below you can see my \u0026ldquo;solution\u0026rdquo;. (Part II)\nCreating the image was more of the same I did on Part I link\nHardware # StarFive VisionFive 2 BEYIMEI PCIE Riser-Ver010X GPU Riser, 1X tot 16X (4PIN/6PIN/MOLEX) PCIE-verlengkabel, M.2 naar PCI-E Riser Card Bitcoin Litecoin Ethereum. This is about 11 EURO on amazon, so no big deal\u0026hellip; amazon-link AMD/ATI Hawaii PRO [Radeon R9 290/390], Bought on a Dutch second-hand website, for 45 EURO. An ATX power supply (was still lying around in the house) For debugging a USB to TTL (was still lying around in the house), is about 5 EURO. Update firmware VisionFive 2 to 2.11.5 # I updated my board to VisionFive2 Software v2.11.5\ndownload:\nvisionfive2_fw_payload.img u-boot-spl.bin.normal.out sdcard.img steps:\nI used balenaEtcher to flash a SD-card with sdcard.img. Mounted the root partition and sudo-cp the visionfive2_fw_payload.img and u-boot-spl.bin.normal.out file to /root Used Serial to connect to VisionFive 2, login with root / starfive Run commands: flashcp -v /root/u-boot-spl.bin.normal.out /dev/mtd0 flashcp -v /root/visionfive2_fw_payload.img /dev/mtd1 Done!\nCreate SD-card # Download ubuntu-22.04.2-preinstalled-server-riscv64+visionfive.img.xz from ubuntu Unzip it to ubuntu-22.04.2-preinstalled-server-riscv64+visionfive.img.\nDownload the starfive-jh7110-VF2-SD-wayland.img (202303) from StarFive VisionFive 2 Support page (I used google drive).\n# create a loop device of image $ sudo losetup -f -P ~/Downloads/visionfive_firmware_2023-04/starfive-jh7110-VF2-SD-wayland.img $ sudo losetup -f -P ~/iso/ubuntu-22.04.2-preinstalled-server-riscv64+visionfive.img # find your loop device $ losetup -l NAME SIZELIMIT OFFSET AUTOCLEAR RO BACK-FILE DIO LOG-SEC /dev/loop1 0 0 0 0 /home/opvolger/iso/ubuntu-22.04.2-preinstalled-server-riscv64+visionfive.img 0 512 /dev/loop0 0 0 0 0 /home/opvolger/Downloads/visionfive_firmware_2023-04/starfive-jh7110-VF2-SD-wayland.img 0 512 # in my case it is loop0 and loop1 # insert your SD-card and delete all partitions (I had 3) $ sudo fdisk /dev/sdb [sudo] password for opvolger: Welcome to fdisk (util-linux 2.38.1). Changes will remain in memory only, until you decide to write them. Be careful before using the write command. Command (m for help): d Partition number (1-4, default 4): Partition 4 has been deleted. Command (m for help): d Partition number (1-3, default 3): Partition 3 has been deleted. Command (m for help): d Partition number (1,2, default 2): Partition 2 has been deleted. Command (m for help): d Selected partition 1 Partition 1 has been deleted. Command (m for help): w The partition table has been altered. Calling ioctl() to re-read partition table. Syncing disks. # add all 4 partitions (not all data) of the debian-wayland to the SD-card $ sudo dd if=/dev/loop0 of=/dev/sdb status=progress 2831151616 bytes (2,8 GB, 2,6 GiB) copied, 635 s, 4,5 MB/s 5529600+0 records in 5529600+0 records out 2831155200 bytes (2,8 GB, 2,6 GiB) copied, 635,097 s, 4,5 MB/s $ sudo fdisk -l /dev/loop1 [sudo] password for opvolger: Disk /dev/loop1: 4,5 GiB, 4831838208 bytes, 9437184 sectors Units: sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disklabel type: gpt Disk identifier: 27D729D1-39F3-4647-9B99-E2EF8937310A Device Start End Sectors Size Type /dev/loop1p1 227362 9437150 9209789 4,4G Linux filesystem /dev/loop1p3 225314 227361 2048 1M Linux filesystem /dev/loop1p12 217122 225313 8192 4M Linux filesystem /dev/loop1p15 34 217121 217088 106M EFI System Partition table entries are not in disk order. # So the 1st partition is the rootfs # 1ste is the root partition. We need to (re)place the root partition of the debian-wayland (4th partition now on the SD-card) # the partition is to small, we make the root bigger (first e2fsck then parted) $ sudo e2fsck -f /dev/sdb4 e2fsck 1.47.0 (5-Feb-2023) Pass 1: Checking inodes, blocks, and sizes Inode 86649 extent tree (at level 2) could be narrower. Optimize\u0026lt;y\u0026gt;? yes Inode 89474 extent tree (at level 1) could be narrower. Optimize\u0026lt;y\u0026gt;? yes Inode 91900 extent tree (at level 1) could be narrower. Optimize\u0026lt;y\u0026gt;? yes Inode 91929 extent tree (at level 1) could be narrower. Optimize\u0026lt;y\u0026gt;? yes Inode 91932 extent tree (at level 1) could be narrower. Optimize\u0026lt;y\u0026gt;? yes Pass 1E: Optimizing extent trees Pass 2: Checking directory structure Pass 3: Checking directory connectivity Pass 4: Checking reference counts Pass 5: Checking group summary information root: ***** FILE SYSTEM WAS MODIFIED ***** root: 93204/165984 files (0.2% non-contiguous), 647953/663291 blocks $ sudo parted /dev/sdb [sudo] password for opvolger: GNU Parted 3.5 Using /dev/sdb Welcome to GNU Parted! Type \u0026#39;help\u0026#39; to view a list of commands. (parted) print Warning: Not all of the space available to /dev/sdb appears to be used, you can fix the GPT to use all of the space (an extra 119140352 blocks) or continue with the current setting? Fix/Ignore? Fix Model: Generic STORAGE DEVICE (scsi) Disk /dev/sdb: 63,8GB Sector size (logical/physical): 512B/512B Partition Table: gpt Disk Flags: Number Start End Size File system Name Flags 1 2097kB 4194kB 2097kB 2 4194kB 8389kB 4194kB 3 8389kB 113MB 105MB fat16 boot, esp 4 113MB 2830MB 2717MB ext4 legacy_boot (parted) resizepart 4 6GB (parted) print Model: Generic STORAGE DEVICE (scsi) Disk /dev/sdb: 63,8GB Sector size (logical/physical): 512B/512B Partition Table: gpt Disk Flags: Number Start End Size File system Name Flags 1 2097kB 4194kB 2097kB 2 4194kB 8389kB 4194kB 3 8389kB 113MB 105MB fat16 boot, esp 4 113MB 6000MB 5887MB ext4 legacy_boot (parted) quit Information: You may need to update /etc/fstab. $ sudo dd if=/dev/loop1p1 of=/dev/sdb4 status=progress 4714652160 bytes (4,7 GB, 4,4 GiB) copied, 103 s, 45,8 MB/s 9209789+0 records in 9209789+0 records out 4715411968 bytes (4,7 GB, 4,4 GiB) copied, 191,996 s, 24,6 MB/s Building the Linux Kernel # I build this on my own machine, otherwise it will take a very long time. so cross compile! Everything is neatly explained if you click through to the \u0026ldquo;linux\u0026rdquo; repo of all (yet) custom code for the SBC. link\n$ mkdir ~/visionfive2 $ cd visionfive2 $ git clone https://github.com/starfive-tech/linux.git Cloning into \u0026#39;linux\u0026#39;... remote: Enumerating objects: 9469722, done. remote: Counting objects: 100% (39691/39691), done. remote: Compressing objects: 100% (17697/17697), done. remote: Total 9469722 (delta 28345), reused 28687 (delta 21896), pack-reused 9430031 Receiving objects: 100% (9469722/9469722), 2.11 GiB | 14.23 MiB/s, done. Resolving deltas: 100% (8042369/8042369), done. Updating files: 100% (79598/79598), done. $ cd linux $ git checkout VF2_v2.11.5 Updating files: 100% (20490/20490), done. Note: switching to \u0026#39;VF2_v2.11.5\u0026#39;. You are in \u0026#39;detached HEAD\u0026#39; state. You can look around, make experimental changes and commit them, and you can discard any commits you make in this state without impacting any branches by switching back to a branch. If you want to create a new branch to retain commits you create, you may do so (now or later) by using -c with the switch command. Example: git switch -c \u0026lt;new-branch-name\u0026gt; Or undo this operation with: git switch - Turn off this advice by setting config variable advice.detachedHead to false HEAD is now at a87c6861c6d9 Merge tag \u0026#39;JH7110_515_SDK_v4.5.2\u0026#39; into vf2-515-devel Updating files: 100% (46210/46210), done. Note: switching to \u0026#39;VF2_v2.8.0\u0026#39;. You are in \u0026#39;detached HEAD\u0026#39; state. You can look around, make experimental changes and commit them, and you can discard any commits you make in this state without impacting any branches by switching back to a branch. If you want to create a new branch to retain commits you create, you may do so (now or later) by using -c with the switch command. Example: git switch -c \u0026lt;new-branch-name\u0026gt; Or undo this operation with: git switch - Turn off this advice by setting config variable advice.detachedHead to false HEAD is now at 59cf9af678db Merge tag \u0026#39;JH7110_515_SDK_v4.0.0-rc2\u0026#39; into vf2-515-devel $ git revert 2757ebeaf3992ee6c5d4842ffbfc1d022e790f9f --no-commit # This commit make the M.2 -\u0026gt; PCI-e not work Now we have the configure a new kernel 5.15 that workes with VisionFive 2 and an AMD/ATI Hawaii PRO [Radeon R9 290/390]. We can use the instructions of the other branch link. Here and there I deviated a little from it.\nFirst I tried to use the ATI (old) kernel drivers, because that was working with the ATI Radion HD 5450. But I did get text, but not a (good) graphical output (and a reset of XOrg). So I got the new amdgpu drivers working (not what I expected)\n# create the .config with all you need for only the StarFive VisionFive 2 make ARCH=riscv CROSS_COMPILE=riscv64-linux-gnu- starfive_jh7110_defconfig # starfive_jh7110_defconfig -\u0026gt; we need PCI-e what is not enabled in starfive_visionfive2_defconfig # open the menu make CROSS_COMPILE=riscv64-linux-gnu- ARCH=riscv menuconfig Now we have to add the ATI video-card and HDMI-audio.\nDevice Drivers ---\u0026gt; [HIT ENTER] Generic Driver Options ---\u0026gt; [HIT ENTER] Firmware loader ---\u0026gt; [HIT ENTER] () Build named firmware blobs into the kernel binary [HIT ENTER] enter this in the line:\n(only the amdgpu bin files, radeon drivers was not working on my GPU)\namdgpu/hawaii_k_smc.bin amdgpu/hawaii_smc.bin amdgpu/hawaii_uvd.bin amdgpu/hawaii_vce.bin amdgpu/hawaii_sdma.bin amdgpu/hawaii_sdma1.bin amdgpu/hawaii_pfp.bin amdgpu/hawaii_me.bin amdgpu/hawaii_ce.bin amdgpu/hawaii_rlc.bin amdgpu/hawaii_mec.bin amdgpu/hawaii_mc.bin Select Exit,Exit\nWe need some stuff for snapd:\nDevice Drivers -\u0026gt; Block devices -\u0026gt; [HIT ENTER] \u0026lt;*\u0026gt; RAM block device support [HIT SPACE 2x] Select Exit\nDevice Drivers ---\u0026gt; Graphics support ---\u0026gt; [HIT ENTER] \u0026lt;*\u0026gt; AMD GPU [HIT SPACE 2x] [*] Enable amdgpu support for SI parts [HIT SPACE] [*] Enable amdgpu support for CIK parts [HIT SPACE] ACP (Audio CoProcessor) Configuration ---\u0026gt; [HIT ENTER] [*] Enable AMD Audio CoProcessor IP support [HIT SPACE] (Select Exit) Select Exit,Exit\nDevice Drivers ---\u0026gt; Sound card support ---\u0026gt; [HIT ENTER] Advanced Linux Sound Architecture ---\u0026gt; [HIT ENTER] HD-Audio ---\u0026gt; [HIT ENTER] HD Audio PCI [HIT SPACE 2x] Build HDMI/DisplayPort HD-audio codec support [HIT SPACE 2x] Select Exit,Exit,Exit,Exit\nWe need more some stuff for snapd:\nFile systems -\u0026gt; [HIT ENTER] Miscellaneous filesystems -\u0026gt; [HIT ENTER] \u0026lt;*\u0026gt; SquashFS 4.0 - Squased file system support [HIT SPACE 2x] \u0026lt;*\u0026gt; Squashfs XATTR support [HIT SPACE 2x] \u0026lt;*\u0026gt; Include support for ZLIB compressed file systems \u0026lt;*\u0026gt; Include support for LZ4 compressed file systems [HIT SPACE] \u0026lt;*\u0026gt; Include support for LZO compressed file systems [HIT SPACE] \u0026lt;*\u0026gt; Include support for XZ compressed file systems [HIT SPACE] \u0026lt;*\u0026gt; Include support for ZSTD compressed file systems [HIT SPACE] Select Exit,Exit,Exit\nYes You wish to save your new configuration!\n# We can compile the kernel, I have 16 cores in my machine... so I added -j 16 $ make ARCH=riscv CROSS_COMPILE=riscv64-linux-gnu- -j 16 scripts/extract-cert.c: In function ‚Äòdisplay_openssl_errors‚Äô: scripts/extract-cert.c:46:9: warning: ‚ÄòERR_get_error_line‚Äô is deprecated: Since OpenSSL 3.0 [-Wdeprecated-declarations] 46 | while ((e = ERR_get_error_line(\u0026amp;file, \u0026amp;line))) { | ^~~~~ ... ... ... drivers/gpu/drm/verisilicon/inno_hdmi.c: In function \u0026#39;inno_hdmi_config_pll\u0026#39;: drivers/gpu/drm/verisilicon/inno_hdmi.c:208:9: warning: ISO C90 forbids mixed declarations and code [-Wdeclaration-after-statement] 208 | const reg_value_t cfg_pll_data[] = { | ^~~~~ $ mkdir -p ~/visionfive2/kernel $ make CROSS_COMPILE=riscv64-linux-gnu- ARCH=riscv INSTALL_PATH=~/visionfive2/kernel zinstall -j 16 sh ./arch/riscv/boot/install.sh 5.15.0+ \\ arch/riscv/boot/Image.gz System.map \u0026#34;/home/opvolger/visionfive2/kernel\u0026#34; Installing compressed kernel The kernel is Done! Now copy it to the boot partition!\nBOOT/ROOT Copy kernel # We have the SD-card inserted (again).\n$ mkdir -p ~/visionfive2/boot $ mkdir -p ~/visionfive2/root # mount boot and root partition $ sudo mount /dev/sdb3 ~/visionfive2/boot $ sudo mount /dev/sdb4 ~/visionfive2/root # copy the kernel $ sudo cp ~/visionfive2/kernel/*+ ~/visionfive2/boot BOOT/ROOT Add the boot option # $ sudo nano ~/visionfive2/boot/extlinux/extlinux.conf We have to change the kernel from /boot/vmlinuz-5.15.0-starfive to /boot/vmlinuz-5.15.0+\n## /extlinux/extlinux.conf ## ## IMPORTANT WARNING ## ## The configuration of this file is generated automatically. ## Do not edit this file manually, use: u-boot-update default l0 menu title U-Boot menu prompt 0 timeout 50 label l0 menu label Debian GNU/Linux bookworm/sid 5.15.0-starfive linux /vmlinuz-5.15.0-starfive initrd /initrd.img-5.15.0-starfive fdtdir /dtbs append root=/dev/mmcblk1p4 root=/dev/mmcblk1p4 rw console=tty0 console=ttyS0,115200 earlycon rootwait stmmaceth=chain_mode:1 selinux=0 label l0r menu label Debian GNU/Linux bookworm/sid 5.15.0-starfive (rescue target) linux /vmlinuz-5.15.0-starfive initrd /initrd.img-5.15.0-starfive fdtdir /dtbs append root=/dev/mmcblk1p4 root=/dev/mmcblk1p4 rw console=tty0 console=ttyS0,115200 earlycon rootwait stmmaceth=chain_mode:1 selinux=0 single to\n## /extlinux/extlinux.conf ## ## IMPORTANT WARNING ## ## The configuration of this file is generated automatically. ## Do not edit this file manually, use: u-boot-update default l0 menu title U-Boot menu prompt 0 timeout 50 # add \u0026#39; radeon.cik_support=0 amdgpu.cik_support=1 radeon.si_support=0 amdgpu.si_support=1 amdgpu.dc=1\u0026#39; to append if you have build ATI and AMD drivers in the kernel (amdgpu is not the default, the default is the old ati driver.) # we changed the kernel from vmlinuz-5.15.0-starfive to vmlinuz-5.15.0+ label l0 menu label Debian GNU/Linux bookworm/sid 5.15.0-starfive linux /vmlinuz-5.15.0+ initrd /initrd.img-5.15.0-starfive fdtdir /dtbs append root=/dev/mmcblk1p4 root=/dev/mmcblk1p4 rw console=tty0 console=ttyS0,115200 earlycon rootwait stmmaceth=chain_mode:1 selinux=0 label l0r menu label Debian GNU/Linux bookworm/sid 5.15.0-starfive (rescue target) linux /vmlinuz-5.15.0-starfive initrd /initrd.img-5.15.0-starfive fdtdir /dtbs append root=/dev/mmcblk1p4 root=/dev/mmcblk1p4 rw console=tty0 console=ttyS0,115200 earlycon rootwait stmmaceth=chain_mode:1 selinux=0 single BOOT/ROOT Fix the fstab of the root partition # We have to change the /boot mount point. The UUID/LABEL are different. We have to findout the new UUID\n$ blkid /dev/sdb3 /dev/sdb3: SEC_TYPE=\u0026#34;msdos\u0026#34; UUID=\u0026#34;FCD7-CFFB\u0026#34; BLOCK_SIZE=\u0026#34;512\u0026#34; TYPE=\u0026#34;vfat\u0026#34; PARTUUID=\u0026#34;0c10506e-2b34-40b5-9f06-92cf5745e874\u0026#34; $ sudo nano ~/visionfive2/root/etc/fstab change\nLABEL=cloudimg-rootfs / ext4 discard,errors=remount-ro 0 1 LABEL=UEFI /boot/efi vfat umask=0077 0 1 to\nLABEL=cloudimg-rootfs / ext4 discard,errors=remount-ro 0 1 UUID=FCD7-CFFB /boot vfat umask=0077 0 1 BOOT/ROOT fix ubuntu-advantage-tools hang # ubuntu-advantage-tools (not working for risc-v yet), so we disable it\nsudo rm ~/visionfive2/root/var/lib/dpkg/info/ubuntu-advantage-tools.postinst BOOT/ROOT Fix VirtualKeyboard (disable) # create file so after we install kde, you will not have a big VirtualKeyboard in your login screen\nsudo nano ~/visionfive2/root/etc/sddm.conf with:\n# InputMethod=qtvirtualkeyboard is default InputMethod= BOOT/ROOT umount # # umount the SD-card $ sudo umount ~/visionfive2/root/ $ sudo umount ~/visionfive2/boot/ We are ready to Boot it up # But the SD-card in the VisionFive 2 and power on! If you see a login, turn if off again!\nWe need to change the ssh-key of the ubuntu (will be set on first boot)\nadded ssh key (yours public) If you have no ssh-key run ssh-keygen -t ed25519 local (google it)\naccepted ssh key in ubuntu are the autorized_keys in the ssh dir of the user.\n$ sudo mount /dev/sdb3 ~/visionfive2/root $ sudo cp ~/.ssh/id_ed25519.pub ~/visionfive2/root/home/ubuntu/.ssh/authorized_keys $ sudo chown 1000:1000 ~/visionfive2/root/home/ubuntu/.ssh/authorized_keys $ sudo umount ~/visionfive2/root/ Put the SD-card back in the VisionFive 2.\nFind out the ip-address of you VisionFive 2 and login with ssh\n$ ssh ubuntu@192.168.2.24 Welcome to Ubuntu 22.04.2 LTS (GNU/Linux 5.15.0-dirty riscv64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Tue Apr 4 20:32:59 UTC 2023 System load: 1.7021484375 Processes: 126 Usage of /: 4.7% of 57.44GB Users logged in: 0 Memory usage: 2% IPv4 address for eth0: 192.168.2.24 Swap usage: 0% Expanded Security Maintenance for Applications is not enabled. 0 updates can be applied immediately. Enable ESM Apps to receive additional future security updates. See https://ubuntu.com/esm or run: sudo pro status The list of available updates is more than a week old. To check for new updates run: sudo apt update Last login: Tue Apr 4 20:33:03 2023 from 192.168.2.25 To run a command as administrator (user \u0026#34;root\u0026#34;), use \u0026#34;sudo \u0026lt;command\u0026gt;\u0026#34;. See \u0026#34;man sudo_root\u0026#34; for details. ubuntu@ubuntu:~$ sudo -i root@ubuntu:~# passwd ubuntu New password: Retype new password: passwd: password updated successfully root@ubuntu:~# exit logout ubuntu@ubuntu:~$ debuggen if display is not working # $ ssh ubuntu@192.168.2.24 ubuntu@ubuntu:~$ journalctl -b | grep radeon ubuntu@ubuntu:~$ journalctl -b | grep amdgpu ubuntu@ubuntu:~$ journalctl -b | grep firmware kde install and other stuff 22.04 # Now we can install a user interface, I like kde, so I installed KDE (and some other stuff)\n# delete Ubuntu image kernels and autoupdate kernel tool sudo apt-get purge --auto-remove flash-kernel linux-starfive linux-image-starfive linux-headers-starfive linux-firmware Do you want to continue? [Y/n] y $ sudo apt update $ sudo apt upgrade # maybe your update hangs (was on my machine) Setting up libsasl2-2:riscv64 (2.1.27+dfsg2-3ubuntu1.2) ... Setting up systemd-hwe-hwdb (249.11.3) ... Setting up libmm-glib0:riscv64 (1.20.0-1~ubuntu22.04.1) ... Setting up isc-dhcp-common (4.4.1-2.3ubuntu2.4) ... Setting up ubuntu-advantage-tools (27.13.6~22.04.1) ... Progress: [ 75%] [###########################################################################################################....................................] # CTRL + Z # if \u0026#39;ubuntu-advantage-tools\u0026#39; updates, rm postinst (again) $ sudo rm /var/lib/dpkg/info/ubuntu-advantage-tools.postinst $ sudo apt upgrade Waiting for cache lock: Could not get lock /var/lib/dpkg/lock-frontend. It is held by process 3029 (apt) Waiting for cache lock: Could not get lock /var/lib/dpkg/lock-frontend. It is held by process 3029 (apt) # CTRL + C $ sudo kill -9 3029 # repeat $ sudo apt upgrade E: dpkg was interrupted, you must manually run \u0026#39;sudo dpkg --configure -a\u0026#39; to correct the problem. $ sudo dpkg --configure -a # It will work again. Errors were encountered while processing: cloud-init libpam-systemd:riscv64 $ sudo reboot # ignore errors # disable sleep, less reboots sudo systemctl mask sleep.target suspend.target hibernate.target hybrid-sleep.target sudo apt upgrade # install KDE and some build tools $ sudo apt install kde-standard build-essential libxml2 libcurl4-gnutls-dev neofetch ubuntu-dev-tools libopenal-dev libpng-dev libjpeg-dev libfreetype6-dev libfontconfig1-dev libcurl4-gnutls-dev libsdl2-dev zlib1g-dev libbz2-dev libedit-dev python-is-python3 m4 clang # ignore kernel error (message) $ sudo reboot Network # Fix network manager in KDE (so you can control network in KDE)\n$ sudo nano /etc/netplan/01-network-manager-all.yaml # Let NetworkManager manage all devices on this system network: version: 2 renderer: NetworkManager Need reboot to get it working!\nScreenshot! # install gcc 13 on 23.04 # If you use the (now beta) release 23.04 and wish to use gcc 13:\napt install G++-13 gcc-13 sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-12 12 sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-12 12 sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-13 13 sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-13 13 sudo update-alternatives --config gcc sudo update-alternatives --config g++ fix snapd # If snap is broken, you can fix it: (happens ones)\nsudo apt purge snapd sudo apt install snapd plasma-discover-backend-snap # plasma-discover-backend-snap is you had installed kde ","date":"5 April 2023","externalUrl":null,"permalink":"/posts/starfive-visionfive-2/2023-04-05-ubuntu-ati-radeon-r9_290/","section":"Posts","summary":"","title":"StarFive VisionFive 2 - Ubuntu 22.04 external GPU ATI Radeon R9 290","type":"posts"},{"content":" Intro # I wanted to compile and test a few programs on a RISC-V. I only ran into the problem of minimal support of the onboard GPU and custom build Debian from the StarFive Team.\nSo below you can see my \u0026ldquo;solution\u0026rdquo;. (Part I)\nHardware # StarFive VisionFive 2 BEYIMEI PCIE Riser-Ver010X GPU Riser, 1X tot 16X (4PIN/6PIN/MOLEX) PCIE-verlengkabel, M.2 naar PCI-E Riser Card Bitcoin Litecoin Ethereum. This is about 11 EURO on amazon, so no big deal\u0026hellip; amazon-link ATI Radeon 5450, Bought on a Dutch second-hand website, for 10 EURO. An ATX power supply (was still lying around in the house) For debugging a USB to TTL (was still lying around in the house), is about 5 EURO. My first setup was with a too light power supply for the video card, you can still see it in the background (no longer connected). I always used this to connect a hard disk externally. If this also happens to you, you will see that the video card is recognized by the kernel, but that you see a lot of errors. [ 817.910347] pcie_plda 2c000000.pcie: AXI fetch error\nDebugging # The longest I spent trying to get a working kernel that had the ATI video card and audio over HDMI working.\nI have spent a lot of hours to get Kernel driver in use: radeon and Kernel driver in use: snd_hda_intel in my screen :)\n$ lspci -k 0000:00:00.0 PCI bridge: PLDA XpressRich-AXI Ref Design (rev 02) lspci: Unable to load libkmod resources: error -2 0000:01:00.0 USB controller: VIA Technologies, Inc. VL805/806 xHCI USB 3.0 Controller (rev 01) Subsystem: VIA Technologies, Inc. VL805/806 xHCI USB 3.0 Controller Kernel driver in use: xhci_hcd 0001:00:00.0 PCI bridge: PLDA XpressRich-AXI Ref Design (rev 02) 0001:01:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Cedar [Radeon HD 5000/6000/7350/8350 Series] Subsystem: ASUSTeK Computer Inc. Device 0366 Kernel driver in use: radeon 0001:01:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Cedar HDMI Audio [Radeon HD 5400/6300/7300 Series] Subsystem: ASUSTeK Computer Inc. Device aa68 Kernel driver in use: snd_hda_intel # or for Audio $ inxi -aA Audio: Device-1: AMD Cedar HDMI Audio [Radeon HD 5400/6300/7300 Series] vendor: ASUSTeK driver: snd_hda_intel v: kernel bus-ID: 0001:01:00.1 chip-ID: 1002:aa68 class-ID: 0403 Device-2: jh7110-pwmdac driver: starfive_pwmdac bus-ID: N/A chip-ID: starfive:100b0000 class-ID: pwmdac Device-3: jh7110-hdmi driver: innohdmi_starfive bus-ID: N/A chip-ID: starfive:29590000 class-ID: hdmi Device-4: simple-audio-card driver: N/A bus-ID: N/A chip-ID: simple-audio-card:soc class-ID: snd-card0 Device-5: simple-audio-card driver: asoc_simple_card bus-ID: N/A chip-ID: simple-audio-card:soc class-ID: snd-card1 Device-6: simple-audio-card driver: N/A bus-ID: N/A chip-ID: simple-audio-card:soc class-ID: snd-card2 Device-7: simple-audio-card driver: asoc_simple_card bus-ID: N/A chip-ID: simple-audio-card:soc class-ID: snd-card3 Device-8: simple-audio-card driver: N/A bus-ID: N/A chip-ID: simple-audio-card:soc class-ID: snd-card4 Device-9: simple-audio-card driver: N/A bus-ID: N/A chip-ID: simple-audio-card:soc class-ID: snd-card5 Device-10: simple-audio-card driver: N/A bus-ID: N/A chip-ID: simple-audio-card:soc class-ID: snd-card6 Sound API: ALSA v: k5.15.0-dirty running: yes Sound Server-1: PulseAudio v: 16.1 running: no Sound Server-2: PipeWire v: 0.3.59 running: yes The longest it take to findout I had to add firmwares to the kernel. I got the error\u0026rsquo;s with:\n$ journalctl -b | grep radeon $ journalctl -b | grep amdgpu $ journalctl -b | grep firmware After this it was only getting the Fedora root partition on my SD-card. The \u0026ldquo;Frankenstein\u0026rdquo; Debian-build-69 is fun if you want to see the board working with the onboard GPU, but those drivers are really unfinished and X11 was as fast as I could see completely custom build for this GPU. (No OpenGL, OpenGL ES 3 only).\nDIY Step by step # Create SD-card # My machine has a SD-card reader on /dev/mmcblk0 this can of course be difference on your machine.\nDownload the Debian-Image-69 from StarFive VisionFive 2 Support page (I used the torrent in the google drive). Download the Fedora RISC-V image Fedora-Developer-37-20221130.n.0-nvme.raw.img.xz link and extract it to Fedora-Developer-37-20221130.n.0-nvme.raw.img\n# create a loop device of image $ sudo losetup -f -P ~/Downloads/Image-69/starfive-jh7110-VF2_515_v2.5.0-69.img $ sudo losetup -f -P ~/Downloads/Fedora-Developer-37-20221130.n.0-nvme.raw.img # find your loop device $ losetup -l NAME SIZELIMIT OFFSET AUTOCLEAR RO BACK-FILE DIO LOG-SEC /dev/loop1 0 0 1 1 /var/lib/snapd/snaps/gnome-3-28-1804_161.snap 0 512 /dev/loop8 0 0 1 1 /var/lib/snapd/snaps/gtk-common-themes_1534.snap 0 512 /dev/loop15 0 0 0 0 /home/opvolger/Downloads/Fedora-Developer-37-20221130.n.0-nvme.raw.img 0 512 /dev/loop6 0 0 1 1 /var/lib/snapd/snaps/core18_2679.snap 0 512 /dev/loop13 0 0 1 1 /var/lib/snapd/snaps/wine-platform-runtime_335.snap 0 512 /dev/loop4 0 0 1 1 /var/lib/snapd/snaps/bare_5.snap 0 512 /dev/loop11 0 0 1 1 /var/lib/snapd/snaps/wine-platform-5-stable_18.snap 0 512 /dev/loop2 0 0 1 1 /var/lib/snapd/snaps/core18_2697.snap 0 512 /dev/loop0 0 0 1 1 /var/lib/snapd/snaps/gtk-common-themes_1535.snap 0 512 /dev/loop9 0 0 1 1 /var/lib/snapd/snaps/snapd_18357.snap 0 512 /dev/loop7 0 0 1 1 /var/lib/snapd/snaps/snapd_17950.snap 0 512 /dev/loop14 0 0 0 0 /home/opvolger/Downloads/Image-69/starfive-jh7110-VF2_515_v2.5.0-69.img 0 512 /dev/loop5 0 0 1 1 /var/lib/snapd/snaps/cncra_63.snap 0 512 /dev/loop12 0 0 1 1 /var/lib/snapd/snaps/wine-platform-runtime_334.snap 0 512 /dev/loop3 0 0 1 1 /var/lib/snapd/snaps/cncra_76.snap 0 512 /dev/loop10 0 0 1 1 /var/lib/snapd/snaps/wine-platform-5-stable_16.snap 0 512 # in my case it is loop14 and loop15 # insert your SD-card and delete all partitions (I had 3) $ sudo fdisk /dev/mmcblk0 [sudo] password for opvolger: Welcome to fdisk (util-linux 2.38.1). Changes will remain in memory only, until you decide to write them. Be careful before using the write command. Command (m for help): d Partition number (1-3, default 3): 1 Partition 1 has been deleted. Command (m for help): d Partition number (2,3, default 3): 2 Partition 2 has been deleted. Command (m for help): d Selected partition 3 Partition 3 has been deleted. Command (m for help): w The partition table has been altered. Calling ioctl() to re-read partition table. Syncing disks. # add all 3 partitions (not all data) of the Debain-Image-69 to the SD-card $ sudo dd if=/dev/loop14 of=/dev/mmcblk0 status=progress [sudo] password for opvolger: 1121309184 bytes (1.1 GB, 1.0 GiB) copied, 93 s, 12.1 MB/s^C 2190529+0 records in 2190529+0 records out 1121550848 bytes (1.1 GB, 1.0 GiB) copied, 95.7358 s, 11.7 MB/s # You can hit Ctrl+C after about 1GB (I did!) # the Fedora img has only 2 partitions, 2nd is the root partition. We need to (re)place the root partition of the Debain-Image-69 (3th partition now on the SD-card) $ sudo dd if=/dev/loop15p2 of=/dev/mmcblk0p3 status=progress 9975758848 bytes (10 GB, 9.3 GiB) copied, 319 s, 31.3 MB/s 19537853+0 records in 19537853+0 records out 10003380736 bytes (10 GB, 9.3 GiB) copied, 384.316 s, 26.0 MB/s Remove the SD-card and put it back in again.\nBuilding the Linux Kernel # I build this on my own machine, otherwise it will take a very long time. so cross compile! Everything is neatly explained if you click through to the \u0026ldquo;linux\u0026rdquo; repo of all (yet) custom code for the SBC. link\n$ mkdir ~/visionfive2 $ cd visionfive2 $ git clone https://github.com/starfive-tech/linux.git Cloning into \u0026#39;linux\u0026#39;... remote: Enumerating objects: 9350943, done. remote: Counting objects: 100% (1061/1061), done. remote: Compressing objects: 100% (425/425), done. Receiving objects: 1% (160706/9350943), 77.16 MiB | 14.26 MiB/s Done $ cd linux $ git checkout JH7110_VisionFive2_devel # not working with tag \u0026#39;VF2_v2.10.4\u0026#39;, may in the feature it will (again) $ git checkout VF2_v2.8.0 Updating files: 100% (20490/20490), done. Switched to branch \u0026#39;JH7110_VisionFive2_devel\u0026#39; Your branch is up to date with \u0026#39;origin/JH7110_VisionFive2_devel\u0026#39;. Now we have the modified kernel 5.15 that workes with VisionFive 2. We can use the instructions of the other branch link. Here and there I deviated a little from it\nI am running Manjaro on got an error. I fixxed it in arch/riscv/Makefile on line +/- 56 (find this online).\n... ... ... # ISA string setting riscv-march-$(CONFIG_ARCH_RV32I)\t:= rv32ima riscv-march-$(CONFIG_ARCH_RV64I)\t:= rv64ima riscv-march-$(CONFIG_FPU)\t:= $(riscv-march-y)fd riscv-march-$(CONFIG_RISCV_ISA_C)\t:= $(riscv-march-y)c # Newer binutils versions default to ISA spec version 20191213 which moves some # instructions from the I extension to the Zicsr and Zifencei extensions. toolchain-need-zicsr-zifencei := $(call cc-option-yn, -march=$(riscv-march-y)_zicsr_zifencei) riscv-march-$(toolchain-need-zicsr-zifencei) := $(riscv-march-y)_zicsr_zifencei KBUILD_CFLAGS += -march=$(subst fd,,$(riscv-march-y)) KBUILD_AFLAGS += -march=$(riscv-march-y) ... ... ... # create the .config with all you need for only the StarFive VisionFive 2 make ARCH=riscv CROSS_COMPILE=riscv64-linux-gnu- starfive_jh7110_defconfig # open the menu make CROSS_COMPILE=riscv64-linux-gnu- ARCH=riscv menuconfig Now we have to add the ATI video-card and HDMI-audio.\nDevice Drivers ---\u0026gt; [HIT ENTER] Generic Driver Options ---\u0026gt; [HIT ENTER] Firmware loader ---\u0026gt; [HIT ENTER] () Build named firmware blobs into the kernel binary [HIT ENTER] enter this in the line:\nradeon/CYPRESS_uvd.bin radeon/CEDAR_smc.bin radeon/CEDAR_me.bin radeon/CEDAR_pfp.bin radeon/CEDAR_rlc.bin Select Exit,Exit,Exit\nDevice Drivers ---\u0026gt; Graphics support ---\u0026gt; [HIT ENTER] \u0026lt;*\u0026gt; ATI Radeon [hit space twice] Select Exit\nDevice Drivers ---\u0026gt; Sound card support ---\u0026gt; [HIT ENTER] Advanced Linux Sound Architecture ---\u0026gt; [HIT ENTER] HD-Audio ---\u0026gt; Build HDMI/DisplayPort HD-audio codec support [hit space twice] Select Exit,Exit,Exit,Exit\nNow save your changes! as .config and Exit\nWe can compile the kernel, I have 8 cores in my machine\u0026hellip; so I added -j 8\n$ make ARCH=riscv CROSS_COMPILE=riscv64-linux-gnu- -j 8 SYNC include/config/auto.conf CALL scripts/atomic/check-atomics.sh CALL scripts/checksyscalls.sh CHK include/generated/compile.h CC sound/core/sound.o CC sound/core/init.o CC sound/core/control.o UPD kernel/config_data AR sound/pci/ac97/built-in.a CC sound/pci/hda/hda_bind.o CC sound/pci/hda/hda_codec.o GZIP kernel/config_data.gz CC kernel/configs.o CC drivers/tty/vt/keyboard.o AR kernel/built-in.a CC sound/core/vmaster.o CC sound/usb/card.o CC sound/pci/hda/hda_jack.o CC sound/core/ctljack.o ... ... ... LD vmlinux SORTTAB vmlinux SYSMAP System.map MODPOST modules-only.symvers OBJCOPY arch/riscv/boot/Image GZIP arch/riscv/boot/Image.gz GEN Module.symvers LD [M] drivers/net/wireless/eswin/wlan_ecr6600u_usb.ko Kernel: arch/riscv/boot/Image.gz is ready $ mkdir -p ~/visionfive2/kernel $ make CROSS_COMPILE=riscv64-linux-gnu- ARCH=riscv INSTALL_PATH=~/visionfive2/kernel zinstall -j 8 sh ./arch/riscv/boot/install.sh 5.15.0-dirty \\ arch/riscv/boot/Image.gz System.map \u0026#34;/home/opvolger/visionfive2/kernel\u0026#34; Installing compressed kernel The kernel is Done! Now copy it to the boot partition!\nBOOT/ROOT Copy kernel # We have the SD-card inserted (again).\n$ mkdir -p ~/visionfive2/boot $ mkdir -p ~/visionfive2/root # mount boot and root partition $ sudo mount /dev/mmcblk0p2 ~/visionfive2/boot $ sudo mount /dev/mmcblk0p3 ~/visionfive2/root # copy the kernel $ sudo cp ~/visionfive2/kernel/*dirty ~/visionfive2/boot/boot BOOT/ROOT Add the boot option # $ sudo nano ~/visionfive2/boot/boot/extlinux/extlinux.conf We have to change the kernel from /boot/vmlinuz-5.15.0-starfive to /boot/vmlinuz-5.15.0-dirty\n## /boot/extlinux/extlinux.conf ## ## IMPORTANT WARNING ## ## The configuration of this file is generated automatically. ## Do not edit this file manually, use: u-boot-update default l0 menu title U-Boot menu prompt 0 timeout 50 label l0 menu label Debian GNU/Linux bookworm/sid 5.15.0-starfive linux /boot/vmlinuz-5.15.0-starfive initrd /boot/initrd.img-5.15.0-starfive fdtdir /boot/dtbs/ append root=/dev/mmcblk1p3 rw console=tty0 console=ttyS0,115200 earlycon rootwait stmmaceth=chain_mode:1 selinux=0 label l0r menu label Debian GNU/Linux bookworm/sid 5.15.0-starfive (rescue target) linux /boot/vmlinuz-5.15.0-starfive initrd /boot/initrd.img-5.15.0-starfive fdtdir /boot/dtbs/ append root=/dev/mmcblk1p3 rw console=tty0 console=ttyS0,115200 earlycon rootwait stmmaceth=chain_mode:1 selinux=0 single to\n## /boot/extlinux/extlinux.conf ## ## IMPORTANT WARNING ## ## The configuration of this file is generated automatically. ## Do not edit this file manually, use: u-boot-update default l0 menu title U-Boot menu prompt 0 timeout 50 label l0 menu label Fedora GNU/Linux bookworm/sid 5.15.0-dirty linux /boot/vmlinuz-5.15.0-dirty initrd /boot/initrd.img-5.15.0-starfive fdtdir /boot/dtbs/ append root=/dev/mmcblk1p3 rw console=tty0 console=ttyS0,115200 earlycon rootwait stmmaceth=chain_mode:1 selinux=0 label l0r menu label Debian GNU/Linux bookworm/sid 5.15.0-starfive (rescue target) linux /boot/vmlinuz-5.15.0-starfive initrd /boot/initrd.img-5.15.0-starfive fdtdir /boot/dtbs/ append root=/dev/mmcblk1p3 rw console=tty0 console=ttyS0,115200 earlycon rootwait stmmaceth=chain_mode:1 selinux=0 single BOOT/ROOT Fix the fstab of the root partition # We have to change the /boot mount point. The UUID and type are different. We have to findout the new UUID and change the type from ext4 to vfat. (Debian image works with vfat!)\n$ blkid /dev/mmcblk0p2 /dev/mmcblk0p2: SEC_TYPE=\u0026#34;msdos\u0026#34; UUID=\u0026#34;9936-8B5F\u0026#34; BLOCK_SIZE=\u0026#34;512\u0026#34; TYPE=\u0026#34;vfat\u0026#34; PARTUUID=\u0026#34;9ba5bebd-7dd9-4a43-b352-3b197302ead9\u0026#34; $ sudo nano ~/visionfive2/root/etc/fstab change\nUUID=d9334329-e2ad-4b72-8f5f-b61406e9d461 / ext4 defaults,noatime,x-systemd.device-timeout=300s,x-systemd.mount-timeout=300s 0 0 UUID=53e7246e-90c3-42c4-b447-3ebc9fe1fdfc /boot ext4 defaults,noatime,x-systemd.device-timeout=300s,x-systemd.mount-timeout=300s 0 0 to\nUUID=d9334329-e2ad-4b72-8f5f-b61406e9d461 / ext4 defaults,noatime,x-systemd.device-timeout=300s,x-systemd.mount-timeout=300s 0 0 UUID=9936-8B5F /boot vfat defaults,noatime,x-systemd.device-timeout=30s,x-systemd.mount-timeout=30s 0 0 BOOT/ROOT Yum repo\u0026rsquo;s # There is no real release yet of RISC-V of Fedora (mainline). So we need to disable alot of repo\u0026rsquo;s\n$ sudo nano ~/visionfive2/root/etc/yum.repos.d/fedora-cisco-openh264.repo $ sudo nano ~/visionfive2/root/etc/yum.repos.d/fedora-modular.repo $ sudo nano ~/visionfive2/root/etc/yum.repos.d/fedora-riscv.repo $ sudo nano ~/visionfive2/root/etc/yum.repos.d/fedora-updates-modular.repo $ sudo nano ~/visionfive2/root/etc/yum.repos.d/fedora-updates.repo $ sudo nano ~/visionfive2/root/etc/yum.repos.d/fedora-updates-testing-modular.repo $ sudo nano ~/visionfive2/root/etc/yum.repos.d/fedora-updates-testing.repo and change\nenabled=1 to\nenabled=0 We only have to update one file\n$ sudo nano ~/visionfive2/root/etc/yum.repos.d/fedora.repo [fedora] name=Fedora $releasever - $basearch #baseurl=http://download.example/pub/fedora/linux/releases/$releasever/Everything/$basearch/os/ metalink=https://mirrors.fedoraproject.org/metalink?repo=fedora-$releasever\u0026amp;arch=$basearch enabled=1 countme=1 metadata_expire=6h ... ... ... ... to\n[fedora] name=Fedora $releasever - $basearch baseurl=https://dl.fedoraproject.org/pub/alt/risc-v/repo/fedora/37/latest/riscv64/ #metalink=https://mirrors.fedoraproject.org/metalink?repo=fedora-$releasever\u0026amp;arch=$basearch enabled=1 countme=1 metadata_expire=6h ... ... ... ... ... BOOT it up! # # umount the SD-card $ sudo umount ~/visionfive2/root/ $ sudo umount ~/visionfive2/boot/ Put the SD-card into the VisionFive 2 and turn it on! We have to wait for dev-zram0.device \u0026hellip;\nNow we connect to the VisionFive 2 (ip will be different)\n$ ssh riscv@192.168.2.20 The authenticity of host \u0026#39;192.168.2.20 (192.168.2.20)\u0026#39; can\u0026#39;t be established. ED25519 key fingerprint is SHA256:cqqk6Zm4/oC0tSwrC4JtT29MPpOC7Ye9yAuxQMklugM. This key is not known by any other names. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added \u0026#39;192.168.2.20\u0026#39; (ED25519) to the list of known hosts. riscv@192.168.2.20\u0026#39;s password: Now first remove zram!\n[riscv@fedora-riscv ~]$ sudo yum remove zram-generator-defaults We trust you have received the usual lecture from the local System Administrator. It usually boils down to these three things: #1) Respect the privacy of others. #2) Think before you type. #3) With great power comes great responsibility. [sudo] password for riscv: Dependencies resolved. =============================================================================================================== Package Architecture Version Repository Size =============================================================================================================== Removing: zram-generator-defaults noarch 1.1.2-2.fc37 @koji-override-0 320 Removing unused dependencies: zram-generator riscv64 1.1.2-2.fc37 @koji-override-0 728 k Transaction Summary =============================================================================================================== Remove 2 Packages Freed space: 728 k Is this ok [y/N]: y Running transaction check Transaction check succeeded. Running transaction test Transaction test succeeded. Running transaction Preparing : 1/1 Erasing : zram-generator-defaults-1.1.2-2.fc37.noarch 1/2 Erasing : zram-generator-1.1.2-2.fc37.riscv64 2/2 Running scriptlet: zram-generator-1.1.2-2.fc37.riscv64 2/2 Verifying : zram-generator-1.1.2-2.fc37.riscv64 1/2 Verifying : zram-generator-defaults-1.1.2-2.fc37.noarch 2/2 Removed: zram-generator-1.1.2-2.fc37.riscv64 zram-generator-defaults-1.1.2-2.fc37.noarch Complete! Update # $ sudo dnf update --exclude=kernel-* --exclude=uboot-* --exclude=opensbi-* $ sudo dnf install firefox @gnome-desktop --skip-broken # pptp is not yet there Compile Quake2 # # clean yum clean all [riscv@fedora-riscv ~]$ sudo yum clean all 0 files removed # install packages needed for compiling (Y)Quake2 # GPG is not working, so no check on it (this will take a while) [riscv@fedora-riscv ~]$ sudo yum install SDL2-devel openal-soft-devel libcurl-devel --nogpgcheck Fedora 37 - riscv64 71% [======================================- ] 1.3 MB/s | 40 MB 00:12 ETA ... ... ... Verifying : openal-soft-devel-1.22.2-2.fc37.riscv64 10/10 Installed: SDL2-2.24.0-1.fc37.riscv64 SDL2-devel-2.24.0-1.fc37.riscv64 libcurl-devel-7.85.0-2.fc37.riscv64 libdecor-0.1.0-3.fc37.riscv64 libglvnd-core-devel-1:1.5.0-1.fc37.riscv64 libglvnd-devel-1:1.5.0-1.fc37.riscv64 libmysofa-1.2.1-3.fc37.riscv64 mesa-libEGL-devel-22.2.2-1.fc37.riscv64 openal-soft-1.22.2-2.fc37.riscv64 openal-soft-devel-1.22.2-2.fc37.riscv64 Complete! Now clone Quake2 and build it!\n[riscv@fedora-riscv ~]$ git clone https://github.com/yquake2/yquake2.git Cloning into \u0026#39;yquake2\u0026#39;... remote: Enumerating objects: 27461, done. remote: Counting objects: 100% (452/452), done. remote: Compressing objects: 100% (203/203), done. remote: Total 27461 (delta 278), reused 386 (delta 248), pack-reused 27009 Receiving objects: 100% (27461/27461), 24.93 MiB | 8.24 MiB/s, done. Resolving deltas: 100% (19048/19048), done. [riscv@fedora-riscv ~]$ cd yquake2 [riscv@fedora-riscv yquake2]$ make Build configuration ============================ YQ2_ARCH = riscv64 COMPILER = gcc WITH_CURL = yes WITH_OPENAL = yes WITH_RPATH = yes WITH_SYSTEMWIDE = no WITH_SYSTEMDIR = ============================ ===\u0026gt; Building quake2 make release/quake2 make[1]: Entering directory \u0026#39;/home/riscv/yquake2\u0026#39; ===\u0026gt; CC src/backends/generic/misc.c ===\u0026gt; CC src/client/cl_cin.c ===\u0026gt; CC src/client/cl_console.c ... ... ... ... ... ===\u0026gt; CC src/client/refresh/files/pvs.c ===\u0026gt; CC src/common/shared/shared.c ===\u0026gt; CC src/common/md4.c ===\u0026gt; CC src/backends/unix/shared/hunk.c ===\u0026gt; LD release/ref_soft.so make[1]: Leaving directory \u0026#39;/home/riscv/yquake2\u0026#39; [riscv@fedora-riscv ~]$ cd [riscv@fedora-riscv ~]$ mkdir -p ~/.yq2/baseq2 # if you own Quake2 copy the content of your baseq2 folder to ~/.yq2/baseq2 # if not.. get the demo version of pak0.pak and other files from here: [riscv@fedora-riscv ~]$ git clone https://github.com/drags/docker-quake2.git Cloning into \u0026#39;docker-quake2\u0026#39;... remote: Enumerating objects: 1190, done. remote: Total 1190 (delta 0), reused 0 (delta 0), pack-reused 1190 Receiving objects: 100% (1190/1190), 70.91 MiB | 8.56 MiB/s, done. Resolving deltas: 100% (87/87), done. Updating files: 100% (1191/1191), done. [riscv@fedora-riscv ~]$ cp -R docker-quake2/baseq2/* ~/.yq2/baseq2/ # we have do not need x86 :) [riscv@fedora-riscv ~]$ rm ~/.yq2/baseq2/gamex86_64.so # create maps.lst [riscv@fedora-riscv ~]$ cat \u0026lt;\u0026lt;EOT \u0026gt;\u0026gt; ~/.yq2/baseq2/maps.lst q2dm1 \u0026#34;The Edge\u0026#34; \\ q2dm2 \u0026#34;Tokay\u0026#39;s Towers\u0026#34; \\ q2dm3 \u0026#34;The Frag Pipe\u0026#34; \\ q2dm4 \u0026#34;Lost Hallways\u0026#34; \\ q2dm5 \u0026#34;The Pits\u0026#34; \\ q2dm6 \u0026#34;Lava Tomb\u0026#34; \\ q2dm7 \u0026#34;The Slimy Place\u0026#34; \\ q2dm8 \u0026#34;WareHouse\u0026#34; EOT Done!\nPlay Quake2 # Login X11 and start ~/yquake2/release/quake2\nHere you can see the YouTube Demo:\n","date":"27 February 2023","externalUrl":null,"permalink":"/posts/starfive-visionfive-2/2023-02-27-fedora-ati-radeon5450/","section":"Posts","summary":"","title":"StarFive VisionFive 2 - Fedora 37 external GPU ATI Radeon 5450 running Quake2","type":"posts"},{"content":" Intro # In addition to Ubuntu and Fedora, I had also run OpenSUSE Tumbleweed on the StarFive VisionFive 2. I had never written a manual for this before. Hence this manual. The OpenSUSE Tumbleweed image uses a kernel that does not yet have the PCIe patches of the StarFive VisionFive 2. More information about what is and is not main-stream in the kernel can be found here: site\nSo I have created my own kernel and updated the efi/root partition a little bit to boot OpenSUSE Tumbleweed with external GPU.\nSee the YouTube Video for the end result: video\nThe entire manual works from 1 directory. In my case ~/OpenSUSETumbleweed\n$ mkdir OpenSUSETumbleweed $ cd OpenSUSETumbleweed/ Hardware # StarFive VisionFive 2 BEYIMEI PCIE Riser-Ver010X GPU Riser, 1X tot 16X (4PIN/6PIN/MOLEX) PCIE-verlengkabel, M.2 naar PCI-E Riser Card Bitcoin Litecoin Ethereum. This is about 11 EURO on amazon, so no big deal\u0026hellip; amazon-link AMD/ATI Hawaii PRO [Radeon R9 290/390], Bought on a Dutch second-hand website, for 45 EURO. or ATI Radeon 5450, Bought on a Dutch second-hand website, for 10 EURO. An ATX power supply (was still lying around in the house) For debugging a USB to TTL (was still lying around in the house), is about 5 EURO. or Downloads # We\u0026rsquo;ll start with some downloads, we\u0026rsquo;ll need:\nimages from OpenSUSE Tumbleweed site EFI-boot from Ubuntu site kernel/firmware from StarFive VisionFive 2 repo site Update firmware of the StarFive VisionFive 2 # I have already described this in the Ubuntu 23.10 manual here.\nBut there is a newer version so here a short version:\n# download firmware $ wget https://github.com/starfive-tech/VisionFive2/releases/download/JH7110_VF2_515_v5.10.3/u-boot-spl.bin.normal.out --2024-02-10 14:02:38-- https://github.com/starfive-tech/VisionFive2/releases/download/JH7110_VF2_515_v5.10.3/u-boot-spl.bin.normal.out Resolving github.com (github.com)... 140.82.121.3 Connecting to github.com (github.com)|140.82.121.3|:443... connected. ... ... ... Length: 148440 (145K) [application/octet-stream] Saving to: ‚Äòu-boot-spl.bin.normal.out‚Äô u-boot-spl.bin.normal.out 100%[===========================================================================================================================================================================================\u0026gt;] 144,96K --.-KB/s in 0,02s 2024-02-10 14:02:39 (7,36 MB/s) - ‚Äòu-boot-spl.bin.normal.out‚Äô saved [148440/148440] # download firmware $ wget https://github.com/starfive-tech/VisionFive2/releases/download/JH7110_VF2_515_v5.10.3/visionfive2_fw_payload.img --2024-02-10 14:03:29-- https://github.com/starfive-tech/VisionFive2/releases/download/JH7110_VF2_515_v5.10.3/visionfive2_fw_payload.img Resolving github.com (github.com)... 140.82.121.4 Connecting to github.com (github.com)|140.82.121.4|:443... connected. ... ... ... 2024-02-10 14:03:30 (14,1 MB/s) - ‚Äòvisionfive2_fw_payload.img‚Äô saved [3015045/3015045] # take down your firewall (so port 69 can be used) $ sudo systemctl stop firewalld.service [sudo] password for opvolger: # startup docker container with tftp of this directory $ docker run -p 0.0.0.0:69:69/udp -v $(pwd):/var/tftpboot -i -t pghalliday/tftp Do NOT hit Ctrl+C! We need this server until we are done flashing! Keep it running\nSetup your VisionFive 2 without a SD-card and the USB to TTL connected (see link for more information)\nMy machine (with docker) has ip-address 192.168.2.29 and I give my VisionFive 2 the ip 192.168.2.222\nOpen a new terminal (keep docker running)\n# This will open a serial screen to your VisionFive 2 screen -L /dev/ttyUSB0 115200 Boot up your VisionFive 2\n... ... ... Loading: * ARP Retry count exceeded; starting again StarFive # This will be the commands (for the StarFive firmware):\n# set the ip of the VisionFive 2, and of the server (where docker is running) $ setenv ipaddr 192.168.2.222; setenv serverip 192.168.2.29 # test network $ ping 192.168.2.29 # Initialize SPI Flash $ sf probe # Download and Update SPL binary $ tftpboot 0xa0000000 ${serverip}:u-boot-spl.bin.normal.out $ sf update 0xa0000000 0x0 $filesize # Download and Update U-Boot binary $ tftpboot 0xa0000000 ${serverip}:visionfive2_fw_payload.img $ sf update 0xa0000000 0x100000 $filesize # We will not need to reset to default now! # Save your changes $ env save The output will be something like this:\nStarFive # setenv ipaddr 192.168.2.222; setenv serverip 192.168.2.29 StarFive # ping 192.168.2.29 Using ethernet@16040000 device host 192.168.2.29 is alive StarFive # sf probe SF: Detected gd25lq128 with page size 256 Bytes, erase size 4 KiB, total 16 MiB StarFive # tftpboot 0xa0000000 ${serverip}:u-boot-spl.bin.normal.out Using ethernet@16040000 device TFTP from server 192.168.2.29; our IP address is 192.168.2.222 Filename \u0026#39;u-boot-spl.bin.normal.out\u0026#39;. Load address: 0xa0000000 Loading: ########### 960 KiB/s done Bytes transferred = 148440 (243d8 hex) StarFive # sf update 0xa0000000 0x0 $filesize device 0 offset 0x0, size 0x243d8 148440 bytes written, 0 bytes skipped in 1.202s, speed 126143 B/s StarFive # sf update 0xa0000000 0x0 $filesize device 0 offset 0x0, size 0x243d8 148440 bytes written, 0 bytes skipped in 1.202s, speed 126143 B/s StarFive # sf update 0xa0000000 0x0 $filesize device 0 offset 0x0, size 0x243d8 0 bytes written, 148440 bytes skipped in 0.26s, speed 5241467 B/s StarFive # tftpboot 0xa0000000 ${serverip}:visionfive2_fw_payload.img Using ethernet@16040000 device TFTP from server 192.168.2.29; our IP address is 192.168.2.222 Filename \u0026#39;visionfive2_fw_payload.img\u0026#39;. Load address: 0xa0000000 Loading: ################################################################# ################################################################# ################################################################# ########### 1 MiB/s done Bytes transferred = 3015045 (2e0185 hex) StarFive # sf update 0xa0000000 0x100000 $filesize device 0 offset 0x100000, size 0x2e0185 1970176 bytes written, 1044869 bytes skipped in 16.433s, speed 187844 B/s StarFive # env save Saving Environment to SPIFlash... Erasing SPI flash...Writing to SPI flash...done OK Done!\nYou can now hit Ctrl+C on your docker terminal and start your firewall again\n$ sudo systemctl start firewalld.service [sudo] password for opvolger: You can turn off the VisionFive 2 again\nImages from OpenSUSE Tumbleweed # Download the images from the OpenSUSE Tumbleweed site.\n$ wget https://download.opensuse.org/repositories/devel:/RISCV:/Factory:/Contrib:/StarFive:/VisionFive2/images/openSUSE-Tumbleweed-RISC-V-JeOS-starfivevisionfive2.riscv64-2024.01.16-Build23.43.raw.xz --2024-02-10 13:47:06-- https://download.opensuse.org/repositories/devel:/RISCV:/Factory:/Contrib:/StarFive:/VisionFive2/images/openSUSE-Tumbleweed-RISC-V-JeOS-starfivevisionfive2.riscv64-2024.01.16-Build23.43.raw.xz ... ... ... 2024-02-10 13:48:08 (14,3 MB/s) - ‚ÄòopenSUSE-Tumbleweed-RISC-V-JeOS-starfivevisionfive2.riscv64-2024.01.16-Build23.43.raw.xz‚Äô saved [928465828/928465828] Now flash it to a SD-card. I use balenaEtcher for it. (on my machine it was /dev/sdb)\nCompile the 6.1.31+ kernel # I have installed Fedora linux and had to install some stuff to be able to cross compile\n$ sudo dnf group install \u0026#34;Development Tools\u0026#34; $ sudo dnf install git gcc-plugin-devel libmpc-devel gcc-c++ gcc-c++-riscv64-linux-gnu ncurses-devel libmpc-devel nano We need to checkout the kernel of StarFive and make some changes\n# we need the firmware for AMD / ATI cards, we do not need history so depth 1 $ git clone --depth 1 git://git.kernel.org/pub/scm/linux/kernel/git/firmware/linux-firmware.git linux-firmware Cloning into \u0026#39;linux-firmware\u0026#39;... remote: Enumerating objects: 3389, done. remote: Counting objects: 100% (3389/3389), done. remote: Compressing objects: 100% (2461/2461), done. remote: Total 3389 (delta 1233), reused 2471 (delta 832), pack-reused 0 Receiving objects: 100% (3389/3389), 435.72 MiB | 13.27 MiB/s, done. Resolving deltas: 100% (1233/1233), done. Updating files: 100% (3554/3554), done. # We need the kernel of StarFive, we do not need history so depth 1 opvolger@desktop:~/OpenSUSETumbleweed$ git clone --branch VF2_6.1_v3.8.2 --depth 1 https://github.com/starfive-tech/linux.git Cloning into \u0026#39;linux\u0026#39;... remote: Enumerating objects: 84693, done. remote: Counting objects: 100% (84693/84693), done. remote: Compressing objects: 100% (78851/78851), done. remote: Total 84693 (delta 8228), reused 22621 (delta 4958), pack-reused 0 Receiving objects: 100% (84693/84693), 233.16 MiB | 7.86 MiB/s, done. Resolving deltas: 100% (8228/8228), done. Note: switching to \u0026#39;22e0315434b13cdde93ded101b567d5d1c4d5a2e\u0026#39;. You are in \u0026#39;detached HEAD\u0026#39; state. You can look around, make experimental changes and commit them, and you can discard any commits you make in this state without impacting any branches by switching back to a branch. If you want to create a new branch to retain commits you create, you may do so (now or later) by using -c with the switch command. Example: git switch -c \u0026lt;new-branch-name\u0026gt; Or undo this operation with: git switch - Turn off this advice by setting config variable advice.detachedHead to false Updating files: 100% (79971/79971), done. #Go to the kernel dir $ cd linux # create a \u0026#34;default\u0026#34; .config for the kernel compilation $ make ARCH=riscv CROSS_COMPILE=riscv64-linux-gnu- starfive_jh7110_defconfig HOSTCC scripts/basic/fixdep HOSTCC scripts/kconfig/conf.o HOSTCC scripts/kconfig/confdata.o HOSTCC scripts/kconfig/expr.o LEX scripts/kconfig/lexer.lex.c YACC scripts/kconfig/parser.tab.[ch] HOSTCC scripts/kconfig/lexer.lex.o HOSTCC scripts/kconfig/menu.o HOSTCC scripts/kconfig/parser.tab.o HOSTCC scripts/kconfig/preprocess.o HOSTCC scripts/kconfig/symbol.o HOSTCC scripts/kconfig/util.o HOSTLD scripts/kconfig/conf # # configuration written to .config # # open the menu $ make CROSS_COMPILE=riscv64-linux-gnu- ARCH=riscv menuconfig Now we have to add the ATI video-card and HDMI-audio.\nDevice Drivers ---\u0026gt; [HIT ENTER] Generic Driver Options ---\u0026gt; [HIT ENTER] Firmware loader ---\u0026gt; [HIT ENTER] () Build named firmware blobs into the kernel binary [HIT ENTER] (/lib/firmware) Firmware blobs root directory [change it to ../linux-firmware] enter this in the line:\n(radeon bins for ATI Radeon 5450, amdgpu/radeon bin files of AMD/ATI Hawaii PRO [Radeon R9 290/390] (has 2 drivers amd and ATI) and rt2870.bin for my wifi dongel)\nradeon/CYPRESS_uvd.bin radeon/CEDAR_smc.bin radeon/CEDAR_me.bin radeon/CEDAR_pfp.bin radeon/CEDAR_rlc.bin amdgpu/hawaii_k_smc.bin amdgpu/hawaii_smc.bin amdgpu/hawaii_uvd.bin amdgpu/hawaii_vce.bin amdgpu/hawaii_sdma.bin amdgpu/hawaii_sdma1.bin amdgpu/hawaii_pfp.bin amdgpu/hawaii_me.bin amdgpu/hawaii_ce.bin amdgpu/hawaii_rlc.bin amdgpu/hawaii_mec.bin amdgpu/hawaii_mc.bin radeon/hawaii_pfp.bin radeon/hawaii_me.bin radeon/hawaii_ce.bin radeon/hawaii_mec.bin radeon/hawaii_mc.bin radeon/hawaii_rlc.bin radeon/hawaii_sdma.bin radeon/hawaii_smc.bin radeon/hawaii_k_smc.bin radeon/HAWAII_pfp.bin radeon/HAWAII_me.bin radeon/HAWAII_ce.bin radeon/HAWAII_mec.bin radeon/HAWAII_mc.bin radeon/HAWAII_mc2.bin radeon/HAWAII_rlc.bin radeon/HAWAII_sdma.bin radeon/HAWAII_smc.bin rt2870.bin Select Exit,Exit\nWe need some stuff for snapd:\nDevice Drivers -\u0026gt; Block devices -\u0026gt; [HIT ENTER] \u0026lt;*\u0026gt; RAM block device support [HIT SPACE 2x] Select Exit\nI have a RaLink Wifi dongle\nDevice Drivers -\u0026gt; Network device support ---\u0026gt; [HIT ENTER] Wireless LAN ---\u0026gt; [HIT ENTER] \u0026lt;*\u0026gt; Ralink driver support ---- [HIT SPACE 2x][HIT ENTER] \u0026lt;*\u0026gt; Ralink rt27xx/rt28xx/rt30xx (USB) [HIT SPACE 2x] [*] rt2800usb - Incl..... 6x [HIT SPACE 1x on 4 rows] Select Exit,Exit,Exit\nDevice Drivers ---\u0026gt; Graphics support ---\u0026gt; [HIT ENTER] \u0026lt;*\u0026gt; ATI GPU [HIT SPACE] \u0026lt;*\u0026gt; AMD GPU [HIT SPACE 2x] [*] Enable amdgpu support for SI parts [HIT SPACE] [*] Enable amdgpu support for CIK parts [HIT SPACE] ACP (Audio CoProcessor) Configuration ---\u0026gt; [HIT ENTER] [*] Enable AMD Audio CoProcessor IP support [HIT SPACE] Select Exit,Exit\nDevice Drivers ---\u0026gt; Sound card support ---\u0026gt; [HIT ENTER] Advanced Linux Sound Architecture ---\u0026gt; [HIT ENTER] HD-Audio ---\u0026gt; [HIT ENTER] \u0026lt;*\u0026gt; HD Audio PCI [HIT SPACE 2x] \u0026lt;*\u0026gt; Build HDMI/DisplayPort HD-audio codec support [HIT SPACE 2x] Select Exit,Exit,Exit,Exit\nWe need more some stuff for snapd:\nFile systems -\u0026gt; [HIT ENTER] Miscellaneous filesystems -\u0026gt; [HIT ENTER] \u0026lt;*\u0026gt; SquashFS 4.0 - Squased file system support [HIT SPACE 2x] [*] Squashfs XATTR support [HIT SPACE] [*] Include support for ZLIB compressed file systems [*] Include support for LZ4 compressed file systems [HIT SPACE] [*] Include support for LZO compressed file systems [HIT SPACE] [*] Include support for XZ compressed file systems [HIT SPACE] [*] Include support for ZSTD compressed file systems [HIT SPACE] Select Exit,Exit\nWe need CONFIG_SECCOMP and CONFIG_SECCOMP_FILTER for the epiphany browser\nGeneral architecture-dependent options ---\u0026gt; [HIT ENTER] [*] Enable seccomp to safely execute untrusted bytecode -\u0026gt; [HIT SPACE] Select Exit,Exit\nYes You wish to save your new configuration!\nIf you use GCC 13 and up, you need to patch the kernel code see this patch.\n# Download the patch $ wget -O gcc13.patch https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=e6a71160cc145e18ab45195abf89884112e02dfb --2024-02-10 14:59:30-- https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=e6a71160cc145e18ab45195abf89884112e02dfb Resolving git.kernel.org (git.kernel.org)... 2604:1380:4601:e00::1, 145.40.68.75 Connecting to git.kernel.org (git.kernel.org)|2604:1380:4601:e00::1|:443... connected. HTTP request sent, awaiting response... 200 OK Length: unspecified [text/plain] Saving to: ‚Äògcc13.patch‚Äô gcc13.patch [ \u0026lt;=\u0026gt; ] 1,39K --.-KB/s in 0s 2024-02-10 14:59:30 (46,7 MB/s) - ‚Äògcc13.patch‚Äô saved [1419] # apply the patch $ git apply gcc13.patch Compile the kernel, config is now ready! I added -j 16 (i have 16 thread on my machine!)\n# build kernel $ make ARCH=riscv CROSS_COMPILE=riscv64-linux-gnu- -j 16 SYNC include/config/auto.conf WRAP arch/riscv/include/generated/uapi/asm/errno.h WRAP arch/riscv/include/generated/uapi/asm/fcntl.h WRAP arch/riscv/include/generated/uapi/asm/ioctl.h WRAP arch/riscv/include/generated/uapi/asm/ioctls.h WRAP arch/riscv/include/generated/uapi/asm/ipcbuf.h WRAP arch/riscv/include/generated/uapi/asm/mman.h ... ... # takes a long time!!! ... ... NM .tmp_vmlinux.kallsyms2.syms KSYMS .tmp_vmlinux.kallsyms2.S AS .tmp_vmlinux.kallsyms2.S LD vmlinux NM System.map SORTTAB vmlinux OBJCOPY arch/riscv/boot/Image GZIP arch/riscv/boot/Image.gz Kernel: arch/riscv/boot/Image.gz is ready # build kernel modules $ make ARCH=riscv CROSS_COMPILE=riscv64-linux-gnu- modules -j 16 CALL scripts/checksyscalls.sh # install modules to dir $ mkdir ~/OpenSUSETumbleweed/modules $ make ARCH=riscv CROSS_COMPILE=riscv64-linux-gnu- INSTALL_MOD_PATH=~/OpenSUSETumbleweed/modules modules_install -j 16 INSTALL /home/opvolger/OpenSUSETumbleweed/modules/lib/modules/6.1.31+/kernel/arch/riscv/kvm/kvm.ko INSTALL /home/opvolger/OpenSUSETumbleweed/modules/lib/modules/6.1.31+/kernel/crypto/authenc.ko INSTALL /home/opvolger/OpenSUSETumbleweed/modules/lib/modules/6.1.31+/kernel/crypto/authencesn.ko INSTALL /home/opvolger/OpenSUSETumbleweed/modules/lib/modules/6.1.31+/kernel/crypto/blake2b_generic.ko INSTALL /home/opvolger/OpenSUSETumbleweed/modules/lib/modules/6.1.31+/kernel/crypto/cbc.ko INSTALL /home/opvolger/OpenSUSETumbleweed/modules/lib/modules/6.1.31+/kernel/crypto/echainiv.ko INSTALL /home/opvolger/OpenSUSETumbleweed/modules/lib/modules/6.1.31+/kernel/crypto/seqiv.ko INSTALL /home/opvolger/OpenSUSETumbleweed/modules/lib/modules/6.1.31+/kernel/crypto/xor.ko INSTALL /home/opvolger/OpenSUSETumbleweed/modules/lib/modules/6.1.31+/kernel/crypto/xxhash_generic.ko INSTALL /home/opvolger/OpenSUSETumbleweed/modules/lib/modules/6.1.31+/kernel/drivers/clk/starfive/clk-starfive-jh7100-audio.ko INSTALL /home/opvolger/OpenSUSETumbleweed/modules/lib/modules/6.1.31+/kernel/drivers/gpu/drm/drm_shmem_helper.ko INSTALL /home/opvolger/OpenSUSETumbleweed/modules/lib/modules/6.1.31+/kernel/drivers/gpu/drm/virtio/virtio-gpu.ko ... ... ... INSTALL /home/opvolger/OpenSUSETumbleweed/modules/lib/modules/6.1.31+/kernel/net/netfilter/xt_nat.ko INSTALL /home/opvolger/OpenSUSETumbleweed/modules/lib/modules/6.1.31+/kernel/net/sched/cls_cgroup.ko INSTALL /home/opvolger/OpenSUSETumbleweed/modules/lib/modules/6.1.31+/kernel/net/xfrm/xfrm_algo.ko INSTALL /home/opvolger/OpenSUSETumbleweed/modules/lib/modules/6.1.31+/kernel/net/xfrm/xfrm_user.ko INSTALL /home/opvolger/OpenSUSETumbleweed/modules/lib/modules/6.1.31+/kernel/net/netfilter/xt_tcpudp.ko DEPMOD /home/opvolger/OpenSUSETumbleweed/modules/lib/modules/6.1.31+ The kernel is Done!\nEFI-boot from Ubuntu (cd-boot-images-riscv64_10_all.deb) # The boot chain of OpenSUSE Tumbleweed (OpenSBI - U-Boot - EFI) would not work with my kernel (6.1.31+). That\u0026rsquo;s why I chose NOT to boot from SD card and use StarFive VisionFive 2\u0026rsquo;s OpenSBI and U-Boot. Unfortunately, OpenSUSE\u0026rsquo;s efi boot did not work with this. That\u0026rsquo;s why I use the efi-boot from Ubuntu (it worked with my 6.1.31+ kernel).\nDownload cd-boot-images-riscv64_10_all.deb\n$ wget http://mirrors.kernel.org/ubuntu/pool/main/c/cd-boot-images-riscv64/cd-boot-images-riscv64_10_all.deb # I am running Fedora and needed to install dpkg $ sudo yum install dpkg # unpack the file $ dpkg-deb -x cd-boot-images-riscv64_10_all.deb cd-boot-images-riscv64_10_all Copy/Change files to SD-card # On my computer i flashed the OpenSUSE Tumbleweed to /dev/sdb\nEFI-partition # We need to copy bootriscv64.efi to the EFI-partition\n$ cd ~/OpenSUSETumbleweed $ mkdir -p sd/efi # EFI partition is the first partition $ sudo mount /dev/sdb1 ~/OpenSUSETumbleweed/sd/efi # We will now replace the efi boot from OpenSUSE Tumbleweed with the Ubuntu version $ sudo cp cd-boot-images-riscv64_10_all/usr/share/cd-boot-images-riscv64/tree/EFI/boot/bootriscv64.efi sd/efi/EFI/BOOT/bootriscv64.efi # unmount again $ sudo umount ~/OpenSUSETumbleweed/sd/efi ROOT-partition # We need to copy the kernel files\n$ cd ~/OpenSUSETumbleweed $ mkdir -p sd/root # ROOT partition is the 3e partition $ sudo mount /dev/sdb3 ~/OpenSUSETumbleweed/sd/root # copy kernel files $ sudo cp linux/arch/riscv/boot/dts/starfive/jh7110-visionfive-v2.dtb ~/OpenSUSETumbleweed/sd/root/boot/dtb-6.1.31+ $ sudo cp linux/arch/riscv/boot/Image ~/OpenSUSETumbleweed/sd/root/boot/Image-6.1.31+ $ sudo cp linux/System.map ~/OpenSUSETumbleweed/sd/root/boot/System.map-6.1.31+ $ sudo cp modules/lib/modules/6.1.31+ ~/OpenSUSETumbleweed/sd/root/usr/lib/modules -R Edit grub2.cfg # We need to edit the current grub2.cfg so we can boot the created kernel.\nsudo nano ~/OpenSUSETumbleweed/sd/root/boot/grub2/grub.cfg Scroll until tou see:\n### BEGIN /etc/grub.d/10_linux ### menuentry \u0026#39;openSUSE Tumbleweed\u0026#39; --class opensuse --class gnu-linux --class gnu --class os $menuentry_id_option \u0026#39;gnulinux-simple-c0fea55f-b955-491e-82fb-eef04b20619d\u0026#39; { load_video set gfxpayload=keep insmod gzio insmod part_gpt insmod ext2 search --no-floppy --fs-uuid --set=root c0fea55f-b955-491e-82fb-eef04b20619d echo \u0026#39;Loading Linux 6.8.0-rc3-83-default ...\u0026#39; linux /boot/Image-6.8.0-rc3-83-default root=UUID=c0fea55f-b955-491e-82fb-eef04b20619d loglevel=3 splash=silent systemd.show_status=1 console=ttyS0,115200n8 echo \u0026#39;Loading initial ramdisk ...\u0026#39; initrd /boot/initrd-6.8.0-rc3-83-default } submenu \u0026#39;Advanced options for openSUSE Tumbleweed\u0026#39; --hotkey=1 $menuentry_id_option \u0026#39;gnulinux-advanced-c0fea55f-b955-491e-82fb-eef04b20619d\u0026#39; { menuentry \u0026#39;openSUSE Tumbleweed, with Linux 6.8.0-rc3-83-default\u0026#39; --hotkey=2 --class opensuse --class gnu-linux --class gnu --class os $menuentry_id_option \u0026#39;gnulinux-6.8.0-rc3-83-default-advanced-c0fea55f\u0026gt; Change it to: (I deleted the search line changes the linux line and replaced the initrd for devicetree)\n### BEGIN /etc/grub.d/10_linux ### menuentry \u0026#39;openSUSE Tumbleweed\u0026#39; --class opensuse --class gnu-linux --class gnu --class os $menuentry_id_option \u0026#39;gnulinux-simple-c0fea55f-b955-491e-82fb-eef04b20619d\u0026#39; { load_video set gfxpayload=keep insmod gzio insmod part_gpt insmod ext2 echo \u0026#39;Loading Linux 6.1.31+ ...\u0026#39; linux /boot/Image-6.1.31+ root=/dev/mmcblk1p3 ro efi=debug earlycon console=ttyS0,115200n8 echo \u0026#39;Loading devicetree 6.1.31+\u0026#39; devicetree /boot/dtb-6.1.31+ } submenu \u0026#39;Advanced options for openSUSE Tumbleweed\u0026#39; --hotkey=1 $menuentry_id_option \u0026#39;gnulinux-advanced-c0fea55f-b955-491e-82fb-eef04b20619d\u0026#39; { menuentry \u0026#39;openSUSE Tumbleweed, with Linux 6.8.0-rc3-83-default\u0026#39; --hotkey=2 --class opensuse --class gnu-linux --class gnu --class os $menuentry_id_option \u0026#39;gnulinux-6.8.0-rc3-83-default-advanced-c0fea55f\u0026gt; Save and Exit\nEdit fstab # Updates of the efi-boot must not be written on the efi-partition\nsudo nano ~/OpenSUSETumbleweed/sd/root/etc/fstab from:\nUUID=9a7b06a0-0385-44c1-8487-8881b55420ab swap swap defaults 0 0 UUID=c0fea55f-b955-491e-82fb-eef04b20619d / ext4 noatime,nobarrier 0 1 UUID=9035-7EB0 /boot/efi vfat defaults 0 0 to:\nUUID=9a7b06a0-0385-44c1-8487-8881b55420ab swap swap defaults 0 0 UUID=c0fea55f-b955-491e-82fb-eef04b20619d / ext4 noatime,nobarrier 0 1 #UUID=9035-7EB0 /boot/efi vfat defaults 0 0 Add item in grub2 40_custom # We need to add a grub option, so as we rebuild grub (get a new grub2.cfg) we still can boot the custom kernel.\nsudo nano ~/OpenSUSETumbleweed/sd/root/etc/grub.d/40_custom #!/bin/sh exec tail -n +3 $0 # This file provides an easy way to add custom menu entries. Simply type the # menu entries you want to add after this comment. Be careful not to change # the \u0026#39;exec tail\u0026#39; line above. menuentry \u0026#39;openSUSE Tumbleweed, with Linux 6.1.31+\u0026#39; { load_video set gfxpayload=keep insmod gzio insmod part_gpt insmod ext2 echo \u0026#39;Loading Linux 6.1.31+\u0026#39; linux /boot/Image-6.1.31+ root=/dev/mmcblk1p3 ro efi=debug earlycon console=ttyS0,115200n8 echo \u0026#39;Loading devicetree 6.1.31+\u0026#39; devicetree /boot/dtb-6.1.31+ } Set default grub item on boot # De default boot option is item 0. We have added a new custom item we want to boot in the future as default.\n$ sudo nano ~/OpenSUSETumbleweed/sd/root/etc/default/grub from:\nGRUB_DEFAULT=0 to\nGRUB_DEFAULT=3 Umount # # umount again $ sudo umount ~/OpenSUSETumbleweed/sd/root GParted # The root-partition will not be resized. So we have to do this. I use GParted, yes it can be done command-line but this is easyer. Hit Fix! and apply the changes!\nBoot the StarFive VisionFive 2 # Insert the SD-card in the StarFive VisionFive 2 and boot it up.\nWelcome to openSUSE Tumbleweed 20240208 - Kernel 6.1.31+ (ttyS0). end0: fe80::4b03:cfeb:7489:a749 end1: wlp1s0u1u1: StarFive login: [ 20.805126] starfive-eth-plat 16040000.ethernet end1: Link is Up - 1Gbps/Full - flow control rx/tx [ 20.814211] IPv6: ADDRCONF(NETDEV_CHANGE): end1: link becomes ready Welcome to openSUSE Tumbleweed 20240208 - Kernel 6.1.31+ (ttyS0). end0: fe80::4b03:cfeb:7489:a749 end1: 192.168.2.17 fe80::d24e:a2cc:d51b:b14b wlp1s0u1u1: StarFive login: Welcome to openSUSE Tumbleweed 20240208 - Kernel 6.1.31+ (ttyS0). end0: end1: 192.168.2.17 fe80::d24e:a2cc:d51b:b14b wlp1s0u1u1: riscv login: [ 38.081393] mipi_0p9: disabling You can now log in with username root and password linux\nriscv login: root Password: Have a lot of fun... Create user and fix boot\n# create a user $ useradd opvolger # set password for user $ passwd opvolger New password: Retype new password: passwd: password updated successfully # create a new grub.cfg $ grub2-mkconfig -o /boot/grub2/grub.cfg [ 219.384928] device-mapper: ioctl: 4.47.0-ioctl (2022-07-28) initialised: dm-devel@redhat.com Generating grub configuration file ... Found theme: /boot/grub2/themes/openSUSE/theme.txt Found linux image: /boot/Image-6.8.0-rc3-83-default Found initrd image: /boot/initrd-6.8.0-rc3-83-default Found linux image: /boot/Image-6.1.31+ Warning: os-prober will not be executed to detect other bootable partitions. Systems on them will not be added to the GRUB boot configuration. Check GRUB_DISABLE_OS_PROBER documentation entry. Adding boot menu entry for UEFI Firmware Settings ... done Fix Tumbleweed repo\u0026rsquo;s\n# disable updates repo (Tumbleweed has no updates) $ zypper lr Repository priorities are without effect. All enabled repositories share the same priority. # | Alias | Name | Enabled | GPG Check | Refresh --+--------------------------------------+-------+---------+-----------+-------- 1 | Factory-Contrib-StarFive:VisionFive2 | Fac-\u0026gt; | Yes | ( p) Yes | Yes 2 | repo-debug | ope-\u0026gt; | No | ---- | ---- 3 | repo-openh264 | Ope-\u0026gt; | Yes | ( p) Yes | Yes 4 | repo-oss | ope-\u0026gt; | Yes | ( p) Yes | Yes 5 | repo-source | ope-\u0026gt; | No | ---- | ---- 6 | repo-update | ope-\u0026gt; | Yes | ( p) Yes | Yes $ zypper mr -d 6 Repository \u0026#39;repo-update\u0026#39; has been successfully disabled. # update repo\u0026#39;s $ zypper update New repository or package signing key received: Repository: Factory-Contrib-StarFive:VisionFive2 Key Fingerprint: 1CE6 63CF D3C2 3AA6 4CB0 9374 F824 F2D3 FEC6 4695 Key Name: devel:RISCV OBS Project \u0026lt;devel:RISCV@build.opensuse.org\u0026gt; Key Algorithm: RSA 2048 Key Created: Thu Apr 7 08:44:18 2022 Key Expires: Sat Jun 15 08:44:18 2024 Rpm Name: gpg-pubkey-fec64695-624ea462 Note: Signing data enables the recipient to verify that no modifications occurred after the data were signed. Accepting data with no, wrong or unknown signature can lead to a corrupted system and in extreme cases even to a system compromise. Note: A GPG pubkey is clearly identified by its fingerprint. Do not rely on the key\u0026#39;s name. If you are not sure whether the presented key is authentic, ask the repository provider or check their web site. Many providers maintain a web page showing the fingerprints of the GPG keys they are using. Do you want to reject the key, trust temporarily, or trust always? [r/t/a/?] (r): a Retrieving repository \u0026#39;Factory-Contrib-StarFive:VisionFive2\u0026#39; metadata ....[done] Building repository \u0026#39;Factory-Contrib-StarFive:VisionFive2\u0026#39; cache .........[done] Retrieving repository \u0026#39;Open H.264 Codec (openSUSE Tumbleweed)\u0026#39; metadata ..[done] Building repository \u0026#39;Open H.264 Codec (openSUSE Tumbleweed)\u0026#39; cache .......[done] Retrieving repository \u0026#39;openSUSE-Tumbleweed-Oss\u0026#39; metadata .................[done] Building repository \u0026#39;openSUSE-Tumbleweed-Oss\u0026#39; cache ......................[done] Loading repository data... Reading installed packages... Nothing to do. Install stuff for KDE: browsers/codecs\n# install some stuff # obi can install codecs # neofetch to show specs # chromium a browser # nano for editing $ zypper install opi neofetch chromium nano $ neofetch ...... root@riscv.home .,cdxxxoc,. .:kKMMMNWMMMNk:. --------------- cKMMN0OOOKWMMXo. A ;0MWk:\u0026#39; \u0026#39;:OMMk. OS: openSUSE Tumbleweed riscv64 ;WMK;\u0026#39; \u0026#39;lKMMNM, :NMK\u0026#39; \u0026#39;OMW; Host: StarFive VisionFive V2 cMW; WMMMN ,XMK\u0026#39; oMM. Kernel: 6.1.31+ .MMc \u0026#39;\u0026#39;^*~l. xMN: KM0 Uptime: 8 mins \u0026#39;MM. .NMO oMM Packages: 774 (rpm) .MM, .kMMl xMN Shell: bash 5.2.26 KM0 .kMM0\u0026#39; .dl\u0026gt;~,. .WMd Resolution: 1920x1080 \u0026#39;XM0. ,OMMK\u0026#39; OMMM7\u0026#39; .XMK Terminal: /dev/ttyS0 *WMO:. .;xNMMk\u0026#39; NNNMKl. .xWMx CPU: (4) @ 1.500GHz ^ONMMNXMMMKx; V \u0026#39;xNMWKkxllox0NMWk\u0026#39; GPU: AMD ATI Radeon R9 290/390 \u0026#39;\u0026#39;\u0026#39;\u0026#39;\u0026#39; \u0026#39;:dOOXXKOxl\u0026#39; Memory: 110MiB / 7868MiB # install opi codecs (will give some errors, not everyting is there for riscv) $ opi codecs Do you want to install codecs from Packman repository? (Y/n) y Adding packman repo 1. ftp.fau.de - University of Erlangen, Germany - 1h sync 2. ftp.halifax.rwth-aachen.de - University of Aachen, Germany - 1h sync 3. ftp.gwdg.de - University of G√∂ttingen, Germany - 4h sync 4. mirror.karneval.cz - TES Media, Czech Republic - 1h sync 5. mirrors.aliyun.com - Alibaba Cloud, China - 24h sync Pick a mirror near your location (0 to quit): 1 Import package signing key \u0026#39;PackMan Project (signing key) \u0026lt;packman@links2linux.de\u0026gt;\u0026#39; (Y/n) Y Repository \u0026#39;Factory-Contrib-StarFive:VisionFive2\u0026#39; is up to date. Retrieving repository \u0026#39;Packman\u0026#39; metadata .................................[done] Building repository \u0026#39;Packman\u0026#39; cache ......................................[done] Repository \u0026#39;Open H.264 Codec (openSUSE Tumbleweed)\u0026#39; is up to date. Repository \u0026#39;openSUSE-Tumbleweed-Oss\u0026#39; is up to date. All repositories have been refreshed. Loading repository data... Reading installed packages... Computing distribution upgrade... Nothing to do. Loading repository data... Reading installed packages... \u0026#39;ffmpeg\u0026gt;=5\u0026#39; not found in package names. Trying capabilities. Package \u0026#39;gstreamer-plugins-bad-codecs\u0026#39; not found in specified repositories. Package \u0026#39;gstreamer-plugins-ugly-codecs\u0026#39; not found in specified repositories. Package \u0026#39;pipewire-aptx\u0026#39; not found in specified repositories. Package \u0026#39;vlc-codecs\u0026#39; not found in specified repositories. \u0026#39;ffmpeg\u0026#39; not found in package names. Trying capabilities. \u0026#39;libavcodec-full\u0026#39; not found in package names. Trying capabilities. No provider of \u0026#39;libavcodec-full\u0026#39; found. \u0026#39;libfdk-aac2\u0026#39; not found in package names. Trying capabilities. \u0026#39;libfdk-aac2\u0026#39; is already installed. \u0026#39;gstreamer-plugins-libav\u0026#39; not found in package names. Trying capabilities. Resolving package dependencies... The following 42 NEW packages are going to be installed: ffmpeg-6 gstreamer gstreamer-plugins-base gstreamer-plugins-libav libSDL2-2_0-0 libSPIRV-Tools-2023_6_rc1 libXv1 libass9 libavdevice60 libavfilter9 libbs2b0 libcdda_interface0 libcdda_paranoia0 libcdio19 libcdio_cdda2 libcdio_paranoia2 libdc1394-26 libdovi3 libfftw3-3 libglslang14 libgraphene-1_0-0 libgstallocators-1_0-0 libgstapp-1_0-0 libgstaudio-1_0-0 libgstgl-1_0-0 libgstpbutils-1_0-0 libgstreamer-1_0-0 libgstriff-1_0-0 libgsttag-1_0-0 libgstvideo-1_0-0 liborc-0_4-0 libplacebo338 libpostproc57 librubberband2 libshaderc_shared1 libswscale7 libvidstab1_1 libvisual-0_4-0 libvmaf3 libwayland-cursor0 libwayland-egl1 libzimg2 42 new packages to install. Overall download size: 13.7 MiB. Already cached: 0 B. After the operation, additional 33.3 MiB will be used. Continue? [y/n/v/...? shows all options] (y): y ... ... ... ... 161 new packages to install. Overall download size: 32.8 MiB. Already cached: 0 B. After the operation, additional 107.6 MiB will be used. Continue? [y/n/v/...? shows all options] (y): y ... ... ... ... (160/161) Installing: gstreamer-plugins-bad-1.22.9-1.1.riscv64 ...........[done] (161/161) Installing: gstreamer-plugins-good-extra-1.22.9-1.1.riscv64 ....[done] %posttrans(cantarell-fonts-0.303.1-1.2.noarch) script output: Failed to connect to bus: No medium found Failed to connect to bus: No medium found Running post-transaction scripts .........................................[done] Do you want to install openh264 codecs from openSUSE openh264 repository? (Y/n) y Installing from existing repo \u0026#39;Open H.264 Codec (openSUSE Tumbleweed)\u0026#39; Loading repository data... Reading installed packages... Computing distribution upgrade... Nothing to do. Loading repository data... Reading installed packages... \u0026#39;libgstopenh264.so()(64bit)\u0026#39; not found in package names. Trying capabilities. No provider of \u0026#39;libgstopenh264.so()(64bit)\u0026#39; found. \u0026#39;mozilla-openh264\u0026#39; not found in package names. Trying capabilities. No provider of \u0026#39;mozilla-openh264\u0026#39; found. Resolving package dependencies... Nothing to do. Install the KDE desktop\n# install KDE desktop $ zypper install -t pattern kde kde_plasma ... ... ... The following 19 NEW patterns are going to be installed: fonts fonts_opt games kde kde_games kde_internet kde_multimedia kde_office kde_pim kde_plasma kde_utilities kde_utilities_opt kde_yast multimedia office x11 x11_enhanced x11_yast yast2_desktop 1128 new packages to install. Overall download size: 926.3 MiB. Already cached: 0 B. After the operation, additional 2.4 GiB will be used. Continue? [y/n/v/...? shows all options] (y): y ... ... ... (1118/1128) Installing: sddm-0.20.0-4.1.riscv64 ..........................[done] (1119/1128) Installing: plasma5-workspace-branding-openSUSE-84.87~git20231[done] update-alternatives: using /usr/share/xsessions/plasma5.desktop to provide /usr/share/xsessions/default.desktop (default-xsession.desktop) in auto mode (1120/1128) Installing: plasma5-session-5.27.10-3.1.noarch ...............[done] (1121/1128) Installing: pim-sieve-editor-23.08.4-1.1.riscv64 .............[done] (1122/1128) Installing: patterns-base-x11-20200505-47.1.riscv64 ..........[done] (1123/1128) Installing: patterns-base-x11_enhanced-20200505-47.1.riscv64 .[done] (1124/1128) Installing: plasma5-session-wayland-5.27.10-3.1.riscv64 ......[done] (1125/1128) Installing: patterns-kde-kde_pim-20231206-2.1.noarch .........[done] (1126/1128) Installing: patterns-games-games-20220126-1.2.riscv64 ........[done] (1127/1128) Installing: patterns-kde-kde_plasma-20231206-2.1.noarch ......[done] (1128/1128) Installing: patterns-kde-kde-20231206-2.1.noarch .............[done] %posttrans(java-11-openjdk-headless-11.0.22.0-17.1.riscv64) script output: ++ /usr/bin/file --mime-type -b /var/lib/ca-certificates/java-cacerts ++ stat -c %s /usr/lib64/jvm/java-11-openjdk-11/lib/security/cacerts ++ /usr/bin/file --mime-type -b -L /usr/lib64/jvm/java-11-openjdk-11/lib/security/cacerts Running post-transaction scripts .........................................[done] Update notifications were received from the following packages: mariadb-11.2.2-28.1.riscv64 (/var/adm/update-messages/mariadb-11.2.2-28.1-something) View the notifications now? [y/n] (n): # reboot, sometimes it hangs! then hard reset the board! $ reboot Done! You will now have OpenSUSE with KDE on RISC-V\nAfter Updates # After running updates the system gives my only a grub prompt. I fixxed that by recreating the grup.cfg on the EFI partition\n$ sudo mount /dev/sdb1 ~/OpenSUSETumbleweed/sd/efi/ $ sudo blkid ... ... ... /dev/sda3: TYPE=\u0026#34;BitLocker\u0026#34; PARTLABEL=\u0026#34;Basic data partition\u0026#34; PARTUUID=\u0026#34;a4305c27-eb7f-4ab2-a711-e6f9420bf175\u0026#34; /dev/sda4: BLOCK_SIZE=\u0026#34;512\u0026#34; UUID=\u0026#34;8698031798030581\u0026#34; TYPE=\u0026#34;ntfs\u0026#34; PARTUUID=\u0026#34;5633b16b-b2ed-4f0c-b9f1-38471da05550\u0026#34; /dev/sdb1: SEC_TYPE=\u0026#34;msdos\u0026#34; LABEL_FATBOOT=\u0026#34;EFI\u0026#34; LABEL=\u0026#34;EFI\u0026#34; UUID=\u0026#34;9035-7EB0\u0026#34; BLOCK_SIZE=\u0026#34;512\u0026#34; TYPE=\u0026#34;vfat\u0026#34; PARTLABEL=\u0026#34;p.UEFI\u0026#34; PARTUUID=\u0026#34;1efd457e-107c-4159-8ca7-70f808bb0975\u0026#34; /dev/sdb3: LABEL=\u0026#34;ROOT\u0026#34; UUID=\u0026#34;c0fea55f-b955-491e-82fb-eef04b20619d\u0026#34; BLOCK_SIZE=\u0026#34;4096\u0026#34; TYPE=\u0026#34;ext4\u0026#34; PARTLABEL=\u0026#34;p.lxroot\u0026#34; PARTUUID=\u0026#34;ae391a45-c12f-48f8-b9af-3c1c5872db1f\u0026#34; /dev/sdb5: LABEL=\u0026#34;SWAP\u0026#34; UUID=\u0026#34;9a7b06a0-0385-44c1-8487-8881b55420ab\u0026#34; TYPE=\u0026#34;swap\u0026#34; PARTLABEL=\u0026#34;p.swap\u0026#34; PARTUUID=\u0026#34;59a6c3a5-1cae-47e1-9c14-4899c752c449\u0026#34; /dev/zram0: LABEL=\u0026#34;zram0\u0026#34; UUID=\u0026#34;8a74b26d-ba01-4e1e-aaa7-08f769c4d7f2\u0026#34; TYPE=\u0026#34;swap\u0026#34; /dev/sdb4: PARTLABEL=\u0026#34;spl\u0026#34; PARTUUID=\u0026#34;3e53f545-ccaa-4ba4-bde8-1bf3826557d9\u0026#34; /dev/sdb2: PARTLABEL=\u0026#34;uboot\u0026#34; PARTUUID=\u0026#34;a3a77f65-d8e8-4450-a3b2-b06faf72bff2\u0026#34; /dev/sda2: PARTLABEL=\u0026#34;Microsoft reserved partition\u0026#34; PARTUUID=\u0026#34;44d42eb1-d5aa-47ca-a146-dcb13723529c\u0026#34; $ sudo nano ~/OpenSUSETumbleweed/sd/efi/EFI/BOOT/grub.cfg and set this back: (have a good look if it is the correct UUID my /dev/sdb3 == c0fea55f-b955-491e-82fb-eef04b20619d)\nset btrfs_relative_path=\u0026#34;yes\u0026#34; search --fs-uuid --set=root c0fea55f-b955-491e-82fb-eef04b20619d set prefix=($root)/boot/grub2 source ($root)/boot/grub2/grub.cfg $ sudo umount ~/OpenSUSETumbleweed/sd/efi/ Boot your VisionFive again!\nCompile yquake2 / duke3d # zypper install libcurl-devel git SDL2-devel git openal-soft-devel libvpx-devel alsa-devel flac-devel ","date":"5 February 2023","externalUrl":null,"permalink":"/posts/starfive-visionfive-2/2023-02-05-opensuse-ati-radeon-r9_290/","section":"Posts","summary":"","title":"StarFive VisionFive 2 - OpenSUSE Tumbleweed with external GPU ATI Radeon R9 290","type":"posts"},{"content":" Intro # In de satelliet-wereld is het een algemeen begrip, de kanalenlijst gemaakt door Hans van de satellietclub De Transponder. Tijdens mijn bezoek in het clubgebouw werd duidelijk dat ik al meerdere addons gemaakt had voor Kodi. Een paar clubleden vroegen zich af of ik dit ook met de Kanalenlijst van Hans kon doen. Natuurlijk, dus zo gezegd, zo gedaan. plugin.video.hanssettings\nSatellietclub De Transponder # De satellietclub \u0026ldquo;De Transponder\u0026rdquo; is een groep mensen welke (elke) 4de zaterdag van de maand samen komen in het clubgebouw/buurtcentrum \u0026ldquo;Op Dreef\u0026rdquo; in Apeldoorn. Hier flashen ze de laatste firmware van hun satelliet ontvanger, repareren ze satelliet ontvanger en hebben ze het over de techniek. Voor meer info zie hun website. Ze hebben zelfs eens een Kodi demo gegeven youtube.\nGeen officele addon # Ik heb geprobeerd er een offici√´le addon van te maken en hem aan te bieden bij Kodi-addons, maar helaas kon de addon niet aan hun regels voldoen. De streams kunnen namelijk door een 3de partij veranderd worden (Hans). Mogelijk zouden er ook stream neergezet kunnen worden welke betaald zijn. Dus het is een priv√© project gebleven.\n","date":"1 January 2018","externalUrl":null,"permalink":"/kodi/kanalenlijst-hans/","section":"Kodis","summary":"","title":"KODI Addons - Kanalenlijst Hans","type":"kodi"},{"content":"","date":"1 January 2018","externalUrl":null,"permalink":"/kodi/","section":"Kodis","summary":"","title":"Kodis","type":"kodi"},{"content":"","date":"1 January 2013","externalUrl":null,"permalink":"/tags/hack/","section":"Tags","summary":"","title":"Hack","type":"tags"},{"content":"","date":"1 January 2013","externalUrl":null,"permalink":"/categories/kodi/","section":"Categories","summary":"","title":"KODI","type":"categories"},{"content":"","date":"1 January 2013","externalUrl":null,"permalink":"/tags/kodi/","section":"Tags","summary":"","title":"KODI","type":"tags"},{"content":" Intro # Een stukje uitleg over de addon plugin.video.uzg voor Kodi. Deze blijf ik aanvullen als er (grote) dingen veranderen.\nAddon in kodi-repo # In 2013 had ik de addon geschreven aangezien in mijn televisie abonnement had stop gezet. Met een paar aanpassingen aan mijn pull-request was deze een lange tijd zelfs opgenomen in de offici√´le addons repo van Kodi.\nTegenslag / Stoppen publieke addon # Maar helaas kwam daar na 5 jaar in eind november 2018 een einde aan. De NPO had namelijk de voorwaarden aangepast. Zover ik het nu kan lezen mag er geen publieke plugins/addons meer gemaakt worden. Gelukkig mag dit nog wel steeds voor eigen gebruik, er staat nergens dat dit niet mag! De app was ook ‚Äúverbeterd‚Äù, je kan niet meer al het verkeer aftappen. Nu liep al het verkeer netjes via https, maar op Android Telefoons van versie 5 en lager, kan zelf ‚Äúroot‚Äù certificaten toevoegen. Dus we gingen naar ‚ÄúZAP \u0026gt; Tools \u0026gt; Options \u0026gt; Dynamic SSL Certificates‚Äù en exporteerde het certificaat. We zette deze op de Android telefoon en al het verkeer was weer leesbaar.\nWat je hier doet, is al je verkeer via je proxy laten lopen, op je pc ook ‚Äúdecoderen‚Äù en opnieuw ‚Äúcoderen‚Äù mijn jouw certificaat. Je kan namelijk niet het certificaat van NPO gebruiken, je hebt immers de ‚Äúprivate-key/geheime sleutel‚Äù niet. Je doet letterlijk een man-in-the-middle attack.\nDe Api was totaal veranderd, tevens de voorwaarden. Volgens de nieuwe voorwaarden mocht wat ik deed helaas niet meer. Netjes een verzoek gedaan bij Kodi om mijn addon ‚Äúbroken‚Äù te melden.\nNatuurlijk kon ik priv√© gewoon doorgaan met mijn addon.\nDRM # Alsof de tegenslag van november 2018 nog niet genoeg was, maart 2019 ging NPO over op DRM. Alles werkte nog, behalve de video-stream uitvragen. Dit moest ik dus weer uitzoeken. De app was nog beter beveiligt, ze doen nu aan ‚ÄúCertificate Pinning‚Äù, kortom je kan er niet tussen in gaan zitten met je eigen zap-ssl-certificaat. Dit was niet zo fijn. Uiteindelijk de Andoid App van de NPO moeten decompileren. Gelukkig kan dit online (hoef je de tools niet te installeren). Helaas hadden ze gebruik gemaakt van ‚Äúcode obfuscation (niet leesbaar maken van code)‚Äù, maar dat weerhield mij niet. Het koste mij alleen wat meer tijd. Ik kwam er achter hoe de video‚Äôs nu werden opgevraagd, met deze informatie kon ik mijn addon weer aanpassen.\nCode uit de Android App\npublic NedforceCatalog(OkHttpClient okHttpClient, NpoPlayerConfig npoPlayerConfig) { this._httpClient = okHttpClient; this._config = npoPlayerConfig; switch (this._config.getEnvironment()) { case 1: okHttpClient = \u0026#34;https://api.npobeta.nl\u0026#34;; break; case 2: okHttpClient = \u0026#34;https://start-api.npo.nl\u0026#34;; break; default: okHttpClient = \u0026#34;https://npo-api.staging.egeniq.com\u0026#34;; break; } this._baseUrl = HttpUrl.parse(okHttpClient); } en public void getStreamForAsset(final String str, String str2, String str3, boolean z, boolean z2, int i, final CatalogCallback\u0026lt;NpoStream\u0026gt; catalogCallback) { HttpUrl build = this._baseUrl.newBuilder().addPathSegment(\u0026#34;media\u0026#34;).addPathSegment(str).addPathSegment(\u0026#34;stream\u0026#34;).build(); JSONObject jSONObject = new JSONObject(); JSONObject jSONObject2 = new JSONObject(); try { jSONObject.put(Scopes.PROFILE, str2); str2 = true; if (z) { jSONObject2.put(\u0026#34;startOver\u0026#34;, true); } jSONObject.put(\u0026#34;options\u0026#34;, jSONObject2); if (!TextUtils.isEmpty(str3)) { jSONObject.put(\u0026#34;ageRestriction\u0026#34;, str3); } if (z2) { if (this._config == null || this._config.getPlayerOptions() == null || TextUtils.isEmpty(this._config.getPlayerOptions().getEncryptionType()) != null) { GlobalLogger.m6738a().m6749b(TAG, \u0026#34;skipCatalog = true requires to provide a DRM type!\u0026#34;); } else { jSONObject.put(\u0026#34;skipCatalog\u0026#34;, true); jSONObject.put(\u0026#34;useEncryption\u0026#34;, this._config.getPlayerOptions().getEncryptionType()); } } jSONObject.put(\u0026#34;hasSubscription\u0026#34;, i != 0); str3 = \u0026#34;hasPremiumSubscription\u0026#34;; if (2 != i) { str2 = null; } jSONObject.put(str3, str2); jSONObject.put(\u0026#34;platform\u0026#34;, 2 == i ? Plan.PREMIUM : \u0026#34;npo\u0026#34;); this._httpClient.newCall(new Builder().url(build).post(RequestBody.create(HttpClient.f5884b, jSONObject.toString())).build()).enqueue(new Callback() { public void onFailure(Call call, IOException iOException) { Gelukkig was Kodi 18 net uit en daar kon je streams met DRM bekijken! Dus een paar avonden uitzoeken hoe je dat moest aanroepen en we konden weer video‚Äôs opstarten.\nSecurity BUG (2019-2023) # Toen ik bezig was met uitzoeken hoe de ‚ÄúAPI‚Äôs‚Äù nu werkte. Ja API‚Äôs want de lijst met programma‚Äôs en afleveringen staat helemaal los van de uitvraag van de video-streams. Hierin zit dus ook een beveiligingsprobleem. de uitvraag voor de video-stream heeft geen kennis van de ‚ÄúAPI‚Äù van de NPO. Ook niet of je nu wel of geen ‚ÄúPremium‚Äù account hebt. (Lees NPO-plus). Kortom, je kan dus ZONDER dat je NPO-Plus account hebt WEL een NPO-Plus video opvragen. Vrij makkelijk zelfs, je past even een switch aan van ‚Äúfalse‚Äù naar ‚Äútrue‚Äù in je bericht en klaar. Natuurlijk heb ik dit eerst netjes gemeld bij de NPO helemaal niks meer gehoord. Een direct gericht via Twitter, geen response en publiek bericht via twitter, geen reactie. Een bericht via Facebook, een hele korte reactie van ‚ÄúWe zullen het doorgeven‚Ä¶‚Äù Toen kwam ik deze pagina tegen bij de NPO link. Hier wilde ik wel in komen te staan!, een mail naar de NPO dan maar in maart, april en in mei‚Ä¶, allemaal niks meer van gehoord.\nDus hier het beveiliging lek, ik vraag hier een video-stream op van ‚ÄúDe Luizenmoeder‚Äù. Welke ik netjes terug krijg. Ook al mijn andere uitvragen komen nu met een 720p-stream terug i.p.v. een SD-stream. Voor de netheid de ‚Äúbug‚Äù niet doorgevoerd in mijn addon, maar dat is met 2 regels aanpassen wel te doen :)\nUpdate: uiteindelijk november 2019 is de bug herkend en zijn er excuses gemaakt dat er zo traag gereageert was! alleen is de bug nooit opgelost. 1 december 2023 heeft de NPO een totaal andere API genomen, hierdoor werkt de \u0026ldquo;hack\u0026rdquo; niet meer.\nUpdate december 2023 # Ze hebben in december 2023 de hele api vervangen, ik heb de hele addon opnieuw mogen schrijven. Helaas geen \u0026ldquo;gratis\u0026rdquo; NPO-plus meer, maar nog steeds uitzending gemist op Kodi.\n","date":"1 January 2013","externalUrl":null,"permalink":"/kodi/npo/","section":"Kodis","summary":"","title":"KODI Addons - NPO Uitzending gemist","type":"kodi"},{"content":" Intro # Een stukje uitleg over het hoe en waarom van de addon plugin.video.rtlxl voor Kodi.\nHelaas werkt deze niet meer omdat begin 2024 er geen nieuwe video\u0026rsquo;s meer geplaatst worden, ze zijn nu overgestapt naar videoland.\nWaarom # Zie Uitzendinggemist (NPO)\nOplossing # Zie Uitzendinggemist (NPO)\nUitwerking # Zie Uitzendinggemist (NPO)\nTegenslag / Stoppen publieke addon # Ergens +/- december 2016 kreeg ik tegengas van RTL(xl) en heb ik helaas mijn code offline moeten halen. Deze werkte met een kleine aanpassing wel weer (ze hielden letterlijk aanvragen vanuit de addon tegen), maar de boodschap was duidelijk. Stop met de addon of we gaan stappen ondernemen. De repo stond toen nog op bitbucket (hg), ik heb deze nog overgezet naar github, maar is altijd een private-repo geweest. Sinds 2024-02-08 is de repo op publieke toegang gezet. Het maakt allemaal niet meer uit. RTLxl bestaan niet meer.\n","date":"1 January 2013","externalUrl":null,"permalink":"/kodi/rtlxl/","section":"Kodis","summary":"","title":"KODI Addons - RTLxl","type":"kodi"},{"content":"","date":"1 January 2013","externalUrl":null,"permalink":"/tags/npo/","section":"Tags","summary":"","title":"NPO","type":"tags"},{"content":"","date":"1 January 2013","externalUrl":null,"permalink":"/tags/rtlxl/","section":"Tags","summary":"","title":"RTLxl","type":"tags"},{"content":"","date":"1 January 2013","externalUrl":null,"permalink":"/tags/uitzending-gemist/","section":"Tags","summary":"","title":"Uitzending Gemist","type":"tags"},{"content":" Bas Magr√© # I like technical challenges. Whether it is with code or my classic car. You can also see this in my hobby projects. Keeping old cars running or code projects to make my or someone else\u0026rsquo;s life easier.\nWork # I started by a secondment agency as Oracle Database developer, then switched to c# developer and from 2018 I am a DevOps engineer.\nWe launched Babelvis in 2025. If your IT department needs support in CI/CD, security, or other Dev(Sec)Ops matters, take a look at babelvis.nl.\nyear company work 2025 - now Babelvis Co-founder 2011 - 2025 Topicus C#/App/Frontend developer (7 y), now: Puppet VMs Ansible Azure k8s helm == DevOps engineer 2007 - 2011 Centraal Boekhuis Oracle Database developer 2007 - 2011 Ceasar Groep (secondment agency) Oracle Database developer ","externalUrl":null,"permalink":"/about/","section":"Opvolger","summary":"","title":"About","type":"page"},{"content":"","externalUrl":null,"permalink":"/authors/","section":"Authors","summary":"","title":"Authors","type":"authors"},{"content":"","externalUrl":null,"permalink":"/dump/","section":"Dumps","summary":"","title":"Dumps","type":"dump"},{"content":" Waarom # Omdat ik had besloten de ‚Äúkabel‚Äù eruit ‚Äúte gooien‚Äù, omdat ik geen zin meer had in betaald reclame te kijken en alles was van het zelfde op t.v. Netflix kwam toen net in Nederland en ik dacht: ‚ÄúIk doe het gewoon, ik gooi de kabel er uit‚Äù. Ik had een ‚ÄúSmart‚Äù TV welke RTL-XL en NPO uitzendingen terug kon kijken (zonder reclame) en film van Netflix. Prima. Google Chromecast + Kodi op een Raspberry Pi. Alles opgelost dacht ik.\nHelaas 2 maanden nadat ik mijn kabel opzeg, veranderd de ‚ÄúAPI‚Äù van RTL-XL en weer 4 maanden later die van NPO. Kortom, ik kon dit niet meer kijken op mijn ‚ÄúSmart‚Äù TV.\nOplossing # Kodi gebruikte ik al jaren voor mijn series en films te kijken (legaal! ik heb de DVD‚Äôs/Blu-Ray‚Äôs in de kast staan). Na het opzeggen van de kabel had ik ook tvheadend met een dvb-t USB ontvanger geconfigureerd met Kodi. Zodat ik in het hele huis Nederland 1/2/3 en TV Gelderland kon kijken. Ik kan vanuit mijn werk uit aardig programmeren, dus het lag nu voor de hand om een add-on te maken in Kodi voor NPO en RTL-XL. Beide add-ons aangemeld bij Kodi en ze zijn jaren lang een ‚ÄúOffici√´le‚Äù addon geweest, deze was dus te downloaden uit de repository van Kodi zelf.\nUitwerking # Hoe start je nu zo iets? Het was vroeger wat meer zoek werk, maar je kan het allemaal vinden op de wiki pagina van Kodi, nu hebben ze erg goede uitlegt hoe je moet beginnen. Nu dus de taal python nog even leren (lees google elke actie welke je wil doen) en achterhalen hoe je video‚Äôs ophaalt bij NPO. Dat laatste ging vroeger erg makkelijk, dat deed je als volgend:\nZet een ‚ÄúZed Attack Proxy‚Äù op je pc Stel het juiste IP-Adres in (van je locale netwerk) ‚ÄúZAP \u0026gt; Tools \u0026gt; Options \u0026gt; Local Proxies‚Äù Op een Android telefoon (emulator of echte), zet je de NPO App er op. Zorg ervoor dat je telefoon via de proxy loop (Ga naar ‚Äúadvanced options‚Äù van je Wifi connection) of je emulator opstart met ‚Äú-http-proxy http://xx.xxx.xx.xx:8080‚Äù Klaar! Als je verkeer loopt nu via je pc, je ziet alle aanvragen van de app. Alles ging over http, hier kon je zien hoe de ‚ÄúAPI‚Äù werkte en deze ‚Äúop de zelfde manier‚Äù toepassen in python. Je moest alleen even aansluiten om de ‚ÄúAPI‚Äù van Kodi en klaar. Dit klinkt natuurlijk makkelijker dan het is, maar daar komt het in het kort wel op neer. Dit alles is gemaakt november 2013 t/m januari 2014. De code aangeboden aan Kodi met een pull request en na wat kleine aanpassingen geaccepteerd!\nMijn addons # NPO\nRTLxl\nKanalenlijst Hans\n","externalUrl":null,"permalink":"/kodi/kodi/","section":"Kodis","summary":"","title":"KODI Addons","type":"kodi"},{"content":"","externalUrl":null,"permalink":"/series/","section":"Series","summary":"","title":"Series","type":"series"}]