<!doctype html>
<html>
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <meta name="generator" content="pandoc">
      <meta name="author" content="Bas Magré">
      <meta name="date" content="2025-02-25">
      
      <title>StarFive VisionFive 2 Ubuntu 24.10 AMDGPU</title>
      <link rel="icon" href="/website-template/favicon.ico">
      <!-- Bootstrap -->
      <link rel="stylesheet" target="_blank" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
      <!-- Font-awesome -->
      <link rel="stylesheet" target="_blank" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
      <!-- Styles -->
      <link rel="stylesheet" href="/website-template/styles.css">
            <!-- Add favicon here -->
            <!-- Add site-verifications here -->
         </head>
   <body>
            <nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark">
                <!--<a class="navbar-brand" href="#">Navbar</a>-->
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                   <ul class="navbar-nav mr-auto">
                      <li class="nav-item active">
                         <a class="nav-link" href="/index.html">Me <span class="sr-only">(current)</span></a>
                      </li>
                      <!-- <li class="nav-item">
                         <a class="nav-link" href="#">Link</a>
                      </li> -->
                      <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarKODI" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Kodi Addons
                        </a>
                        <div class="dropdown-menu" aria-labelledby="navbarKODI">
                           <a class="dropdown-item" href="/kodi/npo.html">NPO Uitzending gemist</a>               
                           <a class="dropdown-item" href="/kodi/kanalenlijst-hans.html">De Transponder - Kanalenlijk (Hans)</a>
                           <div class="dropdown-divider"></div>
                           <a class="dropdown-item" href="/kodi/rtlxl.html">(Inactive) RTLxl</a>
                        </div>
                     </li>
                     <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarMilkVJ" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Milk-V Jupiter
                        </a>
                        <div class="dropdown-menu" aria-labelledby="navbarMilkVJ">
                           <a class="dropdown-item" href="/milkVjupiter/OpenSUSEATIRadeonR9_290.html">ATI Radeon R9 290 Kernel 6.1</a>
                           <a class="dropdown-item" href="/milkVjupiter/OpenSUSEATIRadeonHD5850.html">OpenSUSE Tumbleweed ATI Radeon HD 5850 Kernel 6.6</a>
                        </div>
                     </li>
                      <li class="nav-item dropdown">
                         <a class="nav-link dropdown-toggle" href="#" id="navbarSFVF2" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                         Starfive VisionFive 2
                         </a>
                         <div class="dropdown-menu" aria-labelledby="navbarSFVF2">
                            <a class="dropdown-item" href="/starfiveVisionFive2/UbuntuATIRadeonR9_290.html">Ubuntu 22.04 with ATI Radeon R9 290</a>
                            <a class="dropdown-item" href="/starfiveVisionFive2/FedoraATIRadeon5450.html">Fedora with ATI Radeon5450</a>
                            <a class="dropdown-item" href="/starfiveVisionFive2/UbuntuATIRadeonR9_290_2023_11_20.html">Ubuntu 23.10 with ATI Radeon R9 290</a>
                            <a class="dropdown-item" href="/starfiveVisionFive2/OpenSUSEATIRadeonR9_290.html">OpenSUSE Tumbleweed ATI Radeon R9 290</a>
                            <a class="dropdown-item" href="/starfiveVisionFive2/OpenSUSEATIRadeonR9_290_mainline.html">OpenSUSE Tumbleweed ATI Radeon R9 290 mainline kernel</a>
                            <a class="dropdown-item" href="/starfiveVisionFive2/Ubuntu2410_outofthebox.html">StarFive VisionFive 2 Ubuntu 24.10 AMDGPU</a>
                            <!-- <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="#">Something else here</a> -->
                         </div>
                      </li>
                      <!-- <li class="nav-item">
                         <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Disabled</a>
                      </li> -->
                   </ul>
                   <div class="menu-icons">
                     <a class="menu-icon" target="_blank" href="https://github.com/Opvolger" target="_blank"><i class="fa fa-github fa-2x"></i></a>
                     <a class="menu-icon" target="_blank" href="https://www.twitter.com/Opvolger" target="_blank"><i class="fa fa-twitter fa-2x"></i></a>
                     <a class="menu-icon" href="mailto:Opvolger@gmail.com"><i class="fa fa-at fa-2x"></i></a>
                     <a class="menu-icon" target="_blank" href="https://www.linkedin.com/in/bas-magr%C3%A9-67234222/" target="_blank"><i class="fa fa-linkedin fa-2x"></i></a>
                     <a class="menu-icon" target="_blank" href="https://www.youtube.com/@justanotherdevopsguy" target="_blank"><i class="fa fa-youtube fa-2x"></i></a>
                     <a class="menu-icon" target="_blank" href="https://www.youtube.com/@opvolger" target="_blank"><i class="fa fa-youtube fa-2x"></i></a>
                  </div>

                   <!-- <form class="form-inline my-2 my-lg-0">
                      <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
                      <button class="btn btn-outline-info my-2 my-sm-0" type="submit">Search</button>
                   </form> -->
                </div>
             </nav>
            <div class="container">
         <p class="date">2025-02-25 - Bas Magré</p>
         <!-- <h1 class="title">StarFive VisionFive 2 Ubuntu 24.10
AMDGPU</h1> -->
                  <div class="row">
            <div class="col-xl-10"><h1
id="ubuntu-24.10-starfive-visionfive-2-amdgpu">Ubuntu 24.10 StarFive
VisionFive 2 AMDGPU</h1>
<p>Ubuntu 24.10 is using the 6.11 kernel. This has the PCI-e controller
of StarFive VisionFive 2 + AMDGPU drivers that are working with RISC-V.
So if you have a m2 to pci-e adapter you can now run Ubuntu with AMDGPU
on RISC-V (without building your own kernel with patches etc.)</p>
<p>The only problem is now the u-boot that initialize the PCI-e
controller to scan for m.2 drivers. Some of my AMDPGU do not like that
(fan 100% and not detected anymore in the kernel).</p>
<p>So we need a u-boot (from Ubuntu) without the initialization of the
PCI-e controller. I have build that and release the flash-files (u-boot
+ opensbi) on github.</p>
<p>So we can now just flash Ubuntu 24.10 to an eMMC, use the custom
flash-files (u-boot + opensbi).</p>
<p>a lot of AMDGPU’s worked on this setup:</p>
<ul>
<li>ATI Radeon HD 5450 (Cedar PRO)</li>
<li>ATI Radeon HD 5850 (Cypress PRO)</li>
<li>AMD Radeon R9 290 (Hawaii PRO)</li>
<li>AMD Radeon R9 290X (Hawaii XT)</li>
</ul>
<p>not working:</p>
<ul>
<li>AMD Radeon RX 6600 (Navi 23 XL)</li>
</ul>
<p>It is booting, it gives screenoutput (black) and then the system
hangs completely</p>
<h2 id="flash-ubuntu-24.10-to-emmc">Flash Ubuntu 24.10 to eMMC</h2>
<p>download from the <a
target="_blank" href="https://ubuntu.com/download/risc-v">site</a> the <a
target="_blank" href="https://cdimage.ubuntu.com/releases/24.10/release/ubuntu-24.10-preinstalled-server-riscv64+nezha.img.xz">image
24.10</a>.</p>
<p>I used “balenaEtcher” to flash this to my eMMC (with an USB to eMMC
adapter).</p>
<h2
id="createdownload-u-boot-without-pci-e-initialization-and-flash-to-sd">Create/download
u-boot without PCI-e initialization and flash to SD</h2>
<p>We need a custom u-boot that will not try to initialize the PCI-e
controller (scan for m.2 device). Some of the AMDGPU’s don’t like that
(fan 100% and not detected anymore in the kernel)</p>
<p>So on build we need to set <code>CONFIG_PCI_INIT_R</code> and
<code>CONFIG_CMD_PCI</code> to n (no).</p>
<p>I all ready create this builds and they can be found <a
target="_blank" href="https://github.com/Opvolger/ansible-riscv-sd-card-creater/releases">here</a>:</p>
<p>Insert you SD-card in you computer</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://github.com/Opvolger/ansible-riscv-sd-card-creater/releases/download/0.1.0/release.tgz</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tar</span> <span class="at">-xvzf</span> release.tgz</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># check where your SD-card is with lsblk, in this example it is /dev/sdb</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># delete MBR of SD-Card</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> dd if=/dev/zero of=/dev/sdb bs=512 count=1 conv=notrunc</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># we will create the needed partitions to boot from SD-card</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> sgdisk <span class="at">--clear</span> <span class="dt">\</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">--set-alignment</span><span class="op">=</span>2 <span class="dt">\</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">--new</span><span class="op">=</span>1:4096:8191 <span class="at">--change-name</span><span class="op">=</span>1:spl <span class="at">--typecode</span><span class="op">=</span>1:2E54B353-1271-4842-806F-E436D6AF6985 <span class="dt">\</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">--new</span><span class="op">=</span>2:8192:16383 <span class="at">--change-name</span><span class="op">=</span>2:uboot <span class="at">--typecode</span><span class="op">=</span>2:BC13C2FF-59E6-4262-A352-B275FD6F7172 <span class="dt">\</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    /dev/sdb</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># now &quot;flash&quot; the firmware on the sd-card</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> dd if=release/ubuntu-24-10/u-boot-spl.bin.normal.out of=/dev/sdb1</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> dd if=release/ubuntu-24-10/u-boot.itb of=/dev/sdb2</span></code></pre></div>
<p>If booting ubuntu is not working (you can see it with
serial-connection for example
<code>screen -L /dev/ttyUSB0 115200</code>), go back to default settings
in u-boot with:</p>
<p>how to set the default is explained also in the ubuntu <a
target="_blank" href="https://canonical-ubuntu-boards.readthedocs-hosted.com/en/latest/how-to/starfive-visionfive-2/">site</a>.
The only different is that I am using the sd-card and not the onboard
flash.</p>
<p>StarFive #</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">env</span> default <span class="at">-f</span> <span class="at">-a</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">env</span> save</span></code></pre></div>
<p>Reboot you board (power off/on)</p>
<h2 id="first-boot-ubuntu">First boot Ubuntu</h2>
<p>login with ubuntu/ubuntu (you have to change the password!)</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> timedatectl set-timezone Europe/Amsterdam</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># check if the date is correct (now)!</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">date</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt update</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt upgrade</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># add repo for firefox</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> add-apt-repository ppa:mozillateam/ppa</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># install what default stuff + install kde + firefox + some c dev tools (so you can compile some stuff)</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install software-properties-common cmake cabextract sddm sddm-theme-breeze kde-standard build-essential libxml2 libcurl4-gnutls-dev neofetch ubuntu-dev-tools libopenal-dev libpng-dev libjpeg-dev libfreetype6-dev libfontconfig1-dev libcurl4-gnutls-dev libsdl2-dev zlib1g-dev libbz2-dev libedit-dev python-is-python3 m4 clang sddm-theme-breeze firefox</span></code></pre></div>
<p>I did get a configuration i had to fill in:
<code>Please enter the default mirror you want to be used by pbuilder.</code>
I hit enter and get the question again, so i filled in:
<code>http://archive.ubuntu.com/ubuntu</code> and it was installing
again.</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># now reboot</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> reboot</span></code></pre></div>
<h2 id="done">Done</h2>
<p>You will now see a KDE desktop login! Good luck and have
fun!</p></div>
            <div class="d-none d-xl-block col-xl-2 bd-toc">
               <ul class="section-nav">
                  <li class="toc-entry"><ul>
<li><a href="#ubuntu-24.10-starfive-visionfive-2-amdgpu"
id="toc-ubuntu-24.10-starfive-visionfive-2-amdgpu">Ubuntu 24.10 StarFive
VisionFive 2 AMDGPU</a>
<ul>
<li><a href="#flash-ubuntu-24.10-to-emmc"
id="toc-flash-ubuntu-24.10-to-emmc">Flash Ubuntu 24.10 to eMMC</a></li>
<li><a
href="#createdownload-u-boot-without-pci-e-initialization-and-flash-to-sd"
id="toc-createdownload-u-boot-without-pci-e-initialization-and-flash-to-sd">Create/download
u-boot without PCI-e initialization and flash to SD</a></li>
<li><a href="#first-boot-ubuntu" id="toc-first-boot-ubuntu">First boot
Ubuntu</a></li>
<li><a href="#done" id="toc-done">Done</a></li>
</ul></li>
</ul></li>
               </ul>
            </div>
         </div>
               </div>
            <!-- Add comment hosting service here -->
            <!-- Footer -->
            <footer class="footer text-muted">
                <div align="center">
                   <!-- Update licences -->
                   Content is available under <a target="_blank" href="https://creativecommons.org/licenses/by-sa/3.0/" target="_blank" rel="noopener">CC BY-SA 3.0</a>
                   &nbsp;|&nbsp;
                   Sourcecode licensed under <a target="_blank" href="https://www.gnu.org/licenses/gpl-3.0.en.html" target="_blank" rel="noopener">GPL-3.0</a>
                   <br />
                   <!-- Please keep the following line -->
                   Built with <a target="_blank" href="https://www.pandoc.org" target="_blank" rel="noopener">Pandoc</a> 
                   using <a target="_blank" href="https://github.com/ashki23/pandoc-bootstrap" target="_blank" rel="noopener">pandoc-bootstrap</a> theme
                   <br />
                   <!-- Update copyright -->
                   Copyright, Bas Magr&eacute;
                </div>
             </footer>
             <!-- Add global site tag (gtag.js) and site analytics here -->
            <!-- JS, Popper.js, and jQuery -->
      <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
      <!-- Mathjax -->
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script>
         /* Bootstrap styles to tables */
         function bootstrapStylePandocTables() {
         $('tr.header').parent('thead').parent('table').addClass('table table-condensed'); }
         $(document).ready(function () { bootstrapStylePandocTables(); });
         /* Adjust the height when click the toc */
         var shiftWindow = function() { scrollBy(0, -60) };
         window.addEventListener("hashchange", shiftWindow);
         function load() { if (window.location.hash) shiftWindow(); }
      </script>
   </body>
</html>