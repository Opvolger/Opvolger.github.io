<!doctype html>
<html>
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <meta name="generator" content="pandoc">
      <meta name="author" content="Bas Magré">
      <meta name="date" content="2023-04-05">
      
      <title>StarFive VisionFive 2 Ubuntu 22.04 ATI Radeon R9
290</title>
      <link rel="icon" href="/website-template/favicon.ico">
      <!-- Bootstrap -->
      <link rel="stylesheet" target="_blank" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
      <!-- Font-awesome -->
      <link rel="stylesheet" target="_blank" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
      <!-- Styles -->
      <link rel="stylesheet" href="/website-template/styles.css">
            <!-- Add favicon here -->
            <!-- Add site-verifications here -->
         </head>
   <body>
            <nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark">
                <!--<a class="navbar-brand" href="#">Navbar</a>-->
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                   <ul class="navbar-nav mr-auto">
                      <li class="nav-item active">
                         <a class="nav-link" href="/index.html">Me <span class="sr-only">(current)</span></a>
                      </li>
                      <!-- <li class="nav-item">
                         <a class="nav-link" href="#">Link</a>
                      </li> -->
                      <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarKODI" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Kodi Addons
                        </a>
                        <div class="dropdown-menu" aria-labelledby="navbarKODI">
                           <a class="dropdown-item" href="/kodi/npo.html">NPO Uitzending gemist</a>               
                           <a class="dropdown-item" href="/kodi/kanalenlijst-hans.html">De Transponder - Kanalenlijk (Hans)</a>
                           <div class="dropdown-divider"></div>
                           <a class="dropdown-item" href="/kodi/rtlxl.html">(Inactive) RTLxl</a>
                        </div>
                     </li>
                      <li class="nav-item dropdown">
                         <a class="nav-link dropdown-toggle" href="#" id="navbarSFVF2" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                         Starfive VisionFive 2
                         </a>
                         <div class="dropdown-menu" aria-labelledby="navbarSFVF2">
                            <a class="dropdown-item" href="/starfiveVisionFive2/UbuntuATIRadeonR9_290.html">Ubuntu 22.04 with ATI Radeon R9 290</a>
                            <a class="dropdown-item" href="/starfiveVisionFive2/FedoraATIRadeon5450.html">Fedora with ATI Radeon5450</a>
                            <a class="dropdown-item" href="/starfiveVisionFive2/UbuntuATIRadeonR9_290_2023_11_20.html">Ubuntu 23.10 with ATI Radeon R9 290</a>
                            <!-- <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="#">Something else here</a> -->
                         </div>
                      </li>
                      <!-- <li class="nav-item">
                         <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Disabled</a>
                      </li> -->
                   </ul>
                   <div class="menu-icons">
                     <a class="menu-icon" target="_blank" href="https://github.com/Opvolger" target="_blank"><i class="fa fa-github fa-2x"></i></a>
                     <a class="menu-icon" target="_blank" href="https://www.twitter.com/Opvolger" target="_blank"><i class="fa fa-twitter fa-2x"></i></a>
                     <a class="menu-icon" href="mailto:Opvolger@gmail.com"><i class="fa fa-at fa-2x"></i></a>
                     <a class="menu-icon" target="_blank" href="https://www.linkedin.com/in/bas-magr%C3%A9-67234222/" target="_blank"><i class="fa fa-linkedin fa-2x"></i></a>
                     <a class="menu-icon" target="_blank" href="https://www.youtube.com/@justanotherdevopsguy" target="_blank"><i class="fa fa-youtube fa-2x"></i></a>
                  </div>

                   <!-- <form class="form-inline my-2 my-lg-0">
                      <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
                      <button class="btn btn-outline-info my-2 my-sm-0" type="submit">Search</button>
                   </form> -->
                </div>
             </nav>
            <div class="container">
         <p class="date">2023-04-05 - Bas Magré</p>
         <!-- <h1 class="title">StarFive VisionFive 2 Ubuntu 22.04 ATI
Radeon R9 290</h1> -->
                  <div class="row">
            <div class="col-xl-10"><h1
id="starfive-visionfive-2---ubuntu-22.04-external-gpu-ati-radeon-r9-290">StarFive
VisionFive 2 - Ubuntu 22.04 external GPU ATI Radeon R9 290</h1>
<p>I wanted to compile and test a few programs on a RISC-V. I only ran
into the problem of minimal support of the onboard GPU and custom build
Debian from the StarFive Team.</p>
<p>So below you can see my “solution”. (Part II)</p>
<p>Creating the image was more of the same I did on Part I <a
href="FedoraATIRadeon5450.html">link</a></p>
<h2 id="hardware">Hardware</h2>
<ul>
<li>StarFive VisionFive 2</li>
<li>BEYIMEI PCIE Riser-Ver010X GPU Riser, 1X tot 16X (4PIN/6PIN/MOLEX)
PCIE-verlengkabel, M.2 naar PCI-E Riser Card Bitcoin Litecoin Ethereum.
This is about 11 EURO on amazon, so no big deal… <a
target="_blank" href="https://www.amazon.nl/dp/B0BF4PH83Y?ref_=pe_28126711_487767311_302_E_DDE_dt_1">amazon-link</a></li>
<li>AMD/ATI Hawaii PRO [Radeon R9 290/390], Bought on a Dutch
second-hand website, for 45 EURO.</li>
<li>An ATX power supply (was still lying around in the house)</li>
<li>For debugging a USB to TTL (was still lying around in the house), is
about 5 EURO.</li>
</ul>
<p><img src="UbuntuATIRadeonR9_290/setup_001.jpeg" alt="img" /> <img
src="UbuntuATIRadeonR9_290/setup_002.jpeg" alt="img" /></p>
<h2 id="update-firmware-visionfive-2-to-2.11.5">Update firmware
VisionFive 2 to 2.11.5</h2>
<p>I updated my board to <code>VisionFive2 Software v2.11.5</code></p>
<p>download:</p>
<ul>
<li><a
target="_blank" href="https://github.com/starfive-tech/VisionFive2/releases/download/VF2_v2.11.5/visionfive2_fw_payload.img">visionfive2_fw_payload.img</a></li>
<li><a
target="_blank" href="https://github.com/starfive-tech/VisionFive2/releases/download/VF2_v2.11.5/u-boot-spl.bin.normal.out">u-boot-spl.bin.normal.out</a></li>
<li><a
target="_blank" href="https://github.com/starfive-tech/VisionFive2/releases/download/VF2_v2.11.5/sdcard.img">sdcard.img</a></li>
</ul>
<p>steps:</p>
<ul>
<li>I used <code>balenaEtcher</code> to flash a SD-card with
sdcard.img.</li>
<li>Mounted the root partition and sudo-cp the
<code>visionfive2_fw_payload.img</code> and
<code>u-boot-spl.bin.normal.out</code> file to /root</li>
<li>Used Serial to connect to VisionFive 2, login with root /
starfive</li>
<li>Run commands:</li>
</ul>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">flashcp</span> <span class="at">-v</span> /root/u-boot-spl.bin.normal.out /dev/mtd0</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">flashcp</span> <span class="at">-v</span> /root/visionfive2_fw_payload.img /dev/mtd1</span></code></pre></div>
<p>Done!</p>
<h2 id="create-sd-card">Create SD-card</h2>
<p>Download
<code>ubuntu-22.04.2-preinstalled-server-riscv64+visionfive.img.xz</code>
from <a target="_blank" href="https://ubuntu.com/download/risc-v">ubuntu</a> Unzip it to
<code>ubuntu-22.04.2-preinstalled-server-riscv64+visionfive.img</code>.</p>
<p>Download the <code>starfive-jh7110-VF2-SD-wayland.img</code> (202303)
from StarFive VisionFive 2 Support <a
target="_blank" href="https://debian.starfivetech.com/">page</a> (I used google
drive).</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a loop device of image</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo losetup <span class="at">-f</span> <span class="at">-P</span> ~/Downloads/visionfive_firmware_2023-04/starfive-jh7110-VF2-SD-wayland.img</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo losetup <span class="at">-f</span> <span class="at">-P</span> ~/iso/ubuntu-22.04.2-preinstalled-server-riscv64+visionfive.img</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># find your loop device</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> losetup <span class="at">-l</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="ex">NAME</span>       SIZELIMIT OFFSET AUTOCLEAR RO BACK-FILE                                                                    DIO LOG-SEC</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="ex">/dev/loop1</span>         0      0         0  0 /home/opvolger/iso/ubuntu-22.04.2-preinstalled-server-riscv64+visionfive.img   0     512</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="ex">/dev/loop0</span>         0      0         0  0 /home/opvolger/Downloads/visionfive_firmware_2023-04/starfive-jh7110-VF2-SD-wayland.img        0     512</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># in my case it is loop0 and loop1</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># insert your SD-card and delete all partitions (I had 3)</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo fdisk /dev/sdb</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="ex">[sudo]</span> password for opvolger: </span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="ex">Welcome</span> to fdisk <span class="er">(</span><span class="ex">util-linux</span> 2.38.1<span class="kw">)</span><span class="bu">.</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="ex">Changes</span> will remain in memory only, until you decide to write them.</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="ex">Be</span> careful before using the write command.</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="ex">Command</span> <span class="er">(</span><span class="ex">m</span> for help<span class="kw">)</span><span class="bu">:</span> d</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="ex">Partition</span> number <span class="er">(</span><span class="ex">1-4,</span> default 4<span class="kw">)</span><span class="bu">:</span> </span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="ex">Partition</span> 4 has been deleted.</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="ex">Command</span> <span class="er">(</span><span class="ex">m</span> for help<span class="kw">)</span><span class="bu">:</span> d</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="ex">Partition</span> number <span class="er">(</span><span class="ex">1-3,</span> default 3<span class="kw">)</span><span class="bu">:</span> </span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="ex">Partition</span> 3 has been deleted.</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="ex">Command</span> <span class="er">(</span><span class="ex">m</span> for help<span class="kw">)</span><span class="bu">:</span> d</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="ex">Partition</span> number <span class="er">(</span><span class="ex">1,2,</span> default 2<span class="kw">)</span><span class="bu">:</span> </span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="ex">Partition</span> 2 has been deleted.</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="ex">Command</span> <span class="er">(</span><span class="ex">m</span> for help<span class="kw">)</span><span class="bu">:</span> d</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="ex">Selected</span> partition 1</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="ex">Partition</span> 1 has been deleted.</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="ex">Command</span> <span class="er">(</span><span class="ex">m</span> for help<span class="kw">)</span><span class="bu">:</span> w</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="ex">The</span> partition table has been altered.</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="ex">Calling</span> ioctl<span class="er">(</span><span class="kw">)</span> <span class="ex">to</span> re-read partition table.</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="ex">Syncing</span> disks.</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a><span class="co"># add all 4 partitions (not all data) of the debian-wayland to the SD-card</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo dd if=/dev/loop0 of=/dev/sdb status=progress</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a><span class="ex">2831151616</span> bytes <span class="er">(</span><span class="ex">2,8</span> GB, 2,6 GiB<span class="kw">)</span> <span class="ex">copied,</span> 635 s, 4,5 MB/s </span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="ex">5529600+0</span> records in</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a><span class="ex">5529600+0</span> records out</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="ex">2831155200</span> bytes <span class="er">(</span><span class="ex">2,8</span> GB, 2,6 GiB<span class="kw">)</span> <span class="ex">copied,</span> 635,097 s, 4,5 MB/s</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo fdisk <span class="at">-l</span> /dev/loop1</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a><span class="ex">[sudo]</span> password for opvolger: </span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a><span class="ex">Disk</span> /dev/loop1: 4,5 GiB, 4831838208 bytes, 9437184 sectors</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a><span class="ex">Units:</span> sectors of 1 <span class="pp">*</span> 512 = 512 bytes</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a><span class="ex">Sector</span> size <span class="er">(</span><span class="ex">logical/physical</span><span class="kw">)</span><span class="bu">:</span> 512 bytes / 512 bytes</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a><span class="ex">I/O</span> size <span class="er">(</span><span class="ex">minimum/optimal</span><span class="kw">)</span><span class="bu">:</span> 512 bytes / 512 bytes</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a><span class="ex">Disklabel</span> type: gpt</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a><span class="ex">Disk</span> identifier: 27D729D1-39F3-4647-9B99-E2EF8937310A</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a><span class="ex">Device</span>         Start     End Sectors  Size Type</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a><span class="ex">/dev/loop1p1</span>  227362 9437150 9209789  4,4G Linux filesystem</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a><span class="ex">/dev/loop1p3</span>  225314  227361    2048    1M Linux filesystem</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a><span class="ex">/dev/loop1p12</span> 217122  225313    8192    4M Linux filesystem</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a><span class="ex">/dev/loop1p15</span>     34  217121  217088  106M EFI System</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a><span class="ex">Partition</span> table entries are not in disk order.</span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a><span class="co"># So the 1st partition is the rootfs</span></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a><span class="co"># 1ste is the root partition. We need to (re)place the root partition of the debian-wayland (4th partition now on the SD-card)</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a><span class="co"># the partition is to small, we make the root bigger (first e2fsck then parted)</span></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo e2fsck <span class="at">-f</span> /dev/sdb4</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a><span class="ex">e2fsck</span> 1.47.0 <span class="er">(</span><span class="ex">5-Feb-2023</span><span class="kw">)</span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a><span class="ex">Pass</span> 1: Checking inodes, blocks, and sizes</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a><span class="ex">Inode</span> 86649 extent tree <span class="er">(</span><span class="ex">at</span> level 2<span class="kw">)</span> <span class="ex">could</span> be narrower.  Optimize<span class="op">&lt;</span>y<span class="op">&gt;</span><span class="pp">?</span> yes</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a><span class="ex">Inode</span> 89474 extent tree <span class="er">(</span><span class="ex">at</span> level 1<span class="kw">)</span> <span class="ex">could</span> be narrower.  Optimize<span class="op">&lt;</span>y<span class="op">&gt;</span><span class="pp">?</span> yes</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a><span class="ex">Inode</span> 91900 extent tree <span class="er">(</span><span class="ex">at</span> level 1<span class="kw">)</span> <span class="ex">could</span> be narrower.  Optimize<span class="op">&lt;</span>y<span class="op">&gt;</span><span class="pp">?</span> yes</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a><span class="ex">Inode</span> 91929 extent tree <span class="er">(</span><span class="ex">at</span> level 1<span class="kw">)</span> <span class="ex">could</span> be narrower.  Optimize<span class="op">&lt;</span>y<span class="op">&gt;</span><span class="pp">?</span> yes</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a><span class="ex">Inode</span> 91932 extent tree <span class="er">(</span><span class="ex">at</span> level 1<span class="kw">)</span> <span class="ex">could</span> be narrower.  Optimize<span class="op">&lt;</span>y<span class="op">&gt;</span><span class="pp">?</span> yes</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a><span class="ex">Pass</span> 1E: Optimizing extent trees</span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a><span class="ex">Pass</span> 2: Checking directory structure</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a><span class="ex">Pass</span> 3: Checking directory connectivity</span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a><span class="ex">Pass</span> 4: Checking reference counts</span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a><span class="ex">Pass</span> 5: Checking group summary information</span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a><span class="ex">root:</span> <span class="pp">*****</span> FILE SYSTEM WAS MODIFIED <span class="pp">*****</span></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a><span class="ex">root:</span> 93204/165984 files <span class="er">(</span><span class="ex">0.2%</span> non-contiguous<span class="kw">)</span><span class="ex">,</span> 647953/663291 blocks</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo parted /dev/sdb</span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a><span class="ex">[sudo]</span> password for opvolger: </span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a><span class="ex">GNU</span> Parted 3.5</span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a><span class="ex">Using</span> /dev/sdb</span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a><span class="ex">Welcome</span> to GNU Parted! Type <span class="st">&#39;help&#39;</span> to view a list of commands.</span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span>  <span class="ex">print</span>                                                            </span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a><span class="ex">Warning:</span> Not all of the space available to /dev/sdb appears to be used, you can fix the GPT to use all of the space <span class="er">(</span><span class="ex">an</span> extra 119140352 blocks<span class="kw">)</span> <span class="ex">or</span></span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a><span class="cf">continue</span> <span class="ex">with</span> the current setting<span class="pp">?</span> </span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a><span class="ex">Fix/Ignore?</span> Fix                                                           </span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a><span class="ex">Model:</span> Generic STORAGE DEVICE <span class="er">(</span><span class="ex">scsi</span><span class="kw">)</span></span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a><span class="ex">Disk</span> /dev/sdb: 63,8GB</span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a><span class="ex">Sector</span> size <span class="er">(</span><span class="ex">logical/physical</span><span class="kw">)</span><span class="bu">:</span> 512B/512B</span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a><span class="ex">Partition</span> Table: gpt</span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a><span class="ex">Disk</span> Flags: </span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a><span class="ex">Number</span>  Start   End     Size    File system  Name  Flags</span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a> <span class="ex">1</span>      2097kB  4194kB  2097kB</span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a> <span class="ex">2</span>      4194kB  8389kB  4194kB</span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a> <span class="ex">3</span>      8389kB  113MB   105MB   fat16              boot, esp</span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a> <span class="ex">4</span>      113MB   2830MB  2717MB  ext4               legacy_boot</span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="ex">resizepart</span> 4 6GB                                                 </span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="ex">print</span>                                                            </span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a><span class="ex">Model:</span> Generic STORAGE DEVICE <span class="er">(</span><span class="ex">scsi</span><span class="kw">)</span></span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a><span class="ex">Disk</span> /dev/sdb: 63,8GB</span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a><span class="ex">Sector</span> size <span class="er">(</span><span class="ex">logical/physical</span><span class="kw">)</span><span class="bu">:</span> 512B/512B</span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a><span class="ex">Partition</span> Table: gpt</span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a><span class="ex">Disk</span> Flags: </span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a><span class="ex">Number</span>  Start   End     Size    File system  Name  Flags</span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a> <span class="ex">1</span>      2097kB  4194kB  2097kB</span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a> <span class="ex">2</span>      4194kB  8389kB  4194kB</span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a> <span class="ex">3</span>      8389kB  113MB   105MB   fat16              boot, esp</span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a> <span class="ex">4</span>      113MB   6000MB  5887MB  ext4               legacy_boot</span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="ex">quit</span>                                                             </span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a><span class="ex">Information:</span> You may need to update /etc/fstab.</span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo dd if=/dev/loop1p1 of=/dev/sdb4 status=progress </span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a><span class="ex">4714652160</span> bytes <span class="er">(</span><span class="ex">4,7</span> GB, 4,4 GiB<span class="kw">)</span> <span class="ex">copied,</span> 103 s, 45,8 MB/s</span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a><span class="ex">9209789+0</span> records in</span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a><span class="ex">9209789+0</span> records out</span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a><span class="ex">4715411968</span> bytes <span class="er">(</span><span class="ex">4,7</span> GB, 4,4 GiB<span class="kw">)</span> <span class="ex">copied,</span> 191,996 s, 24,6 MB/s</span></code></pre></div>
<h2 id="building-the-linux-kernel">Building the Linux Kernel</h2>
<p>I build this on my own machine, otherwise it will take a very long
time. so cross compile! Everything is neatly explained if you click
through to the “linux” repo of all (yet) custom code for the SBC. <a
target="_blank" href="https://github.com/starfive-tech/VisionFive2">link</a></p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mkdir ~/visionfive2</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cd visionfive2</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> git clone https://github.com/starfive-tech/linux.git</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Cloning</span> into <span class="st">&#39;linux&#39;</span>...</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="ex">remote:</span> Enumerating objects: 9469722, done.</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="ex">remote:</span> Counting objects: 100% <span class="er">(</span><span class="ex">39691/39691</span><span class="kw">)</span><span class="ex">,</span> done.</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="ex">remote:</span> Compressing objects: 100% <span class="er">(</span><span class="ex">17697/17697</span><span class="kw">)</span><span class="ex">,</span> done.</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="ex">remote:</span> Total 9469722 <span class="er">(</span><span class="ex">delta</span> 28345<span class="kw">)</span><span class="ex">,</span> reused 28687 <span class="er">(</span><span class="ex">delta</span> 21896<span class="kw">)</span><span class="ex">,</span> pack-reused 9430031</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="ex">Receiving</span> objects: 100% <span class="er">(</span><span class="ex">9469722/9469722</span><span class="kw">)</span><span class="ex">,</span> 2.11 GiB <span class="kw">|</span> <span class="ex">14.23</span> MiB/s, done.</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="ex">Resolving</span> deltas: 100% <span class="er">(</span><span class="ex">8042369/8042369</span><span class="kw">)</span><span class="ex">,</span> done.</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="ex">Updating</span> files: 100% <span class="er">(</span><span class="ex">79598/79598</span><span class="kw">)</span><span class="ex">,</span> done.</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cd linux</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> git checkout VF2_v2.11.5</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="ex">Updating</span> files: 100% <span class="er">(</span><span class="ex">20490/20490</span><span class="kw">)</span><span class="ex">,</span> done.</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="ex">Note:</span> switching to <span class="st">&#39;VF2_v2.11.5&#39;</span>.</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="ex">You</span> are in <span class="st">&#39;detached HEAD&#39;</span> state. You can look around, make experimental</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="ex">changes</span> and commit them, and you can discard any commits you make in this</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="ex">state</span> without impacting any branches by switching back to a branch.</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="ex">If</span> you want to create a new branch to retain commits you create, you may</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="cf">do</span> <span class="ex">so</span> <span class="er">(</span><span class="ex">now</span> or later<span class="kw">)</span> <span class="ex">by</span> using <span class="at">-c</span> with the switch command. Example:</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">git</span> switch <span class="at">-c</span> <span class="op">&lt;</span>new-branch-name<span class="op">&gt;</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="ex">Or</span> undo this operation with:</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">git</span> switch <span class="at">-</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="ex">Turn</span> off this advice by setting config variable advice.detachedHead to false</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="ex">HEAD</span> is now at a87c6861c6d9 Merge tag <span class="st">&#39;JH7110_515_SDK_v4.5.2&#39;</span> into vf2-515-devel</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="ex">Updating</span> files: 100% <span class="er">(</span><span class="ex">46210/46210</span><span class="kw">)</span><span class="ex">,</span> done.</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="ex">Note:</span> switching to <span class="st">&#39;VF2_v2.8.0&#39;</span>.</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="ex">You</span> are in <span class="st">&#39;detached HEAD&#39;</span> state. You can look around, make experimental</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="ex">changes</span> and commit them, and you can discard any commits you make in this</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="ex">state</span> without impacting any branches by switching back to a branch.</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="ex">If</span> you want to create a new branch to retain commits you create, you may</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="cf">do</span> <span class="ex">so</span> <span class="er">(</span><span class="ex">now</span> or later<span class="kw">)</span> <span class="ex">by</span> using <span class="at">-c</span> with the switch command. Example:</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">git</span> switch <span class="at">-c</span> <span class="op">&lt;</span>new-branch-name<span class="op">&gt;</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a><span class="ex">Or</span> undo this operation with:</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">git</span> switch <span class="at">-</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a><span class="ex">Turn</span> off this advice by setting config variable advice.detachedHead to false</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a><span class="ex">HEAD</span> is now at 59cf9af678db Merge tag <span class="st">&#39;JH7110_515_SDK_v4.0.0-rc2&#39;</span> into vf2-515-devel</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> git revert 2757ebeaf3992ee6c5d4842ffbfc1d022e790f9f <span class="at">--no-commit</span> <span class="co"># This commit make the M.2 -&gt; PCI-e not work</span></span></code></pre></div>
<p>Now we have the configure a new kernel 5.15 that workes with
VisionFive 2 and an AMD/ATI Hawaii PRO [Radeon R9 290/390]. We can use
the instructions of the other branch <a
target="_blank" href="https://github.com/starfive-tech/linux/tree/JH7110_VisionFive2_upstream">link</a>.
Here and there I deviated a little from it.</p>
<p>First I tried to use the ATI (old) kernel drivers, because that was
working with the ATI Radion HD 5450. But I did get text, but not a
(good) graphical output (and a reset of XOrg). So I got the new amdgpu
drivers working (not what I expected)</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create the .config with all you need for only the StarFive VisionFive 2</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> ARCH=riscv CROSS_COMPILE=riscv64-linux-gnu- starfive_jh7110_defconfig <span class="co"># starfive_jh7110_defconfig -&gt; we need PCI-e what is not enabled in starfive_visionfive2_defconfig</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># open the menu</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> CROSS_COMPILE=riscv64-linux-gnu- ARCH=riscv menuconfig</span></code></pre></div>
<p>Now we have to add the ATI video-card and HDMI-audio.</p>
<pre><code>Device Drivers ---&gt; [HIT ENTER]
  Generic Driver Options ---&gt; [HIT ENTER]
    Firmware loader ---&gt; [HIT ENTER]
      () Build named firmware blobs into the kernel binary [HIT ENTER]</code></pre>
<p>enter this in the line:</p>
<p>(only the amdgpu bin files, radeon drivers was not working on my
GPU)</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode ini"><code class="sourceCode ini"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="dt">amdgpu/hawaii_k_smc.bin amdgpu/hawaii_smc.bin amdgpu/hawaii_uvd.bin amdgpu/hawaii_vce.bin amdgpu/hawaii_sdma.bin amdgpu/hawaii_sdma1.bin amdgpu/hawaii_pfp.bin amdgpu/hawaii_me.bin amdgpu/hawaii_ce.bin amdgpu/hawaii_rlc.bin amdgpu/hawaii_mec.bin amdgpu/hawaii_mc.bin</span></span></code></pre></div>
<p>Select Exit,Exit</p>
<p>We need some stuff for snapd:</p>
<pre><code>Device Drivers -&gt; 
    Block devices -&gt; [HIT ENTER]
      &lt;*&gt; RAM block device support [HIT SPACE 2x]</code></pre>
<p>Select Exit</p>
<pre><code>Device Drivers ---&gt;
  Graphics support ---&gt; [HIT ENTER]
    &lt;*&gt; AMD GPU [HIT SPACE 2x]
    [*] Enable amdgpu support for SI parts [HIT SPACE]
    [*] Enable amdgpu support for CIK parts [HIT SPACE]
    ACP (Audio CoProcessor) Configuration ---&gt; [HIT ENTER]
      [*] Enable AMD Audio CoProcessor IP support [HIT SPACE] (Select Exit)</code></pre>
<p>Select Exit,Exit</p>
<pre><code>Device Drivers ---&gt;
  Sound card support ---&gt; [HIT ENTER]
    Advanced Linux Sound Architecture ---&gt; [HIT ENTER]
      HD-Audio ---&gt; [HIT ENTER]
        HD Audio PCI [HIT SPACE 2x]
        Build HDMI/DisplayPort HD-audio codec support [HIT SPACE 2x]</code></pre>
<p>Select Exit,Exit,Exit,Exit</p>
<p>We need more some stuff for snapd:</p>
<pre><code>File systems  -&gt; [HIT ENTER]
  Miscellaneous filesystems -&gt; [HIT ENTER]
    &lt;*&gt; SquashFS 4.0 - Squased file system support [HIT SPACE 2x]
    &lt;*&gt; Squashfs XATTR support [HIT SPACE 2x]
    &lt;*&gt; Include support for ZLIB compressed file systems
    &lt;*&gt; Include support for LZ4 compressed file systems [HIT SPACE]
    &lt;*&gt; Include support for LZO compressed file systems [HIT SPACE]
    &lt;*&gt; Include support for XZ compressed file systems [HIT SPACE]
    &lt;*&gt; Include support for ZSTD compressed file systems [HIT SPACE]</code></pre>
<p>Select Exit,Exit,Exit</p>
<p>Yes You wish to save your new configuration!</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We can compile the kernel, I have 16 cores in my machine... so I added -j 16</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> make ARCH=riscv CROSS_COMPILE=riscv64-linux-gnu- <span class="at">-j</span> 16</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="ex">scripts/extract-cert.c:</span> In function ‘display_openssl_errors’:</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="ex">scripts/extract-cert.c:46:9:</span> warning: ‘ERR_get_error_line’ is deprecated: Since OpenSSL 3.0 <span class="pp">[-</span><span class="ss">Wdeprecated</span><span class="pp">-</span><span class="ss">declarations</span><span class="pp">]</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>   <span class="ex">46</span> <span class="kw">|</span>         <span class="cf">while</span> <span class="kw">((</span><span class="va">e</span> <span class="op">=</span> <span class="va">ERR_get_error_line</span>(<span class="op">&amp;</span><span class="va">file</span><span class="kw">,</span> <span class="op">&amp;</span><span class="va">line</span>)<span class="kw">))</span> <span class="kw">{</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span>         <span class="ex">^~~~~</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="ex">drivers/gpu/drm/verisilicon/inno_hdmi.c:</span> In function <span class="st">&#39;inno_hdmi_config_pll&#39;</span>:</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="ex">drivers/gpu/drm/verisilicon/inno_hdmi.c:208:9:</span> warning: ISO C90 forbids mixed declarations and code <span class="pp">[-</span><span class="ss">Wdeclaration</span><span class="pp">-</span><span class="ss">after</span><span class="pp">-</span><span class="ss">statement</span><span class="pp">]</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="ex">208</span> <span class="kw">|</span>         <span class="ex">const</span> reg_value_t cfg_pll_data[] = {</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span>         <span class="ex">^~~~~</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mkdir <span class="at">-p</span> ~/visionfive2/kernel</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> make CROSS_COMPILE=riscv64-linux-gnu- ARCH=riscv INSTALL_PATH=~/visionfive2/kernel zinstall <span class="at">-j</span> 16</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="fu">sh</span> ./arch/riscv/boot/install.sh 5.15.0+ <span class="dt">\</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>arch/riscv/boot/Image.gz System.map <span class="st">&quot;/home/opvolger/visionfive2/kernel&quot;</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="ex">Installing</span> compressed kernel</span></code></pre></div>
<p>The kernel is Done! Now copy it to the boot partition!</p>
<h2 id="bootroot-copy-kernel">BOOT/ROOT Copy kernel</h2>
<p>We have the SD-card inserted (again).</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mkdir <span class="at">-p</span> ~/visionfive2/boot</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mkdir <span class="at">-p</span> ~/visionfive2/root</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># mount boot and root partition</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo mount /dev/sdb3 ~/visionfive2/boot</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo mount /dev/sdb4 ~/visionfive2/root</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># copy the kernel</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo cp ~/visionfive2/kernel/<span class="pp">*</span>+ ~/visionfive2/boot</span></code></pre></div>
<h3 id="bootroot-add-the-boot-option">BOOT/ROOT Add the boot option</h3>
<div class="sourceCode" id="cb13"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo nano ~/visionfive2/boot/extlinux/extlinux.conf</span></code></pre></div>
<p>We have to change the kernel from /boot/vmlinuz-5.15.0-starfive to
/boot/vmlinuz-5.15.0+</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode ini"><code class="sourceCode ini"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">## /extlinux/extlinux.conf</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">##</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">## IMPORTANT </span><span class="al">WARNING</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">##</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co">## The configuration of this file is generated automatically.</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co">## Do not edit this file manually, use: u-boot-update</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="dt">default l0</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="dt">menu title U-Boot menu</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="dt">prompt 0</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="dt">timeout 50</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="dt">label l0</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="dt">        menu label Debian GNU/Linux bookworm/sid 5.15.0-starfive</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="dt">        linux /vmlinuz-5.15.0-starfive</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="dt">        initrd /initrd.img-5.15.0-starfive</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="dt">        fdtdir /dtbs</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="dt">        append root</span><span class="ot">=</span><span class="st">/dev/mmcblk1p4 root=/dev/mmcblk1p4 rw console=tty0 console=ttyS0,115200 earlycon rootwait stmmaceth=chain_mode:1 selinux=0</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="dt">label l0r</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="dt">        menu label Debian GNU/Linux bookworm/sid 5.15.0-starfive (rescue target)</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="dt">        linux /vmlinuz-5.15.0-starfive</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="dt">        initrd /initrd.img-5.15.0-starfive</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="dt">        fdtdir /dtbs</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="dt">        append root</span><span class="ot">=</span><span class="st">/dev/mmcblk1p4 root=/dev/mmcblk1p4 rw console=tty0 console=ttyS0,115200 earlycon rootwait stmmaceth=chain_mode:1 selinux=0 single</span></span></code></pre></div>
<p>to</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode ini"><code class="sourceCode ini"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">## /extlinux/extlinux.conf</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co">##</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">## IMPORTANT </span><span class="al">WARNING</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">##</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">## The configuration of this file is generated automatically.</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">## Do not edit this file manually, use: u-boot-update</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="dt">default l0</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="dt">menu title U-Boot menu</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="dt">prompt 0</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="dt">timeout 50</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co"># add &#39; radeon.cik_support=0 amdgpu.cik_support=1 radeon.si_support=0 amdgpu.si_support=1 amdgpu.dc=1&#39; to append if you have build ATI and AMD drivers in the kernel (amdgpu is not the default, the default is the old ati driver.)</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co"># we changed the kernel from vmlinuz-5.15.0-starfive to vmlinuz-5.15.0+</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="dt">label l0</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="dt">        menu label Debian GNU/Linux bookworm/sid 5.15.0-starfive</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="dt">        linux /vmlinuz-5.15.0+</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="dt">        initrd /initrd.img-5.15.0-starfive</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="dt">        fdtdir /dtbs</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="dt">        append root</span><span class="ot">=</span><span class="st">/dev/mmcblk1p4 root=/dev/mmcblk1p4 rw console=tty0 console=ttyS0,115200 earlycon rootwait stmmaceth=chain_mode:1 selinux=0</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="dt">label l0r</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="dt">        menu label Debian GNU/Linux bookworm/sid 5.15.0-starfive (rescue target)</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a><span class="dt">        linux /vmlinuz-5.15.0-starfive</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a><span class="dt">        initrd /initrd.img-5.15.0-starfive</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a><span class="dt">        fdtdir /dtbs</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a><span class="dt">        append root</span><span class="ot">=</span><span class="st">/dev/mmcblk1p4 root=/dev/mmcblk1p4 rw console=tty0 console=ttyS0,115200 earlycon rootwait stmmaceth=chain_mode:1 selinux=0 single</span></span></code></pre></div>
<h3 id="bootroot-fix-the-fstab-of-the-root-partition">BOOT/ROOT Fix the
fstab of the root partition</h3>
<p>We have to change the /boot mount point. The UUID/LABEL are
different. We have to findout the new UUID</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> blkid /dev/sdb3</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="ex">/dev/sdb3:</span> SEC_TYPE=<span class="st">&quot;msdos&quot;</span> UUID=<span class="st">&quot;FCD7-CFFB&quot;</span> BLOCK_SIZE=<span class="st">&quot;512&quot;</span> TYPE=<span class="st">&quot;vfat&quot;</span> PARTUUID=<span class="st">&quot;0c10506e-2b34-40b5-9f06-92cf5745e874&quot;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo nano ~/visionfive2/root/etc/fstab</span></code></pre></div>
<p>change</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode ini"><code class="sourceCode ini"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="dt">LABEL</span><span class="ot">=</span><span class="st">cloudimg-rootfs   /        ext4   discard,errors=remount-ro       0 1</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="dt">LABEL</span><span class="ot">=</span><span class="st">UEFI      /boot/efi       vfat    umask=0077      0 1</span></span></code></pre></div>
<p>to</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode ini"><code class="sourceCode ini"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="dt">LABEL</span><span class="ot">=</span><span class="st">cloudimg-rootfs   /        ext4   discard,errors=remount-ro       0 1</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="dt">UUID</span><span class="ot">=</span><span class="st">FCD7-CFFB      /boot       vfat    umask=0077      0 1</span></span></code></pre></div>
<h2 id="bootroot-fix-ubuntu-advantage-tools-hang">BOOT/ROOT fix
ubuntu-advantage-tools hang</h2>
<p>ubuntu-advantage-tools (not working for risc-v yet), so we disable
it</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> rm ~/visionfive2/root/var/lib/dpkg/info/ubuntu-advantage-tools.postinst</span></code></pre></div>
<h2 id="bootroot-fix-virtualkeyboard-disable">BOOT/ROOT Fix
VirtualKeyboard (disable)</h2>
<p>create file so after we install kde, you will not have a big
VirtualKeyboard in your login screen</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> nano ~/visionfive2/root/etc/sddm.conf</span></code></pre></div>
<p>with:</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode ini"><code class="sourceCode ini"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># InputMethod=qtvirtualkeyboard is default</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="dt">InputMethod</span><span class="ot">=</span></span></code></pre></div>
<h2 id="bootroot-umount">BOOT/ROOT umount</h2>
<div class="sourceCode" id="cb22"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># umount the SD-card</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo umount ~/visionfive2/root/</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo umount ~/visionfive2/boot/</span></code></pre></div>
<h2 id="we-are-ready-to-boot-it-up">We are ready to Boot it up</h2>
<p>But the SD-card in the VisionFive 2 and power on! If you see a login,
turn if off again!</p>
<p>We need to change the ssh-key of the ubuntu (will be set on first
boot)</p>
<p>added ssh key (yours public) If you have no ssh-key run
<code>ssh-keygen -t ed25519</code> local (google it)</p>
<p>accepted ssh key in ubuntu are the <code>autorized_keys</code> in the
ssh dir of the user.</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo mount /dev/sdb3 ~/visionfive2/root</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo cp  ~/.ssh/id_ed25519.pub ~/visionfive2/root/home/ubuntu/.ssh/authorized_keys</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo chown 1000:1000 ~/visionfive2/root/home/ubuntu/.ssh/authorized_keys</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo umount ~/visionfive2/root/</span></code></pre></div>
<p>Put the SD-card back in the VisionFive 2.</p>
<p>Find out the ip-address of you VisionFive 2 and login with ssh</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ssh ubuntu@192.168.2.24</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Welcome</span> to Ubuntu 22.04.2 LTS <span class="er">(</span><span class="ex">GNU/Linux</span> 5.15.0-dirty riscv64<span class="kw">)</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a> <span class="ex">*</span> Documentation:  https://help.ubuntu.com</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a> <span class="ex">*</span> Management:     https://landscape.canonical.com</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a> <span class="ex">*</span> Support:        https://ubuntu.com/advantage</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="ex">System</span> information as of Tue Apr  4 20:32:59 UTC 2023</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="ex">System</span> load:  1.7021484375      Processes:             126</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="ex">Usage</span> of /:   4.7% of 57.44GB   Users logged in:       0</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="ex">Memory</span> usage: 2%                IPv4 address for eth0: 192.168.2.24</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="ex">Swap</span> usage:   0%</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="ex">Expanded</span> Security Maintenance for Applications is not enabled.</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span> updates can be applied immediately.</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="ex">Enable</span> ESM Apps to receive additional future security updates.</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="ex">See</span> https://ubuntu.com/esm or run: sudo pro status</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a><span class="ex">The</span> list of available updates is more than a week old.</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a><span class="ex">To</span> check for new updates run: sudo apt update</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a><span class="ex">Last</span> login: Tue Apr  4 20:33:03 2023 from 192.168.2.25</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a><span class="ex">To</span> run a command as administrator <span class="er">(</span><span class="ex">user</span> <span class="st">&quot;root&quot;</span><span class="kw">)</span><span class="ex">,</span> use <span class="st">&quot;sudo &lt;command&gt;&quot;</span>.</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a><span class="ex">See</span> <span class="st">&quot;man sudo_root&quot;</span> for details.</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@ubuntu:~$</span> sudo <span class="at">-i</span></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a><span class="ex">root@ubuntu:~#</span> passwd ubuntu</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a><span class="ex">New</span> password: </span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a><span class="ex">Retype</span> new password: </span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a><span class="ex">passwd:</span> password updated successfully</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a><span class="ex">root@ubuntu:~#</span> exit</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a><span class="bu">logout</span></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@ubuntu:~$</span></span></code></pre></div>
<h2 id="debuggen-if-display-is-not-working">debuggen if display is not
working</h2>
<div class="sourceCode" id="cb25"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ssh ubuntu@192.168.2.24</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@ubuntu:~$</span> journalctl <span class="at">-b</span> <span class="kw">|</span> <span class="fu">grep</span> radeon</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@ubuntu:~$</span> journalctl <span class="at">-b</span> <span class="kw">|</span> <span class="fu">grep</span> amdgpu</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@ubuntu:~$</span> journalctl <span class="at">-b</span> <span class="kw">|</span> <span class="fu">grep</span> firmware</span></code></pre></div>
<h2 id="kde-install-and-other-stuff-22.04">kde install and other stuff
22.04</h2>
<p>Now we can install a user interface, I like kde, so I installed KDE
(and some other stuff)</p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># delete Ubuntu image kernels and autoupdate kernel tool</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt-get purge <span class="at">--auto-remove</span> flash-kernel linux-starfive linux-image-starfive linux-headers-starfive linux-firmware</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Do</span> you want to continue<span class="pp">?</span> <span class="pp">[</span><span class="ss">Y/n</span><span class="pp">]</span> y</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo apt update</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo apt upgrade</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co"># maybe your update hangs (was on my machine)</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Setting</span> up libsasl2-2:riscv64 <span class="er">(</span><span class="ex">2.1.27+dfsg2-3ubuntu1.2</span><span class="kw">)</span> <span class="ex">...</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="ex">Setting</span> up systemd-hwe-hwdb <span class="er">(</span><span class="ex">249.11.3</span><span class="kw">)</span> <span class="ex">...</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="ex">Setting</span> up libmm-glib0:riscv64 <span class="er">(</span><span class="ex">1.20.0-1~ubuntu22.04.1</span><span class="kw">)</span> <span class="ex">...</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="ex">Setting</span> up isc-dhcp-common <span class="er">(</span><span class="ex">4.4.1-2.3ubuntu2.4</span><span class="kw">)</span> <span class="ex">...</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="ex">Setting</span> up ubuntu-advantage-tools <span class="er">(</span><span class="ex">27.13.6~22.04.1</span><span class="kw">)</span> <span class="ex">...</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="ex">Progress:</span> [ 75%] <span class="pp">[</span><span class="ss">###########################################################################################################....................................</span><span class="pp">]</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="co"># CTRL + Z</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="co"># if &#39;ubuntu-advantage-tools&#39; updates, rm postinst (again)</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo rm /var/lib/dpkg/info/ubuntu-advantage-tools.postinst</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo apt upgrade</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="ex">Waiting</span> for cache lock: Could not get lock /var/lib/dpkg/lock-frontend. It is held by process 3029 <span class="er">(</span><span class="ex">apt</span><span class="kw">)</span>      </span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="ex">Waiting</span> for cache lock: Could not get lock /var/lib/dpkg/lock-frontend. It is held by process 3029 <span class="er">(</span><span class="ex">apt</span><span class="kw">)</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="co"># CTRL + C</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo kill <span class="at">-9</span> 3029 <span class="co"># repeat</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo apt upgrade</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a><span class="ex">E:</span> dpkg was interrupted, you must manually run <span class="st">&#39;sudo dpkg --configure -a&#39;</span> to correct the problem.</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo dpkg <span class="at">--configure</span> <span class="at">-a</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a><span class="co"># It will work again.</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a><span class="ex">Errors</span> were encountered while processing:</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a> <span class="ex">cloud-init</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a> <span class="ex">libpam-systemd:riscv64</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo reboot <span class="co"># ignore errors</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a><span class="co"># disable sleep, less reboots</span></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl mask sleep.target suspend.target hibernate.target hybrid-sleep.target</span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt upgrade</span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a><span class="co"># install KDE and some build tools</span></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo apt install kde-standard build-essential libxml2 libcurl4-gnutls-dev neofetch ubuntu-dev-tools libopenal-dev libpng-dev libjpeg-dev libfreetype6-dev libfontconfig1-dev libcurl4-gnutls-dev libsdl2-dev zlib1g-dev libbz2-dev libedit-dev python-is-python3 m4 clang </span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a><span class="co"># ignore kernel error (message)</span></span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo reboot</span></code></pre></div>
<h2 id="network">Network</h2>
<p>Fix network manager in KDE (so you can control network in KDE)</p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo nano /etc/netplan/01-network-manager-all.yaml</span></code></pre></div>
<div class="sourceCode" id="cb28"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let NetworkManager manage all devices on this system</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">network</span><span class="kw">:</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="dv">2</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">renderer</span><span class="kw">:</span><span class="at"> NetworkManager</span></span></code></pre></div>
<p>Need reboot to get it working!</p>
<h2 id="screenshot">Screenshot!</h2>
<figure>
<img src="UbuntuATIRadeonR9_290/Screenshot.png" alt="img" />
<figcaption aria-hidden="true">img</figcaption>
</figure>
<h2 id="install-gcc-13-on-23.04">install gcc 13 on 23.04</h2>
<p>If you use the (now beta) release 23.04 and wish to use gcc 13:</p>
<div class="sourceCode" id="cb29"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="ex">apt</span> install G++-13 gcc-13</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> update-alternatives <span class="at">--install</span> /usr/bin/gcc gcc /usr/bin/gcc-12 12</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> update-alternatives <span class="at">--install</span> /usr/bin/g++ g++ /usr/bin/g++-12 12</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> update-alternatives <span class="at">--install</span> /usr/bin/gcc gcc /usr/bin/gcc-13 13</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> update-alternatives <span class="at">--install</span> /usr/bin/g++ g++ /usr/bin/g++-13 13</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> update-alternatives <span class="at">--config</span> gcc</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> update-alternatives <span class="at">--config</span> g++</span></code></pre></div>
<h2 id="fix-snapd">fix snapd</h2>
<p>If snap is broken, you can fix it: (happens ones)</p>
<div class="sourceCode" id="cb30"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt purge snapd</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install snapd plasma-discover-backend-snap <span class="co"># plasma-discover-backend-snap is you had installed kde</span></span></code></pre></div></div>
            <div class="d-none d-xl-block col-xl-2 bd-toc">
               <ul class="section-nav">
                  <li class="toc-entry"><ul>
<li><a
href="#starfive-visionfive-2---ubuntu-22.04-external-gpu-ati-radeon-r9-290"
id="toc-starfive-visionfive-2---ubuntu-22.04-external-gpu-ati-radeon-r9-290">StarFive
VisionFive 2 - Ubuntu 22.04 external GPU ATI Radeon R9 290</a>
<ul>
<li><a href="#hardware" id="toc-hardware">Hardware</a></li>
<li><a href="#update-firmware-visionfive-2-to-2.11.5"
id="toc-update-firmware-visionfive-2-to-2.11.5">Update firmware
VisionFive 2 to 2.11.5</a></li>
<li><a href="#create-sd-card" id="toc-create-sd-card">Create
SD-card</a></li>
<li><a href="#building-the-linux-kernel"
id="toc-building-the-linux-kernel">Building the Linux Kernel</a></li>
<li><a href="#bootroot-copy-kernel"
id="toc-bootroot-copy-kernel">BOOT/ROOT Copy kernel</a></li>
<li><a href="#bootroot-fix-ubuntu-advantage-tools-hang"
id="toc-bootroot-fix-ubuntu-advantage-tools-hang">BOOT/ROOT fix
ubuntu-advantage-tools hang</a></li>
<li><a href="#bootroot-fix-virtualkeyboard-disable"
id="toc-bootroot-fix-virtualkeyboard-disable">BOOT/ROOT Fix
VirtualKeyboard (disable)</a></li>
<li><a href="#bootroot-umount" id="toc-bootroot-umount">BOOT/ROOT
umount</a></li>
<li><a href="#we-are-ready-to-boot-it-up"
id="toc-we-are-ready-to-boot-it-up">We are ready to Boot it up</a></li>
<li><a href="#debuggen-if-display-is-not-working"
id="toc-debuggen-if-display-is-not-working">debuggen if display is not
working</a></li>
<li><a href="#kde-install-and-other-stuff-22.04"
id="toc-kde-install-and-other-stuff-22.04">kde install and other stuff
22.04</a></li>
<li><a href="#network" id="toc-network">Network</a></li>
<li><a href="#screenshot" id="toc-screenshot">Screenshot!</a></li>
<li><a href="#install-gcc-13-on-23.04"
id="toc-install-gcc-13-on-23.04">install gcc 13 on 23.04</a></li>
<li><a href="#fix-snapd" id="toc-fix-snapd">fix snapd</a></li>
</ul></li>
</ul></li>
               </ul>
            </div>
         </div>
               </div>
            <!-- Add comment hosting service here -->
            <!-- Footer -->
            <footer class="footer text-muted">
                <div align="center">
                   <!-- Update licences -->
                   Content is available under <a target="_blank" href="https://creativecommons.org/licenses/by-sa/3.0/" target="_blank" rel="noopener">CC BY-SA 3.0</a>
                   &nbsp;|&nbsp;
                   Sourcecode licensed under <a target="_blank" href="https://www.gnu.org/licenses/gpl-3.0.en.html" target="_blank" rel="noopener">GPL-3.0</a>
                   <br />
                   <!-- Please keep the following line -->
                   Built with <a target="_blank" href="https://www.pandoc.org" target="_blank" rel="noopener">Pandoc</a> 
                   using <a target="_blank" href="https://github.com/ashki23/pandoc-bootstrap" target="_blank" rel="noopener">pandoc-bootstrap</a> theme
                   <br />
                   <!-- Update copyright -->
                   Copyright, Bas Magr&eacute;
                </div>
             </footer>
             <!-- Add global site tag (gtag.js) and site analytics here -->
            <!-- JS, Popper.js, and jQuery -->
      <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
      <!-- Mathjax -->
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script>
         /* Bootstrap styles to tables */
         function bootstrapStylePandocTables() {
         $('tr.header').parent('thead').parent('table').addClass('table table-condensed'); }
         $(document).ready(function () { bootstrapStylePandocTables(); });
         /* Adjust the height when click the toc */
         var shiftWindow = function() { scrollBy(0, -60) };
         window.addEventListener("hashchange", shiftWindow);
         function load() { if (window.location.hash) shiftWindow(); }
      </script>
   </body>
</html>