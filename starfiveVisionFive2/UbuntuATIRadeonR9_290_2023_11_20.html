<!doctype html>
<html>
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <meta name="generator" content="pandoc">
      <meta name="author" content="Bas Magré">
      <meta name="date" content="2023-11-20">
      
      <title>StarFive VisionFive 2 Ubuntu 23.10 ATI Radeon R9
290</title>
      <link rel="icon" href="/website-template/favicon.ico">
      <!-- Bootstrap -->
      <link rel="stylesheet" target="_blank" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
      <!-- Font-awesome -->
      <link rel="stylesheet" target="_blank" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
      <!-- Styles -->
      <link rel="stylesheet" href="/website-template/styles.css">
            <!-- Add favicon here -->
            <!-- Add site-verifications here -->
         </head>
   <body>
            <nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark">
                <!--<a class="navbar-brand" href="#">Navbar</a>-->
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                   <ul class="navbar-nav mr-auto">
                      <li class="nav-item active">
                         <a class="nav-link" href="/index.html">Me <span class="sr-only">(current)</span></a>
                      </li>
                      <!-- <li class="nav-item">
                         <a class="nav-link" href="#">Link</a>
                      </li> -->
                      <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarKODI" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Kodi Addons
                        </a>
                        <div class="dropdown-menu" aria-labelledby="navbarKODI">
                           <a class="dropdown-item" href="/kodi/npo.html">NPO Uitzending gemist</a>               
                           <a class="dropdown-item" href="/kodi/kanalenlijst-hans.html">De Transponder - Kanalenlijk (Hans)</a>
                           <div class="dropdown-divider"></div>
                           <a class="dropdown-item" href="/kodi/rtlxl.html">(Inactive) RTLxl</a>
                        </div>
                     </li>
                     <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarMilkVJ" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Milk-V Jupiter
                        </a>
                        <div class="dropdown-menu" aria-labelledby="navbarMilkVJ">
                           <a class="dropdown-item" href="/milkVjupiter/OpenSUSEATIRadeonR9_290.html">ATI Radeon R9 290 Kernel 6.1</a>
                           <a class="dropdown-item" href="/milkVjupiter/OpenSUSEATIRadeonHD5850.html">OpenSUSE Tumbleweed ATI Radeon HD 5850 Kernel 6.6</a>
                        </div>
                     </li>
                      <li class="nav-item dropdown">
                         <a class="nav-link dropdown-toggle" href="#" id="navbarSFVF2" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                         Starfive VisionFive 2
                         </a>
                         <div class="dropdown-menu" aria-labelledby="navbarSFVF2">
                            <a class="dropdown-item" href="/starfiveVisionFive2/UbuntuATIRadeonR9_290.html">Ubuntu 22.04 with ATI Radeon R9 290</a>
                            <a class="dropdown-item" href="/starfiveVisionFive2/FedoraATIRadeon5450.html">Fedora with ATI Radeon5450</a>
                            <a class="dropdown-item" href="/starfiveVisionFive2/UbuntuATIRadeonR9_290_2023_11_20.html">Ubuntu 23.10 with ATI Radeon R9 290</a>
                            <a class="dropdown-item" href="/starfiveVisionFive2/OpenSUSEATIRadeonR9_290.html">OpenSUSE Tumbleweed ATI Radeon R9 290</a>
                            <a class="dropdown-item" href="/starfiveVisionFive2/OpenSUSEATIRadeonR9_290_mainline.html">OpenSUSE Tumbleweed ATI Radeon R9 290 mainline kernel</a>
                            <a class="dropdown-item" href="/starfiveVisionFive2/Ubuntu2410_outofthebox.html">StarFive VisionFive 2 Ubuntu 24.10 AMDGPU</a>
                            <!-- <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="#">Something else here</a> -->
                         </div>
                      </li>
                      <!-- <li class="nav-item">
                         <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Disabled</a>
                      </li> -->
                   </ul>
                   <div class="menu-icons">
                     <a class="menu-icon" target="_blank" href="https://github.com/Opvolger" target="_blank"><i class="fa fa-github fa-2x"></i></a>
                     <a class="menu-icon" target="_blank" href="https://www.twitter.com/Opvolger" target="_blank"><i class="fa fa-twitter fa-2x"></i></a>
                     <a class="menu-icon" href="mailto:Opvolger@gmail.com"><i class="fa fa-at fa-2x"></i></a>
                     <a class="menu-icon" target="_blank" href="https://www.linkedin.com/in/bas-magr%C3%A9-67234222/" target="_blank"><i class="fa fa-linkedin fa-2x"></i></a>
                     <a class="menu-icon" target="_blank" href="https://www.youtube.com/@justanotherdevopsguy" target="_blank"><i class="fa fa-youtube fa-2x"></i></a>
                     <a class="menu-icon" target="_blank" href="https://www.youtube.com/@opvolger" target="_blank"><i class="fa fa-youtube fa-2x"></i></a>
                  </div>

                   <!-- <form class="form-inline my-2 my-lg-0">
                      <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
                      <button class="btn btn-outline-info my-2 my-sm-0" type="submit">Search</button>
                   </form> -->
                </div>
             </nav>
            <div class="container">
         <p class="date">2023-11-20 - Bas Magré</p>
         <!-- <h1 class="title">StarFive VisionFive 2 Ubuntu 23.10 ATI
Radeon R9 290</h1> -->
                  <div class="row">
            <div class="col-xl-10"><h1
id="starfive-visionfive-2---ubuntu-23.10-external-gpu-ati-radeon-r9-290">StarFive
VisionFive 2 - Ubuntu 23.10 external GPU ATI Radeon R9 290</h1>
<p>I read on the Ubuntu website that there is now external GPU support
for Ubuntu 23.10. There is no lie in that, but with the current kernel
(6.5.0-9 and 6.5.0-10) it completely crashes.</p>
<p><a
target="_blank" href="https://bugs.launchpad.net/ubuntu/+source/linux-riscv/+bug/2039782">link</a></p>
<p>Keep in mind that:</p>
<ul>
<li>the kernel of Ubuntu only works with the firmware of Ubuntu.</li>
<li>the kernel of StarFive only works with the firmware of
Starfive.</li>
</ul>
<p>So I put together my own kernel again and got it running again.</p>
<h2 id="hardware">Hardware</h2>
<ul>
<li>StarFive VisionFive 2</li>
<li>BEYIMEI PCIE Riser-Ver010X GPU Riser, 1X tot 16X (4PIN/6PIN/MOLEX)
PCIE-verlengkabel, M.2 naar PCI-E Riser Card Bitcoin Litecoin Ethereum.
This is about 11 EURO on amazon, so no big deal… <a
target="_blank" href="https://www.amazon.nl/dp/B0BF4PH83Y?ref_=pe_28126711_487767311_302_E_DDE_dt_1">amazon-link</a></li>
<li>AMD/ATI Hawaii PRO [Radeon R9 290/390], Bought on a Dutch
second-hand website, for 45 EURO. or ATI Radeon 5450, Bought on a Dutch
second-hand website, for 10 EURO.</li>
<li>An ATX power supply (was still lying around in the house)</li>
<li>For debugging a USB to TTL (was still lying around in the house), is
about 5 EURO.</li>
</ul>
<p><img src="UbuntuATIRadeonR9_290/setup_001.jpeg" alt="img" /> <img
src="UbuntuATIRadeonR9_290/setup_002.jpeg" alt="img" /> or <img
src="FedoraATIRadeon5450/setup.png" alt="img" /></p>
<h2 id="downloades">Downloades</h2>
<p>download (to <code>~/Downloads/SF2_2023_11_20</code>):</p>
<ul>
<li><a
target="_blank" href="https://github.com/starfive-tech/VisionFive2/releases/download/VF2_v3.8.2/visionfive2_fw_payload.img">visionfive2_fw_payload.img</a></li>
<li><a
target="_blank" href="https://github.com/starfive-tech/VisionFive2/releases/download/VF2_v3.8.2/u-boot-spl.bin.normal.out">u-boot-spl.bin.normal.out</a></li>
<li><a
target="_blank" href="https://launchpad.net/~ubuntu-risc-v-team/+archive/ubuntu/release/+files/u-boot-starfive_2023.09.22-next-5d2fae79c7d6-0ubuntu1~ppa5_riscv64.deb">u-boot-starfive-ubuntu-deb</a></li>
</ul>
<p>Download the
<code>starfive-jh7110-VF2_515_v3.8.2-66-SD-minimal-desktop-wayland.img.bz2</code>
(202310/sd) from StarFive VisionFive 2 Support <a
target="_blank" href="https://debian.starfivetech.com/">page</a> (I used One Drive).</p>
<p>Download
<code>[ubuntu-22.04.2-preinstalled-server-riscv64+visionfive.img.xz](https://cdimage.ubuntu.com/releases/23.10/release/ubuntu-23.10-preinstalled-server-riscv64+visionfive2.img.xz)</code>
from <a target="_blank" href="https://ubuntu.com/download/risc-v">ubuntu</a> Unzip it to
<code>ubuntu-23.10-preinstalled-server-riscv64+visionfive2.img</code>.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mkdir <span class="at">-p</span> ~/Downloads/SF2_2023_11_20</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mkdir <span class="at">-p</span> ~/Downloads/SF2_2023_11_20/ubuntu</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cd ~/Downloads/SF2_2023_11_20</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> wget https://github.com/starfive-tech/VisionFive2/releases/download/VF2_v3.8.2/visionfive2_fw_payload.img</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> wget https://github.com/starfive-tech/VisionFive2/releases/download/VF2_v3.8.2/u-boot-spl.bin.normal.out</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> bzip2 <span class="at">-d</span> ~/Downloads/SF2_2023_11_20/starfive-jh7110-VF2_515_v3.8.2-66-SD-minimal-desktop-wayland.img.bz2</span></code></pre></div>
<h2 id="update-firmware-from-the-visionfive-2-to-ubuntu-firmware">Update
firmware from the VisionFive 2 to Ubuntu firmware</h2>
<p>My first staps are flowing the Ubuntu <a
target="_blank" href="https://wiki.ubuntu.com/RISC-V/StarFive%20VisionFive%202">wiki</a></p>
<p>We already downloaded
<code>u-boot-starfive_2023.09.22-next-5d2fae79c7d6-0ubuntu1~ppa5_riscv64.deb</code>
and now extract the firmware to
<code>~/Downloads/SF2_2023_11_20/ubuntu</code></p>
<p>I used Ark for this <img
src="UbuntuATIRadeonR9_290/unpack_deb_firmware.png" alt="img" /></p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># my download tree is now</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cd ~/Downloads/SF2_2023_11_20</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> tree</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="bu">.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> sdcard.img</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> starfive-jh7110-VF2_515_v3.8.2-66-SD-minimal-desktop-wayland.img</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> u-boot-spl.bin.normal.out</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> u-boot-starfive_2023.09.22-next-5d2fae79c7d6-0ubuntu1~ppa5_riscv64.deb</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> ubuntu</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── u-boot.itb</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── u-boot-spl.bin.normal.out</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> visionfive2_fw_payload.img</span></code></pre></div>
<p>If you read the documentation of Ubuntu and uses the firmware of
Ubuntu. This wil work for their kernels but if you compile the source
code of StarFive the USB devices will not work (mouse/keyboard).</p>
<p>I didn’t get it working with the sdcard.img (like last times) to
flash my VisionFive 2, so I used tftp. I used the docker <a
target="_blank" href="https://hub.docker.com/r/pghalliday/tftp">image</a></p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cd ~/Downloads/SF2_2023_11_20</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># startup the docker tftp server and expose the current directory to /var/tftpboot</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The first time you will see this message, but the second time you will see nothing</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker run <span class="at">-p</span> 0.0.0.0:69:69/udp <span class="at">-v</span> <span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span>:/var/tftpboot <span class="at">-i</span> <span class="at">-t</span> pghalliday/tftp</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Unable</span> to find image <span class="st">&#39;pghalliday/tftp:latest&#39;</span> locally</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="ex">latest:</span> Pulling from pghalliday/tftp</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="ex">fae91920dcd4:</span> Pull complete </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="ex">0bb6771b2292:</span> Pull complete </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="ex">Digest:</span> sha256:59f843a93d62ac6e2fa475ee3d1a3786464fe5ea0334e6f1ea79bdec837f09fa</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="ex">Status:</span> Downloaded newer image for pghalliday/tftp:latest</span></code></pre></div>
<p>Do NOT hit Ctrl+C! We need this server until we are done
flashing!</p>
<p>Boot up your VisionFive 2 without a SD-card and the USB to TTL
connected (see <a
target="_blank" href="https://doc-en.rvspace.org/VisionFive2/PDF/VisionFive2_QSG.pdf">link</a>
for more information)</p>
<p>My machine (with docker) has ip-address 192.168.2.29 and I give my
VisionFive 2 the ip 192.168.2.222</p>
<p>This will be the commands (for the Ubuntu firmware):</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set the ip of the VisionFive 2, and of the server (where docker is running)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> setenv ipaddr 192.168.2.222<span class="kw">;</span> <span class="ex">setenv</span> serverip 192.168.2.29</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># check connection</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ping 192.168.2.29</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize SPI Flash</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sf probe</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Download and Update SPL binary</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> tftpboot 0xa0000000 <span class="va">${serverip}</span>:ubuntu/u-boot-spl.bin.normal.out</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sf update 0xa0000000 0x0 <span class="va">$filesize</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Download and Update U-Boot binary</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> tftpboot 0xa0000000 <span class="va">${serverip}</span>:ubuntu/u-boot.itb</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sf update 0xa0000000 0x100000 <span class="va">$filesize</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Reset the default (default load options)</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> env default <span class="at">-f</span> <span class="at">-a</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Save your changes</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> env save</span></code></pre></div>
<p>It will look somethink like this:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Hit</span> any key to stop autoboot:  0 </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ex">StarFive</span> <span class="co"># setenv ipaddr 192.168.2.222; setenv serverip 192.168.2.29</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="ex">StarFive</span> <span class="co"># ping 192.168.2.29</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="ex">ethernet@16030000</span> Waiting for PHY auto negotiation to complete....... done</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Using</span> ethernet@16030000 device</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="ex">host</span> 192.168.2.29 is alive</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="ex">StarFive</span> <span class="co"># sf probe</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="ex">SF:</span> Detected gd25lq128 with page size 256 Bytes, erase size 4 KiB, total 16 MiB</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="ex">StarFive</span> <span class="co"># tftpboot 0xa0000000 ${serverip}:ubuntu/u-boot-spl.bin.normal.out</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="ex">Using</span> ethernet@16030000 device</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="ex">TFTP</span> from server 192.168.2.29<span class="kw">;</span> <span class="ex">our</span> IP address is 192.168.2.222</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="ex">Filename</span> <span class="st">&#39;ubuntu/u-boot-spl.bin.normal.out&#39;</span>.</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="ex">Load</span> address: 0xa0000000</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="ex">Loading:</span> <span class="co">##########</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>         <span class="ex">900.4</span> KiB/s</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="ex">Bytes</span> transferred = 139367 <span class="er">(</span><span class="ex">22067</span> hex<span class="kw">)</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="ex">StarFive</span> <span class="co"># sf update 0xa0000000 0x0 $filesize</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="ex">device</span> 0 offset 0x0, size 0x22067</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="ex">139367</span> bytes written, 0 bytes skipped in 0.802s, speed 177281 B/s</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="ex">StarFive</span> <span class="co"># tftpboot 0xa0000000 ${serverip}:ubuntu/u-boot.itb</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="ex">Using</span> ethernet@16030000 device</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="ex">TFTP</span> from server 192.168.2.29<span class="kw">;</span> <span class="ex">our</span> IP address is 192.168.2.222</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="ex">Filename</span> <span class="st">&#39;ubuntu/u-boot.itb&#39;</span>.</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="ex">Load</span> address: 0xa0000000</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="ex">Loading:</span> <span class="co">#################################################################</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>         <span class="co">####</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>         <span class="ex">1010.7</span> KiB/s</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="ex">Bytes</span> transferred = 1005851 <span class="er">(</span><span class="ex">f591b</span> hex<span class="kw">)</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="ex">StarFive</span> <span class="co"># sf update 0xa0000000 0x100000 $filesize</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="ex">device</span> 0 offset 0x100000, size 0xf591b</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="ex">932123</span> bytes written, 73728 bytes skipped in 7.618s, speed 135134 B/s</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="ex">StarFive</span> <span class="co"># env default -f -a</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="co">## Resetting to default environment</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a><span class="ex">StarFive</span> <span class="co"># env save</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="ex">Saving</span> Environment to SPIFlash... Erasing SPI flash...Writing to SPI flash...done</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a><span class="ex">OK</span></span></code></pre></div>
<p>Done!</p>
<p>You can turn off the VisionFive 2 again and hit Ctrl+C to stop
docker.</p>
<h2 id="create-the-sd-card">Create the SD-card</h2>
<p>I used <code>balenaEtcher</code> to flash a SD-card with
<code>ubuntu-23.10-preinstalled-server-riscv64+visionfive2.img</code>.</p>
<h2 id="fedora-install-packages">Fedora install packages</h2>
<p>I have installed Fedora linux and had to install some stuff to be
able to cross compile</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> dnf group install <span class="st">&quot;Development Tools&quot;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> dnf install git gcc-plugin-devel libmpc-devel gcc-c++ gcc-c++-riscv64-linux-gnu ncurses-devel libmpc-devel</span></code></pre></div>
<h2 id="building-the-linux-kernel">Building the Linux Kernel</h2>
<p>Building a kernel of the source code from StarFive</p>
<p>I build this on my own machine, otherwise it will take a very long
time. so cross compile! Everything is neatly explained if you click
through to the “linux” repo of all (yet) custom code for the SBC. <a
target="_blank" href="https://github.com/starfive-tech/VisionFive2">link</a></p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mkdir ~/Downloads/SF2_2023_11_20/visionfive2</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cd ~/Downloads/SF2_2023_11_20/visionfive2</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># we need the firmware for AMD / ATI cards, we do not need history so depth 1</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> git clone <span class="at">--depth</span> 1 git://git.kernel.org/pub/scm/linux/kernel/git/firmware/linux-firmware.git linux-firmware</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Cloning</span> into <span class="st">&#39;linux-firmware&#39;</span>...</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="ex">remote:</span> Enumerating objects: 3126, done.</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="ex">remote:</span> Counting objects: 100% <span class="er">(</span><span class="ex">3126/3126</span><span class="kw">)</span><span class="ex">,</span> done.</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="ex">remote:</span> Compressing objects: 100% <span class="er">(</span><span class="ex">2281/2281</span><span class="kw">)</span><span class="ex">,</span> done.</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="ex">remote:</span> Total 3126 <span class="er">(</span><span class="ex">delta</span> 1061<span class="kw">)</span><span class="ex">,</span> reused 2423 <span class="er">(</span><span class="ex">delta</span> 751<span class="kw">)</span><span class="ex">,</span> pack-reused 0</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="ex">Receiving</span> objects: 100% <span class="er">(</span><span class="ex">3126/3126</span><span class="kw">)</span><span class="ex">,</span> 428.00 MiB <span class="kw">|</span> <span class="ex">13.40</span> MiB/s, done.</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="ex">Resolving</span> deltas: 100% <span class="er">(</span><span class="ex">1061/1061</span><span class="kw">)</span><span class="ex">,</span> done.</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="ex">Updating</span> files: 100% <span class="er">(</span><span class="ex">3248/3248</span><span class="kw">)</span><span class="ex">,</span> done.</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co">#Check out the last kernel, we do not need history so depth 1</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> git clone <span class="at">--branch</span> VF2_v3.8.2 <span class="at">--depth</span> 1 https://github.com/starfive-tech/linux.git</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="ex">Cloning</span> into <span class="st">&#39;linux&#39;</span>...</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="ex">remote:</span> Enumerating objects: 79432, done.</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="ex">remote:</span> Counting objects: 100% <span class="er">(</span><span class="ex">79432/79432</span><span class="kw">)</span><span class="ex">,</span> done.</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="ex">remote:</span> Compressing objects: 100% <span class="er">(</span><span class="ex">74286/74286</span><span class="kw">)</span><span class="ex">,</span> done.</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="ex">remote:</span> Total 79432 <span class="er">(</span><span class="ex">delta</span> 7390<span class="kw">)</span><span class="ex">,</span> reused 21741 <span class="er">(</span><span class="ex">delta</span> 4319<span class="kw">)</span><span class="ex">,</span> pack-reused 0</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="ex">Receiving</span> objects: 100% <span class="er">(</span><span class="ex">79432/79432</span><span class="kw">)</span><span class="ex">,</span> 213.11 MiB <span class="kw">|</span> <span class="ex">6.87</span> MiB/s, done.</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="ex">Resolving</span> deltas: 100% <span class="er">(</span><span class="ex">7390/7390</span><span class="kw">)</span><span class="ex">,</span> done.</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="ex">Note:</span> switching to <span class="st">&#39;b133739ab239ec9e5cd9bc4a15817145989021e4&#39;</span>.</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="ex">You</span> are in <span class="st">&#39;detached HEAD&#39;</span> state. You can look around, make experimental</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="ex">changes</span> and commit them, and you can discard any commits you make in this</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="ex">state</span> without impacting any branches by switching back to a branch.</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="ex">If</span> you want to create a new branch to retain commits you create, you may</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="cf">do</span> <span class="ex">so</span> <span class="er">(</span><span class="ex">now</span> or later<span class="kw">)</span> <span class="ex">by</span> using <span class="at">-c</span> with the switch command. Example:</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">git</span> switch <span class="at">-c</span> <span class="op">&lt;</span>new-branch-name<span class="op">&gt;</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="ex">Or</span> undo this operation with:</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">git</span> switch <span class="at">-</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="ex">Turn</span> off this advice by setting config variable advice.detachedHead to false</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="ex">Updating</span> files: 100% <span class="er">(</span><span class="ex">74883/74883</span><span class="kw">)</span><span class="ex">,</span> done.</span></code></pre></div>
<p>I had to patch the kernel because I am using gcc-13: <a
target="_blank" href="https://lore.kernel.org/lkml/DB6P189MB05681E9F4785DF2758B9875B9CA49@DB6P189MB0568.EURP189.PROD.OUTLOOK.COM/t/">link</a></p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode patch"><code class="sourceCode diff"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">*** ../linux-5.18/scripts/gcc-plugins/gcc-common.h  2022-03-20 20:14:17.0000</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="dt">00000 +0000</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">--- scripts/gcc-plugins/gcc-common.h  2022-06-08 09:21:21.693178983 +0100</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="dt">***************</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="dt">*** 71,76 ****</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="dt">--- 71,78 ----</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  #include &quot;varasm.h&quot;</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  #include &quot;stor-layout.h&quot;</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  #include &quot;internal-fn.h&quot;</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="va">+ #include &quot;gimple.h&quot;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="va">+ #include &quot;gimple-iterator.h&quot;</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  #include &quot;gimple-expr.h&quot;</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  #include &quot;gimple-fold.h&quot;</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  #include &quot;context.h&quot;</span></code></pre></div>
<p>I used VS-Code to edit the file.</p>
<figure>
<img src="UbuntuATIRadeonR9_290/update_gcc_common_h.png" alt="img" />
<figcaption aria-hidden="true">img</figcaption>
</figure>
<p>Now we have the configure a new kernel 5.15 that workes with
VisionFive 2 and an AMD/ATI Hawaii PRO [Radeon R9 290/390]. We can use
the instructions of the other branch <a
target="_blank" href="https://github.com/starfive-tech/linux/tree/JH7110_VisionFive2_upstream">link</a>.
Here and there I deviated a little from it.</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># go to checkout code</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cd ~/Downloads/SF2_2023_11_20/visionfive2/linux</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create the .config with all you need for only the StarFive VisionFive 2</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> ARCH=riscv CROSS_COMPILE=riscv64-linux-gnu- starfive_jh7110_defconfig <span class="co"># starfive_jh7110_defconfig -&gt; we need PCI-e what is not enabled in starfive_visionfive2_defconfig</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># open the menu</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> CROSS_COMPILE=riscv64-linux-gnu- ARCH=riscv menuconfig</span></code></pre></div>
<p>Now we have to add the ATI video-card and HDMI-audio.</p>
<pre><code>Device Drivers ---&gt; [HIT ENTER]
  Generic Driver Options ---&gt; [HIT ENTER]
    Firmware loader ---&gt; [HIT ENTER]
      () Build named firmware blobs into the kernel binary [HIT ENTER]
      (/lib/firmware) Firmware blobs root directory [change it to ../linux-firmware]</code></pre>
<p>enter this in the line:</p>
<p>(radeon bins for ATI Radeon 5450, amdgpu/radeon bin files of AMD/ATI
Hawaii PRO [Radeon R9 290/390] (has 2 drivers amd and ATI) and bin
driver for my wifi dongel)</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode ini"><code class="sourceCode ini"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="dt">radeon/CYPRESS_uvd.bin radeon/CEDAR_smc.bin radeon/CEDAR_me.bin radeon/CEDAR_pfp.bin radeon/CEDAR_rlc.bin amdgpu/hawaii_k_smc.bin amdgpu/hawaii_smc.bin amdgpu/hawaii_uvd.bin amdgpu/hawaii_vce.bin amdgpu/hawaii_sdma.bin amdgpu/hawaii_sdma1.bin amdgpu/hawaii_pfp.bin amdgpu/hawaii_me.bin amdgpu/hawaii_ce.bin amdgpu/hawaii_rlc.bin amdgpu/hawaii_mec.bin amdgpu/hawaii_mc.bin radeon/hawaii_pfp.bin radeon/hawaii_me.bin radeon/hawaii_ce.bin radeon/hawaii_mec.bin radeon/hawaii_mc.bin radeon/hawaii_rlc.bin radeon/hawaii_sdma.bin radeon/hawaii_smc.bin radeon/hawaii_k_smc.bin radeon/HAWAII_pfp.bin radeon/HAWAII_me.bin radeon/HAWAII_ce.bin radeon/HAWAII_mec.bin radeon/HAWAII_mc.bin radeon/HAWAII_mc2.bin radeon/HAWAII_rlc.bin radeon/HAWAII_sdma.bin radeon/HAWAII_smc.bin rt2870.bin</span></span></code></pre></div>
<p>Select Exit,Exit</p>
<p>We need some stuff for snapd:</p>
<pre><code>Device Drivers -&gt; 
    Block devices -&gt; [HIT ENTER]
      &lt;*&gt; RAM block device support [HIT SPACE 2x]</code></pre>
<p>Select Exit</p>
<pre><code>Device Drivers -&gt; 
    Network device support ---&gt; [HIT ENTER]
      Wireless LAN ---&gt; [HIT ENTER]
        &lt;*&gt; Ralink driver support ---- [HIT SPACE 2x][HIT ENTER]
          &lt;*&gt; Ralink rt27xx/rt28xx/rt30xx (USB) [HIT SPACE 2x]
          [*] rt2800usb - Incl..... 6x [HIT SPACE 1x on 4 rows]</code></pre>
<p>Select Exit,Exit,Exit</p>
<pre><code>Device Drivers ---&gt;
  Graphics support ---&gt; [HIT ENTER]
    &lt;*&gt; ATI GPU [HIT SPACE]
    &lt;*&gt; AMD GPU [HIT SPACE 2x]
    [*] Enable amdgpu support for SI parts [HIT SPACE]
    [*] Enable amdgpu support for CIK parts [HIT SPACE]
    ACP (Audio CoProcessor) Configuration ---&gt; [HIT ENTER]
      [*] Enable AMD Audio CoProcessor IP support [HIT SPACE]</code></pre>
<p>Select Exit,Exit</p>
<pre><code>Device Drivers ---&gt;
  Sound card support ---&gt; [HIT ENTER]
    Advanced Linux Sound Architecture ---&gt; [HIT ENTER]
      HD-Audio ---&gt; [HIT ENTER]
        &lt;*&gt; HD Audio PCI [HIT SPACE 2x]
        &lt;*&gt; Build HDMI/DisplayPort HD-audio codec support [HIT SPACE 2x]</code></pre>
<p>Select Exit,Exit,Exit,Exit</p>
<p>We need more some stuff for snapd:</p>
<pre><code>File systems  -&gt; [HIT ENTER]
  Miscellaneous filesystems -&gt; [HIT ENTER]
    &lt;*&gt; SquashFS 4.0 - Squased file system support [HIT SPACE 2x]
    [*] Squashfs XATTR support [HIT SPACE]
    [*] Include support for ZLIB compressed file systems
    [*] Include support for LZ4 compressed file systems [HIT SPACE]
    [*] Include support for LZO compressed file systems [HIT SPACE]
    [*] Include support for XZ compressed file systems [HIT SPACE]
    [*] Include support for ZSTD compressed file systems [HIT SPACE]</code></pre>
<p>Select Exit,Exit</p>
<p>We need CONFIG_SECCOMP and CONFIG_SECCOMP_FILTER for the
<code>epiphany</code> browser</p>
<pre><code>General architecture-dependent options  ---&gt; [HIT ENTER]
  [*] Enable seccomp to safely execute untrusted bytecode -&gt; [HIT SPACE]</code></pre>
<p>Select Exit,Exit</p>
<p>Yes You wish to save your new configuration!</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We can compile the kernel, I have 16 cores in my machine... so I added -j 16</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> make ARCH=riscv CROSS_COMPILE=riscv64-linux-gnu- <span class="at">-j</span> 16</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="ex">scripts/extract-cert.c:</span> In function ‘display_openssl_errors’:</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="ex">scripts/extract-cert.c:46:9:</span> warning: ‘ERR_get_error_line’ is deprecated: Since OpenSSL 3.0 <span class="pp">[-</span><span class="ss">Wdeprecated</span><span class="pp">-</span><span class="ss">declarations</span><span class="pp">]</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>   <span class="ex">46</span> <span class="kw">|</span>         <span class="cf">while</span> <span class="kw">((</span><span class="va">e</span> <span class="op">=</span> <span class="va">ERR_get_error_line</span>(<span class="op">&amp;</span><span class="va">file</span><span class="kw">,</span> <span class="op">&amp;</span><span class="va">line</span>)<span class="kw">))</span> <span class="kw">{</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span>         <span class="ex">^~~~~</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="ex">In</span> file included from scripts/extract-cert.c:23:</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="ex">/usr/include/openssl/err.h:423:15:</span> note: declared here</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="ex">423</span> <span class="kw">|</span> <span class="ex">unsigned</span> long ERR_get_error_line<span class="er">(</span><span class="ex">const</span> char <span class="pp">**</span>file, int <span class="pp">*</span>line<span class="kw">);</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span>               <span class="ex">^~~~~~~~~~~~~~~~~~</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="ex">scripts/extract-cert.c:</span> In function ‘drain_openssl_errors’:</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="ex">scripts/extract-cert.c:59:9:</span> warning: ‘ERR_get_error_line’ is deprecated: Since OpenSSL 3.0 <span class="pp">[-</span><span class="ss">Wdeprecated</span><span class="pp">-</span><span class="ss">declarations</span><span class="pp">]</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>   <span class="ex">59</span> <span class="kw">|</span>         <span class="cf">while</span> <span class="kw">(</span><span class="ex">ERR_get_error_line</span><span class="er">(</span><span class="kw">&amp;</span><span class="fu">file</span>, <span class="kw">&amp;</span><span class="ex">line</span><span class="kw">))</span> <span class="ex">{}</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span>         <span class="ex">^~~~~</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="ex">/usr/include/openssl/err.h:423:15:</span> note: declared here</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  <span class="ex">423</span> <span class="kw">|</span> <span class="ex">unsigned</span> long ERR_get_error_line<span class="er">(</span><span class="ex">const</span> char <span class="pp">**</span>file, int <span class="pp">*</span>line<span class="kw">);</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="ex">.......</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="ex">.......</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="ex">.......</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="ex">.......</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="ex">drivers/gpu/drm/amd/amdgpu/../display/dc/dce/dce_aux.c:</span> In function ‘dce_aux_transfer_with_retries’:</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="ex">drivers/gpu/drm/amd/amdgpu/../display/dc/dce/dce_aux.c:704:32:</span> warning: storing the address of local variable ‘reply’ in ‘<span class="pp">*</span>payload.reply’ <span class="pp">[-</span><span class="ss">Wdangling</span><span class="pp">-</span><span class="ss">pointer=</span><span class="pp">]</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  <span class="ex">704</span> <span class="kw">|</span>                 <span class="ex">payload-</span><span class="op">&gt;</span>reply = <span class="kw">&amp;</span><span class="ex">reply</span><span class="kw">;</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span>                 <span class="ex">~~~~~~~~~~~~~~~^~~~~~~~</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a><span class="ex">drivers/gpu/drm/amd/amdgpu/../display/dc/dce/dce_aux.c:687:17:</span> note: ‘reply’ declared here</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>  <span class="ex">687</span> <span class="kw">|</span>         <span class="ex">uint8_t</span> reply<span class="kw">;</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span>                 <span class="ex">^~~~~</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="ex">drivers/gpu/drm/amd/amdgpu/../display/dc/dce/dce_aux.c:684:37:</span> note: ‘payload’ declared here</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>  <span class="ex">684</span> <span class="kw">|</span>                 <span class="ex">struct</span> aux_payload <span class="pp">*</span>payload<span class="er">)</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span>                 <span class="ex">~~~~~~~~~~~~~~~~~~~~^~~~~~~</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span></span></code></pre></div>
<p>The kernel is Done! Now copy it to the boot partition on the
SD-card!</p>
<h2 id="bootroot-copy-kernel">BOOT/ROOT Copy kernel</h2>
<p>We need the initrd-img of 5.15.0 from VisionFive 2, so we don’t have
to make it ourselves.</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a loop device of image</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> losetup <span class="at">-f</span> <span class="at">-P</span> ~/Downloads/SF2_2023_11_20/starfive-jh7110-VF2_515_v3.8.2-66-SD-minimal-desktop-wayland.img</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># find your loop device</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> losetup <span class="at">-a</span> <span class="co"># or -l</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="ex">/dev/loop0:</span> []: <span class="er">(</span><span class="ex">/home/opvolger/Downloads/SF2_2023_11_20/starfive-jh7110-VF2_515_v3.8.2-66-SD-minimal-desktop-wayland.img</span><span class="kw">)</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> lsblk</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="ex">NAME</span>        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="ex">loop0</span>         7:0    0   3,9G  0 loop </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="ex">├─loop0p1</span>   259:7    0     2M  0 part </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="ex">├─loop0p2</span>   259:8    0     4M  0 part </span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="ex">├─loop0p3</span>   259:9    0   100M  0 part </span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="ex">└─loop0p4</span>   259:10   0   3,8G  0 part </span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="ex">....</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="ex">....</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="ex">....</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="ex">....</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="co"># create dir</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mkdir <span class="at">-p</span> ~/Downloads/SF2_2023_11_20/visionfive2/mount</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="co"># mount to dir</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo mount /dev/loop0p3 ~/Downloads/SF2_2023_11_20/visionfive2/mount</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="co"># copy initrd img</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cp ~/Downloads/SF2_2023_11_20/visionfive2/mount/initrd.img-5.15.0-starfive ~/Downloads/SF2_2023_11_20/visionfive2</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="co"># umount</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo umount /dev/loop0p3</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a><span class="co"># detache loop device</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo losetup <span class="at">-d</span> /dev/loop0</span></code></pre></div>
<p>We have the SD-card inserted (again). Mount the sd-card
(cloudimg-rootfs) Now we need to mount the first partition of the
SD-card. my is mounted on
<code>/run/media/opvolger/cloudimg-rootfs/</code> after a click in KDE
:)</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># go to checkout code</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cd ~/Downloads/SF2_2023_11_20/visionfive2/linux</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># copy the kernel to the sd-card</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo cp arch/riscv/boot/Image.gz /run/media/opvolger/cloudimg-rootfs/boot/vmlinuz-5.15.0-dirty</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># copy the System map</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo cp System.map /run/media/opvolger/cloudimg-rootfs/boot/System.map-5.15.0-dirty</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># copy the dtb (Device Tree) to the sd-card</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo cp arch/riscv/boot/dts/starfive/jh7110-visionfive-v2.dtb /run/media/opvolger/cloudimg-rootfs/boot/dtb-5.15.0-dirty</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co"># copy initrd to the sd-card</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo cp ~/Downloads/SF2_2023_11_20/visionfive2/initrd.img-5.15.0-starfive /run/media/opvolger/cloudimg-rootfs/boot/initrd.img-5.15.0-dirty</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co"># we have now all the 4 files we need</span></span></code></pre></div>
<p>Now we need a custom boot option (the kernel we have made)</p>
<p>edit <code>40_custom</code> in
<code>/run/media/opvolger/cloudimg-rootfs/etc/grub.d/</code></p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode ini"><code class="sourceCode ini"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/sh</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="dt">exec tail -n +3 $0</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># This file provides an easy way to add custom menu entries.  Simply type the</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># menu entries you want to add after this comment.  Be careful not to change</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># the &#39;exec tail&#39; line above.</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="dt">menuentry &#39;Ubuntu StarFive VisionFive 2 5.15.0-dirty&#39; --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option &#39;gnulinux-simple-5-15-0-dirty&#39; {</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="dt">        load_video</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="dt">        insmod gzio</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="dt">        if </span><span class="kw">[ x$grub_platform = xxen ]</span><span class="dt">; then insmod xzio; insmod lzopio; fi</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="dt">        insmod part_gpt</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="dt">        insmod ext2</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="dt">        search --no-floppy --fs-uuid --set</span><span class="ot">=</span><span class="st">root 40249bdb-adbf-44bf-a50e-74b81c1200d7</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="dt">        echo    &#39;Loading Linux 5.15.0-dirty ...&#39;</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="dt">        linux   /boot/vmlinuz-5.15.0-dirty root</span><span class="ot">=</span><span class="st">LABEL=cloudimg-rootfs ro  efi=debug earlycon sysctl.kernel.watchdog_thresh=60</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="dt">        echo    &#39;Loading initial ramdisk ...&#39;</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="dt">        initrd  /boot/initrd.img-5.15.0-dirty</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="dt">        echo    &#39;Loading device tree blob...&#39;</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="dt">        devicetree      /boot/dtb-5.15.0-dirty</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="dt">}</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo nano /run/media/opvolger/cloudimg-rootfs/etc/grub.d/40_custom</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy the text above</span></span></code></pre></div>
<h2 id="setup-ubuntu-with-ubuntu-kernel-and-firmware">Setup Ubuntu with
ubuntu kernel and firmware</h2>
<p>Put the SD-Card in the VisionFive 2 without an external GPU and use
the USB to TTL.</p>
<p>Turn on the VisionFive 2</p>
<p>If booting is not working, reflash the firmware but skip the command
<code>env default -f -a</code>. I had this problem (sometimes?).</p>
<p>Ubuntu will boot with the kernel and firmware from Ubuntu!</p>
<p>You will get to setup your ubuntu password (default is
ubuntu/ubuntu).</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">-----BEGIN</span> SSH HOST KEY KEYS-----</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="ex">ecdsa-sha2-nistp256</span> AAAAB2VjZHNhLXNoYTItbmlzdHByNTYAAAAIbmlzdHAyNTYAAABBBNPq5SLKgBXEcCWZwAequ9Qr9af/PSurVzwNX3XIF/CAutf/aMGsOtBIyH5mk44HdLmtNLoM+voHsiZZ2/I8uCU= root@</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="ex">ssh-ed25519</span> AAAAC3NzaC1lZBI1NTE5AAAAIGFLC6yXTpRmdkQstt6l2vzoJHRkQfvFllD3sVNg0L3o root@ubuntu</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="ex">ssh-rsa</span> AAAAB3NzaC1yc2EAAABDAQABAAABgQC1nU/WOAedfYMyRYSLXWHgsDd8brhSlYYLMCpS00Lv2CJr037RUe+v5TfzPqbBw9xech8lFruZxzJ0AHJx4kbu34va9de6xSVLjD+5cHE343pn0eXi4VI9KT9bnN42h2</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="ex">1+7q/yGv2+ALQJ48Gi/AvuDnWKFXa8i4LOqlVjbnfutpko6bdw1ogttRXF8Lh7PacU6XihfQ7R5yPk0r2Kw0eFPT8vLRWp5OmT2KJaMg0K/UE0+Avv5zLq5axvSchA4pbeQ0NhgCw7NQUmuFha3ZUf/saksiohAtXUo2AF</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="ex">HB3crZFM39ffyHaZyycP0rSMCU3ErCsV3YYRWJZ34A0t7+4fxdWUfhB1+hxm9D8EovTtB6/K1qiEU5/b7fP4n2wuBlpMhn/Nt/UG3vJ/jxtfLCoNHTL4iFdhP33mpnpB7uVZxR9TGI22+EQO5HyXSMF5HI4CGUr2bo2/ud</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="ex">A/QNZScPICD9Hfq1MFS553M2dINFpFmVuvSqK3u0w4sW7ErB2Xr/U=</span> root@ubuntu</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="ex">-----END</span> SSH HOST KEY KEYS-----</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  127.899234] cloud-init<span class="pp">[</span><span class="ss">1714</span><span class="pp">]</span>: Cloud-init <span class="er">v.</span> <span class="ex">23.3.1-0ubuntu2</span> finished at Mon, 20 Nov 2023 23:21:04 +0000. Datasource DataSourceNoCloud [seed=/var/lib/cloud/seed/noc</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="ex">loud-net][dsmode=net].</span>  Up 127.87 seconds</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  OK  <span class="bu">]</span> <span class="ex">Finished</span> cloud-final.servi… Execute cloud user/final scripts.</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span>  OK  <span class="bu">]</span> <span class="ex">Reached</span> target cloud-init.target <span class="at">-</span> Cloud-init target.</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="ex">Ubuntu</span> 23.10 ubuntu ttyS0</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu</span> login: ubuntu</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="ex">Password:</span> </span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="ex">You</span> are required to change your password immediately <span class="er">(</span><span class="ex">administrator</span> enforced<span class="kw">)</span><span class="bu">.</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="ex">Changing</span> password for ubuntu.</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="ex">Current</span> password: </span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="ex">New</span> password: </span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="ex">Retype</span> new password: </span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="ex">Welcome</span> to Ubuntu 23.10 <span class="er">(</span><span class="ex">GNU/Linux</span> 6.5.0-9-generic riscv64<span class="kw">)</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="ex">....</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a><span class="ex">....</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a><span class="ex">....</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a><span class="ex">To</span> run a command as administrator <span class="er">(</span><span class="ex">user</span> <span class="st">&quot;root&quot;</span><span class="kw">)</span><span class="ex">,</span> use <span class="st">&quot;sudo &lt;command&gt;&quot;</span>.</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a><span class="ex">See</span> <span class="st">&quot;man sudo_root&quot;</span> for details.</span></code></pre></div>
<p>Now we will change the default boot option of Grub We will edit
<code>etc/default/grub</code></p>
<p>The default boot option is now <code>GRUB_DEFAULT=0</code> we will
change that to <code>GRUB_DEFAULT=2</code>. The boot options start
counting with 0, so we need option number 3 (That is 2).</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@ubuntu:~$</span> sudo nano /etc/default/grub</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># now change `GRUB_DEFAULT=0` to `GRUB_DEFAULT=2`</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># We will now update grub with the custom kernel and menuentry</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@ubuntu:~$</span> sudo update-grub</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Sourcing</span> file <span class="st">&#39;/etc/default/grub&#39;</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Sourcing</span> file <span class="st">&#39;/etc/default/grub.d/10_cmdline.cfg&#39;</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Sourcing</span> file <span class="st">&#39;/etc/default/grub.d/90_watchdog-thresh.cfg&#39;</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="ex">Generating</span> grub configuration file ...</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="ex">Found</span> linux image: /boot/vmlinuz-6.5.0-9-generic</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="ex">Found</span> initrd image: /boot/initrd.img-6.5.0-9-generic</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="ex">Found</span> linux image: /boot/vmlinuz-5.15.0-dirty</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="ex">Found</span> initrd image: /boot/initrd.img-5.15.0-dirty</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="ex">Warning:</span> os-prober will not be executed to detect other bootable partitions.</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="ex">Systems</span> on them will not be added to the GRUB boot configuration.</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="ex">Check</span> GRUB_DISABLE_OS_PROBER documentation entry.</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="ex">Adding</span> boot menu entry for UEFI Firmware Settings ...</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="co"># turn it off</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@ubuntu:~$</span> sudo halt</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="ex">Broadcast</span> message from root@ubuntu on pts/0 <span class="er">(</span><span class="ex">Tue</span> 2023-11-21 19:51:40 UTC<span class="kw">)</span><span class="bu">:</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a><span class="ex">The</span> system will halt now!</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@ubuntu:~$</span> [  366.522166] reboot: System halted</span></code></pre></div>
<p>Turn off the VisionFive2 and remove the CD-card.</p>
<h2 id="update-firmware-visionfive-2-to-3.8.2">Update firmware
VisionFive 2 to 3.8.2</h2>
<p>Now we need to update firmware of the board to the version of
VisionFive2.</p>
<p>I updated my board to <code>VisionFive2 Software v3.8.2</code></p>
<p>We will use the firmware from StarFive (with there
kernel-source-build 5.15.0-dirty) if you want to use an extenal GPU
without a crash within 1a10 minutes. We can not start a Ubuntu kernel
with the firmware of StarFive!</p>
<p>I didn’t get it working with the sdcard.img (like last times) to
flash my VisionFive 2, so I used tftp. I used the docker <a
target="_blank" href="https://hub.docker.com/r/pghalliday/tftp">image</a></p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cd ~/Downloads/SF2_2023_11_20</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker run <span class="at">-p</span> 0.0.0.0:69:69/udp <span class="at">-v</span> <span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span>:/var/tftpboot <span class="at">-i</span> <span class="at">-t</span> pghalliday/tftp</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Unable</span> to find image <span class="st">&#39;pghalliday/tftp:latest&#39;</span> locally</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="ex">latest:</span> Pulling from pghalliday/tftp</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="ex">fae91920dcd4:</span> Pull complete </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="ex">0bb6771b2292:</span> Pull complete </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Digest:</span> sha256:59f843a93d62ac6e2fa475ee3d1a3786464fe5ea0334e6f1ea79bdec837f09fa</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="ex">Status:</span> Downloaded newer image for pghalliday/tftp:latest</span></code></pre></div>
<p>Boot up your VisionFive 2 without a SD-card and the USB to TTL
connected (see <a
target="_blank" href="https://doc-en.rvspace.org/VisionFive2/PDF/VisionFive2_QSG.pdf">link</a>
for more information)</p>
<p>My machine (with docker) has ip-address 192.168.2.29 and I give my
VisionFive 2 the ip 192.168.2.222</p>
<p>This will be the commands (for the StarFive firmware):</p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set the ip of the VisionFive 2, and of the server (where docker is running)</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> setenv ipaddr 192.168.2.222<span class="kw">;</span> <span class="ex">setenv</span> serverip 192.168.2.29</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># test network</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ping 192.168.2.29</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize SPI Flash</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sf probe</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Download and Update SPL binary</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> tftpboot 0xa0000000 <span class="va">${serverip}</span>:u-boot-spl.bin.normal.out</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sf update 0xa0000000 0x0 <span class="va">$filesize</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Download and Update U-Boot binary</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> tftpboot 0xa0000000 <span class="va">${serverip}</span>:visionfive2_fw_payload.img</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sf update 0xa0000000 0x100000 <span class="va">$filesize</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="co"># We will not need to reset to default now!</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Save your changes</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> env save</span></code></pre></div>
<p>It will look something like this: (I hit a key to stop autoboot)</p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># open a (new console with) screen to the VisionFive 2</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> screen <span class="at">-L</span> /dev/ttyUSB0 115200</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># now turn on the VisionFive 2 and you will see that if boot.</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="ex">U-Boot</span> SPL 2023.10-2023.09.22-next-5d2fae79c7d6-0ubuntu1~ppa5 <span class="er">(</span><span class="ex">Oct</span> 13 2023 <span class="at">-</span> 13:25:02 +0000<span class="kw">)</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="ex">DDR</span> version: dc2e84f0.</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Trying</span> to boot from SPI</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="ex">U-Boot</span> 2023.10-2023.09.22-next-5d2fae79c7d6-0ubuntu1~ppa5 <span class="er">(</span><span class="ex">Oct</span> 13 2023 <span class="at">-</span> 13:25:02 +0000<span class="kw">)</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="ex">CPU:</span>   rv64imafdc_zba_zbb</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="ex">Model:</span> StarFive VisionFive 2 v1.3B</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="ex">DRAM:</span>  8 GiB</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="ex">Core:</span>  129 devices, 24 uclasses, devicetree: board</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="ex">MMC:</span>   mmc@16010000: 0, mmc@16020000: 1</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="ex">Loading</span> Environment from SPIFlash... SF: Detected gd25lq128 with page size 256 Bytes, erase size 4 KiB, total 16 MiB</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="ex">OK</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="ex">StarFive</span> EEPROM format v2</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a><span class="ex">--------EEPROM</span> INFO--------</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a><span class="ex">Vendor</span> : StarFive Technology Co., Ltd.</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a><span class="ex">Product</span> full SN: VF7110B1-2253-D008E000-00001648</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a><span class="ex">data</span> version: 0x2</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a><span class="ex">PCB</span> revision: 0xb2</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a><span class="ex">BOM</span> revision: A</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a><span class="ex">Ethernet</span> MAC0 address: 6c:cf:39:00:2a:e5</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a><span class="ex">Ethernet</span> MAC1 address: 6c:cf:39:00:2a:e6</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a><span class="ex">--------EEPROM</span> INFO--------</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a><span class="ex">In:</span>    serial@10000000</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a><span class="ex">Out:</span>   serial@10000000</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a><span class="ex">Err:</span>   serial@10000000</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a><span class="ex">Net:</span>   eth0: ethernet@16030000, eth1: ethernet@16040000</span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a><span class="ex">Working</span> FDT set to ff7309d0</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a><span class="ex">Hit</span> any key to stop autoboot:  0</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a><span class="ex">StarFive</span> <span class="co"># setenv ipaddr 192.168.2.222; setenv serverip 192.168.2.29</span></span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a><span class="ex">StarFive</span> <span class="co"># ping 192.168.2.29</span></span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a><span class="ex">ethernet@16030000</span> Waiting for PHY auto negotiation to complete....... done</span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a><span class="ex">Using</span> ethernet@16030000 device</span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a><span class="ex">host</span> 192.168.2.29 is alive</span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a><span class="ex">StarFive</span> <span class="co"># sf probe</span></span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a><span class="ex">SF:</span> Detected gd25lq128 with page size 256 Bytes, erase size 4 KiB, total 16 MiB</span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a><span class="ex">StarFive</span> <span class="co"># tftpboot 0xa0000000 ${serverip}:u-boot-spl.bin.normal.out</span></span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a><span class="ex">Using</span> ethernet@16030000 device</span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a><span class="ex">TFTP</span> from server 192.168.2.29<span class="kw">;</span> <span class="ex">our</span> IP address is 192.168.2.222</span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a><span class="ex">Filename</span> <span class="st">&#39;u-boot-spl.bin.normal.out&#39;</span>.</span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a><span class="ex">Load</span> address: 0xa0000000</span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a><span class="ex">Loading:</span> <span class="co">###########</span></span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a>         <span class="ex">1012.7</span> KiB/s</span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a><span class="ex">Bytes</span> transferred = 147336 <span class="er">(</span><span class="ex">23f88</span> hex<span class="kw">)</span></span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a><span class="ex">StarFive</span> <span class="co"># sf update 0xa0000000 0x0 $filesize</span></span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a><span class="ex">device</span> 0 offset 0x0, size 0x23f88</span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a><span class="ex">143360</span> bytes written, 3976 bytes skipped in 0.840s, speed 178970 B/s</span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true" tabindex="-1"></a><span class="ex">StarFive</span> <span class="co"># tftpboot 0xa0000000 ${serverip}:visionfive2_fw_payload.img</span></span>
<span id="cb27-56"><a href="#cb27-56" aria-hidden="true" tabindex="-1"></a><span class="ex">Using</span> ethernet@16030000 device</span>
<span id="cb27-57"><a href="#cb27-57" aria-hidden="true" tabindex="-1"></a><span class="ex">TFTP</span> from server 192.168.2.29<span class="kw">;</span> <span class="ex">our</span> IP address is 192.168.2.222</span>
<span id="cb27-58"><a href="#cb27-58" aria-hidden="true" tabindex="-1"></a><span class="ex">Filename</span> <span class="st">&#39;visionfive2_fw_payload.img&#39;</span>.</span>
<span id="cb27-59"><a href="#cb27-59" aria-hidden="true" tabindex="-1"></a><span class="ex">Load</span> address: 0xa0000000</span>
<span id="cb27-60"><a href="#cb27-60" aria-hidden="true" tabindex="-1"></a><span class="ex">Loading:</span> <span class="co">#################################################################</span></span>
<span id="cb27-61"><a href="#cb27-61" aria-hidden="true" tabindex="-1"></a>         <span class="co">#################################################################</span></span>
<span id="cb27-62"><a href="#cb27-62" aria-hidden="true" tabindex="-1"></a>         <span class="co">#################################################################</span></span>
<span id="cb27-63"><a href="#cb27-63" aria-hidden="true" tabindex="-1"></a>         <span class="co">###########</span></span>
<span id="cb27-64"><a href="#cb27-64" aria-hidden="true" tabindex="-1"></a>         <span class="ex">1</span> MiB/s</span>
<span id="cb27-65"><a href="#cb27-65" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span>
<span id="cb27-66"><a href="#cb27-66" aria-hidden="true" tabindex="-1"></a><span class="ex">Bytes</span> transferred = 3013797 <span class="er">(</span><span class="ex">2dfca5</span> hex<span class="kw">)</span></span>
<span id="cb27-67"><a href="#cb27-67" aria-hidden="true" tabindex="-1"></a><span class="ex">StarFive</span> <span class="co"># sf update 0xa0000000 0x100000 $filesize</span></span>
<span id="cb27-68"><a href="#cb27-68" aria-hidden="true" tabindex="-1"></a><span class="ex">device</span> 0 offset 0x100000, size 0x2dfca5</span>
<span id="cb27-69"><a href="#cb27-69" aria-hidden="true" tabindex="-1"></a><span class="ex">933888</span> bytes written, 2079909 bytes skipped in 8.149s, speed 378573 B/s</span>
<span id="cb27-70"><a href="#cb27-70" aria-hidden="true" tabindex="-1"></a><span class="ex">StarFive</span> <span class="co"># env save</span></span>
<span id="cb27-71"><a href="#cb27-71" aria-hidden="true" tabindex="-1"></a><span class="ex">Saving</span> Environment to SPIFlash... Erasing SPI flash...Writing to SPI flash...done</span>
<span id="cb27-72"><a href="#cb27-72" aria-hidden="true" tabindex="-1"></a><span class="ex">OK</span></span>
<span id="cb27-73"><a href="#cb27-73" aria-hidden="true" tabindex="-1"></a><span class="ex">StarFive</span> <span class="co">#</span></span></code></pre></div>
<p>Done!</p>
<p>You can turn off the VisionFive 2 again</p>
<h2 id="boot-visionfive-2-with-external-gpu">Boot Visionfive 2 with
external GPU</h2>
<p>Put the SD-card in the Visionfive 2.</p>
<p>We will start the Visionfive 2 with the external GPU.</p>
<p>We will use the USB to TTL to see that every thing is working!</p>
<div class="sourceCode" id="cb28"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> screen <span class="at">-L</span> /dev/ttyUSB0 115200</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># After boot up, login with ubuntu and your password</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># First update all the packages!</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@ubuntu:~$</span> sudo apt update</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># This takes some time</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@ubuntu:~$</span> sudo apt upgrade</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co"># after install updates ignore kernel warning! Restart some services</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co"># install KDE and some build tools</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@ubuntu:~$</span> sudo apt install sddm sddm-theme-breeze kde-standard build-essential libxml2 libcurl4-gnutls-dev neofetch ubuntu-dev-tools libopenal-dev libpng-dev libjpeg-dev libfreetype6-dev libfontconfig1-dev libcurl4-gnutls-dev libsdl2-dev zlib1g-dev libbz2-dev libedit-dev python-is-python3 m4 clang sddm-theme-breeze epiphany-browser minetest</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="ex">Service</span> restarts being deferred:                                               </span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a> <span class="ex">/etc/needrestart/restart.d/dbus.service</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a> <span class="ex">systemctl</span> restart systemd-logind.service</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a> <span class="ex">systemctl</span> restart unattended-upgrades.service</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a> <span class="ex">systemctl</span> restart wpa_supplicant.service</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="ex">No</span> containers need to be restarted.</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a><span class="ex">User</span> sessions running outdated binaries:</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a> <span class="ex">ubuntu</span> @ user manager service: systemd<span class="pp">[</span><span class="ss">882</span><span class="pp">]</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="ex">No</span> VM guests are running outdated hypervisor <span class="er">(</span><span class="ex">qemu</span><span class="kw">)</span> <span class="ex">binaries</span> on this host.</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@ubuntu:~$</span> sudo reboot</span></code></pre></div>
<p>Now KDE will startup after booting! Have fun!</p>
<h2 id="network">Network</h2>
<p>Fix network manager in KDE (so you can control network in KDE)</p>
<div class="sourceCode" id="cb29"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo nano /etc/netplan/01-network-manager-all.yaml</span></code></pre></div>
<div class="sourceCode" id="cb30"><pre
class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let NetworkManager manage all devices on this system</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">network</span><span class="kw">:</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="dv">2</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">renderer</span><span class="kw">:</span><span class="at"> NetworkManager</span></span></code></pre></div>
<p>Need reboot to get it working!</p>
<h2 id="screenshot">Screenshot!</h2>
<p>picture or it didn’t happen</p>
<p>ATI Radeon 5450:</p>
<figure>
<img
src="UbuntuATIRadeonR9_290/Screenshot_2023_11_20_ATI_Radeon_5450.png"
alt="Screenshot with ATI Radeon 5450" />
<figcaption aria-hidden="true">Screenshot with ATI Radeon
5450</figcaption>
</figure>
<p>ATI Radeon R9 290:</p>
<figure>
<img
src="UbuntuATIRadeonR9_290/Screenshot_2023_11_20_ATI_Radeon_R9_290.png"
alt="Screenshot with ATI Radeon R9 290" />
<figcaption aria-hidden="true">Screenshot with ATI Radeon R9
290</figcaption>
</figure></div>
            <div class="d-none d-xl-block col-xl-2 bd-toc">
               <ul class="section-nav">
                  <li class="toc-entry"><ul>
<li><a
href="#starfive-visionfive-2---ubuntu-23.10-external-gpu-ati-radeon-r9-290"
id="toc-starfive-visionfive-2---ubuntu-23.10-external-gpu-ati-radeon-r9-290">StarFive
VisionFive 2 - Ubuntu 23.10 external GPU ATI Radeon R9 290</a>
<ul>
<li><a href="#hardware" id="toc-hardware">Hardware</a></li>
<li><a href="#downloades" id="toc-downloades">Downloades</a></li>
<li><a href="#update-firmware-from-the-visionfive-2-to-ubuntu-firmware"
id="toc-update-firmware-from-the-visionfive-2-to-ubuntu-firmware">Update
firmware from the VisionFive 2 to Ubuntu firmware</a></li>
<li><a href="#create-the-sd-card" id="toc-create-the-sd-card">Create the
SD-card</a></li>
<li><a href="#fedora-install-packages"
id="toc-fedora-install-packages">Fedora install packages</a></li>
<li><a href="#building-the-linux-kernel"
id="toc-building-the-linux-kernel">Building the Linux Kernel</a></li>
<li><a href="#bootroot-copy-kernel"
id="toc-bootroot-copy-kernel">BOOT/ROOT Copy kernel</a></li>
<li><a href="#setup-ubuntu-with-ubuntu-kernel-and-firmware"
id="toc-setup-ubuntu-with-ubuntu-kernel-and-firmware">Setup Ubuntu with
ubuntu kernel and firmware</a></li>
<li><a href="#update-firmware-visionfive-2-to-3.8.2"
id="toc-update-firmware-visionfive-2-to-3.8.2">Update firmware
VisionFive 2 to 3.8.2</a></li>
<li><a href="#boot-visionfive-2-with-external-gpu"
id="toc-boot-visionfive-2-with-external-gpu">Boot Visionfive 2 with
external GPU</a></li>
<li><a href="#network" id="toc-network">Network</a></li>
<li><a href="#screenshot" id="toc-screenshot">Screenshot!</a></li>
</ul></li>
</ul></li>
               </ul>
            </div>
         </div>
               </div>
            <!-- Add comment hosting service here -->
            <!-- Footer -->
            <footer class="footer text-muted">
                <div align="center">
                   <!-- Update licences -->
                   Content is available under <a target="_blank" href="https://creativecommons.org/licenses/by-sa/3.0/" target="_blank" rel="noopener">CC BY-SA 3.0</a>
                   &nbsp;|&nbsp;
                   Sourcecode licensed under <a target="_blank" href="https://www.gnu.org/licenses/gpl-3.0.en.html" target="_blank" rel="noopener">GPL-3.0</a>
                   <br />
                   <!-- Please keep the following line -->
                   Built with <a target="_blank" href="https://www.pandoc.org" target="_blank" rel="noopener">Pandoc</a> 
                   using <a target="_blank" href="https://github.com/ashki23/pandoc-bootstrap" target="_blank" rel="noopener">pandoc-bootstrap</a> theme
                   <br />
                   <!-- Update copyright -->
                   Copyright, Bas Magr&eacute;
                </div>
             </footer>
             <!-- Add global site tag (gtag.js) and site analytics here -->
            <!-- JS, Popper.js, and jQuery -->
      <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
      <!-- Mathjax -->
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script>
         /* Bootstrap styles to tables */
         function bootstrapStylePandocTables() {
         $('tr.header').parent('thead').parent('table').addClass('table table-condensed'); }
         $(document).ready(function () { bootstrapStylePandocTables(); });
         /* Adjust the height when click the toc */
         var shiftWindow = function() { scrollBy(0, -60) };
         window.addEventListener("hashchange", shiftWindow);
         function load() { if (window.location.hash) shiftWindow(); }
      </script>
   </body>
</html>